<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="description" content="docs">
<meta name="generator" content="Paradox, paradox-material-theme=0.7.0, mkdocs-material=3.0.3">

<meta name="lang:clipboard.copy" content="Copy to clipboard">
<meta name="lang:clipboard.copied" content="Copied to clipboard">
<meta name="lang:search.language" content="">
<meta name="lang:search.pipeline.stopwords" content="true">
<meta name="lang:search.pipeline.trimmer" content="true">
<meta name="lang:search.result.none" content="No matching documents">
<meta name="lang:search.result.one" content="1 matching document">
<meta name="lang:search.result.other" content="# matching documents">
<meta name="lang:search.tokenizer" content="[\s\-]+">


<meta name="description" content="docs">
<link rel="shortcut icon" href="../assets/images/favicon.png">
<title>Auth Components Â· TMT JavaScript/Typescript Library</title>
<link rel="stylesheet" href="../assets/stylesheets/application.451f80e5.css">
<link rel="stylesheet" href="../lib/material__tabs/dist/mdc.tabs.min.css">
<link rel="stylesheet" href="../lib/prettify/prettify.css">
<script src="../assets/javascripts/modernizr.1aa3b519.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
<style>
body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}
code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}
</style>
<link rel="stylesheet" href="../assets/fonts/font-awesome.css">
<link rel="stylesheet" href="../assets/fonts/material-icons.css">
<link rel="stylesheet" href="../assets/stylesheets/paradox-material-theme.css">
</head>
<body
>
<input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
<input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
<label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
<header class="md-header" data-md-component="header">
<nav class="md-header-nav md-grid">
<div class="md-flex">
<div class="md-flex__cell md-flex__cell--shrink">
<a href="../index.html" title="TMT JavaScript/Typescript Library" class="md-header-nav__button md-logo">
<i class="md-icon">local_library</i>
</a>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
</div>
<div class="md-flex__cell md-flex__cell--stretch">
<div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
<span class="md-header-nav__topic">
TMT JavaScript/Typescript Library
</span>
<span class="md-header-nav__topic">
Auth Components
</span>
</div>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
<label class="md-icon md-search__icon" for="__search"></label>
<button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">&#xE5CD;</button>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix>
<div class="md-search-result" data-md-component="result">
<div class="md-search-result__meta">
Type to start searching
</div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>

</div>
</div>
</nav>
</header>

<div class="md-container">
<main class="md-main">
<div class="md-main__inner md-grid" data-md-component="container">
<div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--primary" data-md-level="0" style="visibility: hidden">
<label class="md-nav__title md-nav__title--site" for="drawer">
<a href="../index.html" title="TMT JavaScript/Typescript Library" class="md-nav__button md-logo">
<span class="md-nav__button md-logo">
<i class="md-icon">local_library</i>
</a>
<a href="../index.html" title="TMT JavaScript/Typescript Library">
TMT JavaScript/Typescript Library
</a>
</label>
<ul>
  <li><a href="../UIOverview.html" class="page">User Interfaces in ESW and TMT</a></li>
  <li><a href="../common/getting-started.html" class="page">Getting Started with ESW-TS</a></li>
  <li><a href="../params/index.html" class="page">Params</a>
  <ul>
    <li><a href="../params/commands.html" class="page">Commands</a></li>
    <li><a href="../params/events.html" class="page">Events</a></li>
    <li><a href="../params/keys-and-parameters.html" class="page">Keys and Parameters</a></li>
    <li><a href="../params/result.html" class="page">Result</a></li>
    <li><a href="../params/subsystem.html" class="page">Subsystem</a></li>
    <li><a href="../params/state-variables.html" class="page">State variables</a></li>
    <li><a href="../params/units.html" class="page">Units</a></li>
  </ul></li>
  <li><a href="../aas/auth-components.html" class="page">Auth Components</a></li>
  <li><a href="../common/response-handling.html" class="page">Response Handling in ESW-TS</a></li>
  <li><a href="../common/error-handling.html" class="page">Error Handling in ESW-TS</a></li>
  <li><a href="../services/index.html" class="page">Services</a>
  <ul>
    <li><a href="../services/admin-service.html" class="page">Admin Service</a></li>
    <li><a href="../services/alarm-service.html" class="page">Alarm Service</a></li>
    <li><a href="../services/command-service.html" class="page">Command Service</a></li>
    <li><a href="../services/config-service.html" class="page">Config Service</a></li>
    <li><a href="../services/event-service.html" class="page">Event Service</a></li>
    <li><a href="../services/location-service.html" class="page">Location Service</a></li>
    <li><a href="../services/logging-service.html" class="page">Logging Service</a></li>
  </ul></li>
  <li><a href="../technical/index.html" class="page">Technical Design Documentation</a>
  <ul>
    <li><a href="../technical/agent-service.html" class="page">Agent Service</a></li>
    <li><a href="../technical/sequencer-service.html" class="page">Sequencer Service</a></li>
    <li><a href="../technical/sequence-manager-service.html" class="page">Sequence Manager Service</a></li>
    <li><a href="../technical/auth-components.html" class="active page">Auth Components</a></li>
    <li><a href="../common/contract.html" class="page">Service Contract</a></li>
  </ul></li>
  <li><a href="../common/ts-docs.html" class="page">Type Definitions</a></li>
</ul>
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../technical/auth-components.html#auth-components" class="header">Auth Components</a>
  <ul>
    <li><a href="../technical/auth-components.html#implementation" class="header">Implementation</a></li>
    <li><a href="../technical/auth-components.html#keycloak" class="header">Keycloak</a></li>
    <li><a href="../technical/auth-components.html#working-of-auth-components" class="header">Working of Auth Components</a></li>
  </ul></li>
</ul>
</nav>

</nav>
<ul style="display: none">
<li class="md-nav__item md-version" id="project.version">
<label class="md-nav__link" for="__version">
<i class="md-icon" title="Version">label_outline</i> 0.6.0-M1
</label>
</li>
</ul>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../technical/auth-components.html#auth-components" class="header">Auth Components</a>
  <ul>
    <li><a href="../technical/auth-components.html#implementation" class="header">Implementation</a></li>
    <li><a href="../technical/auth-components.html#keycloak" class="header">Keycloak</a></li>
    <li><a href="../technical/auth-components.html#working-of-auth-components" class="header">Working of Auth Components</a></li>
  </ul></li>
</ul>
</nav>

</div>
</div>
</div>
<div class="md-content">
<article class="md-content__inner md-typeset">
<div class="md-content__searchable">
<h1><a href="#auth-components" name="auth-components" class="anchor"><span class="anchor-link"></span></a>Auth Components</h1>
<p><code>esw-ts</code> exposes react components to enable authentication and authorization. It is built in TypeScript on top of <a href="https://www.keycloak.org/guides.html#securing-apps">keycloak-js</a> which is JavaScript adapter provided by Keycloak.</p>
<p><em>Note: The Keycloak JavaScript adapters have been deprecated and removed after Keycloak-25.x, which we are still using. Before upgrading to newer versions of Keycloak, the code based on these adapters will need to be rewritten.</em></p>
<h2><a href="#implementation" name="implementation" class="anchor"><span class="anchor-link"></span></a>Implementation</h2>
<p>Core implementation of Auth Components of <code>ESW-TS</code>, uses</p>
<ul>
  <li><a href="https://www.keycloak.org/guides.html#securing-apps">keycloak-js</a> - keycloak JavaScript adapter (Note: Deprecated/removed after Keycloak-25.x)</li>
  <li><a href="https://react.dev/">React</a> - JavaScript library for building user interfaces</li>
  <li><a href="https://www.typescriptlang.org/">Typescript</a> - Types superset of JavaScript which compiles to JavaScript</li>
  <li><a href="https://tmtsoftware.github.io/csw/6.0.0-M3/services/location">csw-location-service</a> - resolve keycloak using Location Service HTTP endpoint</li>
</ul>
<h2><a href="#keycloak" name="keycloak" class="anchor"><span class="anchor-link"></span></a>Keycloak</h2>
<p>In order for web application utilize keycloak following steps are needed:</p>
<ul>
  <li>
  <p>Registered web application as a public keycloak client Please refer to <a href="https://www.keycloak.org/getting-started/getting-started-zip">keycloak documentation</a> for details.</p></li>
  <li>
  <p>Create new Keycloak client instance This instantiation expects config which includes keycloak server URL and some application specific config like <code>realm</code> and <code>clientId</code>. Auth Service uses CSW Location Service to resolve keycloak server.</p></li>
</ul>
<p>See, how to configure realm &amp; client-id <a href="../common/getting-started.html#ui-app-configuration-for-esw-ts">here</a></p>
<ul>
  <li>To call secure end point, web application first needs to be authenticated using keycloak server. There are two options to make this adapter automatically authenticate - <code>login-required</code> and <code>check-sso</code>. <code>login-required</code> will automatically authenticate if the user is already logged-in, otherwise it will display keycloak login page. <code>check-sso</code> will only authenticate if the user is already logged-in. If the user is not logged-in the browser will be redirected back to the application and remain unauthenticated.</li>
</ul>
<p>Auth components of <code>ESW-TS</code> use <code>check-sso</code> to instantiate keycloak. It shows secure components if user is already logged in. If user is not authenticated then Login component gets rendered. If user clicks on login button, it instantiates keycloak using <code>login-required</code>. This redirects user to keycloak login page. As access token has very short life span, at time of keycloak instantiation, these Auth Components also add hooks to refresh token. This gives seamless user experience as user will not have to login again.</p>
<p>Keycloak adapter supports three authorization flows e.g. authorization code flow, implicit flow and hybrid flow. Auth components in <code>ESW-TS</code>, uses hybrid flow as it has better performance than authorization code flow and unlike implicit flow, hybrid flow makes refresh token available to application. For more information please refer <a href="https://www.keycloak.org/guides.html#securing-apps">keycloak documentaion for authorization flows</a>.</p>
<h2><a href="#working-of-auth-components" name="working-of-auth-components" class="anchor"><span class="anchor-link"></span></a>Working of Auth Components</h2>
<p>When user opens Web application in the browser:</p>
<ul>
  <li>
  <p><code>AuthContextProvider</code> component gets mounted. Which does instantiation of keycloak client and initialize keycloak JavaScript adapter with <code>check-sso</code> and <code>hybrid</code> authorization flow.</p></li>
  <li>
  <p>It also creates hooks for refreshing token, and when token expires it silently refreshes token resulting seamless user experience once logged in.</p></li>
  <li>
  <p>After authentication is done via keycloak JavaScript adapter, <code>AuthContext</code> is extracted in domain model and this data is passed down the component tree using React Context API.</p></li>
  <li>
  <p><code>AuthContext</code> gives handle to token, realm and resource roles, <code>userInfo</code>. Any component which want to use this information can become consumer of <code>AuthContext</code>.</p></li>
</ul>
<p>For example:</p>
<dl>
  <dt>Typescript</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/esw-ts/tree/master/example/src/components/config/context/ConfigServiceProvider.tsx#L16" target="_blank" title="Go to snippet source">source</a><code class="language-tsx">const { auth } = useContext(authContext)</code></pre></dd>
</dl>
<p>Access token can be extracted from <code>auth</code> and it can be sent in <code>Authorization</code> header for calling secure API.</p>
<p>For example:</p>
<pre class="prettyprint"><code class="language-typescript">const SampleComponent = () =&gt; {

    const url = &#39;http://localhost:8080/secure-restful-service&#39;;
    const auth = useContext(AuthContext) //AuthContext from esw-ts

    const req = new XMLHttpRequest();
    req.open(&#39;GET&#39;, url, true);
    req.setRequestHeader(&#39;Accept&#39;, &#39;application/json&#39;);

    //extract token from auth context and set Authorization header
    req.setRequestHeader(&#39;Authorization&#39;, &#39;Bearer &#39; + auth.token);

    req.onreadystatechange = function () {
        if (req.readyState == 4) {
            if (req.status == 200) {
                alert(&#39;Success&#39;);
            } else if (req.status == 403) {
                alert(&#39;Forbidden&#39;);
            }
        }
    }

    req.send();
};
</code></pre>
<p>The following diagram explains JavaScript application flow for making request to secure HTTP API:</p>
<p><img src="../assets/javascript-app-workflow.png" alt="javascript-app-flow" /></p>
<ul>
  <li>
  <p>When user opens Web application in the browser, csw-aas-js checks if user is already logged in using <code>check-sso</code> mode.</p></li>
  <li>
  <p>If user is not logged in then <code>Login</code> button is shown.</p></li>
  <li>
  <p>When user clicks on &ldquo;login&rdquo;, user will be redirected to keyclok login page.</p></li>
  <li>
  <p>This completes authentication process. Once authentication is done, <code>AuthContextProvider</code> extracts <code>AuthContext</code> domain model and make it available to consumers of <code>AuthContext</code>.</p></li>
  <li>
  <p>Protected react components can be shown based on information in <code>AuthContext</code>.</p></li>
  <li>
  <p>For example, <code>CreateConfig</code> component can be shown only to users having <code>config admin</code> role. After the user is authenticated the application can make requests to RESTful services secured by Keycloak by including the bearer token in the <code>Authorization</code> header.</p></li>
  <li>
  <p>This completes workflow for web application calling secure HTTP endpoint.</p></li>
</ul>
</div>
<div>
<a href="https://github.com/tmtsoftware/esw-ts/tree/master/docs/src/main/technical/auth-components.md" title="Edit this page" class="md-source-file md-edit">
Edit this page
</a>
</div>
<div class="print-only">
<span class="md-source-file md-version">
0.6.0-M1
</span>
</div>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-nav">
<nav class="md-footer-nav__inner md-grid">
<a href="../technical/sequence-manager-service.html" title="Sequence Manager Service" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
</div>
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Previous
</span>
Sequence Manager Service
</span>
</div>
</a>
<a href="../common/contract.html" title="Service Contract" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Next
</span>
Service Contract
</span>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
</div>
</a>
</nav>
</div>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
Powered by
<a href="https://github.com/lightbend/paradox">Paradox</a>
and
<a href="https://jonas.github.io/paradox-material-theme/">Paradox Material Theme</a>

</div>
</div>
</div>
</footer>

</div>
<script src="../assets/javascripts/application.583bbe55.js"></script>
<script src="../assets/javascripts/paradox-material-theme.js"></script>
<script>app.initialize({version:"0.17",url:{base:"../."}})</script>
<script type="text/javascript" src="../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function(event) {
window.prettyPrint && prettyPrint();
});
</script>
</body>
</html>
