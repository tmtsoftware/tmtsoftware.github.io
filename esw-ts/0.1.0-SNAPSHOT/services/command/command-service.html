<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="description" content="docs">
<meta name="generator" content="Paradox, paradox-material-theme=0.7.0, mkdocs-material=3.0.3">

<meta name="lang:clipboard.copy" content="Copy to clipboard">
<meta name="lang:clipboard.copied" content="Copied to clipboard">
<meta name="lang:search.language" content="">
<meta name="lang:search.pipeline.stopwords" content="true">
<meta name="lang:search.pipeline.trimmer" content="true">
<meta name="lang:search.result.none" content="No matching documents">
<meta name="lang:search.result.one" content="1 matching document">
<meta name="lang:search.result.other" content="# matching documents">
<meta name="lang:search.tokenizer" content="[\s\-]+">


<meta name="description" content="docs">
<link rel="shortcut icon" href="../../assets/images/favicon.png">
<title>Command Service · TMT JavaScript/Typescript Library</title>
<link rel="stylesheet" href="../../assets/stylesheets/application.451f80e5.css">
<link rel="stylesheet" href="../../lib/material__tabs/dist/mdc.tabs.min.css">
<link rel="stylesheet" href="../../lib/prettify/prettify.css">
<script src="../../assets/javascripts/modernizr.1aa3b519.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
<style>
body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}
code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}
</style>
<link rel="stylesheet" href="../../assets/fonts/font-awesome.css">
<link rel="stylesheet" href="../../assets/fonts/material-icons.css">
<link rel="stylesheet" href="../../assets/stylesheets/paradox-material-theme.css">
</head>
<body
>
<input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
<input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
<label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
<header class="md-header" data-md-component="header">
<nav class="md-header-nav md-grid">
<div class="md-flex">
<div class="md-flex__cell md-flex__cell--shrink">
<a href="../../index.html" title="TMT JavaScript/Typescript Library" class="md-header-nav__button md-logo">
<i class="md-icon">local_library</i>
</a>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
</div>
<div class="md-flex__cell md-flex__cell--stretch">
<div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
<span class="md-header-nav__topic">
TMT JavaScript/Typescript Library
</span>
<span class="md-header-nav__topic">
Command Service
</span>
</div>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
<label class="md-icon md-search__icon" for="__search"></label>
<button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">&#xE5CD;</button>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix>
<div class="md-search-result" data-md-component="result">
<div class="md-search-result__meta">
Type to start searching
</div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>

</div>
</div>
</nav>
</header>

<div class="md-container">
<main class="md-main">
<div class="md-main__inner md-grid" data-md-component="container">
<div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--primary" data-md-level="0" style="visibility: hidden">
<label class="md-nav__title md-nav__title--site" for="drawer">
<a href="../../index.html" title="TMT JavaScript/Typescript Library" class="md-nav__button md-logo">
<span class="md-nav__button md-logo">
<i class="md-icon">local_library</i>
</a>
<a href="../../index.html" title="TMT JavaScript/Typescript Library">
TMT JavaScript/Typescript Library
</a>
</label>
<ul>
  <li><a href="../../common/getting-started.html" class="page">Getting Started</a></li>
  <li><a href="../../services/index.html" class="page">Services</a>
  <ul>
    <li><a href="../../services/admin/admin-service.html" class="page">Admin Service</a></li>
    <li><a href="../../services/alarm/alarm-service.html" class="page">Alarm Service</a></li>
    <li><a href="../../services/command/command-service.html" class="active page">Command Service</a></li>
    <li><a href="../../services/config/config-service.html" class="page">Config Service</a></li>
    <li><a href="../../services/event/event-service.html" class="page">Event Service</a></li>
    <li><a href="../../services/location/location-service.html" class="page">Location Service</a></li>
    <li><a href="../../services/logging-service/logging-service.html" class="page">Logging Service</a></li>
    <li><a href="../../services/sequencer/sequencer-service.html" class="page">Sequencer Service</a></li>
  </ul></li>
  <li><a href="../../params/index.html" class="page">Params</a>
  <ul>
    <li><a href="../../params/commands.html" class="page">Commands</a></li>
    <li><a href="../../params/events.html" class="page">Events</a></li>
    <li><a href="../../params/keys-and-parameters.html" class="page">Keys and Parameters</a></li>
    <li><a href="../../params/result.html" class="page">Result</a></li>
    <li><a href="../../params/subsystem.html" class="page">Subsystem</a></li>
    <li><a href="../../params/state-variables.html" class="page">State variables</a></li>
    <li><a href="../../params/units.html" class="page">Units</a></li>
  </ul></li>
  <li><a href="../../aas/csw-aas-js.html" class="page">Javascript Adapter (csw-aas-js)</a></li>
  <li><a href="../../common/contract.html" class="page">Service Contract</a></li>
  <li><a href="../../common/response-handling.html" class="page">Response Handling</a></li>
  <li><a href="../../common/error-handling.html" class="page">Error Handling</a></li>
  <li><a href="../../technical/index.html" class="page">Technical Design Documentation</a>
  <ul>
    <li><a href="../../services/agent-service/agent-service.html" class="page">Agent Service</a></li>
    <li><a href="../../services/sequence-manager/sequence-manager-service.html" class="page">Sequence Manager Service</a></li>
    <li><a href="../../technical/csw-aas-js.html" class="page">csw-aas-js - Javascript adapter</a></li>
  </ul></li>
  <li><a href="../../common/ts-docs.html" class="page">Type Definations</a></li>
</ul>
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../../services/command/command-service.html#command-service" class="header">Command Service</a>
  <ul>
    <li><a href="../../services/command/command-service.html#creation-of-command-service" class="header">Creation of Command Service</a></li>
    <li><a href="../../services/command/command-service.html#type-of-actions" class="header">Type of Actions</a></li>
    <li><a href="../../services/command/command-service.html#control-commands" class="header">Control Commands</a></li>
    <li><a href="../../services/command/command-service.html#usages-of-command-service" class="header">Usages of Command Service</a></li>
  </ul></li>
</ul>
</nav>

</nav>
<ul style="display: none">
<li class="md-nav__item md-version" id="project.version">
<label class="md-nav__link" for="__version">
<i class="md-icon" title="Version">label_outline</i> 0.1.0*
</label>
</li>
</ul>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../../services/command/command-service.html#command-service" class="header">Command Service</a>
  <ul>
    <li><a href="../../services/command/command-service.html#creation-of-command-service" class="header">Creation of Command Service</a></li>
    <li><a href="../../services/command/command-service.html#type-of-actions" class="header">Type of Actions</a></li>
    <li><a href="../../services/command/command-service.html#control-commands" class="header">Control Commands</a></li>
    <li><a href="../../services/command/command-service.html#usages-of-command-service" class="header">Usages of Command Service</a></li>
  </ul></li>
</ul>
</nav>

</div>
</div>
</div>
<div class="md-content">
<article class="md-content__inner md-typeset">
<div class="md-content__searchable">
<h1><a href="#command-service" name="command-service" class="anchor"><span class="anchor-link"></span></a>Command Service</h1>
<p>Command Service provides a handle to send commands to a component which is registered in location service.</p>
<h2><a href="#creation-of-command-service" name="creation-of-command-service" class="anchor"><span class="anchor-link"></span></a>Creation of Command Service</h2>
<h3><a href="#pre-requisite" name="pre-requisite" class="anchor"><span class="anchor-link"></span></a>Pre-requisite</h3>
<h3><a href="#in-order-to-use-command-service-for-a-specific-component-" name="in-order-to-use-command-service-for-a-specific-component-" class="anchor"><span class="anchor-link"></span></a>In order to use command service for a specific component:</h3>
<ol>
  <li>The component needs to be up and running behind the gateway server. <code>GatewayException(InvalidComponent)</code> will be thrown if the specified component is not found.</li>
  <li>Authorization Token with correct access role.  Documentation on how to fetch access token could be found <a href="../../aas/csw-aas-js.html">here</a>.</li>
</ol>
<p>For the given example : <code>Prefix(ESW.Component1)</code> needs to be registered in the location service as any of the component type (<code>HCD</code>, <code>Assembly</code>, etc.).</p>
<h3><a href="#to-create-command-service-client-for-a-component" name="to-create-command-service-client-for-a-component" class="anchor"><span class="anchor-link"></span></a>To create Command service client for a component</h3>
<dl>
  <dt>Typescript</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/esw-ts/tree/master/example/src/documentation/command/CommandExamples.ts#L24-L29" target="_blank" title="Go to snippet source"></a><code class="language-ts">const tokenFactory = () =&gt; auth.token

const commandService: CommandService = await CommandService(
  new ComponentId(new Prefix(&#39;ESW&#39;, &#39;Component1&#39;), &#39;HCD&#39;),
  tokenFactory
)</code></pre></dd>
</dl>
<h2><a href="#type-of-actions" name="type-of-actions" class="anchor"><span class="anchor-link"></span></a>Type of Actions</h2>
<p>Whenever a command gets submitted to a component, it results into in either <code>Immediate completion</code> or <code>Long Running action</code>.</p>
<h3><a href="#immediate-completion" name="immediate-completion" class="anchor"><span class="anchor-link"></span></a>Immediate completion</h3>
<p>If the actions of the submit or submitAndWait command take a very short time to complete, it is referred as Immediate completion. the actions are successful, if the Completed SubmitResponse is returned. If there is a result, the Completed is returned with a parameter set of Result type that can be inspected by the caller.</p>
<h3><a href="#long-running-actions" name="long-running-actions" class="anchor"><span class="anchor-link"></span></a>Long running Actions</h3>
<p>When actions take longer than 1 second and the Component returns the Started SubmitResponse. The Started response indicates to the framework that long-running actions have been started.</p>
<h2><a href="#control-commands" name="control-commands" class="anchor"><span class="anchor-link"></span></a>Control Commands</h2>
<p>In order to call following API, one of the control command needs to be sent. Depending on your use case, you will be sending either Setup or Observe Command.</p>
<p>Following examples show how to create control commands:</p>
<dl>
  <dt>Typescript</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/esw-ts/tree/master/example/src/documentation/command/CommandExamples.ts#L33-L50" target="_blank" title="Go to snippet source"></a><code class="language-ts">// Definition of control command looks like following
type ControlCommand = Setup | Observe

// examples
const setupCommand: Setup = new Setup(
  new Prefix(&#39;ESW&#39;, &#39;Component1&#39;),
  &#39;move-command&#39;,
  paramSet,
  &#39;obs-id&#39;
)

const observeCommand: Observe = new Observe(
  new Prefix(&#39;ESW&#39;, &#39;Component1&#39;),
  &#39;c1&#39;,
  paramSet,
  &#39;obs-id&#39;
)
</code></pre></dd>
</dl><div class="callout note "><div class="callout-title">Async-Await</div>
<p>Note that the examples are using async/await which makes handling of promises more readable.</p></div>
<h2><a href="#usages-of-command-service" name="usages-of-command-service" class="anchor"><span class="anchor-link"></span></a>Usages of Command Service</h2>
<p>Type definitions of all Command Service APIs can be found <a href="https://tmtsoftware.github.io/esw-ts/0.1.0-SNAPSHOT/ts-docs/interfaces/clients.commandservice.html">here</a></p>
<h3><a href="#validating-command" name="validating-command" class="anchor"><span class="anchor-link"></span></a>Validating Command</h3>
<p>A validate message is used to ask a destination component to validate a command and determine if the command can be executed. It does not execute the command and only returns the result of validation. In some scenarios, it may be useful to test to see if a command can be executed prior to trying to execute the command.</p>
<dl>
  <dt>Typescript</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/esw-ts/tree/master/example/src/documentation/command/CommandExamples.ts#L54-L62" target="_blank" title="Go to snippet source"></a><code class="language-ts"><br/>const validateResponse1: ValidateResponse = await commandService.validate(
  setupCommand
)
// or
const validateResponse2: ValidateResponse = await commandService.validate(
  observeCommand
)
</code></pre></dd>
</dl>
<h3><a href="#submitting-a-command" name="submitting-a-command" class="anchor"><span class="anchor-link"></span></a>Submitting a Command</h3>
<p>A submit message can be used when the sender of a command needs to do additional work before long-running actions are completed. For instance, send another command to execute in parallel. If commands are short, submit and submitAndWait behave the same way. When the actions started by submit are long-running, the caller can wait for the actions to complete if needed using the <a href="#queryfinal">queryFinal</a> call.</p>
<dl>
  <dt>Typescript</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/esw-ts/tree/master/example/src/documentation/command/CommandExamples.ts#L66-L73" target="_blank" title="Go to snippet source"></a><code class="language-ts">const submitResponse1: SubmitResponse = await commandService.submit(
  setupCommand
)
// or
const submitResponse2: SubmitResponse = await commandService.submit(
  observeCommand
)
</code></pre></dd>
</dl>
<h3><a href="#submitandwait" name="submitandwait" class="anchor"><span class="anchor-link"></span></a>SubmitAndWait</h3>
<p>This is a convenience method which sends a <a href="#submit">submit</a> message and then, if the command is long-running, it waits for final completion. Sending a submit message with a command returns a <a href="https://tmtsoftware.github.io/esw-ts/0.1.0-SNAPSHOT/ts-docs/modules/models.html#submitresponse">SubmitResponse</a> as a Future.</p>
<dl>
  <dt>Typescript</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/esw-ts/tree/master/example/src/documentation/command/CommandExamples.ts#L134-L139" target="_blank" title="Go to snippet source"></a><code class="language-ts">// Submit a long running command and wait for the result for specific time

const submitAndWaitResponse: SubmitResponse = await commandService.submitAndWait(
  setupCommand,
  10
)</code></pre></dd>
</dl>
<h3><a href="#submitallandwait" name="submitallandwait" class="anchor"><span class="anchor-link"></span></a>SubmitAllAndWait</h3>
<p>Similar to <a href="#submitandwait">SubmitAndWait</a>, submitAllAndWait can be used to send multiple commands sequentially to the same component. This could be used to send initialization commands to an HCD, for instance. The argument for submitAllAndWait is a list of commands. submitAllAndWait returns a list of SubmitResponses – one for each command in the list.</p>
<dl>
  <dt>Typescript</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/esw-ts/tree/master/example/src/documentation/command/CommandExamples.ts#L143-L148" target="_blank" title="Go to snippet source"></a><code class="language-ts">// Submit multiple commands and wait for the result of each submitted command for specific time

const submitAllAndWaitResponse: SubmitResponse[] = await commandService.submitAllAndWait(
  [setupCommand, observeCommand],
  10
)</code></pre></dd>
</dl>
<h3><a href="#oneway" name="oneway" class="anchor"><span class="anchor-link"></span></a>Oneway</h3>
<p>Oneway is useful when Command Service needs to send commands to an HCD as quickly as possible. The command is validated on the destination and the validation response is returned, but no other responses are provided.</p>
<dl>
  <dt>Typescript</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/esw-ts/tree/master/example/src/documentation/command/CommandExamples.ts#L77-L84" target="_blank" title="Go to snippet source"></a><code class="language-ts">const onewayResponse1: OnewayResponse = await commandService.oneway(
  setupCommand
)
// or
const onewayResponse2: OnewayResponse = await commandService.oneway(
  observeCommand
)
</code></pre></dd>
</dl>
<h3><a href="#query" name="query" class="anchor"><span class="anchor-link"></span></a>Query</h3>
<p>If a submitted command returns a <code>Started</code> response indicating it has long-running actions, and the caller needs to determine that the actions have started properly, or wishes to poll the destination component for the final response, the query method of CommandService can be used.</p>
<dl>
  <dt>Typescript</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/esw-ts/tree/master/example/src/documentation/command/CommandExamples.ts#L88-L94" target="_blank" title="Go to snippet source"></a><code class="language-ts">// Submit a long running command
const res: SubmitResponse = await commandService.submit(setupCommand)
// .
// .
// .
// Get the current result of long running command as :
const queryResponse: SubmitResponse = await commandService.query(res.runId)</code></pre></dd>
</dl>
<h3><a href="#queryfinal" name="queryfinal" class="anchor"><span class="anchor-link"></span></a>QueryFinal</h3>
<p>Like <a href="#query">query</a>, queryFinal uses the Id returned by Started. But in this case, rather than returning immediately like query, it waits and only returns when the final SubmitResponse is sent. queryFinal is used exclusively with submit in the case where some other activity must be done before the actions started by the submit complete.</p>
<dl>
  <dt>Typescript</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/esw-ts/tree/master/example/src/documentation/command/CommandExamples.ts#L98-L107" target="_blank" title="Go to snippet source"></a><code class="language-ts">// Submit a long running command
const result: SubmitResponse = await commandService.submit(setupCommand)
// .
// .
// .
// Get the final result of long running command within 10 seconds :
const queryFinalResponse: SubmitResponse = await commandService.queryFinal(
  result.runId,
  10
)</code></pre></dd>
</dl>
<h3><a href="#subscribecurrentstate" name="subscribecurrentstate" class="anchor"><span class="anchor-link"></span></a>SubscribeCurrentState</h3>
<p>This method can be used to subscribe to the <a href="https://tmtsoftware.github.io/esw-ts/0.1.0-SNAPSHOT/ts-docs/classes/models.currentstate.html">CurrentState</a> of a component by providing a callback that is called with the arrival of every CurrentState item.</p>
<dl>
  <dt>Typescript</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/esw-ts/tree/master/example/src/documentation/command/CommandExamples.ts#L111-L130" target="_blank" title="Go to snippet source"></a><code class="language-ts">// subscribe to this set of current states
const currentStates = new Set([&#39;stateName1&#39;, &#39;stateName2&#39;])

// this callback gets called whenever the state changes
const onStateChangeCallback = (currentState: CurrentState) =&gt; {
  // do something when state changes
  console.log(&#39;changed state:&#39;, currentState)
}

// subscribe call
const subscription: Subscription = await commandService.subscribeCurrentState(
  currentStates
)(onStateChangeCallback)

// .
// .
// .
// subscription can be cancelled when it is not required any more
subscription.cancel()
</code></pre></dd>
</dl>
</div>
<div>
<a href="https://github.com/tmtsoftware/esw-ts/tree/master/docs/src/main/services/command/command-service.md" title="Edit this page" class="md-source-file md-edit">
Edit this page
</a>
</div>
<div class="print-only">
<span class="md-source-file md-version">
0.1.0*
</span>
</div>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-nav">
<nav class="md-footer-nav__inner md-grid">
<a href="../../services/alarm/alarm-service.html" title="Alarm Service" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
</div>
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Previous
</span>
Alarm Service
</span>
</div>
</a>
<a href="../../services/config/config-service.html" title="Config Service" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Next
</span>
Config Service
</span>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
</div>
</a>
</nav>
</div>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
Powered by
<a href="https://github.com/lightbend/paradox">Paradox</a>
and
<a href="https://jonas.github.io/paradox-material-theme/">Paradox Material Theme</a>

</div>
</div>
</div>
</footer>

</div>
<script src="../../assets/javascripts/application.583bbe55.js"></script>
<script src="../../assets/javascripts/paradox-material-theme.js"></script>
<script>app.initialize({version:"0.17",url:{base:"../../."}})</script>
<script type="text/javascript" src="../../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function(event) {
window.prettyPrint && prettyPrint();
});
</script>
</body>
</html>
