<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="description" content="docs">
<meta name="generator" content="Paradox, paradox-material-theme=0.4.0, mkdocs-material=2.2.2">

<meta name="lang:clipboard.copy" content="Copy to clipboard">
<meta name="lang:clipboard.copied" content="Copied to clipboard">
<meta name="lang:search.result.none" content="No matching documents">
<meta name="lang:search.result.one" content="1 matching document">
<meta name="lang:search.result.other" content="# matching documents">
<meta name="lang:search.language" content="">
<meta name="lang:search.tokenizer" content="[\s\-]+">


<meta name="description" content="docs">
<link rel="shortcut icon" href="../assets/tmt_favicon.ico">
<title>Events Â· TMT Common Software (CSW)</title>
<link rel="stylesheet" href="../assets/stylesheets/application.7a4cdee3.css">
<link rel="stylesheet" href="../lib/material__tabs/dist/mdc.tabs.min.css">
<link rel="stylesheet" href="../lib/prettify/prettify.css">
<script src="../lib/modernizr/modernizr.min.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
<style>
body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}
code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}
</style>
<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="../assets/stylesheets/paradox-material-theme.css">
</head>
<body
>
<input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
<input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
<label class="md-overlay" data-md-component="overlay" for="drawer"></label>
<header class="md-header" data-md-component="header">
<nav class="md-header-nav md-grid">
<div class="md-flex">
<div class="md-flex__cell md-flex__cell--shrink">
<a href="../index.html" title="TMT Common Software (CSW)" class="md-header-nav__button md-logo">
<i class="md-icon">local_library</i>
</a>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
</div>
<div class="md-flex__cell md-flex__cell--stretch">
<div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
<span class="md-header-nav__topic">
TMT Common Software (CSW)
</span>
<span class="md-header-nav__topic">
Events
</span>
</div>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="search"></label>
<div class="md-search__inner">
<form class="md-search__form" name="search">
<input type="text" class="md-search__input" name="query" required placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query">
<label class="md-icon md-search__icon" for="search"></label>
<button type="reset" class="md-icon md-search__icon" data-md-component="reset">&#xE5CD;</button>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix>
<div class="md-search-result" data-md-component="result">
<div class="md-search-result__meta">
Type to start searching
</div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>

</div>
<div class="md-flex__cell md-flex__cell--shrink">
<div class="md-header-nav__source">
<a href="https://github.com/tmtsoftware/csw-prod"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
tmtsoftware/csw-prod
</div>
</a>

</div>
</div>
</div>
</nav>
</header>

<div class="md-container">
<main class="md-main">
<div class="md-main__inner md-grid" data-md-component="container">
<div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--primary" data-md-level="0" style="visibility: hidden">
<label class="md-nav__title md-nav__title--site" for="drawer">
<span class="md-nav__button md-logo">
<i class="md-icon">local_library</i>
</span>
<a href="../index.html" title="TMT Common Software (CSW)">
TMT Common Software (CSW)
</a>
</label>
<div class="md-nav__source">
<a href="https://github.com/tmtsoftware/csw-prod"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
tmtsoftware/csw-prod
</div>
</a>

</div>
<ul>
  <li><a href="../commons/getting-started.html" class="page">Getting Started</a></li>
  <li><a href="../commons/create-component.html" class="page">Creating a Component</a></li>
  <li><a href="../commons/multiple-components.html" class="page">Multiple Components</a></li>
  <li><a href="../commons/messages.html" class="page">Messages</a>
  <ul>
    <li><a href="../messages/keys-parameters.html" class="page">Keys and Parameters</a></li>
    <li><a href="../messages/units.html" class="page">Units</a></li>
    <li><a href="../messages/subsystem.html" class="page">Subsystem</a></li>
    <li><a href="../messages/commands.html" class="page">Commands</a></li>
    <li><a href="../messages/events.html" class="active page">Events</a></li>
    <li><a href="../messages/states.html" class="page">State variables</a></li>
    <li><a href="../messages/result.html" class="page">Result</a></li>
  </ul></li>
  <li><a href="../commons/framework.html" class="page">Framework for creating components (HCD, Assembly, Container)</a>
  <ul>
    <li><a href="../framework/describing-components.html" class="page">ComponentInfo</a></li>
    <li><a href="../framework/creating-components.html" class="page">Creating an Assembly or Hcd Component</a></li>
    <li><a href="../framework/handling-lifecycle.html" class="page">Lifecycle support</a></li>
    <li><a href="../framework/managing-command-state.html" class="page">Managing Command State</a></li>
    <li><a href="../framework/tracking-connections.html" class="page">Tracking Connections</a></li>
    <li><a href="../framework/publishing-state.html" class="page">Publishing State</a></li>
    <li><a href="../framework/handling-exceptions.html" class="page">Handling Exceptions</a></li>
    <li><a href="../framework/deploying-components.html" class="page">Deploying Components</a></li>
  </ul></li>
  <li><a href="../commons/command.html" class="page">Communication using Commands</a></li>
  <li><a href="../commons/services.html" class="page">Services</a>
  <ul>
    <li><a href="../services/location.html" class="page">Location service</a></li>
    <li><a href="../services/config.html" class="page">Configuration service</a></li>
    <li><a href="../services/logging.html" class="page">Logging service</a></li>
  </ul></li>
  <li><a href="../commons/apps.html" class="page">Applications</a>
  <ul>
    <li><a href="../apps/cswclusterseed.html" class="page">csw-cluster-seed</a></li>
    <li><a href="../apps/cswlocationagent.html" class="page">csw-location-agent</a></li>
    <li><a href="../apps/cswonfigserverapp.html" class="page">csw-config-server</a></li>
    <li><a href="../apps/cswconfigclientcli.html" class="page">csw-config-client-cli</a></li>
    <li><a href="../apps/hostconfig.html" class="page">csw-host-config</a></li>
  </ul></li>
  <li><a href="../commons/testing.html" class="page">Testing</a></li>
  <li><a href="../commons/sbt-tasks.html" class="page">sbt tasks</a></li>
  <li><a href="../commons/manuals.html" class="page">Manuals</a></li>
</ul>
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="toc">Table of contents</label>
<ul>
  <li><a href="../messages/events.html#events" class="header">Events</a>
  <ul>
    <li><a href="../messages/events.html#eventtime" class="header">EventTime</a></li>
    <li><a href="../messages/events.html#observe-event" class="header">Observe Event</a></li>
    <li><a href="../messages/events.html#system-event" class="header">System Event</a></li>
    <li><a href="../messages/events.html#json-serialization" class="header">JSON serialization</a></li>
    <li><a href="../messages/events.html#unique-key-constraint" class="header">Unique Key constraint</a></li>
    <li><a href="../messages/events.html#protobuf" class="header">Protobuf</a></li>
    <li><a href="../messages/events.html#source-code-for-examples" class="header">Source code for examples</a></li>
  </ul></li>
</ul>
</nav>

<div class="md-nav__title--site md-version" title="Version">
<i class="md-icon">label_outline</i> 0.1*
</div>
</nav>

</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="toc">Table of contents</label>
<ul>
  <li><a href="../messages/events.html#events" class="header">Events</a>
  <ul>
    <li><a href="../messages/events.html#eventtime" class="header">EventTime</a></li>
    <li><a href="../messages/events.html#observe-event" class="header">Observe Event</a></li>
    <li><a href="../messages/events.html#system-event" class="header">System Event</a></li>
    <li><a href="../messages/events.html#json-serialization" class="header">JSON serialization</a></li>
    <li><a href="../messages/events.html#unique-key-constraint" class="header">Unique Key constraint</a></li>
    <li><a href="../messages/events.html#protobuf" class="header">Protobuf</a></li>
    <li><a href="../messages/events.html#source-code-for-examples" class="header">Source code for examples</a></li>
  </ul></li>
</ul>
</nav>

</div>
</div>
</div>
<div class="md-content">
<article class="md-content__inner md-typeset">
<div class="md-content__searchable">
<h2><a href="#events" name="events" class="anchor"><span class="anchor-link"></span></a>Events</h2>
<p>Events are the most basic type of asynchronous notification in TMT when an activity occurs somewhere in the TMT system and other components need to be notified. Each type of event has a unique purpose and unique information, but they all share same structural features. All events have <strong>EventInfo</strong> and <strong>ParameterSet</strong>.</p><div class="callout note "><div class="callout-title">Note</div>
<p><code>csw-messages</code> library offers out of the box support to serialize Events using <strong>Protobuf</strong>, so that events can be produced and consumed by JVM(Java virtual machine) as well as Non-JVM applications.</p>
<p>For more on this <a href="events.html#protobuf">Protobuf support</a> section below.</p></div>
<h3><a href="#eventtime" name="eventtime" class="anchor"><span class="anchor-link"></span></a>EventTime</h3>
<p>It captures the instance of a time in UTC format. To create current instance of time use default constructor. For other utility functions, see below examples:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">//default constructor will return current time in UTC
val now: EventTime = EventTime()

//using constructor
val anHourAgo: EventTime = EventTime(Instant.now().minusSeconds(3600))

//current event time using utility function
val currentTime: EventTime = EventTime.toCurrent

//some past time using utility function
val aDayAgo = EventTime.toEventTime(Instant.now.minusSeconds(86400))
</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java"><br/>//apply returns current time in UTC
EventTime now = EventTime.apply();

//using constructor
EventTime anHourAgo = new EventTime(Instant.now().minusSeconds(3600));

//return current time in UTC
EventTime currentTime = EventTime.toCurrent();

//some past time using utility function
EventTime aDayAgo = EventTime.toEventTime(Instant.now().minusSeconds(86400));
</code></pre></dd>
</dl>
<h3><a href="#observe-event" name="observe-event" class="anchor"><span class="anchor-link"></span></a>Observe Event</h3>
<p>ObserveEvent is used to describe an event within a standardized data acquisition process. Published only by Science Detector Assemblies, who emit ObserveEvents during their exposures to signal the occurrence of specific activities/actions during the acquisition of data. Observe Events are published by the detector system using the Event Service.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">//keys
val k1: Key[Int]    = KeyType.IntKey.make(&quot;encoder&quot;)
val k2: Key[Int]    = KeyType.IntKey.make(&quot;windspeed&quot;)
val k3: Key[String] = KeyType.StringKey.make(&quot;filter&quot;)
val k4: Key[Int]    = KeyType.IntKey.make(&quot;notUsed&quot;)

//prefixes
val ck1   = Prefix(&quot;wfos.prog.cloudcover&quot;)
val name1 = EventName(&quot;filter wheel&quot;)
val ck3   = Prefix(&quot;wfos.red.detector&quot;)
val name3 = EventName(&quot;iris&quot;)

//parameters
val p1: Parameter[Int]    = k1.set(22)
val p2: Parameter[Int]    = k2.set(44)
val p3: Parameter[String] = k3.set(&quot;A&quot;, &quot;B&quot;, &quot;C&quot;, &quot;D&quot;)

//Create ObserveEvent using madd
val se1: ObserveEvent = ObserveEvent(ck1, name1).madd(p1, p2)
//Create ObserveEvent using apply
val se2: ObserveEvent = ObserveEvent(ck3, name3, Set(p1, p2))
//Create ObserveEvent and use add
val se3: ObserveEvent = ObserveEvent(ck3, name3).add(p1).add(p2).add(p3)

//access keys
val k1Exists: Boolean = se1.exists(k1) //true

//access Parameters
val p4: Option[Parameter[Int]] = se1.get(k1)

//access values
val v1: Array[Int] = se1(k1).values
val v2: Array[Int] = se2.parameter(k2).values
//k4 is missing
val missingKeys: Set[String] = se3.missingKeys(k1, k2, k3, k4)

//remove keys
val se4: ObserveEvent = se3.remove(k3)
</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">//keys
Key&lt;Integer&gt; k1 = JKeyTypes.IntKey().make(&quot;encoder&quot;);
Key&lt;Integer&gt; k2 = JKeyTypes.IntKey().make(&quot;windspeed&quot;);
Key&lt;String&gt; k3 = JKeyTypes.StringKey().make(&quot;filter&quot;);
Key&lt;Integer&gt; k4 = JKeyTypes.IntKey().make(&quot;notUsed&quot;);

//prefixes
Prefix prefix1 = new Prefix(&quot;wfos.prog.cloudcover&quot;);
EventName name1 = new EventName(&quot;filter wheel&quot;);
Prefix prefix2 = new Prefix(&quot;wfos.red.detector&quot;);
EventName name2 = new EventName(&quot;iris&quot;);

//parameters
Parameter&lt;Integer&gt; p1 = k1.set(22);
Parameter&lt;Integer&gt; p2 = k2.set(44);
Parameter&lt;String&gt; p3 = k3.set(&quot;A&quot;, &quot;B&quot;, &quot;C&quot;, &quot;D&quot;);

//Create ObserveEvent using madd
ObserveEvent oc1 = new ObserveEvent(prefix1, name1).madd(p1, p2);
//Create ObserveEvent using add
ObserveEvent oc2 = new ObserveEvent(prefix2, name2).add(p1).add(p2);
//Create ObserveEvent and use add
ObserveEvent oc3 = new ObserveEvent(prefix2, name2).add(p1).add(p2).add(p3);

//access keys
Boolean k1Exists = oc1.exists(k1); //true

//access Parameters
Optional&lt;Parameter&lt;Integer&gt;&gt; p4 = oc1.jGet(k1);

//access values
List&lt;Integer&gt; v1 = oc1.jGet(k1).get().jValues();
List&lt;Integer&gt; v2 = oc2.parameter(k2).jValues();
//k4 is missing
Set&lt;String&gt; missingKeys = oc3.jMissingKeys(k1, k2, k3, k4);

//remove keys
ObserveEvent oc4 = oc3.remove(k3);</code></pre></dd>
</dl>
<h3><a href="#system-event" name="system-event" class="anchor"><span class="anchor-link"></span></a>System Event</h3>
<p>SystemEvent is used to describe a demand or other algorithm input from one component to the other. It is also used to publish internal state or status values of a component that may be of interest to other components in the system.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">//keys
val k1: Key[Int]    = KeyType.IntKey.make(&quot;encoder&quot;)
val k2: Key[Int]    = KeyType.IntKey.make(&quot;windspeed&quot;)
val k3: Key[String] = KeyType.StringKey.make(&quot;filter&quot;)
val k4: Key[Int]    = KeyType.IntKey.make(&quot;notUsed&quot;)

//prefixes
val ck1   = Prefix(&quot;wfos.prog.cloudcover&quot;)
val name1 = EventName(&quot;filter wheel&quot;)
val ck3   = Prefix(&quot;wfos.red.detector&quot;)
val name3 = EventName(&quot;iris&quot;)

//parameters
val p1: Parameter[Int]    = k1.set(22)
val p2: Parameter[Int]    = k2.set(44)
val p3: Parameter[String] = k3.set(&quot;A&quot;, &quot;B&quot;, &quot;C&quot;, &quot;D&quot;)

//Create SystemEvent using madd
val se1: SystemEvent = SystemEvent(ck1, name1).madd(p1, p2)
//Create SystemEvent using apply
val se2: SystemEvent = SystemEvent(ck3, name3, Set(p1, p2))
//Create SystemEvent and use add
val se3: SystemEvent = SystemEvent(ck3, name3).add(p1).add(p2).add(p3)

//access keys
val k1Exists: Boolean = se1.exists(k1) //true

//access Parameters
val p4: Option[Parameter[Int]] = se1.get(k1)

//access values
val v1: Array[Int] = se1(k1).values
val v2: Array[Int] = se2.parameter(k2).values
//k4 is missing
val missingKeys: Set[String] = se3.missingKeys(k1, k2, k3, k4)

//remove keys
val se4: SystemEvent = se3.remove(k3)

//add more than one parameters, using madd
val se5: SystemEvent = se4.madd(k3.set(&quot;X&quot;, &quot;Y&quot;, &quot;Z&quot;).withUnits(Units.day), k4.set(99, 100))
val paramSize: Int   = se5.size

//update existing key with set
val se6: SystemEvent = se5.add(k2.set(5, 6, 7, 8))
</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">//keys
Key&lt;Integer&gt; k1 = JKeyTypes.IntKey().make(&quot;encoder&quot;);
Key&lt;Integer&gt; k2 = JKeyTypes.IntKey().make(&quot;windspeed&quot;);
Key&lt;String&gt; k3 = JKeyTypes.StringKey().make(&quot;filter&quot;);
Key&lt;Integer&gt; k4 = JKeyTypes.IntKey().make(&quot;notUsed&quot;);

//prefixes
Prefix prefix1 = new Prefix(&quot;wfos.prog.cloudcover&quot;);
EventName name1 = new EventName(&quot;filter wheel&quot;);
Prefix prefix2 = new Prefix(&quot;wfos.red.detector&quot;);
EventName name2 = new EventName(&quot;iris&quot;);

//parameters
Parameter&lt;Integer&gt; p1 = k1.set(22);
Parameter&lt;Integer&gt; p2 = k2.set(44);
Parameter&lt;String&gt; p3 = k3.set(&quot;A&quot;, &quot;B&quot;, &quot;C&quot;, &quot;D&quot;);

//Create SystemEvent using madd
SystemEvent se1 = new SystemEvent(prefix1, name1).madd(p1, p2);
//Create SystemEvent using add
SystemEvent se2 = new SystemEvent(prefix2, name2).add(p1).add(p2);
//Create SystemEvent and use add
SystemEvent se3 = new SystemEvent(prefix2, name2).add(p1).add(p2).add(p3);

//access keys
Boolean k1Exists = se1.exists(k1); //true

//access Parameters
Optional&lt;Parameter&lt;Integer&gt;&gt; p4 = se1.jGet(k1);

//access values
List&lt;Integer&gt; v1 = se1.jGet(k1).get().jValues();
List&lt;Integer&gt; v2 = se2.parameter(k2).jValues();
//k4 is missing
Set&lt;String&gt; missingKeys = se3.jMissingKeys(k1, k2, k3, k4);

//remove keys
SystemEvent se4 = se3.remove(k3);</code></pre></dd>
</dl>
<h3><a href="#json-serialization" name="json-serialization" class="anchor"><span class="anchor-link"></span></a>JSON serialization</h3>
<p>Events can be serialized to JSON. The library has provided <strong>JsonSupport</strong> helper class and methods to serialize Status, Observe and System events.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">import play.api.libs.json.{JsValue, Json}

//key
val k1: Key[MatrixData[Double]] = DoubleMatrixKey.make(&quot;myMatrix&quot;)

val name1  = EventName(&quot;filter wheel&quot;)
val prefix = Prefix(&quot;wfos.blue.filter&quot;)

//values
val m1: MatrixData[Double] = MatrixData.fromArrays(
  Array(1.0, 2.0, 3.0),
  Array(4.1, 5.1, 6.1),
  Array(7.2, 8.2, 9.2)
)
//parameter
val i1: Parameter[MatrixData[Double]] = k1.set(m1)
//events
val observeEvent: ObserveEvent = ObserveEvent(prefix, name1).add(i1)
val systemEvent: SystemEvent   = SystemEvent(prefix, name1).add(i1)

//json support - write
val observeJson: JsValue = JsonSupport.writeEvent(observeEvent)
val systemJson: JsValue  = JsonSupport.writeEvent(systemEvent)

//optionally prettify
val str: String = Json.prettyPrint(systemJson)

//construct command from string
val systemEventFromPrettyStr: SystemEvent = JsonSupport.readEvent[SystemEvent](Json.parse(str))

//json support - read
val observeEvent1: ObserveEvent = JsonSupport.readEvent[ObserveEvent](observeJson)
val systemEvent1: SystemEvent   = JsonSupport.readEvent[SystemEvent](systemJson)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">//key
Key&lt;MatrixData&lt;Double&gt;&gt; k1 = JKeyTypes.DoubleMatrixKey().make(&quot;myMatrix&quot;);

//prefixes
Prefix prefix1 = new Prefix(&quot;wfos.blue.filter&quot;);
EventName name1 = new EventName(&quot;filter wheel&quot;);

//values
Double[][] doubles = {{1.0, 2.0, 3.0}, {4.1, 5.1, 6.1}, {7.2, 8.2, 9.2}};
MatrixData&lt;Double&gt; m1 = MatrixData.fromJavaArrays(Double.class, doubles);

//parameter
Parameter&lt;MatrixData&lt;Double&gt;&gt; i1 = k1.set(m1);


//events
ObserveEvent observeEvent = new ObserveEvent(prefix1, name1).add(i1);
SystemEvent systemEvent = new SystemEvent(prefix1, name1).add(i1);

//json support - write
JsValue observeJson = JavaJsonSupport.writeEvent(observeEvent);
JsValue systemJson = JavaJsonSupport.writeEvent(systemEvent);

//optionally prettify
String str = Json.prettyPrint(systemJson);

//construct DemandState from string
SystemEvent statusFromPrettyStr = JavaJsonSupport.readEvent(Json.parse(str));

//json support - read
ObserveEvent observeEvent1 = JavaJsonSupport.readEvent(observeJson);
SystemEvent systemEvent1 = JavaJsonSupport.readEvent(systemJson);</code></pre></dd>
</dl>
<h3><a href="#unique-key-constraint" name="unique-key-constraint" class="anchor"><span class="anchor-link"></span></a>Unique Key constraint</h3>
<p>By choice, a ParameterSet in either <strong>StatusEvent, ObserveEvent,</strong> or <strong>SystemEvent</strong> command will be optimized to store only unique keys. In other words, trying to store multiple keys with same name, will be automatically optimized by removing duplicates.</p><div class="callout note "><div class="callout-title">Note</div>
<p>Parameters are stored in a Set, which is an unordered collection of items. Hence, it&rsquo;s not predictable whether first or last duplicate copy will be retained. Hence, cautiously avoid adding duplicate keys.</p></div>
<p>Here are some examples that illustrate this point:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">//keys
val encoderKey: Key[Int] = KeyType.IntKey.make(&quot;encoder&quot;)
val filterKey: Key[Int]  = KeyType.IntKey.make(&quot;filter&quot;)
val miscKey: Key[Int]    = KeyType.IntKey.make(&quot;misc.&quot;)

//prefix
val prefix = Prefix(&quot;wfos.blue.filter&quot;)

val name1 = EventName(&quot;filter wheel&quot;)

//params
val encParam1 = encoderKey.set(1)
val encParam2 = encoderKey.set(2)

val encParam3    = encoderKey.set(3)
val filterParam1 = filterKey.set(1)
val filterParam2 = filterKey.set(2)

val filterParam3 = filterKey.set(3)

val miscParam1 = miscKey.set(100)
//StatusEvent with duplicate key via constructor
val systemEvent =
  SystemEvent(prefix, name1, Set(encParam1, encParam2, encParam3, filterParam1, filterParam2, filterParam3))
//four duplicate keys are removed; now contains one Encoder and one Filter key
val uniqueKeys1 = systemEvent.paramSet.toList.map(_.keyName)

//try adding duplicate keys via add + madd
val changedStatusEvent = systemEvent
  .add(encParam3)
  .madd(
    filterParam1,
    filterParam2,
    filterParam3
  )
//duplicate keys will not be added. Should contain one Encoder and one Filter key
val uniqueKeys2 = changedStatusEvent.paramSet.toList.map(_.keyName)

//miscKey(unique) will be added; encoderKey(duplicate) will not be added
val finalStatusEvent = systemEvent.madd(Set(miscParam1, encParam1))
//now contains encoderKey, filterKey, miscKey
val uniqueKeys3 = finalStatusEvent.paramSet.toList.map(_.keyName)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">//keys
Key&lt;Integer&gt; encoderKey = JKeyTypes.IntKey().make(&quot;encoder&quot;);
Key&lt;Integer&gt; filterKey = JKeyTypes.IntKey().make(&quot;filter&quot;);
Key&lt;Integer&gt; miscKey = JKeyTypes.IntKey().make(&quot;misc.&quot;);

//prefix
Prefix prefix1 = new Prefix(&quot;wfos.blue.filter&quot;);
EventName name1 = new EventName(&quot;filter wheel&quot;);

//params
Parameter&lt;Integer&gt; encParam1 = encoderKey.set(1);
Parameter&lt;Integer&gt; encParam2 = encoderKey.set(2);
Parameter&lt;Integer&gt; encParam3 = encoderKey.set(3);

Parameter&lt;Integer&gt; filterParam1 = filterKey.set(1);
Parameter&lt;Integer&gt; filterParam2 = filterKey.set(2);
Parameter&lt;Integer&gt; filterParam3 = filterKey.set(3);

Parameter&lt;Integer&gt; miscParam1 = miscKey.set(100);

//StatusEvent with duplicate key via madd
SystemEvent event = new SystemEvent(prefix1, name1).madd(
        encParam1,
        encParam2,
        encParam3,
        filterParam1,
        filterParam2,
        filterParam3);
//four duplicate keys are removed; now contains one Encoder and one Filter key
List&lt;String&gt; uniqueKeys1 = event.jParamSet().stream().map(Parameter::keyName).collect(Collectors.toList());

//try adding duplicate keys via add + madd
SystemEvent changedEvent = event.add(encParam3).madd(filterParam1, filterParam2, filterParam3);
//duplicate keys will not be added. Should contain one Encoder and one Filter key
List&lt;String&gt; uniqueKeys2 = changedEvent.jParamSet().stream().map(Parameter::keyName).collect(Collectors.toList());

//miscKey(unique) will be added; encoderKey(duplicate) will not be added
SystemEvent finalEvent = changedEvent.madd(miscParam1, encParam1);
//now contains encoderKey, filterKey, miscKey
List&lt;String&gt; uniqueKeys3 = finalEvent.jParamSet().stream().map(Parameter::keyName).collect(Collectors.toList());</code></pre></dd>
</dl>
<h3><a href="#protobuf" name="protobuf" class="anchor"><span class="anchor-link"></span></a>Protobuf</h3>
<p>Protobuf aka Protocol buffers, are a language-neutral, platform-neutral extensible mechanism for serializing structured data. For more, visit <a href="https://developers.google.com/protocol-buffers/">Protobuf home page</a></p>
<p>In TMT observatory, subsystems and components could be running on JVM(Java virtual machine) and Non-JVM platform. This leads to solving a non-trivial problem of a <strong>Non-JVM component</strong> wanting to consume an Event produced by a <strong>JVM component</strong>. Amongst the available options for <strong>data over the wire</strong>, Protobuf was chosen for its performance, data compression and official/unofficial support many mainstream languages. </p>
<p><code>csw-messages</code> library enhances the Protobuf support, by providing out of the box helper methods, to convert events from/to protobuf binary data.</p><div class="callout note "><div class="callout-title">Protobuf Code generation for Non-JVM languages</div>
<p>The protobuf schema is defined in <a href="https://github.com/tmtsoftware/csw-prod/tree/master/csw-messages/src/main/protobuf/csw_protobuf">csw_protobuf</a> directory. The contained <strong>.proto</strong> files can be fed to a protoc compiler in the language of your choice and it will do the required code generation. </p></div>
<p>Here are some examples:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">//Key
val raDecKey = RaDecKey.make(&quot;raDecKey&quot;)

//values
val raDec1 = RaDec(10.20, 40.20)
val raDec2 = RaDec(100.20, 400.20)

//parameters
val param = raDecKey.set(raDec1, raDec2).withUnits(arcmin)

val prefix = Prefix(&quot;wfos.blue.filter&quot;)
val name   = EventName(&quot;filter wheel&quot;)
//events
val observeEvent: ObserveEvent = ObserveEvent(prefix, name).add(param)
val systemEvent1: SystemEvent  = SystemEvent(prefix, name).add(param)
val systemEvent2: SystemEvent =
  SystemEvent(prefix, name).add(param)

//convert events to protobuf bytestring
val byteArray2: PbEvent = observeEvent.toPb
val byteArray3: PbEvent = systemEvent1.toPb
val byteArray4: PbEvent = systemEvent2.toPb

//convert protobuf bytestring to events
val pbObserveEvent: ObserveEvent = ObserveEvent.fromPb(byteArray2)
val pbSystemEvent1: SystemEvent  = SystemEvent.fromPb(byteArray3)
val pbSystemEvent2: SystemEvent  = SystemEvent.fromPb(byteArray4)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java"><br/>//prefixes
Prefix prefix1 = new Prefix(&quot;wfos.blue.filter&quot;);
EventName name1 = new EventName(&quot;filter wheel&quot;);
Prefix prefix2 = new Prefix(&quot;wfos.prog.cloudcover&quot;);
EventName name2 = new EventName(&quot;iris&quot;);

//Key
Key&lt;RaDec&gt; raDecKey = JKeyTypes.RaDecKey().make(&quot;raDecKey&quot;);

//values
RaDec raDec1 = new RaDec(10.20, 40.20);
RaDec raDec2 = new RaDec(100.20, 400.20);

//parameters
Parameter&lt;RaDec&gt; param = raDecKey.set(raDec1, raDec2).withUnits(JUnits.arcmin);

//events
ObserveEvent observeEvent = new ObserveEvent(prefix1, name1).add(param);
SystemEvent systemEvent1 = new SystemEvent(prefix1, name1).add(param);
SystemEvent systemEvent2 = new SystemEvent(prefix2, name2).add(param);

//convert events to protobuf bytestring
PbEvent byteArray2 = observeEvent.toPb();
PbEvent byteArray3 = systemEvent1.toPb();
PbEvent byteArray4 = systemEvent2.toPb();

//convert protobuf bytestring to events
ObserveEvent pbObserveEvent = ObserveEvent.fromPb(byteArray2);
SystemEvent pbSystemEvent1 = SystemEvent.fromPb(byteArray3);
SystemEvent pbSystemEvent2 = SystemEvent.fromPb(byteArray4);</code></pre></dd>
</dl>
<h2><a href="#source-code-for-examples" name="source-code-for-examples" class="anchor"><span class="anchor-link"></span></a>Source code for examples</h2>
<ul>
  <li><a href="https://github.com/tmtsoftware/csw-prod/tree/master/examples/src/test/scala/csw/services/messages/EventsTest.scala">Scala Example</a></li>
  <li><a href="https://github.com/tmtsoftware/csw-prod/tree/master/examples/src/test/java/csw/services/messages/JEventsTest.java">Java Example</a></li>
</ul>
</div>
<div>
<a href="https://github.com/tmtsoftware/csw-prod/tree/master/docs/src/main/messages/events.md" title="Edit this page" class="md-source-file md-edit">
Edit this page
</a>
</div>
<div class="print-only">
<span class="md-source-file md-version">
0.1*
</span>
</div>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-nav">
<nav class="md-footer-nav__inner md-grid">
<a href="../messages/commands.html" title="Commands" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
</div>
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Previous
</span>
Commands
</span>
</div>
</a>
<a href="../messages/states.html" title="State variables" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Next
</span>
State variables
</span>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
</div>
</a>
</nav>
</div>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
Powered by
<a href="https://github.com/lightbend/paradox">Paradox</a>
and
<a href="https://jonas.github.io/paradox-material-theme/">Paradox Material Theme</a>

</div>
</div>
</div>
</footer>

</div>
<script src="../assets/javascripts/application.5165553b.js"></script>
<script src="../assets/javascripts/paradox-material-theme.js"></script>
<script>app.initialize({version:"0.17",url:{base:"../."}})</script>
<script type="text/javascript" src="../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function(event) {
window.prettyPrint && prettyPrint();
});
</script>
</body>
</html>
