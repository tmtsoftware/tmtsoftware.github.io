<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="description" content="docs">
<meta name="generator" content="Paradox, paradox-material-theme, mkdocs-material=1.11.0">

<meta name="lang:clipboard.copy" content="Copy to clipboard">
<meta name="lang:clipboard.copied" content="Copied to clipboard">
<meta name="lang:search.result.none" content="No matching documents">
<meta name="lang:search.result.one" content="1 matching document">
<meta name="lang:search.result.other" content="# matching documents">
<meta name="lang:search.languages" content="">
<meta name="lang:search.tokenizer" content="[\s\-]+">


<meta name="description" content="docs">
<link rel="shortcut icon" href="../assets/images/favicon.png">
<title>Commands Â· TMT Common Software (CSW)</title>
<script src="../lib/modernizr/modernizr.min.js"></script>
<link rel="stylesheet" href="../assets/stylesheets/application-0741cbeb94.css">
<link rel="stylesheet" href="../lib/material__tabs/dist/mdc.tabs.min.css">
<link rel="stylesheet" href="../lib/prettify/prettify.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
<style>
body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}
code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}
</style>
<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="../assets/stylesheets/paradox-material-theme.css">
</head>
<body
data-md-color-primary="indigo"
data-md-color-accent="indigo">
<input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
<input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
<label class="md-overlay" data-md-component="overlay" for="drawer"></label>
<header class="md-header" data-md-component="header">
<nav class="md-header-nav md-grid">
<div class="md-flex">
<div class="md-flex__cell md-flex__cell--shrink">
<a href="../index.html" title="TMT Common Software (CSW)" class="md-header-nav__button md-logo">
<i class="md-icon md-icon--home"></i>
</a>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
</div>
<div class="md-flex__cell md-flex__cell--stretch">
<span class="md-flex__ellipsis md-header-nav__title">
Commands
</span>
</div>
<form name="search" style="display: none">
<input type="text" name="query">
</form>
</div>
</nav>
</header>

<div class="md-container">
<main class="md-main">
<div class="md-main__inner md-grid" data-md-component="container">
<div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--primary" data-md-level="0" style="visibility: hidden">
<label class="md-nav__title md-nav__title--site" for="drawer">
<div class="md-nav__button md-logo">
<i class="md-icon md-icon--home"></i>
</div>
<a href="../index.html" title="TMT Common Software (CSW)">
TMT Common Software (CSW)
</a>
</label>
<ul>
  <li><a href="../csw-overview.html" class="page">Using CSW</a></li>
  <li><a href="../getting-started.html" class="page">Getting Started</a></li>
  <li><a href="../create-component.html" class="page">Creating a Component</a></li>
  <li><a href="../multiple-components.html" class="page">Multiple Components</a></li>
  <li><a href="../messages.html" class="page">Messages</a>
  <ul>
    <li><a href="../messages/keys-parameters.html" class="page">Keys and Parameters</a></li>
    <li><a href="../messages/units.html" class="page">Units</a></li>
    <li><a href="../messages/subsystem.html" class="page">Subsystem</a></li>
    <li><a href="../messages/commands.html" class="active page">Commands</a></li>
    <li><a href="../messages/events.html" class="page">Events</a></li>
    <li><a href="../messages/states.html" class="page">State variables</a></li>
    <li><a href="../messages/result.html" class="page">Result</a></li>
  </ul></li>
  <li><a href="../framework.html" class="page">Framework for creating components (HCD, Assembly, Container)</a>
  <ul>
    <li><a href="../framework/describing-components.html" class="page">ComponentInfo</a></li>
    <li><a href="../framework/creating-components.html" class="page">Creating an Assembly or Hcd Component</a></li>
    <li><a href="../framework/handling-lifecycle.html" class="page">Lifecycle support</a></li>
    <li><a href="../framework/managing-command-state.html" class="page">Managing Command State</a></li>
    <li><a href="../framework/tracking-connections.html" class="page">Tracking Connections</a></li>
    <li><a href="../framework/publishing-state.html" class="page">Publishing State</a></li>
    <li><a href="../framework/handling-exceptions.html" class="page">Handling Exceptions</a></li>
    <li><a href="../framework/deploying-components.html" class="page">Deploying Components</a></li>
  </ul></li>
  <li><a href="../services.html" class="page">Services</a>
  <ul>
    <li><a href="../services/location.html" class="page">Location service</a></li>
    <li><a href="../services/config.html" class="page">Configuration service</a></li>
    <li><a href="../services/logging.html" class="page">Logging service</a></li>
  </ul></li>
  <li><a href="../command.html" class="page">Communication using Commands</a></li>
  <li><a href="../creating-tests.html" class="page">Creating Tests</a></li>
  <li><a href="../apps.html" class="page">Applications</a>
  <ul>
    <li><a href="../apps/cswclusterseed.html" class="page">csw-cluster-seed</a></li>
    <li><a href="../apps/cswlocationagent.html" class="page">csw-location-agent</a></li>
    <li><a href="../apps/cswonfigserverapp.html" class="page">csw-config-server</a></li>
    <li><a href="../apps/cswconfigclientcli.html" class="page">csw-config-client-cli</a></li>
    <li><a href="../apps/hostconfig.html" class="page">csw-host-config</a></li>
  </ul></li>
  <li><a href="../manuals.html" class="page">Manuals</a></li>
</ul>
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="toc">Table of contents</label>
<ul>
  <li><a href="../messages/commands.html#commands" class="header">Commands</a>
  <ul>
    <li><a href="../messages/commands.html#obsid" class="header">ObsId</a></li>
    <li><a href="../messages/commands.html#prefix" class="header">Prefix</a></li>
    <li><a href="../messages/commands.html#setup-command" class="header">Setup Command</a></li>
    <li><a href="../messages/commands.html#observe-command" class="header">Observe Command</a></li>
    <li><a href="../messages/commands.html#wait-command" class="header">Wait Command</a></li>
    <li><a href="../messages/commands.html#json-serialization" class="header">JSON serialization</a></li>
    <li><a href="../messages/commands.html#unique-key-constraint" class="header">Unique Key constraint</a></li>
    <li><a href="../messages/commands.html#cloning-a-command" class="header">Cloning a command</a></li>
    <li><a href="../messages/commands.html#source-code-for-examples" class="header">Source code for examples</a></li>
  </ul></li>
</ul>
</nav>

<div class="md-nav__title--site md-version" title="Version">
<i class="md-icon">label_outline</i> 0.1*
</div>
</nav>

</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="toc">Table of contents</label>
<ul>
  <li><a href="../messages/commands.html#commands" class="header">Commands</a>
  <ul>
    <li><a href="../messages/commands.html#obsid" class="header">ObsId</a></li>
    <li><a href="../messages/commands.html#prefix" class="header">Prefix</a></li>
    <li><a href="../messages/commands.html#setup-command" class="header">Setup Command</a></li>
    <li><a href="../messages/commands.html#observe-command" class="header">Observe Command</a></li>
    <li><a href="../messages/commands.html#wait-command" class="header">Wait Command</a></li>
    <li><a href="../messages/commands.html#json-serialization" class="header">JSON serialization</a></li>
    <li><a href="../messages/commands.html#unique-key-constraint" class="header">Unique Key constraint</a></li>
    <li><a href="../messages/commands.html#cloning-a-command" class="header">Cloning a command</a></li>
    <li><a href="../messages/commands.html#source-code-for-examples" class="header">Source code for examples</a></li>
  </ul></li>
</ul>
</nav>

</div>
</div>
</div>
<div class="md-content">
<article class="md-content__inner md-typeset">
<div class="md-content__searchable">
<h2><a href="#commands" name="commands" class="anchor"><span class="anchor-link"></span></a>Commands</h2>
<h3><a href="#obsid" name="obsid" class="anchor"><span class="anchor-link"></span></a>ObsId</h3>
<p>It is an observation Id and can be constructed by creating instance of <code>ObsId</code>. </p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val obsId: ObsId = ObsId(&quot;Obs001&quot;)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">ObsId obsId = new ObsId(&quot;Obs001&quot;);</code></pre></dd>
</dl>
<h3><a href="#prefix" name="prefix" class="anchor"><span class="anchor-link"></span></a>Prefix</h3>
<p>Identifies a <a href="subsystem.html">Subsystem</a> in TMT observatory. Component developer should supply a valid prefix string and the subsystem will be automatically parsed from it. </p>
<p>See below examples:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">//using constructor, supplying subsystem and prefix both
val prefix1: Prefix = Prefix(Subsystem.NFIRAOS, &quot;nfiraos.ncc.trombone&quot;)

//just by supplying prefix
val prefix2: Prefix = Prefix(&quot;tcs.mobie.blue.filter&quot;)

//invalid prefix string that cant be mapped to a valid subsystem,
// will automatically get Subsystem.BAD
val badPrefix: Prefix = Prefix(&quot;abcdefgh&quot;)

//use implicit conversion to convert from String to Prefix
val prefix3: Prefix = &quot;wfos.prog.cloudcover&quot;</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">//using constructor, supplying subsystem and prefix both
Prefix prefix1 = new Prefix(JSubsystem.NFIRAOS, &quot;nfiraos.ncc.trombone&quot;);

//just by supplying prefix
Prefix prefix2 = new Prefix(&quot;tcs.mobie.blue.filter&quot;);

//invalid prefix string that cant be mapped to a valid subsystem,
// will automatically get Subsystem.BAD
Prefix badPrefix = new Prefix(&quot;abcdefgh&quot;);</code></pre></dd>
</dl>
<h3><a href="#setup-command" name="setup-command" class="anchor"><span class="anchor-link"></span></a>Setup Command</h3>
<p>This command is used to describe a goal that a system should match. Component developer will require to supply following arguments to create <code>Setup</code> command.</p>
<ul>
  <li><strong><a href="commands.html#ObsId">ObsId:</a></strong> An observation Id.</li>
  <li><strong>Prefix:</strong></li>
  <li><strong>paramSet:</strong> Optional Set of Parameters. Default is empty.</li>
</ul>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">//keys
val k1: Key[Int]    = KeyType.IntKey.make(&quot;encoder&quot;)
val k2: Key[String] = KeyType.StringKey.make(&quot;stringThing&quot;)
val k2bad: Key[Int] = KeyType.IntKey.make(&quot;missingKey&quot;)
val k3: Key[Int]    = KeyType.IntKey.make(&quot;filter&quot;)
val k4: Key[Float]  = KeyType.FloatKey.make(&quot;correction&quot;)

//parameters
val i1: Parameter[Int]    = k1.set(22)
val i2: Parameter[String] = k2.set(&quot;A&quot;)

//create Setup, add sequentially using add
val sc1: Setup = Setup(prefix, CommandName(&quot;move&quot;), Some(obsId)).add(i1).add(i2)

//access keys
val k1Exists: Boolean = sc1.exists(k1) //true

//access parameters
val tryParam1: Try[Parameter[Int]] = Try(sc1(k1))    //success
val tryk2Bad: Try[Parameter[Int]]  = Try(sc1(k2bad)) //failure

//add more than one parameters, using madd
val sc2: Setup     = sc1.madd(k3.set(1, 2, 3, 4).withUnits(Units.day), k4.set(1.0f, 2.0f))
val paramSize: Int = sc2.size

//add binary payload
val byteKey1: Key[Byte] = ByteKey.make(&quot;byteKey1&quot;)
val byteKey2: Key[Byte] = ByteKey.make(&quot;byteKey2&quot;)
val bytes1: Array[Byte] = Array[Byte](10, 20)
val bytes2: Array[Byte] = Array[Byte](30, 40)

val b1: Parameter[Byte] = byteKey1.set(bytes1)
val b2: Parameter[Byte] = byteKey2.set(bytes2)

val sc3: Setup = Setup(prefix, CommandName(&quot;move&quot;), Some(obsId), Set(b1, b2))

//remove a key
val sc4: Setup = sc3.remove(b1)

//list all keys
val allKeys: Set[String] = sc4.paramSet.map(_.keyName)
</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">//keys
Key&lt;Integer&gt; k1 = JKeyTypes.IntKey().make(&quot;encoder&quot;);
Key&lt;String&gt; k2 = JKeyTypes.StringKey().make(&quot;stringThing&quot;);
Key&lt;Integer&gt; k2bad = JKeyTypes.IntKey().make(&quot;missingKey&quot;);
Key&lt;Integer&gt; k3 = JKeyTypes.IntKey().make(&quot;filter&quot;);
Key&lt;Float&gt; k4 = JKeyTypes.FloatKey().make(&quot;correction&quot;);

//prefix
String prefixName = &quot;wfos.red.detector&quot;;

//parameters
Parameter&lt;Integer&gt; i1 = k1.set(22);
Parameter&lt;String&gt; i2 = k2.set(&quot;A&quot;);

//create setup, add sequentially using add
Setup sc1 = new Setup(new Prefix(prefixName), new CommandName(&quot;move&quot;), Optional.of(obsId)).add(i1).add(i2);

//access keys
Boolean k1Exists = sc1.exists(k1); //true

//access parameters
Optional&lt;Parameter&lt;Integer&gt;&gt; optParam1 = sc1.jGet(k1); //present
Optional&lt;Parameter&lt;Integer&gt;&gt; optK2Bad = sc1.jGet(k2bad); //absent

//add more than one parameters, using madd
Setup sc2 = sc1.madd(k3.set(1, 2, 3, 4).withUnits(JUnits.day), k4.set(1.0f, 2.0f));
int paramSize = sc2.size();

//add binary payload
Key&lt;Byte&gt; byteKey1 = JKeyTypes.ByteKey().make(&quot;byteKey1&quot;);
Key&lt;Byte&gt; byteKey2 = JKeyTypes.ByteKey().make(&quot;byteKey2&quot;);
Byte[] bytes1 = {10, 20};
Byte[] bytes2 = {30, 40};

Parameter&lt;Byte&gt; b1 = byteKey1.set(bytes1);
Parameter&lt;Byte&gt; b2 = byteKey2.set(bytes2);

Setup sc3 = new Setup(new Prefix(prefixName), new CommandName(&quot;move&quot;), Optional.of(obsId)).add(b1).add(b2);

//remove a key
Setup sc4 = sc3.remove(b1);

//list all keys
java.util.List&lt;String&gt; allKeys = sc4.jParamSet().stream().map(Parameter::keyName).collect(Collectors.toList());</code></pre></dd>
</dl>
<h3><a href="#observe-command" name="observe-command" class="anchor"><span class="anchor-link"></span></a>Observe Command</h3>
<p>This command describes a science observation. Sent only to Science Detector Assemblies and Sequencers.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">//keys
val k1: Key[Boolean] = KeyType.BooleanKey.make(&quot;repeat&quot;)
val k2: Key[Int]     = KeyType.IntKey.make(&quot;expTime&quot;)
val k2bad: Key[Int]  = KeyType.IntKey.make(&quot;missingKey&quot;)
val k3: Key[Int]     = KeyType.IntKey.make(&quot;filter&quot;)
val k4: Key[Instant] = KeyType.TimestampKey.make(&quot;creation-time&quot;)

//parameters
val i1: Parameter[Boolean] = k1.set(true, false, true, false)
val i2: Parameter[Int]     = k2.set(1, 2, 3, 4)

//create Observe, add sequentially using add
val oc1: Observe = Observe(prefix, CommandName(&quot;move&quot;), Some(obsId)).add(i1).add(i2)

//access parameters using apply method
val k1Param: Parameter[Boolean] = oc1.get(k1).get //true
val values: Array[Boolean]      = k1Param.values

//access parameters
val tryParam1: Try[Parameter[Boolean]] = Try(oc1(k1))    //success
val tryk2Bad: Try[Parameter[Int]]      = Try(oc1(k2bad)) //failure

//add more than one parameters, using madd
val oc2: Observe   = oc1.madd(k3.set(1, 2, 3, 4).withUnits(Units.day), k4.set(Instant.now()))
val paramSize: Int = oc2.size

//update existing key with set
val oc3: Observe = oc1.add(k2.set(5, 6, 7, 8))

//remove a key
val oc4: Observe = oc2.remove(k4)
</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">//keys
Key&lt;Boolean&gt; k1 = JKeyTypes.BooleanKey().make(&quot;repeat&quot;);
Key&lt;Integer&gt; k2 = JKeyTypes.IntKey().make(&quot;expTime&quot;);
Key&lt;Integer&gt; k2bad = JKeyTypes.IntKey().make(&quot;missingKey&quot;);
Key&lt;Integer&gt; k3 = JKeyTypes.IntKey().make(&quot;filter&quot;);
Key&lt;Instant&gt; k4 = JKeyTypes.TimestampKey().make(&quot;creation-time&quot;);

//prefix
String prefixName = &quot;wfos.red.detector&quot;;

//parameters
Boolean[] boolArray = {true, false, true, false};
Parameter&lt;Boolean&gt; i1 = k1.set(boolArray);
Parameter&lt;Integer&gt; i2 = k2.set(1, 2, 3, 4);

//create Observe, add sequentially using add
Observe oc1 = new Observe(new Prefix(prefixName), new CommandName(&quot;move&quot;), Optional.of(obsId)).add(i1).add(i2);

//access parameters
Optional&lt;Parameter&lt;Boolean&gt;&gt; k1Param = oc1.jGet(k1); //present
java.util.List&lt;Boolean&gt; values = k1Param.get().jValues();

//access parameters
Optional&lt;Parameter&lt;ArrayData&lt;Float&gt;&gt;&gt; k2BadParam = oc1.jGet(k2bad.keyName(), JKeyTypes.FloatArrayKey());

//add more than one parameters, using madd
Observe oc2 = oc1.madd(k3.set(1, 2, 3, 4).withUnits(JUnits.day), k4.set(Instant.now()));
int paramSize = oc2.size();

//update existing key with set
Integer[] intArray = {5, 6, 7, 8};
Observe oc3 = oc1.add(k2.set(intArray));

//remove a key
Observe oc4 = oc2.remove(k4);

//list all keys
java.util.List&lt;String&gt; allKeys = oc4.jParamSet().stream().map(Parameter::keyName).collect(Collectors.toList());</code></pre></dd>
</dl>
<h3><a href="#wait-command" name="wait-command" class="anchor"><span class="anchor-link"></span></a>Wait Command</h3>
<p>This command causes a Sequencer to wait until notified.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">//keys
val k1: Key[Boolean] = KeyType.BooleanKey.make(&quot;repeat&quot;)
val k2: Key[Int]     = KeyType.IntKey.make(&quot;expTime&quot;)
val k2bad: Key[Int]  = KeyType.IntKey.make(&quot;missingKey&quot;)
val k3: Key[Int]     = KeyType.IntKey.make(&quot;filter&quot;)
val k4: Key[Instant] = KeyType.TimestampKey.make(&quot;creation-time&quot;)

//parameters
val i1: Parameter[Boolean] = k1.set(true, false, true, false)
val i2: Parameter[Int]     = k2.set(1, 2, 3, 4)

//create wait, add sequentially using add
val wc1: Wait = Wait(prefix, CommandName(&quot;move&quot;), Some(obsId)).add(i1).add(i2)

//access params using get method
val k1Param: Option[Parameter[Boolean]] = wc1.get(k1)
val values: Array[Boolean]              = k1Param.map(_.values).getOrElse(Array.empty[Boolean])

//access parameters
val tryParam1: Try[Parameter[Boolean]] = Try(wc1(k1))    //success
val tryk2Bad: Try[Parameter[Int]]      = Try(wc1(k2bad)) //failure

//add more than one parameters, using madd
val wc2: Wait      = wc1.madd(k3.set(1, 2, 3, 4).withUnits(Units.day), k4.set(Instant.now()))
val paramSize: Int = wc2.size

//update existing key with set
val wc3: Wait = wc1.add(k2.set(5, 6, 7, 8))

//remove a key
val wc4: Wait = wc2.remove(k4)
</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">//keys
Key&lt;Boolean&gt; k1 = JKeyTypes.BooleanKey().make(&quot;repeat&quot;);
Key&lt;Integer&gt; k2 = JKeyTypes.IntKey().make(&quot;expTime&quot;);
Key&lt;Integer&gt; k2bad = JKeyTypes.IntKey().make(&quot;missingKey&quot;);
Key&lt;Integer&gt; k3 = JKeyTypes.IntKey().make(&quot;filter&quot;);
Key&lt;Instant&gt; k4 = JKeyTypes.TimestampKey().make(&quot;creation-time&quot;);

//prefix
String prefixName = &quot;wfos.red.detector&quot;;

//parameters
Boolean[] boolArray = {true, false, true, false};
Parameter&lt;Boolean&gt; i1 = k1.set(boolArray);
Parameter&lt;Integer&gt; i2 = k2.set(1, 2, 3, 4);

//create Wait, add sequentially using add
Wait wc1 = new Wait(new Prefix(prefixName), new CommandName(&quot;move&quot;), Optional.of(obsId)).add(i1).add(i2);

//access parameters using jGet
Optional&lt;Parameter&lt;Boolean&gt;&gt; k1Param = wc1.jGet(k1); //present
java.util.List&lt;Boolean&gt; values = k1Param.get().jValues();

//access parameters
Optional&lt;Parameter&lt;ArrayData&lt;Float&gt;&gt;&gt; k2BadParam = wc1.jGet(&quot;absentKeyHere&quot;, JKeyTypes.FloatArrayKey());

//add more than one parameters, using madd
Wait wc2 = wc1.madd(k3.set(1, 2, 3, 4).withUnits(JUnits.day), k4.set(Instant.now()));
int paramSize = wc2.size();

//update existing key with set
Integer[] intArray = {5, 6, 7, 8};
Wait wc3 = wc1.add(k2.set(intArray));

//remove a key
Wait wc4 = wc2.remove(k4);

//list all keys
java.util.List&lt;String&gt; allKeys = wc4.jParamSet().stream().map(Parameter::keyName).collect(Collectors.toList());</code></pre></dd>
</dl>
<h3><a href="#json-serialization" name="json-serialization" class="anchor"><span class="anchor-link"></span></a>JSON serialization</h3>
<p>Commands can be serialized to JSON. The library has provided <strong>JsonSupport</strong> helper class and methods to serialize Setup, Observe and Wait commands.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">import play.api.libs.json.{JsValue, Json}

//key
val k1: Key[MatrixData[Double]] = DoubleMatrixKey.make(&quot;myMatrix&quot;)
//values
val m1: MatrixData[Double] = MatrixData.fromArrays(
  Array(1.0, 2.0, 3.0),
  Array(4.1, 5.1, 6.1),
  Array(7.2, 8.2, 9.2)
)

//parameter
val i1: Parameter[MatrixData[Double]] = k1.set(m1)

//commands
val sc: Setup   = Setup(prefix, CommandName(&quot;move&quot;), Some(obsId)).add(i1)
val oc: Observe = Observe(prefix, CommandName(&quot;move&quot;), Some(obsId)).add(i1)
val wc: Wait    = Wait(prefix, CommandName(&quot;move&quot;), Some(obsId)).add(i1)

//json support - write
val scJson: JsValue = JsonSupport.writeSequenceCommand(sc)
val ocJson: JsValue = JsonSupport.writeSequenceCommand(oc)
val wcJson: JsValue = JsonSupport.writeSequenceCommand(wc)

//optionally prettify
val str: String = Json.prettyPrint(scJson)

//construct command from string
val scFromPrettyStr = JsonSupport.readSequenceCommand[Setup](Json.parse(str))

//json support - read
val sc1: Setup   = JsonSupport.readSequenceCommand[Setup](scJson)
val oc1: Observe = JsonSupport.readSequenceCommand[Observe](ocJson)
val wc1: Wait    = JsonSupport.readSequenceCommand[Wait](wcJson)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">//key
Key&lt;MatrixData&lt;Double&gt;&gt; k1 = JKeyTypes.DoubleMatrixKey().make(&quot;myMatrix&quot;);

//values
Double[][] doubles = {{1.0, 2.0, 3.0}, {4.1, 5.1, 6.1}, {7.2, 8.2, 9.2}};
MatrixData&lt;Double&gt; m1 = MatrixData.fromJavaArrays(Double.class, doubles);

//parameter
Parameter&lt;MatrixData&lt;Double&gt;&gt; i1 = k1.set(m1);

String prefixName = &quot;wfos.blue.filter&quot;;

//commands
Setup sc = new Setup(new Prefix(prefixName), new CommandName(&quot;move&quot;), Optional.of(obsId)).add(i1);
Observe oc = new Observe(new Prefix(prefixName), new CommandName(&quot;move&quot;), Optional.of(obsId)).add(i1);
Wait wc = new Wait(new Prefix(prefixName), new CommandName(&quot;move&quot;), Optional.of(obsId)).add(i1);

//json support - write
JsValue scJson = JavaJsonSupport.writeSequenceCommand(sc);
JsValue ocJson = JavaJsonSupport.writeSequenceCommand(oc);
JsValue wcJson = JavaJsonSupport.writeSequenceCommand(wc);

//optionally prettify
String str = Json.prettyPrint(scJson);

//construct command from string
Setup sc1 = JavaJsonSupport.readSequenceCommand(Json.parse(str));
Observe oc1 = JavaJsonSupport.readSequenceCommand(ocJson);
Wait wc1 = JavaJsonSupport.readSequenceCommand(wcJson);</code></pre></dd>
</dl>
<h3><a href="#unique-key-constraint" name="unique-key-constraint" class="anchor"><span class="anchor-link"></span></a>Unique Key constraint</h3>
<p>By choice, a ParameterSet in either <strong>Setup, Observe,</strong> or <strong>Wait</strong> command will be optimized to store only unique keys. In other words, trying to store multiple keys with same name, will be automatically optimized by removing duplicates.</p><div class="callout note "><div class="callout-title">Note</div>
<p>Parameters are stored in a Set, which is an unordered collection of items. Hence, it&rsquo;s not predictable whether first or last duplicate copy will be retained. Hence, cautiously avoid adding duplicate keys.</p></div>
<p>Here are some examples that illustrate this point:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">//keys
val encoderKey: Key[Int] = KeyType.IntKey.make(&quot;encoder&quot;)
val filterKey: Key[Int]  = KeyType.IntKey.make(&quot;filter&quot;)
val miscKey: Key[Int]    = KeyType.IntKey.make(&quot;misc.&quot;)

//params
val encParam1: Parameter[Int] = encoderKey.set(1)
val encParam2: Parameter[Int] = encoderKey.set(2)
val encParam3: Parameter[Int] = encoderKey.set(3)

val filterParam1: Parameter[Int] = filterKey.set(1)
val filterParam2: Parameter[Int] = filterKey.set(2)
val filterParam3: Parameter[Int] = filterKey.set(3)

val miscParam1 = miscKey.set(100)

//Setup command with duplicate key via constructor
val setup: Setup =
  Setup(prefix,
        CommandName(&quot;move&quot;),
        Some(obsId),
        Set(encParam1, encParam2, encParam3, filterParam1, filterParam2, filterParam3))
//four duplicate keys are removed; now contains one Encoder and one Filter key
val uniqueKeys1 = setup.paramSet.toList.map(_.keyName)

//try adding duplicate keys via add + madd
val changedSetup: Setup = setup
  .add(encParam3)
  .madd(
    filterParam1,
    filterParam2,
    filterParam3
  )
//duplicate keys will not be added. Should contain one Encoder and one Filter key
val uniqueKeys2: List[String] = changedSetup.paramSet.toList.map(_.keyName)

//miscKey(unique) will be added; encoderKey(duplicate) will not be added
val finalSetUp: Setup = setup.madd(Set(miscParam1, encParam1))
//now contains encoderKey, filterKey, miscKey
val uniqueKeys3: List[String] = finalSetUp.paramSet.toList.map(_.keyName)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">//keys
Key&lt;Integer&gt; encoderKey = JKeyTypes.IntKey().make(&quot;encoder&quot;);
Key&lt;Integer&gt; filterKey = JKeyTypes.IntKey().make(&quot;filter&quot;);
Key&lt;Integer&gt; miscKey = JKeyTypes.IntKey().make(&quot;misc.&quot;);

//prefix
String prefix = &quot;wfos.blue.filter&quot;;

//params
Parameter&lt;Integer&gt; encParam1 = encoderKey.set(1);
Parameter&lt;Integer&gt; encParam2 = encoderKey.set(2);
Parameter&lt;Integer&gt; encParam3 = encoderKey.set(3);

Parameter&lt;Integer&gt; filterParam1 = filterKey.set(1);
Parameter&lt;Integer&gt; filterParam2 = filterKey.set(2);
Parameter&lt;Integer&gt; filterParam3 = filterKey.set(3);

Parameter&lt;Integer&gt; miscParam1 = miscKey.set(100);

//Setup command with duplicate key via madd
Setup setup = new Setup(new Prefix(prefix), new CommandName(&quot;move&quot;), Optional.of(obsId)).madd(
        encParam1,
        encParam2,
        encParam3,
        filterParam1,
        filterParam2,
        filterParam3);
//four duplicate keys are removed; now contains one Encoder and one Filter key
List&lt;String&gt; uniqueKeys1 = setup.jParamSet().stream().map(Parameter::keyName).collect(Collectors.toList());

//try adding duplicate keys via add + madd
Setup changedSetup = setup.add(encParam3).madd(filterParam1, filterParam2, filterParam3);
//duplicate keys will not be added. Should contain one Encoder and one Filter key
List&lt;String&gt; uniqueKeys2 = changedSetup.jParamSet().stream().map(Parameter::keyName).collect(Collectors.toList());

//miscKey(unique) will be added; encoderKey(duplicate) will not be added
Setup finalSetUp = setup.madd(miscParam1, encParam1);
//now contains encoderKey, filterKey, miscKey
List&lt;String&gt; uniqueKeys3 = finalSetUp.jParamSet().stream().map(Parameter::keyName).collect(Collectors.toList());</code></pre></dd>
</dl>
<h3><a href="#cloning-a-command" name="cloning-a-command" class="anchor"><span class="anchor-link"></span></a>Cloning a command</h3>
<p>A <code>cloneCommand</code> method is available for all commands which can be used to create a new command from existing parameters, but with a new RunId. </p><div class="callout note "><div class="callout-title">Note</div>
<p>Any command that is sent needs to have a unique Id as this Id is the one against which the status of the command is maintained at the recipient end. This Id can thus be used to query and subscribe the status of the respective command.</p></div>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val setup  = Setup(prefix, commandName, Some(obsId)).madd(i1)
val setup2 = setup.cloneCommand

val observe  = Observe(prefix, commandName, Some(obsId)).madd(i1)
val observe2 = observe.cloneCommand

val wait  = Wait(prefix, commandName, Some(obsId)).madd(i1)
val wait2 = wait.cloneCommand</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">Setup setup = new Setup(new Prefix(prefix), commandName, Optional.of(obsId)).add(encoderParam);
Setup setup2 = setup.cloneCommand();

Observe observe = new Observe(new Prefix(prefix), commandName, Optional.empty()).add(encoderParam);
Observe observe2 = observe.cloneCommand();

Wait wait = new Wait(new Prefix(prefix), commandName, Optional.of(obsId)).add(encoderParam);
Wait wait2 = wait.cloneCommand();</code></pre></dd>
</dl>
<h2><a href="#source-code-for-examples" name="source-code-for-examples" class="anchor"><span class="anchor-link"></span></a>Source code for examples</h2>
<ul>
  <li><a href="https://github.com/tmtsoftware/csw-prod/tree/master/examples/src/test/scala/csw/services/messages/CommandsTest.scala">Scala Example</a></li>
  <li><a href="https://github.com/tmtsoftware/csw-prod/tree/master/examples/src/test/java/csw/services/messages/JCommandsTest.java">Java Example</a></li>
</ul>
</div>
<div>
<a href="https://github.com/tmtsoftware/csw-prod/tree/master/docs/src/main/messages/commands.md" title="Edit this page" class="md-source-file md-edit">
Edit this page
</a>
</div>
<div class="print-only">
<span class="md-source-file md-version">
0.1*
</span>
</div>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-nav">
<nav class="md-footer-nav__inner md-grid">
<a href="../messages/subsystem.html" title="Subsystem" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
</div>
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Previous
</span>
Subsystem
</span>
</div>
</a>
<a href="../messages/events.html" title="Events" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Next
</span>
Events
</span>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
</div>
</a>
</nav>
</div>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
Powered by
<a href="https://github.com/lightbend/paradox" title="Paradox">Paradox</a>
and
<a href="https://jonas.github.io/paradox-material-theme/" title="Paradox Material Theme">Paradox Material Theme</a>

</div>
<div class="md-footer-social">
</div>

</div>
</div>
</footer>

</div>
<script src="../assets/javascripts/application-268d62d82d.js"></script>
<script src="../assets/javascripts/paradox-material-theme.js"></script>
<script>app.initialize({url:{base:".././"}})</script>
<script type="text/javascript" src="../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function(event) {
window.prettyPrint && prettyPrint();
});
</script>
</body>
</html>
