<!DOCTYPE html>
<html class="no-js" lang="en">

<head>
<title>Logging service · TMT Common Software (CSW)</title>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="description" content='docs'/>
<link href="https://fonts.googleapis.com/css?family=Roboto:100normal,100italic,300normal,300italic,400normal,400italic,500normal,500italic,700normal,700italic,900normal,900italicc" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../lib/jquery/jquery.min.js"></script>
<script type="text/javascript" src="../js/page.js"></script>
<script type="text/javascript" src="../js/groups.js"></script>
<link rel="stylesheet" type="text/css" href="../lib/normalize.css/normalize.css"/>
<link rel="stylesheet" type="text/css" href="../lib/foundation/dist/foundation.min.css"/>
<link rel="stylesheet" type="text/css" href="../css/page.css"/>

<!--
<link rel="shortcut icon" href="../images/favicon.ico" />
-->
</head>

<body>
<div class="off-canvas-wrapper">
<div class="off-canvas-wrapper-inner" data-off-canvas-wrapper>

<div class="off-canvas position-left" id="off-canvas-menu" data-off-canvas>
<nav class="off-canvas-nav">
<div class="nav-home">
<a href="../index.html" >
<span class="home-icon">⌂</span>TMT Common Software (CSW)
</a>
<div class="version-number">
0.1*
</div>
</div>
<div class="nav-toc">
<ul>
  <li><a href="../manuals.html" class="page">Manuals</a></li>
  <li><a href="../apps.html" class="page">Applications</a>
  <ul>
    <li><a href="../apps/cswclusterseed.html" class="page">csw-cluster-seed</a></li>
    <li><a href="../apps/cswlocationagent.html" class="page">csw-location-agent</a></li>
    <li><a href="../apps/cswonfigserverapp.html" class="page">csw-config-server</a></li>
    <li><a href="../apps/cswconfigclientcli.html" class="page">csw-config-client-cli</a></li>
  </ul></li>
  <li><a href="../services.html" class="page">Services</a>
  <ul>
    <li><a href="../services/location.html" class="page">Location service</a></li>
    <li><a href="../services/config.html" class="page">Configuration service</a></li>
    <li><a href="../services/logging.html" class="active page">Logging service</a></li>
  </ul></li>
</ul>
</div>

</nav>
</div>

<div class="off-canvas-content" data-off-canvas-content>

<header class="site-header expanded row">
<div class="small-12 column">
<a href="#" class="off-canvas-toggle hide-for-medium" data-toggle="off-canvas-menu"><svg class="svg-icon svg-icon-menu" version="1.1" id="Menu" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve"> <path class="svg-icon-menu-path" fill="#53CDEC" d="M16.4,9H3.6C3.048,9,3,9.447,3,10c0,0.553,0.048,1,0.6,1H16.4c0.552,0,0.6-0.447,0.6-1C17,9.447,16.952,9,16.4,9z M16.4,13
H3.6C3.048,13,3,13.447,3,14c0,0.553,0.048,1,0.6,1H16.4c0.552,0,0.6-0.447,0.6-1C17,13.447,16.952,13,16.4,13z M3.6,7H16.4
C16.952,7,17,6.553,17,6c0-0.553-0.048-1-0.6-1H3.6C3.048,5,3,5.447,3,6C3,6.553,3.048,7,3.6,7z"/></svg>
</a>
<div class="title"><a href="../index.html">TMT Common Software (CSW)</a></div>

<!--
<a href="https://www.example.com" class="logo show-for-medium">logo</a>
-->
</div>
</header>

<div class="expanded row">

<div class="medium-3 large-2 show-for-medium column">
<nav class="site-nav">
<div class="nav-home">
<a href="../index.html" >
<span class="home-icon">⌂</span>TMT Common Software (CSW)
</a>
<div class="version-number">
0.1*
</div>
</div>
<div class="nav-toc">
<ul>
  <li><a href="../manuals.html" class="page">Manuals</a></li>
  <li><a href="../apps.html" class="page">Applications</a>
  <ul>
    <li><a href="../apps/cswclusterseed.html" class="page">csw-cluster-seed</a></li>
    <li><a href="../apps/cswlocationagent.html" class="page">csw-location-agent</a></li>
    <li><a href="../apps/cswonfigserverapp.html" class="page">csw-config-server</a></li>
    <li><a href="../apps/cswconfigclientcli.html" class="page">csw-config-client-cli</a></li>
  </ul></li>
  <li><a href="../services.html" class="page">Services</a>
  <ul>
    <li><a href="../services/location.html" class="page">Location service</a></li>
    <li><a href="../services/config.html" class="page">Configuration service</a></li>
    <li><a href="../services/logging.html" class="active page">Logging service</a></li>
  </ul></li>
</ul>
</div>

</nav>
</div>

<div class="small-12 medium-9 large-10 column">
<section class="site-content">

<div class="page-header row">
<div class="medium-12 show-for-medium column">
<div class="nav-breadcrumbs">
<ul>
  <li><a href="../index.html">TMT Common Software (CSW)</a></li>
  <li><a href="../services.html">Services</a></li>
  <li>Logging service</li>
</ul>
</div>
</div>
</div>

<div class="page-content row">
<div class="small-12 large-9 column" id="docs">
<h1><a href="#logging-service" name="logging-service" class="anchor"><span class="anchor-link"></span></a>Logging service</h1>
<p>Logging Service library provides an advanced logging facility for csw components and services. </p>
<h2><a href="#artifacts" name="artifacts" class="anchor"><span class="anchor-link"></span></a>Artifacts</h2>
<dl>
  <dt>sbt</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">libraryDependencies += &quot;org.tmt&quot; %% &quot;csw-logging_2.12&quot; % &quot;0.1-SNAPSHOT&quot;
</code></pre></dd>
  <dt>maven</dt>
  <dd>
  <pre class="prettyprint"><code class="language-xml">&lt;dependency&gt;
 &lt;groupId&gt;org.tmt&lt;/groupId&gt;
 &lt;artifactId&gt;csw-logging_2.12&lt;/artifactId&gt;
 &lt;version&gt;0.1-SNAPSHOT&lt;/version&gt;
 &lt;type&gt;pom&lt;/type&gt;
&lt;/dependency&gt;
</code></pre></dd>
  <dt>gradle</dt>
  <dd>
  <pre class="prettyprint"><code class="language-gradle">dependencies {
  compile group: &quot;org.tmt&quot;, name: &quot;csw-logging_2.12&quot;, version: &quot;0.1-SNAPSHOT&quot;
}
</code></pre></dd>
</dl>
<h2><a href="#configuration" name="configuration" class="anchor"><span class="anchor-link"></span></a>Configuration</h2>
<p>These are the relevant default configuration values for logging</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-conf">akka {
  // Customised AkkaLogger to intercept akka log messages generated from akka framework code
  loggers = [csw.services.logging.compat.AkkaLogger]
  loglevel = info
  actor {
    debug {
      lifecycle = off
    }
  }
}

csw-logging {
    appenders {
      file {
        // Include standard headers
        fullHeaders = true
        // Sort the fields in Json objects
        sorted = true
        // Directory to hold log files
        logPath = &quot;target/log&quot;
        // Include the service name as a sub-directory for logs
        serviceInPath = false
        // Common log messages below this level are removed, none removed when set to trace
        logLevelLimit = trace
      }
      stdout {
        // Include standard headers
        fullHeaders = false
        // Use colors for log levels
        color = true
        // The maximum number of character that should be on a line
        // This is only a goal; in practice some may contain more characters.
        width = 80
        // Print summary counts when logger is closed
        summary = true
        // pretty output - multiple line json
        pretty = false
        // Messages below this level are removed, none removed when set to trace
        logLevelLimit = trace
        // false Json output; true simple one line text output
        oneLine = false
      }
    }
    // Log level for logger API
    logLevel = info
    // Log level for slf4j messages
    slf4jLogLevel = info
    // Log level for Akka messages, should be &gt;= akka.loglevel
    akkaLogLevel = info
    // Enable timing logging
    time = false
    //Enable garbage collection loggign
    gc = false
  }
</code></pre></dd>
</dl>
<p>These values can be overridden directly in your reference.conf or application.conf</p>
<h2><a href="#log-levels" name="log-levels" class="anchor"><span class="anchor-link"></span></a>Log Levels</h2>
<p>Following Log levels are supported by csw-logging library</p>
<ul>
  <li>FATAL</li>
  <li>ERROR</li>
  <li>WARN</li>
  <li>INFO</li>
  <li>DEBUG</li>
  <li>TRACE</li>
</ul>
<p>There are separate log levels for the logging API(logLevel), Akka logging(akkaLogLevel), and Slf4J(slf4jLogLevel). The initial values of these are set in the configuration file as seen above. These can be overriden in the application.conf file.</p>
<p>These values can also be changed dynamically by calling methods on <code>LoggingSystem</code> class.</p>
<h2><a href="#log-structure" name="log-structure" class="anchor"><span class="anchor-link"></span></a>Log Structure</h2>
<p>All messages are logged by default as Json. Logs can contain the following fields. These are listed in alphabetical order (this is the order displayed by the Json pretty printer).</p>
<ul>
  <li><code>@componentName</code>: The name of the component if present</li>
  <li><code>@host</code>: The local host name</li>
  <li><code>@name</code>: The name and version of the application being run</li>
  <li><code>@severity</code>: The message level: trace, debug, info, warn, error or fatal</li>
  <li><code>actor</code>: The path for an actor when using ActorLogging</li>
  <li><code>class</code>: The class for ClassLogging or ActorLogging</li>
  <li><code>file</code>: The file containing the log call</li>
  <li><code>kind</code>: Either slf4j or akka. Not present for logger API</li>
  <li><code>line</code>: The line where the message was logged</li>
  <li><code>message</code>: The log message</li>
  <li><code>timestamp</code>: The time the message was logged</li>
  <li><code>trace</code>: Information for any exception specified in the logging call</li>
</ul><div class="callout note "><div class="callout-title">Note</div>
<ul>
  <li>@host and @name will appear in log statements only if <em>fullHeaders</em> is set as true in the configuration</li>
</ul></div>
<h2><a href="#create-loggingsystem" name="create-loggingsystem" class="anchor"><span class="anchor-link"></span></a>Create LoggingSystem</h2>
<p>In order to make logging statements appear in your program you need to start <code>LoggingSystem</code> as the first thing in your application. <code>LoggingSystem</code> should be started only once in your application. The name used while creating <code>LoggingSystem</code> will be used to create the folder and dump all logging files for your application in it.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">private val loggingSystem = LoggingSystemFactory.start(&quot;foo-name&quot;, &quot;hostname&quot;, ActorSystem(&quot;logging-system&quot;), Seq(StdOutAppender))</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">List&lt;LogAppenderBuilder&gt; appenders = Arrays.asList(JLogAppenderBuilders.StdOutAppender, JLogAppenderBuilders.FileAppender);

LoggingSystem loggingSystem = JLoggingSystemFactory.start(&quot;foo-name&quot;, &quot;hostname&quot;, ActorSystem.apply(&quot;logging-system&quot;), appenders);</code></pre></dd>
</dl>
<h2><a href="#enable-logging" name="enable-logging" class="anchor"><span class="anchor-link"></span></a>Enable logging</h2>
<h3><a href="#enable-generic-logging" name="enable-generic-logging" class="anchor"><span class="anchor-link"></span></a>Enable generic logging</h3>
<p>To enable logging for some utility code that does not require <code>@componentName</code> in log statements you can inherit following traits</p>
<dl>
  <dt>Scala</dt>
  <dd>
    <ul>
      <li>For actor class extend <code>GenericLogger.Actor</code></li>
    </ul>
    <ul>
      <li>For non-actor class extend <code>GenericLogger.Simple</code></li>
    </ul>
  </dd>
  <dt>Java</dt>
  <dd>
    <ul>
      <li>For actor class inherit <code>JGenericLoggerActor</code></li>
    </ul>
    <ul>
      <li>For non-actor class inherit <code>JGenericLogger</code></li>
    </ul>
  </dd>
</dl>
<h3><a href="#enable-component-level-logging" name="enable-component-level-logging" class="anchor"><span class="anchor-link"></span></a>Enable component level logging</h3>
<p>Whereas, if you want to include <code>@componentName</code> in your log statements you need to first create an object/abstract class/interface as follows:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">object ExampleLogger extends ComponentLogger(&quot;examples&quot;)</code></pre></dd>
  <dt>Actor Java Class</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">//JExampleLoggerActor is used for actor java class only
public abstract class JExampleLoggerActor extends JComponentLoggerActor {
    @Override
    public String componentName() {
        return &quot;examples&quot;;
    }
}</code></pre></dd>
  <dt>Non-Actor Java class
  </dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">//JExampleLogger is used for non-actor java class only
public interface JExampleLogger extends JComponentLogger {
    @Override
    default String componentName() {
        return &quot;examples&quot;;
    }
}</code></pre></dd>
</dl>
<p>Then, you need to inherit following object/interface</p>
<dl>
  <dt>Scala</dt>
  <dd>
    <ul>
      <li>For actor class extend <code>ExampleLogger.Actor</code></li>
    </ul>
    <ul>
      <li>For non-actor class extend <code>ExampleLogger.Simple</code></li>
    </ul>
  </dd>
  <dt>Java</dt>
  <dd>
    <ul>
      <li>For actor class inherit <code>JExampleLoggerActor</code></li>
    </ul>
    <ul>
      <li>For non-actor class inherit <code>JExampleLogger</code></li>
    </ul>
  </dd>
</dl><div class="callout note "><div class="callout-title">If you are writing java code you need to get logger instance in your class </div>
<dl>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">private ILogger jLogger = getLogger();</code></pre></dd>
</dl></div>
<h2><a href="#log-statements" name="log-statements" class="anchor"><span class="anchor-link"></span></a>Log statements</h2>
<p>A basic info statement can be written as follows:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">log.info(s&quot;Result of the find call: $findResult&quot;)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">jLogger.info(() -&gt; &quot;Result of the find call : None&quot;);</code></pre></dd>
</dl>
<p>The output of log statement will be:</p>
<pre><code>{&quot;@componentName&quot;:&quot;examples&quot;,
 &quot;@severity&quot;:&quot;INFO&quot;,
 &quot;actor&quot;:
   &quot;akka.tcp://csw-examples-locationServiceClient@10.131.20.68:51495/user/$a&quot;,
 &quot;class&quot;:&quot;csw.services.location.LocationServiceExampleClient&quot;,
 &quot;file&quot;:&quot;LocationServiceExampleClientApp.scala&quot;,
 &quot;line&quot;:119,
 &quot;message&quot;:&quot;Result of the find call: None&quot;,
 &quot;timestamp&quot;:&quot;2017-06-28T18:11:48.208000000+05:30&quot;
}

</code></pre>
<p>You can also use a <code>Map</code> in message as follows:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">log.info(Map(&quot;@msg&quot; → &quot;Attempting to find connection&quot;, &quot;exampleConnection&quot; → exampleConnection.toString))</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">jLogger.info(() -&gt; {
    HashMap&lt;String, String&gt; map = new HashMap&lt;&gt;();
    map.put(&quot;@msg&quot;, &quot;Attempting to find connection&quot;);
    map.put(&quot;exampleConnection&quot;, exampleConnection.toString());
    return map;
});</code></pre></dd>
</dl>
<p>The output of log statement will be: </p>
<pre><code>{&quot;@componentName&quot;:&quot;examples&quot;,
 &quot;@severity&quot;:&quot;INFO&quot;,
 &quot;actor&quot;:
   &quot;akka.tcp://csw-examples-locationServiceClient@10.131.20.68:51135/user/$a&quot;,
 &quot;class&quot;:&quot;csw.services.location.LocationServiceExampleClient&quot;,
 &quot;file&quot;:&quot;LocationServiceExampleClientApp.scala&quot;,
 &quot;line&quot;:111,
 &quot;message&quot;:
   {&quot;@msg&quot;:&quot;Attempting to find connection&quot;,
    &quot;exampleConnection&quot;:
      &quot;AkkaConnection(ComponentId(LocationServiceExampleComponent,Assembly))&quot;
   },
 &quot;timestamp&quot;:&quot;2017-06-28T17:17:34.848000000+05:30&quot;
}

</code></pre>
<p>Also you can log an error with stacktrace as follows:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">log.error(runtimeException.getMessage, runtimeException)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">jLogger.info(() -&gt; runtimeException.getMessage(), runtimeException);</code></pre></dd>
</dl>
<div class="source-github">
The source code for this page can be found <a href="https://github.com/tmtsoftware/csw-prod/tree/master/docs/src/main/services/logging.md">here</a>.
</div>

</div>
<div class="large-3 show-for-large column" data-sticky-container>
<nav class="sidebar sticky" data-sticky data-anchor="docs" data-sticky-on="large">
<div class="page-nav">
<div class="nav-title">On this page:</div>
<div class="nav-toc">
<ul>
  <li><a href="../services/logging.html#logging-service" class="header">Logging service</a>
  <ul>
    <li><a href="../services/logging.html#artifacts" class="header">Artifacts</a></li>
    <li><a href="../services/logging.html#configuration" class="header">Configuration</a></li>
    <li><a href="../services/logging.html#log-levels" class="header">Log Levels</a></li>
    <li><a href="../services/logging.html#log-structure" class="header">Log Structure</a></li>
    <li><a href="../services/logging.html#create-loggingsystem" class="header">Create LoggingSystem</a></li>
    <li><a href="../services/logging.html#enable-logging" class="header">Enable logging</a></li>
    <li><a href="../services/logging.html#log-statements" class="header">Log statements</a></li>
  </ul></li>
</ul>
</div>
</div>
</nav>
</div>
</div>

</section>
</div>

</div>

<footer class="site-footer">

<section class="site-footer-nav">
<div class="expanded row">
<div class="small-12 large-offset-2 large-10 column">
<div class="row site-footer-content">

<div class="small-12 medium-4 large-3 text-center column">
<div class="nav-links">
<ul>
<!-- <li><a href="https://www.example.com/products/">Products</a> -->
</ul>
</div>
</div>

</div>
</div>
</div>
</section>

<section class="site-footer-base">
<div class="expanded row">
<div class="small-12 large-offset-2 large-10 column">
<div class="row site-footer-content">

<div class="small-12 text-center large-9 column">

<!--
<div class="copyright">
<span class="text">&copy; 2017</span>
<a href="https://www.example.com" class="logo">logo</a>
</div>
-->
</div>

</div>
</div>
</div>
</section>
</footer>

</div>
</div>
</div>
</body>

<script type="text/javascript" src="../lib/foundation/dist/foundation.min.js"></script>
<script type="text/javascript">jQuery(document).foundation();</script>
<script type="text/javascript" src="../js/magellan.js"></script>

<style type="text/css">@import "../lib/prettify/prettify.css";</style>
<script type="text/javascript" src="../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">jQuery(function(){window.prettyPrint && prettyPrint()});</script>

</html>
