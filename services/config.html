<!DOCTYPE html>
<html class="no-js" lang="en">

<head>
<title>Configuration service · TMT Common Software (CSW)</title>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="description" content='docs'/>
<link href="https://fonts.googleapis.com/css?family=Roboto:100normal,100italic,300normal,300italic,400normal,400italic,500normal,500italic,700normal,700italic,900normal,900italicc" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../lib/jquery/jquery.min.js"></script>
<script type="text/javascript" src="../js/page.js"></script>
<link rel="stylesheet" type="text/css" href="../lib/normalize.css/normalize.css"/>
<link rel="stylesheet" type="text/css" href="../lib/foundation/dist/foundation.min.css"/>
<link rel="stylesheet" type="text/css" href="../css/page.css"/>

<!--
<link rel="shortcut icon" href="../images/favicon.ico" />
-->
</head>

<body>
<div class="off-canvas-wrapper">
<div class="off-canvas-wrapper-inner" data-off-canvas-wrapper>

<div class="off-canvas position-left" id="off-canvas-menu" data-off-canvas>
<nav class="off-canvas-nav">
<div class="nav-home">
<a href="../index.html" >
<span class="home-icon">⌂</span>TMT Common Software (CSW)
</a>
<div class="version-number">
0.1*
</div>
</div>
<div class="nav-toc">
<ul>
  <li><a href="../manuals.html">Manuals</a></li>
  <li><a href="../apps.html">Applications</a>
  <ul>
    <li><a href="../apps/cswclusterseed.html">csw-cluster-seed</a></li>
    <li><a href="../apps/cswlocationagent.html">csw-location-agent</a></li>
    <li><a href="../apps/cswonfigserverapp.html">csw-config-server</a></li>
    <li><a href="../apps/cswconfigclientcli.html">csw-config-client-cli</a></li>
  </ul></li>
  <li><a href="../services.html">Services</a>
  <ul>
    <li><a href="../services/location.html">Location service</a></li>
    <li><a href="../services/config.html" class="active">Configuration service</a></li>
  </ul></li>
</ul>
</div>

</nav>
</div>

<div class="off-canvas-content" data-off-canvas-content>

<header class="site-header expanded row">
<div class="small-12 column">
<a href="#" class="off-canvas-toggle hide-for-medium" data-toggle="off-canvas-menu"><svg class="svg-icon svg-icon-menu" version="1.1" id="Menu" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve"> <path class="svg-icon-menu-path" fill="#53CDEC" d="M16.4,9H3.6C3.048,9,3,9.447,3,10c0,0.553,0.048,1,0.6,1H16.4c0.552,0,0.6-0.447,0.6-1C17,9.447,16.952,9,16.4,9z M16.4,13
H3.6C3.048,13,3,13.447,3,14c0,0.553,0.048,1,0.6,1H16.4c0.552,0,0.6-0.447,0.6-1C17,13.447,16.952,13,16.4,13z M3.6,7H16.4
C16.952,7,17,6.553,17,6c0-0.553-0.048-1-0.6-1H3.6C3.048,5,3,5.447,3,6C3,6.553,3.048,7,3.6,7z"/></svg>
</a>
<div class="title"><a href="../index.html">TMT Common Software (CSW)</a></div>

<!--
<a href="https://www.example.com" class="logo show-for-medium">logo</a>
-->
</div>
</header>

<div class="expanded row">

<div class="medium-3 large-2 show-for-medium column">
<nav class="site-nav">
<div class="nav-home">
<a href="../index.html" >
<span class="home-icon">⌂</span>TMT Common Software (CSW)
</a>
<div class="version-number">
0.1*
</div>
</div>
<div class="nav-toc">
<ul>
  <li><a href="../manuals.html">Manuals</a></li>
  <li><a href="../apps.html">Applications</a>
  <ul>
    <li><a href="../apps/cswclusterseed.html">csw-cluster-seed</a></li>
    <li><a href="../apps/cswlocationagent.html">csw-location-agent</a></li>
    <li><a href="../apps/cswonfigserverapp.html">csw-config-server</a></li>
    <li><a href="../apps/cswconfigclientcli.html">csw-config-client-cli</a></li>
  </ul></li>
  <li><a href="../services.html">Services</a>
  <ul>
    <li><a href="../services/location.html">Location service</a></li>
    <li><a href="../services/config.html" class="active">Configuration service</a></li>
  </ul></li>
</ul>
</div>

</nav>
</div>

<div class="small-12 medium-9 large-10 column">
<section class="site-content">

<div class="page-header row">
<div class="medium-12 show-for-medium column">
<div class="nav-breadcrumbs">
<ul>
  <li><a href="../index.html">TMT Common Software (CSW)</a></li>
  <li><a href="../services.html">Services</a></li>
  <li>Configuration service</li>
</ul>
</div>
</div>
</div>

<div class="page-content row">
<div class="small-12 large-9 column" id="docs">
<h1><a href="#configuration-service" name="configuration-service" class="anchor"><span class="anchor-link"></span></a>Configuration service</h1>
<p>Configuration Service provides a centralized persistent store for any configuration file used in the TMT Software System. All versions of configuration files are retained providing a historical record of each configuration file.</p>
<p>This service will be part of observatory cluster and exposes Rest endpoints that can be accessed over HTTP. Component developers can use the csw-config-client library in their code. The library wraps the low level communication with ConfigServer and exposes simple to use methods to access and manage configuration files. </p>
<h2><a href="#artifacts" name="artifacts" class="anchor"><span class="anchor-link"></span></a>Artifacts</h2>
<dl>
  <dt>sbt</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">libraryDependencies += &quot;org.tmt&quot; %% &quot;csw-config_2.12&quot; % &quot;0.1-SNAPSHOT&quot;
</code></pre></dd>
  <dt>maven</dt>
  <dd>
  <pre class="prettyprint"><code class="language-xml">&lt;dependency&gt;
 &lt;groupId&gt;org.tmt&lt;/groupId&gt;
 &lt;artifactId&gt;csw-config_2.12&lt;/artifactId&gt;
 &lt;version&gt;0.1-SNAPSHOT&lt;/version&gt;
 &lt;type&gt;pom&lt;/type&gt;
&lt;/dependency&gt;
</code></pre></dd>
  <dt>gradle</dt>
  <dd>
  <pre class="prettyprint"><code class="language-gradle">dependencies {
  compile group: &quot;org.tmt&quot;, name: &quot;csw-config_2.12&quot;, version: &quot;0.1-SNAPSHOT&quot;
}
</code></pre></dd>
</dl>
<h2><a href="#rules-and-checks" name="rules-and-checks" class="anchor"><span class="anchor-link"></span></a>Rules and checks</h2>
<ul>
  <li>The config file path must not contain <code>!#&lt;&gt;$%&amp;&#39;@^``~+,;=</code> or <code>any whitespace character</code></li>
  <li>If the input file is &gt; 10MB or has lot of non ASCII characters, then for optimization, server will archive it in <code>annex</code> store.</li>
  <li>Large and binary files can be forced to go to &lsquo;annex&rsquo; store by using a <code>annex=true</code> flag in <code>create</code> operation.</li>
  <li>API functions accept date-time values in UTC timezone. (e.g. 2017-05-17T08:00:24.246Z)</li>
</ul>
<h2><a href="#model-classes" name="model-classes" class="anchor"><span class="anchor-link"></span></a>Model classes</h2>
<ul>
  <li><strong>ConfigData</strong> : Represents the contents of the files being managed. It wraps stream of ByteString.</li>
  <li><strong>ConfigFileInfo</strong> : Represents information about a config file stored in the config service.</li>
  <li><strong>ConfigFileRevision</strong> : Represents information about a specific version of a config file.</li>
  <li><strong>ConfigId</strong> : Represents identifier associated with a revision of configuration file, often generated by <code>create</code> or <code>update</code> methods.</li>
  <li><strong>ConfigMetadata</strong> : Represents metadata information about ConfigServer.</li>
  <li><strong>FileType</strong> : Represents the type of storage for a configuration file. Currently two types are supported <code>Normal</code>(small, text files) and <code>Annex</code>(Large, Binary files).</li>
</ul>
<h2><a href="#api-flavours" name="api-flavours" class="anchor"><span class="anchor-link"></span></a>API flavours</h2>
<p>csw-config-client offers two APIs.</p>
<ul>
  <li><strong>clientAPI</strong> : Expected to be consumed by component developers. Available functions are: <code>{exists | getActive}</code></li>
  <li><strong>adminAPI</strong> : Full functionality exposed by ConfigServer is available with this API. Expected to be used administrators. Available functions are: <code>{create | update | getById | getLatest | getByTime | delete | list | history | historyActive | setActiveVersion | resetActiveVersion | getActiveVersion | getActiveByTime | getMetadata | exists | getActive}</code></li>
</ul>
<h2><a href="#accessing-clientapi-and-adminapi" name="accessing-clientapi-and-adminapi" class="anchor"><span class="anchor-link"></span></a>Accessing clientAPI and adminAPI</h2>
<p>ConfigClientFactory exposes functions to get clientAPI and adminAPI. Both the functions require LocationService instance which is used to resolve ConfigServer.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">//config client API
val clientApi: ConfigClientService = ConfigClientFactory.clientApi(actorSystem, locationService)
//config admin API
val adminApi: ConfigService = ConfigClientFactory.adminApi(actorSystem, locationService)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">//config client API
IConfigClientService clientApi = JConfigClientFactory.clientApi(actorRuntime.actorSystem(), clientLocationService);
//config admin API
IConfigService adminApi = JConfigClientFactory.adminApi(actorRuntime.actorSystem(), clientLocationService);</code></pre></dd>
</dl>
<h2><a href="#exists" name="exists" class="anchor"><span class="anchor-link"></span></a>exists</h2>
<p>Function checks if the file exists at specified path in the repository. If it exists it returns Future of Boolean</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">//construct the path
val filePath = Paths.get(&quot;/tmt/trmobone/assembly/hcd.conf&quot;)

// create file using admin API
adminApi.create(filePath, ConfigData.fromString(defaultStrConf), annex = false, &quot;First commit&quot;).await

val doneF = async {
  //check if file exists with config service
  val exists: Boolean = await(clientApi.exists(filePath))
  exists shouldBe true
}
Await.result(doneF, 5.seconds)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">Path filePath = Paths.get(&quot;/tmt/trmobone/assembly/hcd.conf&quot;);

// create file using admin API
adminApi.create(filePath, ConfigData.fromString(defaultStrConf), false, &quot;commit config file&quot;).get();

Boolean exists = clientApi.exists(filePath).get();
Assert.assertTrue(exists);</code></pre></dd>
</dl>
<h2><a href="#getactive" name="getactive" class="anchor"><span class="anchor-link"></span></a>getActive</h2>
<p>Function retrieves currently active file for a given path from config service. It returns a Future of Option of ConfigData.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val defaultStrConf: String = &quot;foo { bar { baz : 1234 } }&quot;
val doneF = async {
  // construct the path
  val filePath = Paths.get(&quot;/tmt/trmobone/assembly/hcd.conf&quot;)

  await(adminApi.create(filePath, ConfigData.fromString(defaultStrConf), annex = false, &quot;First commit&quot;))

  val activeFile: Option[ConfigData] = await(clientApi.getActive(filePath))
  await(activeFile.get.toStringF) shouldBe defaultStrConf
}
Await.result(doneF, 5.seconds)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">String defaultStrConf = &quot;foo { bar { baz : 1234 } }&quot;;
// construct the path
Path filePath = Paths.get(&quot;/tmt/trmobone/assembly/hcd.conf&quot;);

adminApi.create(filePath, ConfigData.fromString(defaultStrConf), false, &quot;First commit&quot;).get();

ConfigData activeFile = clientApi.getActive(filePath).get().get();
Assert.assertEquals(activeFile.toJConfigObject(mat).get().getString(&quot;foo.bar.baz&quot;), &quot;1234&quot;);</code></pre></dd>
</dl>
<h2><a href="#create" name="create" class="anchor"><span class="anchor-link"></span></a>create</h2>
<p>Takes input ConfigData and creates the configuration in the repository at a specified path</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">  async {
    //construct ConfigData from String containing ASCII text
    val configString: String =
      &quot;&quot;&quot;
    // Name: ComponentType ConnectionType
    {
      name: lgsTromboneHCD
      type: Hcd
      connectionType: [akka]
    }
    &quot;&quot;&quot;.stripMargin
    val config1: ConfigData = ConfigData.fromString(configString)

    //construct ConfigData from a local file containing binary data
    val srcFilePath         = getClass.getClassLoader.getResource(&quot;smallBinary.bin&quot;).toURI
    val config2: ConfigData = ConfigData.fromPath(Paths.get(srcFilePath))

    //construct ConfigData from Array[Byte] by reading a local file
    val stream: InputStream    = getClass.getClassLoader.getResourceAsStream(&quot;smallBinary.bin&quot;)
    def byteArray: Array[Byte] = Stream.continually(stream.read).takeWhile(_ != -1).map(_.toByte).toArray
    val config3                = ConfigData.fromBytes(byteArray)

    //store the config, at a specified path as normal text file
    val id1: ConfigId =
      await(adminApi.create(Paths.get(&quot;/hcd/trombone/overnight.conf&quot;), config1, false, &quot;review done&quot;))

    //store the config, at a specified path as a binary file in annex store
    val id2: ConfigId =
      await(adminApi.create(Paths.get(&quot;/hcd/trombone/firmware.bin&quot;), config2, true, &quot;smoke test done&quot;))

    //store the config, at a specified path as a binary file in annex store
    val id3: ConfigId =
      await(adminApi.create(Paths.get(&quot;/hcd/trombone/debug.bin&quot;), config3, true, &quot;new file from vendor&quot;))

    //CAUTION: for demo example setup these IDs are returned. Don&#39;t assume them in production setup.
    id1 shouldEqual ConfigId(1)
    id2 shouldEqual ConfigId(3)
    id3 shouldEqual ConfigId(5)
  }
Await.result(futC, 2.seconds)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">//construct ConfigData from String containing ASCII text
String configString = &quot;axisName11111 = tromboneAxis\naxisName22222 = tromboneAxis2\naxisName3 = tromboneAxis3333&quot;;
ConfigData config1 = ConfigData.fromString(configString);

//construct ConfigData from a local file containing binary data
URI srcFilePath = getClass().getClassLoader().getResource(&quot;smallBinary.bin&quot;).toURI();
ConfigData config2 = ConfigData.fromPath(Paths.get(srcFilePath));

ConfigId id1 = adminApi.create(Paths.get(&quot;/hcd/trombone/overnight.conf&quot;), config1, false, &quot;review done&quot;).get();
ConfigId id2 = adminApi.create(Paths.get(&quot;/hcd/trombone/firmware.bin&quot;), config2, true, &quot;smoke test done&quot;).get();

//CAUTION: for demo example setup these IDs are returned. Don&#39;t assume them in production setup.
Assert.assertEquals(id1, new ConfigId(&quot;1&quot;));
Assert.assertEquals(id2, new ConfigId(&quot;3&quot;));</code></pre></dd>
</dl>
<h2><a href="#update" name="update" class="anchor"><span class="anchor-link"></span></a>update</h2>
<p>Takes input ConfigData and overwrites the configuration specified in the repository</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val futU = async {
  val destPath = Paths.get(&quot;/hcd/trombone/debug.bin&quot;)
  val newId = adminApi
    .update(destPath, ConfigData.fromString(defaultStrConf), comment = &quot;debug statements&quot;)
    .await

  //validate the returned id
  newId shouldEqual ConfigId(7)
}
Await.result(futU, 2.seconds)</code></pre></dd>
</dl>
<h2><a href="#delete" name="delete" class="anchor"><span class="anchor-link"></span></a>delete</h2>
<p>Deletes a file located at specified path in the repository</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val futD = async {
  val unwantedFilePath = Paths.get(&quot;/hcd/trombone/debug.bin&quot;)
  await(adminApi.delete(unwantedFilePath, &quot;no longer needed&quot;))
}
Await.result(futD, 2.seconds)</code></pre></dd>
</dl>
<h2><a href="#getbyid" name="getbyid" class="anchor"><span class="anchor-link"></span></a>getById</h2>
<p>Returns file at a given path and matching revision Id</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val doneF = async {
  // create a file using API first
  val filePath = Paths.get(&quot;/tmt/trmobone/assembly/hcd.conf&quot;)
  val id: ConfigId =
    await(adminApi.create(filePath, ConfigData.fromString(defaultStrConf), annex = false, &quot;First commit&quot;))

  //validate
  val actualData = await(adminApi.getById(filePath, id)).get
  await(actualData.toStringF) shouldBe defaultStrConf
}
Await.result(doneF, 2.seconds)</code></pre></dd>
</dl>
<h2><a href="#getlatest" name="getlatest" class="anchor"><span class="anchor-link"></span></a>getLatest</h2>
<p>Returns the latest versio of file stored at the given path.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val assertionF: Future[Assertion] = async {
  //create a file
  val filePath = Paths.get(&quot;/test.conf&quot;)
  await(adminApi.create(filePath, ConfigData.fromString(defaultStrConf), annex = false, &quot;initial configuration&quot;))

  //override the contents
  val newContent = &quot;I changed the contents!!!&quot;
  await(adminApi.update(filePath, ConfigData.fromString(newContent), &quot;changed!!&quot;))

  //get the latest file
  val newConfigData = await(adminApi.getLatest(filePath)).get
  //validate
  await(newConfigData.toStringF) shouldBe newContent
}
Await.result(assertionF, 2.seconds)</code></pre></dd>
</dl>
<h2><a href="#getbytime" name="getbytime" class="anchor"><span class="anchor-link"></span></a>getByTime</h2>
<p>Gets the file at the given path as it existed at a given time-instance. Note: </p>
<ul>
  <li>If time-instance is before the file was created, the initial version is returned.</li>
  <li>If time-instance is after the last change, the most recent version is returned.</li>
</ul>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val assertionF = async {
  val tInitial = Instant.MIN
  //create a file
  val filePath = Paths.get(&quot;/a/b/c/test.conf&quot;)
  await(adminApi.create(filePath, ConfigData.fromString(defaultStrConf), annex = false, &quot;initial configuration&quot;))

  //override the contents
  val newContent = &quot;I changed the contents!!!&quot;
  await(adminApi.update(filePath, ConfigData.fromString(newContent), &quot;changed!!&quot;))

  val initialData: ConfigData = await(adminApi.getByTime(filePath, tInitial)).get
  await(initialData.toStringF) shouldBe defaultStrConf

  val latestData = await(adminApi.getByTime(filePath, Instant.now())).get
  await(latestData.toStringF) shouldBe newContent
}
Await.result(assertionF, 2.seconds)</code></pre></dd>
</dl>
<h2><a href="#list" name="list" class="anchor"><span class="anchor-link"></span></a>list</h2>
<p>For a given FileType(Annex or Normal) and an optional pattern string, it will list all files whose path matches the given pattern. Some pattern examples are: &ldquo;/path/hcd/*.*&rdquo;, &ldquo;a/b/c/d.*&rdquo;, &ldquo;.*.conf&rdquo;, &ldquo;.*hcd.*&rdquo;</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">//Here&#39;s a list of tuples containing FilePath and FileTyepe(Annex / Normal)
val paths: List[(Path, FileType)] = List[(Path, FileType)](
  (Paths.get(&quot;a/c/trombone.conf&quot;), FileType.Annex),
  (Paths.get(&quot;a/b/c/hcd/hcd.conf&quot;), FileType.Normal),
  (Paths.get(&quot;a/b/assembly/assembly1.fits&quot;), FileType.Annex),
  (Paths.get(&quot;a/b/c/assembly/assembly2.fits&quot;), FileType.Normal),
  (Paths.get(&quot;testing/test.conf&quot;), FileType.Normal)
)

//create config files at those paths
paths map {
  case (path, fileType) ⇒
    val createF = async {
      await(adminApi.create(path, ConfigData.fromString(defaultStrConf), FileType.Annex == fileType,
          &quot;initial commit&quot;))
    }
    Await.result(createF, 2.seconds)
}

val assertionF = async {
  //retrieve list of all files
  await(adminApi.list()).map(info ⇒ info.path).toSet shouldBe paths.map {
    case (path, fileType) ⇒ path
  }.toSet
  //retrieve list of files based on type
  await(adminApi.list(Some(FileType.Annex))).size shouldBe 2
  await(adminApi.list(Some(FileType.Normal))).size shouldBe 3
  //retrieve list using pattern
  await(adminApi.list(None, Some(&quot;.*.conf&quot;))).size shouldBe 3
  await(adminApi.list(Some(FileType.Normal), Some(&quot;.*.conf&quot;))).size shouldBe 2
  await(adminApi.list(Some(FileType.Annex), Some(&quot;a/c.*&quot;))).size shouldBe 1
  await(adminApi.list(Some(FileType.Normal), Some(&quot;test.*&quot;))).size shouldBe 1
}
Await.result(assertionF, 2.seconds)</code></pre></dd>
</dl>
<h2><a href="#history" name="history" class="anchor"><span class="anchor-link"></span></a>history</h2>
<p>Returns the history of revisions of the file at the given path for a range of period specified by <code>from</code> and <code>to</code>. The size of the list can be restricted using <code>maxResults</code>. Returns the history of active revisions of the file at the given path for a range of period specified by <code>from</code> and <code>to</code>. The size of the list can be restricted using <code>maxResults</code>.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val assertionF = async {
  val filePath = Paths.get(&quot;/a/test.conf&quot;)
  val id0      = await(adminApi.create(filePath, ConfigData.fromString(defaultStrConf), annex = false, &quot;first commit&quot;))

  //override the contents twice
  val tBeginUpdate = Instant.now()
  val id1          = await(adminApi.update(filePath, ConfigData.fromString(&quot;changing contents&quot;), &quot;second commit&quot;))
  val id2          = await(adminApi.update(filePath, ConfigData.fromString(&quot;changing contents again&quot;), &quot;third commit&quot;))
  val tEndUpdate   = Instant.now()

  val fullHistory = await(adminApi.history(filePath))
  fullHistory.map(_.id) shouldBe List(id2, id1, id0)
  fullHistory.map(_.comment) shouldBe List(&quot;third commit&quot;, &quot;second commit&quot;, &quot;first commit&quot;)

  //drop initial revision and take only update revisions
  await(adminApi.history(filePath, tBeginUpdate, tEndUpdate)).size shouldBe 2

  //take last two revisions
  await(adminApi.history(filePath, maxResults = 2)).map(_.id) shouldBe List(id2, id1)
}
Await.result(assertionF, 3.seconds)</code></pre></dd>
</dl>
<h2><a href="#managing-active-versions" name="managing-active-versions" class="anchor"><span class="anchor-link"></span></a>Managing active versions</h2>
<p>Following API functions are available to manage the active version of a config file. In it&rsquo;s lifetime a config file undergoes many revisions. An active version is a specific revision from a file&rsquo;s history and it is set by administrators. </p>
<ul>
  <li><strong>historyActive</strong> : Returns the history of active revisions of the file at the given path for a range of period specified by <code>from</code> and <code>to</code>. The size of the list can be restricted using <code>maxResults</code>.</li>
  <li><strong>setActiveVersion</strong> : Sets the &ldquo;active version&rdquo; to be the version provided for the file at the given path. If this method is never called in a config&rsquo;s lifetime, the active version will always be the version returned by <code>create</code> function.</li>
  <li><strong>resetActiveVersion</strong> : Resets the &ldquo;active version&rdquo; of the file at the given path to the latest version.</li>
  <li><strong>getActiveVersion</strong> : Returns the revision Id which represents the &ldquo;active version&rdquo; of the file at the given path.</li>
  <li><strong>getActiveByTime</strong> : Returns the content of active version of the file existed at given instant</li>
</ul>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val assertionF = async {
  val tBegin   = Instant.now()
  val filePath = Paths.get(&quot;/a/test.conf&quot;)
  //create will make the 1st revision active with a default comment
  val id1 = await(adminApi.create(filePath, ConfigData.fromString(defaultStrConf), annex = false, &quot;first&quot;))
  await(adminApi.historyActive(filePath)).map(_.id) shouldBe List(id1)
  //ensure active version is set
  await(adminApi.getActiveVersion(filePath)).get shouldBe id1

  //override the contents four times
  await(adminApi.update(filePath, ConfigData.fromString(&quot;changing contents&quot;), &quot;second&quot;))
  val id3 = await(adminApi.update(filePath, ConfigData.fromString(&quot;changing contents again&quot;), &quot;third&quot;))
  val id4 = await(adminApi.update(filePath, ConfigData.fromString(&quot;final contents&quot;), &quot;fourth&quot;))
  val id5 = await(adminApi.update(filePath, ConfigData.fromString(&quot;final final contents&quot;), &quot;fifth&quot;))

  //update doesn&#39;t change the active revision
  await(adminApi.historyActive(filePath)).map(_.id) shouldBe List(id1)

  //play with active version
  await(adminApi.setActiveVersion(filePath, id3, s&quot;$id3 active&quot;))
  await(adminApi.setActiveVersion(filePath, id4, s&quot;$id4 active&quot;))
  await(adminApi.getActiveVersion(filePath)).get shouldBe id4
  val tEnd = Instant.now()
  //reset active version to latest
  await(adminApi.resetActiveVersion(filePath, &quot;latest active&quot;))
  await(adminApi.getActiveVersion(filePath)).get shouldBe id5
  //finally set initial version as active
  await(adminApi.setActiveVersion(filePath, id1, s&quot;$id1 active&quot;))
  await(adminApi.getActiveVersion(filePath)).get shouldBe id1

  //validate full history
  val fullHistory = await(adminApi.historyActive(filePath))
  fullHistory.map(_.id) shouldBe List(id1, id5, id4, id3, id1)
  fullHistory.map(_.comment) shouldBe List(s&quot;$id1 active&quot;, &quot;latest active&quot;, s&quot;$id4 active&quot;, s&quot;$id3 active&quot;,
    &quot;initializing active file with the first version&quot;)

  //drop initial revision and take only update revisions
  val fragmentedHistory = await(adminApi.historyActive(filePath, tBegin, tEnd))
  fragmentedHistory.size shouldBe 3

  //take last three revisions
  await(adminApi.historyActive(filePath, maxResults = 3)).map(_.id) shouldBe List(id1, id5, id4)

  //get contents of active version at a specified instance
  val initialContents = await(adminApi.getActiveByTime(filePath, tBegin)).get
  await(initialContents.toStringF) shouldBe defaultStrConf
}
Await.result(assertionF, 5.seconds)</code></pre></dd>
</dl>
<h2><a href="#getmetadata" name="getmetadata" class="anchor"><span class="anchor-link"></span></a>getMetaData</h2>
<p>Used to get metadata information about config service. It includes:</p>
<ul>
  <li>repository directory</li>
  <li>annex directory</li>
  <li>min annex file size</li>
  <li>max config file size</li>
</ul>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val assertF = async {
  val metaData: ConfigMetadata = await(adminApi.getMetadata)
  //repository path must not be empty
  metaData.repoPath should not be empty
}
Await.result(assertF, 2.seconds)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">ConfigMetadata metadata = adminApi.getMetadata().get();
//repository path must not be empty
Assert.assertNotEquals(metadata.repoPath(), &quot;&quot;);</code></pre></dd>
</dl>
<h2><a href="#source-code-for-examples" name="source-code-for-examples" class="anchor"><span class="anchor-link"></span></a>Source code for examples</h2>
<ul>
  <li><a href="https://github.com/tmtsoftware/csw-prod/tree/master/csw-config-client/src/test/scala/csw/services/config/client/scaladsl/demo/ConfigClientDemoExample.scala">Scala Example</a></li>
  <li><a href="https://github.com/tmtsoftware/csw-prod/tree/master/csw-config-client/src/test/java/csw/services/config/client/javadsl/demo/JConfigClientDemoExample.java">Java Example</a></li>
</ul>
<div class="source-github">
The source code for this page can be found <a href="https://github.com/tmtsoftware/csw-prod/tree/master/docs/src/main/services/config.md">here</a>.
</div>

</div>
<div class="large-3 show-for-large column" data-sticky-container>
<nav class="sidebar sticky" data-sticky data-anchor="docs" data-sticky-on="large">
<div class="page-nav">
<div class="nav-title">On this page:</div>
<div class="nav-toc">
<ul>
  <li><a href="../services/config.html#configuration-service">Configuration service</a>
  <ul>
    <li><a href="../services/config.html#artifacts">Artifacts</a></li>
    <li><a href="../services/config.html#rules-and-checks">Rules and checks</a></li>
    <li><a href="../services/config.html#model-classes">Model classes</a></li>
    <li><a href="../services/config.html#api-flavours">API flavours</a></li>
    <li><a href="../services/config.html#accessing-clientapi-and-adminapi">Accessing clientAPI and adminAPI</a></li>
    <li><a href="../services/config.html#exists">exists</a></li>
    <li><a href="../services/config.html#getactive">getActive</a></li>
    <li><a href="../services/config.html#create">create</a></li>
    <li><a href="../services/config.html#update">update</a></li>
    <li><a href="../services/config.html#delete">delete</a></li>
    <li><a href="../services/config.html#getbyid">getById</a></li>
    <li><a href="../services/config.html#getlatest">getLatest</a></li>
    <li><a href="../services/config.html#getbytime">getByTime</a></li>
    <li><a href="../services/config.html#list">list</a></li>
    <li><a href="../services/config.html#history">history</a></li>
    <li><a href="../services/config.html#managing-active-versions">Managing active versions</a></li>
    <li><a href="../services/config.html#getmetadata">getMetaData</a></li>
    <li><a href="../services/config.html#source-code-for-examples">Source code for examples</a></li>
  </ul></li>
</ul>
</div>
</div>
</nav>
</div>
</div>

</section>
</div>

</div>

<footer class="site-footer">

<section class="site-footer-nav">
<div class="expanded row">
<div class="small-12 large-offset-2 large-10 column">
<div class="row site-footer-content">

<div class="small-12 medium-4 large-3 text-center column">
<div class="nav-links">
<ul>
<!-- <li><a href="https://www.example.com/products/">Products</a> -->
</ul>
</div>
</div>

</div>
</div>
</div>
</section>

<section class="site-footer-base">
<div class="expanded row">
<div class="small-12 large-offset-2 large-10 column">
<div class="row site-footer-content">

<div class="small-12 text-center large-9 column">

<!--
<div class="copyright">
<span class="text">&copy; 2017</span>
<a href="https://www.example.com" class="logo">logo</a>
</div>
-->
</div>

</div>
</div>
</div>
</section>
</footer>

</div>
</div>
</div>
</body>

<script type="text/javascript" src="../lib/foundation/dist/foundation.min.js"></script>
<script type="text/javascript">jQuery(document).foundation();</script>
<script type="text/javascript" src="../js/magellan.js"></script>

<style type="text/css">@import "../lib/prettify/prettify.css";</style>
<script type="text/javascript" src="../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">jQuery(function(){window.prettyPrint && prettyPrint()});</script>

</html>
