<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="description" content="docs">
<meta name="generator" content="Paradox, paradox-material-theme=0.4.0, mkdocs-material=2.2.2">

<meta name="lang:clipboard.copy" content="Copy to clipboard">
<meta name="lang:clipboard.copied" content="Copied to clipboard">
<meta name="lang:search.result.none" content="No matching documents">
<meta name="lang:search.result.one" content="1 matching document">
<meta name="lang:search.result.other" content="# matching documents">
<meta name="lang:search.language" content="">
<meta name="lang:search.tokenizer" content="[\s\-]+">


<meta name="description" content="docs">
<link rel="shortcut icon" href="../assets/tmt_favicon.ico">
<title>Logging Service · TMT Common Software (CSW)</title>
<link rel="stylesheet" href="../assets/stylesheets/application.7a4cdee3.css">
<link rel="stylesheet" href="../lib/material__tabs/dist/mdc.tabs.min.css">
<link rel="stylesheet" href="../lib/prettify/prettify.css">
<script src="../lib/modernizr/modernizr.min.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
<style>
body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}
code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}
</style>
<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="../assets/stylesheets/paradox-material-theme.css">
</head>
<body
>
<input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
<input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
<label class="md-overlay" data-md-component="overlay" for="drawer"></label>
<header class="md-header" data-md-component="header">
<nav class="md-header-nav md-grid">
<div class="md-flex">
<div class="md-flex__cell md-flex__cell--shrink">
<a href="../index.html" title="TMT Common Software (CSW)" class="md-header-nav__button md-logo">
<i class="md-icon">local_library</i>
</a>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
</div>
<div class="md-flex__cell md-flex__cell--stretch">
<div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
<span class="md-header-nav__topic">
TMT Common Software (CSW)
</span>
<span class="md-header-nav__topic">
Logging Service
</span>
</div>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="search"></label>
<div class="md-search__inner">
<form class="md-search__form" name="search">
<input type="text" class="md-search__input" name="query" required placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query">
<label class="md-icon md-search__icon" for="search"></label>
<button type="reset" class="md-icon md-search__icon" data-md-component="reset">&#xE5CD;</button>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix>
<div class="md-search-result" data-md-component="result">
<div class="md-search-result__meta">
Type to start searching
</div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>

</div>
<div class="md-flex__cell md-flex__cell--shrink">
<div class="md-header-nav__source">
<a href="https://github.com/tmtsoftware/csw-prod"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
tmtsoftware/csw-prod
</div>
</a>

</div>
</div>
</div>
</nav>
</header>

<div class="md-container">
<main class="md-main">
<div class="md-main__inner md-grid" data-md-component="container">
<div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--primary" data-md-level="0" style="visibility: hidden">
<label class="md-nav__title md-nav__title--site" for="drawer">
<span class="md-nav__button md-logo">
<i class="md-icon">local_library</i>
</span>
<a href="../index.html" title="TMT Common Software (CSW)">
TMT Common Software (CSW)
</a>
</label>
<div class="md-nav__source">
<a href="https://github.com/tmtsoftware/csw-prod"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
tmtsoftware/csw-prod
</div>
</a>

</div>
<ul>
  <li><a href="../commons/getting-started.html" class="page">Getting Started</a></li>
  <li><a href="../commons/create-component.html" class="page">Creating a Component</a></li>
  <li><a href="../commons/multiple-components.html" class="page">Multiple Components</a></li>
  <li><a href="../commons/messages.html" class="page">Messages</a>
  <ul>
    <li><a href="../messages/keys-parameters.html" class="page">Keys and Parameters</a></li>
    <li><a href="../messages/units.html" class="page">Units</a></li>
    <li><a href="../messages/subsystem.html" class="page">Subsystem</a></li>
    <li><a href="../messages/commands.html" class="page">Commands</a></li>
    <li><a href="../messages/events.html" class="page">Events</a></li>
    <li><a href="../messages/states.html" class="page">State Variables</a></li>
    <li><a href="../messages/result.html" class="page">Result</a></li>
  </ul></li>
  <li><a href="../commons/framework.html" class="page">Framework for creating components (HCD, Assembly, Container)</a>
  <ul>
    <li><a href="../framework/describing-components.html" class="page">ComponentInfo</a></li>
    <li><a href="../framework/creating-components.html" class="page">Creating an Assembly or Hcd Component</a></li>
    <li><a href="../framework/handling-lifecycle.html" class="page">Component Handlers</a></li>
    <li><a href="../framework/managing-command-state.html" class="page">Managing Command State</a></li>
    <li><a href="../framework/tracking-connections.html" class="page">Tracking Connections</a></li>
    <li><a href="../framework/publishing-state.html" class="page">Publishing State</a></li>
    <li><a href="../framework/handling-exceptions.html" class="page">Handling Exceptions</a></li>
    <li><a href="../framework/deploying-components.html" class="page">Deploying Components</a></li>
  </ul></li>
  <li><a href="../commons/command.html" class="page">Communication using Commands</a></li>
  <li><a href="../commons/services.html" class="page">Services</a>
  <ul>
    <li><a href="../services/location.html" class="page">Location Service</a></li>
    <li><a href="../services/config.html" class="page">Configuration Service</a></li>
    <li><a href="../services/logging.html" class="active page">Logging Service</a></li>
    <li><a href="../services/event.html" class="page">Event Service</a></li>
  </ul></li>
  <li><a href="../commons/apps.html" class="page">Applications</a>
  <ul>
    <li><a href="../apps/cswclusterseed.html" class="page">csw-cluster-seed</a></li>
    <li><a href="../apps/cswlocationagent.html" class="page">csw-location-agent</a></li>
    <li><a href="../apps/cswonfigserverapp.html" class="page">csw-config-server</a></li>
    <li><a href="../apps/cswconfigclientcli.html" class="page">csw-config-client-cli</a></li>
    <li><a href="../apps/csweventcli.html" class="page">csw-event-cli</a></li>
    <li><a href="../apps/hostconfig.html" class="page">csw-host-config</a></li>
  </ul></li>
  <li><a href="../commons/testing.html" class="page">Testing</a></li>
  <li><a href="../commons/sbt-tasks.html" class="page">sbt Tasks</a></li>
  <li><a href="../commons/manuals.html" class="page">Manuals</a></li>
</ul>
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="toc">Table of contents</label>
<ul>
  <li><a href="../services/logging.html#logging-service" class="header">Logging Service</a>
  <ul>
    <li><a href="../services/logging.html#dependencies" class="header">Dependencies</a></li>
    <li><a href="../services/logging.html#configuration" class="header">Configuration</a></li>
    <li><a href="../services/logging.html#log-levels" class="header">Log Levels</a></li>
    <li><a href="../services/logging.html#log-structure" class="header">Log Structure</a></li>
    <li><a href="../services/logging.html#enable-component-logging" class="header">Enable Component Logging</a></li>
    <li><a href="../services/logging.html#enable-generic-logging" class="header">Enable Generic Logging</a></li>
    <li><a href="../services/logging.html#log-statements" class="header">Log Statements</a></li>
    <li><a href="../services/logging.html#create-loggerfactory" class="header">Create LoggerFactory</a></li>
    <li><a href="../services/logging.html#create-loggingsystem" class="header">Create LoggingSystem</a></li>
    <li><a href="../services/logging.html#stop-loggingsystem" class="header">Stop LoggingSystem</a></li>
    <li><a href="../services/logging.html#source-code-for-examples" class="header">Source code for examples</a></li>
    <li><a href="../services/logging.html#performance" class="header">Performance</a></li>
    <li><a href="../services/logging.html#acknowledgement" class="header">Acknowledgement</a></li>
  </ul></li>
</ul>
</nav>

<div class="md-nav__title--site md-version" title="Version">
<i class="md-icon">label_outline</i> 0.5.0
</div>
</nav>

</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="toc">Table of contents</label>
<ul>
  <li><a href="../services/logging.html#logging-service" class="header">Logging Service</a>
  <ul>
    <li><a href="../services/logging.html#dependencies" class="header">Dependencies</a></li>
    <li><a href="../services/logging.html#configuration" class="header">Configuration</a></li>
    <li><a href="../services/logging.html#log-levels" class="header">Log Levels</a></li>
    <li><a href="../services/logging.html#log-structure" class="header">Log Structure</a></li>
    <li><a href="../services/logging.html#enable-component-logging" class="header">Enable Component Logging</a></li>
    <li><a href="../services/logging.html#enable-generic-logging" class="header">Enable Generic Logging</a></li>
    <li><a href="../services/logging.html#log-statements" class="header">Log Statements</a></li>
    <li><a href="../services/logging.html#create-loggerfactory" class="header">Create LoggerFactory</a></li>
    <li><a href="../services/logging.html#create-loggingsystem" class="header">Create LoggingSystem</a></li>
    <li><a href="../services/logging.html#stop-loggingsystem" class="header">Stop LoggingSystem</a></li>
    <li><a href="../services/logging.html#source-code-for-examples" class="header">Source code for examples</a></li>
    <li><a href="../services/logging.html#performance" class="header">Performance</a></li>
    <li><a href="../services/logging.html#acknowledgement" class="header">Acknowledgement</a></li>
  </ul></li>
</ul>
</nav>

</div>
</div>
</div>
<div class="md-content">
<article class="md-content__inner md-typeset">
<div class="md-content__searchable">
<h1><a href="#logging-service" name="logging-service" class="anchor"><span class="anchor-link"></span></a>Logging Service</h1>
<p>The Logging Service library provides an advanced logging facility for csw components and services. </p><div class="callout note "><div class="callout-title">Note</div>
<p>With this release of CSW, only the local logging is provided. A future release will provide the centralized logging facility.</p></div>
<h2><a href="#dependencies" name="dependencies" class="anchor"><span class="anchor-link"></span></a>Dependencies</h2>
<p>To use the Logging Service without using the framework, add this to your <code>build.sbt</code> file:</p>
<dl>
  <dt>sbt</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">libraryDependencies += &quot;org.tmt&quot; %% &quot;csw-logging&quot; % &quot;0.5.0&quot;
</code></pre></dd>
</dl>
<h2><a href="#configuration" name="configuration" class="anchor"><span class="anchor-link"></span></a>Configuration</h2>
<p>These are the relevant default configuration values for logging</p>
<dl>
  <dt>logging.conf
  </dt>
  <dd>
  <pre class="prettyprint"><code class="language-conf">csw-logging {

    # Default appender and is recommended only for dev setup.
    # To use multiple appenders give comma separated list of appenders.
    appenders = [&quot;csw.services.logging.appenders.StdOutAppender$&quot;]

    # Recommended for production setup - Uncomment below line and comment above to enable FileAppender
    #appenders = [&quot;csw.services.logging.appenders.FileAppender$&quot;]

    component-log-levels {
      # By default each compoent will use log level specified by `csw-logging.logLevel`. If required, this block allows
      # overriding log level configuration for one/more components.
      # -- Example --
      # TromboneHcd = debug
      # TromboneAssembly = error
    }

    appender-config {
      file {
        # Include standard headers
        fullHeaders = true
        # Sort the fields in Json objects
        sorted = true
        # Directory to hold log files.
        logPath = &quot;/tmp/&quot;
        # Common log messages below this level are removed, none removed when set to trace
        logLevelLimit = trace
        # Flag to turn file rotation ON or OFF. Currently log file is rotated daily at 12:00 pm UTC time. By turning this flag off
        # file rotation will not happen.
        rotate = true
      }
      stdout {
        # Include standard headers
        fullHeaders = false
        # Use colors for log levels
        color = true
        # The maximum number of character that should be on a line
        # This is only a goal; in practice some may contain more characters.
        width = 80
        # Print summary counts when logger is closed
        summary = true
        # pretty output - multiple line json
        pretty = false
        # Messages below this level are removed, none removed when set to trace
        logLevelLimit = trace
        # false Json output; true simple one line text output
        oneLine = false
      }
    }
    # If component does not specify their log level in component-log-levels block,
    # Then this will be considered as default log level for that component.
    logLevel = info
    # Log level for slf4j messages
    slf4jLogLevel = info
    # Log level for Akka messages
    akkaLogLevel = warn
    # Enable timing logging
    time = false
    # Enable garbage collection logging
    gc = false
}</code></pre></dd>
</dl><div class="callout note "><div class="callout-title">IMPORTANT !!!</div>
<p>It is required to include <code>logging.conf</code> that is shipped with this library in <code>application.conf</code> as follows:</p>
<pre><code>include &quot;logging.conf&quot;
</code></pre>
<p>Default configuration values can be then overridden in <code>application.conf</code>. </p></div>
<p>Also <code>logLevel</code> for each component can be set in application.conf as follows:</p>
<pre><code>component-log-levels {
    tromboneHcd = debug
    tromboneAssembly = error
  }
  
</code></pre><div class="callout note "><div class="callout-title">Note</div>
<p>Here <code>tromboneHcd</code> and <code>tromboneAssembly</code> is the name of component that will be registered with <code>LocationService</code>, which is the <code>name</code> field in the ComponentInfo file (see <a href="../framework/deploying-components.html">DeployingComponents</a>). By default, all components will log at level specified by <code>csw-logging.logLevel</code>. </p></div>
<p>The library provides <code>StdOutAppender</code> as default logging appender. To use <code>FileAppender</code> or some custom appender along-with <code>StdOutAppender</code>, override <code>appenders</code> property to include multiple appender in csv format as follows:</p>
<pre><code><br/>appenders = [&quot;csw.services.logging.appenders.FileAppender$&quot;, &quot;csw.services.logging.appenders.StdOutAppender$&quot;]

</code></pre><div class="callout note "><div class="callout-title">Note</div>
<p>Make sure to provide full path of the appender since it will be spawned using java reflection. In csw code base, a working example of custom appender can be found at: <a href="https://github.com/tmtsoftware/csw-prod/tree/master/csw-logging/src/test/scala/csw/services/logging/appenders/CustomAppenderTest.scala">Custom Appender</a></p></div>
<p>For <code>StdOutAppender</code> specify the format of log statements in <code>csw-logging.stdout</code> via <code>csw-logging.stdout.pretty</code> and <code>csw-logging.stdout.oneLine</code>. </p>
<p>Turning <code>pretty</code> <strong>on</strong> or <strong>off</strong> will produce log statements in following format:</p>
<dl>
  <dt>pretty=true</dt>
  <dd>
  <pre><code>{&quot;@componentName&quot;:&quot;my-component-name&quot;,
 &quot;@host&quot;:&quot;INsaloni.local&quot;,
 &quot;@name&quot;:&quot;LocationServiceExampleClient&quot;,
 &quot;@severity&quot;:&quot;INFO&quot;,
 &quot;@version&quot;:&quot;0.1&quot;,
 &quot;actor&quot;:
   &quot;akka.tcp://csw-examples-locationServiceClient@10.131.23.195:53618/user/$a&quot;,
 &quot;class&quot;:&quot;csw.services.location.LocationServiceExampleClient&quot;,
 &quot;file&quot;:&quot;LocationServiceExampleClientApp.scala&quot;,
 &quot;line&quot;:149,
 &quot;message&quot;:&quot;Result of the find call: None&quot;,
 &quot;timestamp&quot;:&quot;2017-11-30T10:58:03.102Z&quot;
 }
</code></pre></dd>
  <dt>pretty=false</dt>
  <dd>
  <pre><code>{&quot;@componentName&quot;:&quot;my-component-name&quot;,&quot;@host&quot;:&quot;INsaloni.local&quot;,&quot;@name&quot;:&quot;LocationServiceExampleClient&quot;,&quot;@severity&quot;:&quot;INFO&quot;,&quot;@version&quot;:&quot;0.1&quot;,&quot;actor&quot;:&quot;akka.tcp://csw-examples-locationServiceClient@10.131.23.195:53618/user/$a&quot;,&quot;class&quot;:&quot;csw.services.location.LocationServiceExampleClient&quot;,&quot;file&quot;:&quot;LocationServiceExampleClientApp.scala&quot;,&quot;line&quot;:149,&quot;message&quot;:&quot;Result of the find call: None&quot;,&quot;timestamp&quot;:&quot;2017-11-24T04:16:42.108Z&quot;}
</code></pre></dd>
</dl>
<p>Similarly, turning <code>oneLine</code> on will produce log statements in following format:</p>
<dl>
  <dt>oneLine=true</dt>
  <dd>
  <pre><code>[INFO] Attempting to find connection (LocationServiceExampleClientApp.scala 131)
</code></pre></dd>
</dl><div class="callout note "><div class="callout-title">Note</div>
<ul>
  <li>If <code>oneLine</code> is set to <code>true</code> then value of <code>pretty</code> will be ignored</li>
</ul></div>
<h2><a href="#log-levels" name="log-levels" class="anchor"><span class="anchor-link"></span></a>Log Levels</h2>
<p>Following Log levels are supported by csw-logging library</p>
<ul>
  <li>FATAL</li>
  <li>ERROR</li>
  <li>WARN</li>
  <li>INFO</li>
  <li>DEBUG</li>
  <li>TRACE</li>
</ul>
<p>The library allows separate log levels for the logging API(logLevel), Akka logging(akkaLogLevel), and Slf4J(slf4jLogLevel). The initial values of these are set in the configuration file as seen above. These can be overriden in the application.conf file.</p>
<p>These values can also be changed dynamically by calling methods on <code>LoggingSystem</code> class.</p>
<h2><a href="#log-structure" name="log-structure" class="anchor"><span class="anchor-link"></span></a>Log Structure</h2>
<p>All messages are logged by default as Json. Logs can contain following fields:</p>
<ul>
  <li><code>@componentName</code>: The name of the component if present</li>
  <li><code>@host</code>: The local host name</li>
  <li><code>@name</code>: The name of the application being run</li>
  <li><code>@version</code>: The version of the application being run</li>
  <li><code>@severity</code>: The message level: trace, debug, info, warn, error or fatal</li>
  <li><code>actor</code>: The path for an actor when using ActorLogging</li>
  <li><code>class</code>: The class for ClassLogging or ActorLogging</li>
  <li><code>file</code>: The file containing the log call</li>
  <li><code>kind</code>: Either slf4j or akka. Not present for logger API</li>
  <li><code>line</code>: The line where the message was logged</li>
  <li><code>message</code>: The log message</li>
  <li><code>timestamp</code>: The UTC time when the message was logged</li>
  <li><code>trace</code>: Information for any exception specified in the logging call</li>
</ul><div class="callout note "><div class="callout-title">Note</div>
<ul>
  <li><code>@host</code>, <code>@name</code> and <code>@version</code> will appear in log statements only if <em>fullHeaders</em> is set as true in the configuration</li>
  <li><code>file</code> and <code>line</code> will appear only in log statements from Scala classes/actors. This is typical for Java logging tools, and is due to the lack of macro support in Java.</li>
</ul></div>
<h2><a href="#enable-component-logging" name="enable-component-logging" class="anchor"><span class="anchor-link"></span></a>Enable Component Logging</h2>
<p>Component developers will have an instance of <code>LoggerFactory</code> available from <code>csw-framework</code>. This instance will already have a <code>componentName</code> set by <code>csw-framework</code> which will appear in log statements against <code>@componentName</code> tag. Next, to get the <code>Logger</code> from <code>LoggerFactory</code> use one of the following ways: </p>
<dl>
  <dt>Scala Class</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">class SampleClass(loggerFactory: LoggerFactory) {

  val log: Logger = loggerFactory.getLogger
}</code></pre></dd>
  <dt>Java Class</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">public class JSampleClass {

    public JSampleClass(JLoggerFactory loggerFactory) {
        ILogger log = loggerFactory.getLogger(getClass());
    }
}</code></pre></dd>
</dl>
<dl>
  <dt>Scala Actor</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">class SampleActor(loggerFactory: LoggerFactory) extends akka.actor.Actor {

  //context is available from akka.actor.Actor
  val log: Logger = loggerFactory.getLogger(context)

  override def receive = ???
}</code></pre></dd>
  <dt>Java Actor</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">class JSampleActor extends akka.actor.AbstractActor {

    public JSampleActor(JLoggerFactory loggerFactory) {

        //context() is available from akka.actor.AbstractActor
        ILogger log = loggerFactory.getLogger(context(), getClass());
    }

    @Override
    public Receive createReceive() {
        return null;
    }
}</code></pre></dd>
</dl>
<dl>
  <dt>Scala Typed Actor</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">class SampleTypedActor(loggerFactory: LoggerFactory, ctx: ActorContext[ComponentMessage]) {

  val log: Logger = loggerFactory.getLogger(ctx)
}</code></pre></dd>
  <dt>Java Typed Actor</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">class JSampleTypedActor {

    public JSampleTypedActor(JLoggerFactory loggerFactory, ActorContext&lt;ComponentMessage&gt; ctx) {
        ILogger log = loggerFactory.getLogger(ctx, getClass());
    }
}</code></pre></dd>
</dl><div class="callout note "><div class="callout-title">Note</div>
<p>The <code>LoggerFactory</code> can be changed to <code>JLoggerFactory</code> by using <code>asJava</code> method and <code>JLoggerFactory</code> can be changed to <code>LoggerFactory</code> by using <code>asScala</code> method </p></div>
<h2><a href="#enable-generic-logging" name="enable-generic-logging" class="anchor"><span class="anchor-link"></span></a>Enable Generic Logging</h2>
<p>In case there is a need to log statements without <code>@componentName</code> tag, which can be due to unavailability of componentName in some utility code, then use the <code>GenericLoggerFactory</code> as follows:</p>
<dl>
  <dt>Scala Class</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">class GenericClass {

  val log: Logger = GenericLoggerFactory.getLogger
}</code></pre></dd>
  <dt>Java Class</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">public class JGenericClass {

    ILogger log = JGenericLoggerFactory.getLogger(getClass());
}</code></pre></dd>
</dl>
<dl>
  <dt>Scala Actor</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">class GenericActor extends akka.actor.AbstractActor {

  //context is available from akka.actor.Actor
  val log: Logger = GenericLoggerFactory.getLogger(context)

  override def createReceive() = ???
}</code></pre></dd>
  <dt>Java Actor</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">class JGenericActor extends akka.actor.AbstractActor {

    //context() is available from akka.actor.AbstractActor
    ILogger log = JGenericLoggerFactory.getLogger(context(), getClass());

    @Override
    public Receive createReceive() {
        return null;
    }
}</code></pre></dd>
</dl>
<dl>
  <dt>Scala Typed Actor</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">class GenericTypedActor(ctx: ActorContext[ComponentMessage]) {

  val log: Logger = GenericLoggerFactory.getLogger(ctx)
}</code></pre></dd>
  <dt>Java Typed Actor</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">class JGenericTypedActor {

    public JGenericTypedActor(ActorContext&lt;ComponentMessage&gt; ctx) {
        ILogger log = JGenericLoggerFactory.getLogger(ctx, getClass());
    }
}</code></pre></dd>
</dl>
<p><code>log</code> variable is now available in scala and java classes to write log statements as explained in next segment.</p>
<h2><a href="#log-statements" name="log-statements" class="anchor"><span class="anchor-link"></span></a>Log Statements</h2>
<p>Logging statements are used very much like existing logging services such as log4j. For Java, there is an additional way of writing log messages using Supplier methods (lambdas). The use of lambdas is more efficient since the computations in a message (e.g. string concatenation) are not performed unless the message is actually being logged. Therefore, these supplier methods should be used in cases where high performance is required (see <a href="#java-logging-string-vs-supplier-api-performance">performance results below</a>).</p>
<p>A basic info statement can be written as follows:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">log.info(s&quot;Result of the find call: $findResult&quot;)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">log.info(&quot;Find result: &quot; + connectionInfo(findResult.get().connection()));</code></pre></dd>
  <dt>Java (Supplier)
  </dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">log.info(() -&gt; &quot;Resolve result: &quot; + connectionInfo(resolveResult.get().connection()));</code></pre></dd>
</dl>
<p>The output of log statement will be:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre><code>{&quot;@componentName&quot;:&quot;my-component-name&quot;,
 &quot;@host&quot;:&quot;INsaloni.local&quot;,
 &quot;@name&quot;:&quot;LocationServiceExampleClient&quot;,
 &quot;@severity&quot;:&quot;INFO&quot;,
 &quot;@version&quot;:&quot;0.1&quot;,
 &quot;actor&quot;:
   &quot;akka.tcp://csw-examples-locationServiceClient@10.131.23.195:53618/user/$a&quot;,
 &quot;class&quot;:&quot;csw.services.location.LocationServiceExampleClient&quot;,
 &quot;file&quot;:&quot;LocationServiceExampleClientApp.scala&quot;,
 &quot;line&quot;:149,
 &quot;message&quot;:&quot;Result of the find call: None&quot;,
 &quot;timestamp&quot;:&quot;2017-11-30T10:58:03.102Z&quot;
 }
</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre><code>{&quot;@componentName&quot;:&quot;my-component-name&quot;,
 &quot;@host&quot;:&quot;INsaloni.local&quot;,
 &quot;@name&quot;:&quot;JLocationServiceExampleClient&quot;,
 &quot;@severity&quot;:&quot;INFO&quot;,
 &quot;@version&quot;:&quot;0.1&quot;,
 &quot;actor&quot;:
   &quot;akka.tcp://csw-examples-locationServiceClient@10.131.23.195:53625/user/LocationServiceExampleClient&quot;,
 &quot;class&quot;:&quot;csw.services.location.JLocationServiceExampleClient&quot;,
 &quot;message&quot;:&quot;Result of the find call : None&quot;,
 &quot;timestamp&quot;:&quot;2017-11-30T11:02:54.691Z&quot;
}
</code></pre></dd>
  <dt>Java (Supplier)
  </dt>
  <dd>
  <pre><code>{&quot;@componentName&quot;:&quot;my-component-name&quot;,
 &quot;@host&quot;:&quot;INsaloni.local&quot;,
 &quot;@name&quot;:&quot;JLocationServiceExampleClient&quot;,
 &quot;@severity&quot;:&quot;INFO&quot;,
 &quot;actor&quot;:
   &quot;akka.tcp://csw-examples-locationServiceClient@10.131.23.195:53625/user/LocationServiceExampleClient&quot;,
 &quot;class&quot;:&quot;csw.services.location.JLocationServiceExampleClient&quot;,
 &quot;message&quot;:
   &quot;Resolve result: LocationServiceExampleComponent-assembly-akka, component type=Assembly, connection type=AkkaType&quot;,
 &quot;timestamp&quot;:&quot;2017-07-26T19:44:58.636Z&quot;
}
</code></pre></dd>
</dl>
<p>The library allows usage of <code>Map</code> in message as follows:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">log.info(s&quot;Attempting to find $exampleConnection&quot;,
         Map(Keys.OBS_ID → &quot;foo_obs_id&quot;, &quot;exampleConnection&quot; → exampleConnection.name))</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">log.info(&quot;Attempting to find &quot; + exampleConnection,
        new HashMap&lt;String, Object&gt;() {{
            put(JKeys.OBS_ID, &quot;foo_obs_id&quot;);
            put(&quot;exampleConnection&quot;, exampleConnection.name());
        }});</code></pre></dd>
  <dt>Java (Supplier)
  </dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">log.info(() -&gt; &quot;Attempting to resolve &quot; + exampleConnection + &quot; with a wait of &quot; + waitForResolveLimit + &quot;...&quot;, () -&gt; {
    Map&lt;String, Object&gt; map = new HashMap&lt;&gt;();
    map.put(JKeys.OBS_ID, &quot;foo_obs_id&quot;);
    map.put(&quot;exampleConnection&quot;, exampleConnection.name());
    return map;
});</code></pre></dd>
</dl>
<p>The output of log statement will be: </p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre><code>{&quot;@componentName&quot;:&quot;my-component-name&quot;,
 &quot;@host&quot;:&quot;INsaloni.local&quot;,
 &quot;@name&quot;:&quot;LocationServiceExampleClient&quot;,
 &quot;@severity&quot;:&quot;INFO&quot;,
 &quot;@version&quot;:&quot;0.1&quot;,
 &quot;actor&quot;:
   &quot;akka.tcp://csw-examples-locationServiceClient@10.131.23.195:53618/user/$a&quot;,
 &quot;class&quot;:&quot;csw.services.location.LocationServiceExampleClient&quot;,
 &quot;exampleConnection&quot;:&quot;LocationServiceExampleComponent-assembly-akka&quot;,
 &quot;file&quot;:&quot;LocationServiceExampleClientApp.scala&quot;,
 &quot;line&quot;:143,
 &quot;message&quot;:
   &quot;Attempting to find AkkaConnection(ComponentId(LocationServiceExampleComponent,Assembly))&quot;,
 &quot;obsId&quot;:&quot;foo_obs_id&quot;,
 &quot;timestamp&quot;:&quot;2017-11-30T10:58:03.097Z&quot;
}
</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre><code>{&quot;@componentName&quot;:&quot;my-component-name&quot;,
 &quot;@host&quot;:&quot;INsaloni.local&quot;,
 &quot;@name&quot;:&quot;JLocationServiceExampleClient&quot;,
 &quot;@severity&quot;:&quot;INFO&quot;,
 &quot;@version&quot;:&quot;0.1&quot;,
 &quot;actor&quot;:
   &quot;akka.tcp://csw-examples-locationServiceClient@10.131.23.195:53625/user/LocationServiceExampleClient&quot;,
 &quot;class&quot;:&quot;csw.services.location.JLocationServiceExampleClient&quot;,
 &quot;exampleConnection&quot;:&quot;LocationServiceExampleComponent-assembly-akka&quot;,
 &quot;message&quot;:
   &quot;Attempting to find AkkaConnection(ComponentId(LocationServiceExampleComponent,Assembly))&quot;,
 &quot;obsId&quot;:&quot;foo_obs_id&quot;,
 &quot;timestamp&quot;:&quot;2017-11-30T11:02:54.686Z&quot;
}
</code></pre></dd>
  <dt>Java (Supplier)
  </dt>
  <dd>
  <pre><code>{&quot;@componentName&quot;:&quot;my-component-name&quot;,
 &quot;@host&quot;:&quot;INsaloni.local&quot;,
 &quot;@name&quot;:&quot;JLocationServiceExampleClient&quot;,
 &quot;@severity&quot;:&quot;INFO&quot;,
 &quot;@version&quot;:&quot;0.1&quot;,
 &quot;actor&quot;:
   &quot;akka.tcp://csw-examples-locationServiceClient@10.131.23.195:53625/user/LocationServiceExampleClient&quot;,
 &quot;class&quot;:&quot;csw.services.location.JLocationServiceExampleClient&quot;,
 &quot;exampleConnection&quot;:&quot;LocationServiceExampleComponent-assembly-akka&quot;,
 &quot;message&quot;:
   &quot;Attempting to resolve AkkaConnection(ComponentId(LocationServiceExampleComponent,Assembly)) with a wait of 30 seconds...&quot;,
 &quot;obsId&quot;:&quot;foo_obs_id&quot;,
 &quot;timestamp&quot;:&quot;2017-11-24T04:22:02.589Z&quot;
}
</code></pre></dd>
</dl>
<p>The library allows you to log an error with its full stacktrace as follows:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val runtimeException = new RuntimeException(s&quot;Received unexpected message $x&quot;)
log.error(runtimeException.getMessage, ex = runtimeException)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">} catch (InterruptedException | ExecutionException ex) {
    log.info(ex.getMessage(), ex);
    throw ex;
}</code></pre></dd>
  <dt>Java (Supplier)
  </dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">RuntimeException runtimeException = new RuntimeException(&quot;Received unexpected message &quot; + x);
log.info(() -&gt; runtimeException.getMessage(), runtimeException);</code></pre></dd>
</dl>
<h2><a href="#create-loggerfactory" name="create-loggerfactory" class="anchor"><span class="anchor-link"></span></a>Create LoggerFactory</h2><div class="callout note "><div class="callout-title">Note</div>
<p>This functionality is included in the framework code and users should not have to implement it themselves. Documentation is included for testing or further understanding.</p></div>
<p>In order to create a LoggerFactory with a custom componentName refer the following code:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val loggerFactory: LoggerFactory = new LoggerFactory(&quot;my-component-name&quot;)

// convert a scala LoggerFactory to java JLoggerFactory
val jLoggerFactory: JLoggerFactory = loggerFactory.asJava</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">JLoggerFactory jLoggerFactory = new JLoggerFactory(&quot;my-component-name&quot;);

// convert a java JLoggerFactory to scala LoggerFactory
LoggerFactory loggerFactory = jLoggerFactory.asScala();</code></pre></dd>
</dl>
<h2><a href="#create-loggingsystem" name="create-loggingsystem" class="anchor"><span class="anchor-link"></span></a>Create LoggingSystem</h2><div class="callout note "><div class="callout-title">Note</div>
<p>This functionality is included in the framework code and users should not have to implement it themselves. Documentation is included for testing or further understanding.</p></div>
<p>For logging statements to appear in the program, start <code>LoggingSystem</code> at an earliest location in an application. <strong>Also note, <code>LoggingSystem</code> should be started only once in an application.</strong> The name used while creating <code>LoggingSystem</code> will be used to create the folder and dump all logging files.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">private val host = InetAddress.getLocalHost.getHostName
// Only call this once per application
val loggingSystem: LoggingSystem = LoggingSystemFactory.start(&quot;LocationServiceExampleClient&quot;, &quot;0.1&quot;, host, system)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">String host = InetAddress.getLocalHost().getHostName();
loggingSystem = JLoggingSystemFactory.start(&quot;JLocationServiceExampleClient&quot;, &quot;0.1&quot;, host, actorSystem);</code></pre></dd>
</dl><div class="callout note "><div class="callout-title">Note</div>
<ul>
  <li>The <code>hostname</code> that is provided while creating <code>LoggingSystem</code> will appear in log statements against <code>@host</code> tag</li>
</ul></div>
<h2><a href="#stop-loggingsystem" name="stop-loggingsystem" class="anchor"><span class="anchor-link"></span></a>Stop LoggingSystem</h2><div class="callout note "><div class="callout-title">Note</div>
<p>This functionality is included in the framework code and users should not have to implement it themselves. Documentation is included for testing or further understanding.</p></div>
<p>Please ensure to stop <code>LoggingSystem</code> before application exits.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">// Only call this once per application
Await.result(loggingSystem.stop, 30.seconds)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">// Only call this once per application
loggingSystem.javaStop().get();</code></pre></dd>
</dl>
<h2><a href="#source-code-for-examples" name="source-code-for-examples" class="anchor"><span class="anchor-link"></span></a>Source code for examples</h2>
<ul>
  <li><a href="https://github.com/tmtsoftware/csw-prod/tree/master/examples/src/main/scala/csw/services/location/LocationServiceExampleClientApp.scala">Scala Example</a></li>
  <li><a href="https://github.com/tmtsoftware/csw-prod/tree/master/examples/src/main/java/csw/services/location/JLocationServiceExampleClient.java">Java Example</a></li>
</ul>
<h2><a href="#performance" name="performance" class="anchor"><span class="anchor-link"></span></a>Performance</h2>
<p>Performance results documented on this page is measured in terms of Throughput and obtained with the JMH Java benchmark harness. Sourcecode for all the JMH benchmarks can be found here at <a href="https://github.com/tmtsoftware/csw-prod/tree/master/csw-benchmark/src/main">CSW Benchmarks</a> </p>
<p><a href="https://en.wikipedia.org/wiki/Throughput">Wikipedia</a> definition of Throughput is the maximum rate of production or the maximum rate at which something can be processed. In our case, throughput is defined as how many messages can be logged in a certain period of time.</p>
<h3><a href="#test-machine-configuration-" name="test-machine-configuration-" class="anchor"><span class="anchor-link"></span></a>Test Machine Configuration :</h3>
<ul>
  <li>MacBook Pro (Retina, 15-inch, Mid 2015)</li>
  <li>Processor Name: Intel Core i7</li>
  <li>Processor Speed: 2.8 GHz</li>
  <li>No. of Processors: 1</li>
  <li>No. of Cores: 4</li>
  <li>L2 Cache (per Core): 256 KB</li>
  <li>L3 Cache: 6 MB</li>
  <li>Memory: 16 GB 1600 MHz DDR3</li>
  <li>JDK: 1.8.0_121</li>
</ul>
<h3><a href="#scala-logging-appenders-throughput" name="scala-logging-appenders-throughput" class="anchor"><span class="anchor-link"></span></a>Scala Logging : Appender&rsquo;s Throughput</h3>
<p><img src="../images/logging-perf/logging-appenders-perf-results.png" alt="Logging Appenders Throughput" /></p>
<p>Above graph includes the throughput results for File and StdOut appender&rsquo;s using scala&rsquo;s logging API. Java&rsquo;s logging API throughput results are included further down this page.<br/>As shown in the above graph, experiment was carried out for 1, 2, 4, 8 and 16 threads. That means, multiple threads are logging messages concurrently. </p><div class="callout note "><div class="callout-title">Note</div>
<ul>
  <li>Numbers indicated in the graph does not mean that those number of messages are actually written to file or console. These are the number of logging messages sent to LogActor asynchronously for the period of one second.</li>
  <li>It is the responsibility of LogActor to write these messages to file or console.</li>
  <li>LogActor uses BoundedMailbox with a mailbox-capacity = 262144, messages are dropped if mailbox gets full.</li>
</ul></div>
<h3><a href="#scala-and-java-logging-throughput-comparision-log-level-enabled-vs-disabled-" name="scala-and-java-logging-throughput-comparision-log-level-enabled-vs-disabled-" class="anchor"><span class="anchor-link"></span></a>Scala And Java Logging : Throughput Comparision (Log Level Enabled vs Disabled)</h3>
<p>Below graph depicts the throughput of Java&rsquo;s logging API (String and Supplier) and scala&rsquo;s logging API when log level was enabled and disabled. </p><div class="callout note "><div class="callout-title">Note</div>
<ul>
  <li><strong>Log Level Enabled</strong> : Results are obtained for <code>log.info</code> when default log level was set to info, that means the logging messages were sent to LogActor for writing it to file.</li>
  <li><strong>Log Level Disabled</strong> : Results are obtained for <code>log.trace</code> when default log level was set to info, that means the logging messages were not written to file.</li>
</ul></div>
<p><img src="../images/logging-perf/java-scala-logging-throughput-comparision.png" alt="Java Scala Throughput Comparision" /></p>
<p>This graph is produced based on the result generated by <a href="https://github.com/tmtsoftware/csw-prod/blob/master/csw-benchmark/src/main/java/csw/services/logging/perf/jmh/JE2ELoggingBenchmark.java">JE2ELoggingBenchmark</a> and <a href="https://github.com/tmtsoftware/csw-prod/blob/master/csw-benchmark/src/main/scala/csw/services/logging/perf/jmh/E2ELoggingBenchmark.scala">E2ELoggingBenchmark</a></p><div class="callout note "><div class="callout-title">Note</div>
<ul>
  <li>As you can see in the above graph, Supplier version of Java log API and by name of scala API is very efficient and throughput is much higher than String version. It is recommended to use Supplier API by java developers.</li>
</ul></div>
<h2><a href="#acknowledgement" name="acknowledgement" class="anchor"><span class="anchor-link"></span></a>Acknowledgement</h2>
<p>The codebase in <strong>csw-logging</strong> module is based on <a href="https://github.com/nestorpersist/logging">persist-logging</a> library. We appreciate efforts put in by authors of the persist-logging library which made our development fast and easy.</p>
</div>
<div>
<a href="https://github.com/tmtsoftware/csw-prod/tree/master/docs/src/main/services/logging.md" title="Edit this page" class="md-source-file md-edit">
Edit this page
</a>
</div>
<div class="print-only">
<span class="md-source-file md-version">
0.5.0
</span>
</div>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-nav">
<nav class="md-footer-nav__inner md-grid">
<a href="../services/config.html" title="Configuration Service" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
</div>
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Previous
</span>
Configuration Service
</span>
</div>
</a>
<a href="../services/event.html" title="Event Service" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Next
</span>
Event Service
</span>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
</div>
</a>
</nav>
</div>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
Powered by
<a href="https://github.com/lightbend/paradox">Paradox</a>
and
<a href="https://jonas.github.io/paradox-material-theme/">Paradox Material Theme</a>

</div>
</div>
</div>
</footer>

</div>
<script src="../assets/javascripts/application.5165553b.js"></script>
<script src="../assets/javascripts/paradox-material-theme.js"></script>
<script>app.initialize({version:"0.17",url:{base:"../."}})</script>
<script type="text/javascript" src="../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function(event) {
window.prettyPrint && prettyPrint();
});
</script>
</body>
</html>
