<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="description" content="docs">
<meta name="generator" content="Paradox, paradox-material-theme=0.6.0, mkdocs-material=3.0.3">

<meta name="lang:clipboard.copy" content="Copy to clipboard">
<meta name="lang:clipboard.copied" content="Copied to clipboard">
<meta name="lang:search.language" content="">
<meta name="lang:search.pipeline.stopwords" content="true">
<meta name="lang:search.pipeline.trimmer" content="true">
<meta name="lang:search.result.none" content="No matching documents">
<meta name="lang:search.result.one" content="1 matching document">
<meta name="lang:search.result.other" content="# matching documents">
<meta name="lang:search.tokenizer" content="[\s\-]+">


<meta name="description" content="docs">
<link rel="shortcut icon" href="../assets/tmt_favicon.ico">
<title>Alarm Service · TMT Common Software (CSW)</title>
<link rel="stylesheet" href="../assets/stylesheets/application.451f80e5.css">
<link rel="stylesheet" href="../lib/material__tabs/dist/mdc.tabs.min.css">
<link rel="stylesheet" href="../lib/prettify/prettify.css">
<script src="../assets/javascripts/modernizr.1aa3b519.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
<style>
body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}
code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}
</style>
<link rel="stylesheet" href="../assets/fonts/font-awesome.css">
<link rel="stylesheet" href="../assets/fonts/material-icons.css">
<link rel="stylesheet" href="../assets/stylesheets/paradox-material-theme.css">
</head>
<body
>
<input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
<input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
<label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
<header class="md-header" data-md-component="header">
<nav class="md-header-nav md-grid">
<div class="md-flex">
<div class="md-flex__cell md-flex__cell--shrink">
<a href="../index.html" title="TMT Common Software (CSW)" class="md-header-nav__button md-logo">
<i class="md-icon">local_library</i>
</a>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
</div>
<div class="md-flex__cell md-flex__cell--stretch">
<div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
<span class="md-header-nav__topic">
TMT Common Software (CSW)
</span>
<span class="md-header-nav__topic">
Alarm Service
</span>
</div>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
<label class="md-icon md-search__icon" for="__search"></label>
<button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">&#xE5CD;</button>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix>
<div class="md-search-result" data-md-component="result">
<div class="md-search-result__meta">
Type to start searching
</div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>

</div>
<div class="md-flex__cell md-flex__cell--shrink">
<div class="md-header-nav__source">
<a href="https://github.com/tmtsoftware/csw"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
tmtsoftware/csw
</div>
</a>

</div>
</div>
</div>
</nav>
</header>

<div class="md-container">
<main class="md-main">
<div class="md-main__inner md-grid" data-md-component="container">
<div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--primary" data-md-level="0" style="visibility: hidden">
<label class="md-nav__title md-nav__title--site" for="drawer">
<a href="../index.html" title="TMT Common Software (CSW)" class="md-nav__button md-logo">
<span class="md-nav__button md-logo">
<i class="md-icon">local_library</i>
</a>
<a href="../index.html" title="TMT Common Software (CSW)">
TMT Common Software (CSW)
</a>
</label>
<div class="md-nav__source">
<a href="https://github.com/tmtsoftware/csw"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
tmtsoftware/csw
</div>
</a>

</div>
<ul>
  <li><a href="../commons/getting-started.html" class="page">Getting Started</a></li>
  <li><a href="../commons/create-component.html" class="page">Creating a Component</a></li>
  <li><a href="../commons/multiple-components.html" class="page">Multiple Components</a></li>
  <li><a href="../commons/using-alarms.html" class="page">Using Alarms</a></li>
  <li><a href="../commons/unit-tests.html" class="page">Adding Unit Tests</a></li>
  <li><a href="../commons/messages.html" class="page">Messages</a>
  <ul>
    <li><a href="../messages/keys-parameters.html" class="page">Keys and Parameters</a></li>
    <li><a href="../messages/units.html" class="page">Units</a></li>
    <li><a href="../messages/subsystem.html" class="page">Subsystem</a></li>
    <li><a href="../messages/commands.html" class="page">Commands</a></li>
    <li><a href="../messages/events.html" class="page">Events</a></li>
    <li><a href="../messages/states.html" class="page">State Variables</a></li>
    <li><a href="../messages/result.html" class="page">Result</a></li>
  </ul></li>
  <li><a href="../commons/framework.html" class="page">Framework for creating components (HCD, Assembly, Container)</a>
  <ul>
    <li><a href="../framework/describing-components.html" class="page">ComponentInfo</a></li>
    <li><a href="../framework/creating-components.html" class="page">Creating an Assembly or Hcd Component</a></li>
    <li><a href="../framework/handling-lifecycle.html" class="page">Component Handlers</a></li>
    <li><a href="../framework/managing-command-state.html" class="page">Managing Command State</a></li>
    <li><a href="../framework/tracking-connections.html" class="page">Tracking Connections</a></li>
    <li><a href="../framework/publishing-state.html" class="page">Publishing State</a></li>
    <li><a href="../framework/handling-exceptions.html" class="page">Handling Exceptions</a></li>
    <li><a href="../framework/deploying-components.html" class="page">Deploying Components</a></li>
  </ul></li>
  <li><a href="../commons/command.html" class="page">Communication using Commands</a></li>
  <li><a href="../commons/services.html" class="page">Services</a>
  <ul>
    <li><a href="../services/location.html" class="page">Location Service</a></li>
    <li><a href="../services/config.html" class="page">Configuration Service</a></li>
    <li><a href="../services/logging.html" class="page">Logging Service</a></li>
    <li><a href="../services/event.html" class="page">Event Service</a></li>
    <li><a href="../services/alarm.html" class="active page">Alarm Service</a></li>
    <li><a href="../services/time.html" class="page">Time Service</a></li>
    <li><a href="../services/database.html" class="page">Database Service</a></li>
    <li><a href="../services/aas.html" class="page">Authentication and Authorization Service (AAS)</a></li>
  </ul></li>
  <li><a href="../commons/apps.html" class="page">Applications</a>
  <ul>
    <li><a href="../apps/cswlocationserver.html" class="page">csw-location-server</a></li>
    <li><a href="../apps/cswadminserver.html" class="page">csw-admin-server</a></li>
    <li><a href="../apps/cswlocationagent.html" class="page">csw-location-agent</a></li>
    <li><a href="../apps/cswonfigserverapp.html" class="page">csw-config-server</a></li>
    <li><a href="../apps/cswconfigcli.html" class="page">csw-config-cli</a></li>
    <li><a href="../apps/csweventcli.html" class="page">csw-event-cli</a></li>
    <li><a href="../apps/cswalarmcli.html" class="page">csw-alarm-cli</a></li>
    <li><a href="../apps/hostconfig.html" class="page">csw-host-config</a></li>
  </ul></li>
  <li><a href="../commons/testing.html" class="page">Testing</a></li>
  <li><a href="../commons/sbt-tasks.html" class="page">sbt Tasks</a></li>
  <li><a href="../commons/manuals.html" class="page">Manuals</a></li>
</ul>
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../services/alarm.html#alarm-service" class="header">Alarm Service</a>
  <ul>
    <li><a href="../services/alarm.html#dependencies" class="header">Dependencies</a></li>
    <li><a href="../services/alarm.html#api-flavors" class="header">API Flavors</a></li>
    <li><a href="../services/alarm.html#creating-clientapi-and-adminapi" class="header">Creating clientAPI and adminAPI</a></li>
    <li><a href="../services/alarm.html#rules-and-checks" class="header">Rules and checks</a></li>
    <li><a href="../services/alarm.html#model-classes" class="header">Model Classes</a></li>
    <li><a href="../services/alarm.html#client-api" class="header">Client API</a></li>
    <li><a href="../services/alarm.html#admin-api" class="header">Admin API</a></li>
    <li><a href="../services/alarm.html#source-code-for-examples" class="header">Source code for examples</a></li>
  </ul></li>
</ul>
</nav>

</nav>
<ul style="display: none">
<li class="md-nav__item md-version" id="project.version">
<label class="md-nav__link" for="__version">
<i class="md-icon" title="Version">label_outline</i> 0.1*
</label>
</li>
</ul>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../services/alarm.html#alarm-service" class="header">Alarm Service</a>
  <ul>
    <li><a href="../services/alarm.html#dependencies" class="header">Dependencies</a></li>
    <li><a href="../services/alarm.html#api-flavors" class="header">API Flavors</a></li>
    <li><a href="../services/alarm.html#creating-clientapi-and-adminapi" class="header">Creating clientAPI and adminAPI</a></li>
    <li><a href="../services/alarm.html#rules-and-checks" class="header">Rules and checks</a></li>
    <li><a href="../services/alarm.html#model-classes" class="header">Model Classes</a></li>
    <li><a href="../services/alarm.html#client-api" class="header">Client API</a></li>
    <li><a href="../services/alarm.html#admin-api" class="header">Admin API</a></li>
    <li><a href="../services/alarm.html#source-code-for-examples" class="header">Source code for examples</a></li>
  </ul></li>
</ul>
</nav>

</div>
</div>
</div>
<div class="md-content">
<article class="md-content__inner md-typeset">
<div class="md-content__searchable">
<h1><a href="#alarm-service" name="alarm-service" class="anchor"><span class="anchor-link"></span></a>Alarm Service</h1>
<p>The Alarm Service provides API to manage alarms in the TMT software system. The service uses Redis to store Alarm data, including the alarm status and associated metadata. Alarm &ldquo;keys&rdquo; are used to access information about an alarm.</p>
<!-- introduction to the service -->
<h2><a href="#dependencies" name="dependencies" class="anchor"><span class="anchor-link"></span></a>Dependencies</h2>
<p>The Alarm Service comes bundled with the Framework, no additional dependency needs to be added to your <code>build.sbt</code>  file if using it. To use the Alarm service without using the framework, add this to your <code>build.sbt</code> file:</p>
<dl>
  <dt>sbt</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">libraryDependencies += &quot;com.github.tmtsoftware.csw&quot; %% &quot;csw-alarm-client&quot; % &quot;0.1-SNAPSHOT&quot;
</code></pre></dd>
</dl>
<h2><a href="#api-flavors" name="api-flavors" class="anchor"><span class="anchor-link"></span></a>API Flavors</h2>
<p>There are two APIs provided in the Alarm Service: a client API, and an administrative (admin) API. The client API is the API used by component developers to set the severity of an alarm. This is the only functionality needed by component developers. As per TMT policy, the severity of an alarm must be set periodically (within some time limit) in order to maintain the integrity of the alarm status. If an alarm severity is not refreshed within the time limit, currently set at 9 seconds, the severity is set to <code>Disconnected</code> by the Alarm Service, which indicates to the operator that there is some problem with the component&rsquo;s ability to evaluate the alarm status.</p>
<p>The admin API provides all of the functions needed manage the alarm store, as well as providing access to monitor alarms for use by an operator or instrument specialist. The admin API provides the ability to load alarm data into alarm store, set severity of an alarm, acknowledge alarms, shelve or unshelve alarms, reset a latched alarm, get the metadata/status/severity of an alarm, and get or subscribe to aggregations of severity and health of the alarm, a component&rsquo;s alarms, a subsystem&rsquo;s alarms, or the alarms of the whole TMT System. </p>
<p>A command line tool is provided as part of the Alarm Service that implements this API can provides low level control over the Alarm Service. More details about alarm CLI can be found here: <a href="../apps/cswalarmcli.html">CSW Alarm Client CLI application</a></p>
<p>Eventually, operators will use Graphical User Interfaces that access the admin API through a UI gateway. This will be delivered as part of the ESW HCMS package.</p><div class="callout note "><div class="callout-title">Note</div>
<p>Since the admin API will primarily be used with the CLI and HCMS applications, it is only supported in Scala, and not Java.</p></div>
<p>To summarize, the APIs are as follows: * <strong>client API (AlarmService)</strong> : Must be used by component. Available method is : <code>{setSeverity}</code> * <strong>admin API (AlarmAdminService)</strong> : Expected to be used by administrator. Available methods are: <code>{initAlarm | setSeverity | acknowledge | shelve | unshelve | reset | getMetaData
| getStatus | getCurrentSeverity | getAggregatedSeverity | getAggregatedHealth | subscribeAggregatedSeverityCallback
| subscribeAggregatedSeverityActorRef | subscribeAggregatedHealthCallback | subscribeAggregatedHealthActorRef }</code></p>
<h2><a href="#creating-clientapi-and-adminapi" name="creating-clientapi-and-adminapi" class="anchor"><span class="anchor-link"></span></a>Creating clientAPI and adminAPI</h2>
<p>For component developers, the client API is provided as an <a href="https://tmtsoftware.github.io/csw/0.1-SNAPSHOT/api/scala/csw/alarm/api/scaladsl/AlarmService.html">AlarmService</a> object in the <code>CswContext</code> object injected into the ComponentHandlers class provided by the framework. </p>
<p>If you are not using csw-framework, you can create <a href="https://tmtsoftware.github.io/csw/0.1-SNAPSHOT/api/scala/csw/alarm/api/scaladsl/AlarmService.html">AlarmService</a> using <a href="https://tmtsoftware.github.io/csw/0.1-SNAPSHOT/api/scala/csw/alarm/client/AlarmServiceFactory.html">AlarmServiceFactory</a>.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/main/scala/example/alarm/AlarmServiceClientExampleApp.scala#L32-L42" target="_blank" title="Go to snippet source"></a><code class="language-scala">// create alarm client using host and port of alarm server
private val clientAPI1 = new AlarmServiceFactory().makeClientApi(&quot;localhost&quot;, 5225)

// create alarm client using location service
private val clientAPI2 = new AlarmServiceFactory().makeClientApi(locationService)

// create alarm admin using host and port of alarm server
private val adminAPI1 = new AlarmServiceFactory().makeAdminApi(&quot;localhost&quot;, 5226)

// create alarm admin using location service
private val adminAPI2 = new AlarmServiceFactory().makeAdminApi(locationService)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/main/java/example/alarm/JAlarmServiceClientExampleApp.java#L28-L32" target="_blank" title="Go to snippet source"></a><code class="language-java">// create alarm client using host and port of alarm server
 IAlarmService jclientAPI1 = new AlarmServiceFactory().jMakeClientApi(&quot;localhost&quot;, 5227, actorSystem);

// create alarm client using location service
 IAlarmService jclientAPI2 = new AlarmServiceFactory().jMakeClientApi(jLocationService, actorSystem);</code></pre></dd>
</dl>
<h2><a href="#rules-and-checks" name="rules-and-checks" class="anchor"><span class="anchor-link"></span></a>Rules and checks</h2>
<ul>
  <li>When representing a unique alarm, the alarm name or component name must not have <code>* [ ] ^ -</code> or <code>any whitespace characters</code></li>
</ul>
<h2><a href="#model-classes" name="model-classes" class="anchor"><span class="anchor-link"></span></a>Model Classes</h2>
<ul>
  <li><strong>AlarmKey</strong> : Represents the unique alarm in the TMT system. It is composed of subsystem, component and alarm name.</li>
  <li><strong>ComponentKey</strong> : Represents all alarms of a component. Used for getting severity or health of an entire component.</li>
  <li><strong>SubsystemKey</strong> : Represents all alarms of a subsystem Used for getting severity or health of an entire subsystem.</li>
  <li><strong>GlobalKey</strong> : Represents all alarms present in the TMT system. Used for getting severity or health of an entire observatory.</li>
  <li><strong>AlarmMetadata</strong> : Represents static metadata of an alarm, which will not change in its entire lifespan.</li>
  <li><strong>AlarmStatus</strong> : Represents dynamically changing data of the an alarm, which will be changing depending on the severity change or manually changed by an operator</li>
  <li><strong>AlarmSeverity</strong> : Represents severity levels that can be set by the component developer e.g. Okay, Indeterminate, Warning, Major and Critical</li>
  <li><strong>FullAlarmSeverity</strong> : Represents all possible severity levels of the alarm i.e. Disconnected (cannot be set by the developer) plus other severity levels that can be set by the developer</li>
  <li><strong>AlarmHealth</strong> : Represents possible health of an alarm or component or subsystem or whole TMT system</li>
</ul>
<h2><a href="#client-api" name="client-api" class="anchor"><span class="anchor-link"></span></a>Client API</h2>
<h3><a href="#setseverity" name="setseverity" class="anchor"><span class="anchor-link"></span></a>setSeverity</h3>
<p>Sets the severity of the given alarm. The severity must be refreshed by setting it at a regular interval or it will automatically be changed to <code>Disconnected</code> after a specific time. </p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/main/scala/example/alarm/AlarmServiceClientExampleApp.scala#L49-L50" target="_blank" title="Go to snippet source"></a><code class="language-scala">val alarmKey              = AlarmKey(NFIRAOS, &quot;trombone&quot;, &quot;tromboneAxisLowLimitAlarm&quot;)
val resultF: Future[Done] = clientAPI.setSeverity(alarmKey, Okay)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/main/java/example/alarm/JAlarmServiceClientExampleApp.java#L36-L37" target="_blank" title="Go to snippet source"></a><code class="language-java">private AlarmKey alarmKey = new AlarmKey(NFIRAOS, &quot;trombone&quot;, &quot;tromboneAxisLowLimitAlarm&quot;);
Future&lt;Done&gt; doneF = jclientAPI1.setSeverity(alarmKey, Okay);</code></pre></dd>
</dl><div class="callout note "><div class="callout-title">Note</div>
<ul>
  <li>If the alarm is not refreshed within 9 seconds, it will be inferred as <code>Disconnected</code></li>
  <li>If the alarm is auto-acknowledgable and the severity is set to <code>Okay</code> then, the alarm will be auto-acknowledged and  will not require any explicit admin action in terms of acknowledging</li>
</ul></div>
<h2><a href="#admin-api" name="admin-api" class="anchor"><span class="anchor-link"></span></a>Admin API</h2>
<h3><a href="#initalarms" name="initalarms" class="anchor"><span class="anchor-link"></span></a>initAlarms</h3>
<p>Loads the given alarm data in alarm store, passing in the alarm configuration file.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/main/scala/example/alarm/AlarmServiceClientExampleApp.scala#L54-L56" target="_blank" title="Go to snippet source"></a><code class="language-scala">val resource               = &quot;test-alarms/valid-alarms.conf&quot;
val alarmsConfig: Config   = ConfigFactory.parseResources(resource)
val result2F: Future[Done] = adminAPI.initAlarms(alarmsConfig)</code></pre></dd>
</dl>
<p>Alarm configuration files are written in the HOCON format using the following fields:</p>
<ul>
  <li><strong>subsystem:</strong> subsystem name the alarm belongs to</li>
  <li><strong>component:</strong> name of component for the alarm, matching the name in the componentInfo file (see <a href="../framework/describing-components.html">Describing Components</a>)</li>
  <li><strong>name:</strong> name of the alarm</li>
  <li><strong>description:</strong> a description of what the alarm represents</li>
  <li><strong>location:</strong> physical location within observatory or instrument in which the alarm condition is occuring</li>
  <li><strong>alarmType:</strong> the general category for the alarm.</li>
  <li><strong>supportedSeverities:</strong> list of non-Okay severities the alarm may become (Warning, Major, Critical). All alarms are assumed to support Okay, Disconnected, and Indeterminate.</li>
  <li><strong>probableCause:</strong> a description of the likely cause of the alarm reaching each severity level</li>
  <li><strong>operatorResponse:</strong> instructions or information to help the operator respond to the alarm.</li>
  <li><strong>isAutoAcknowledgable:</strong> true/false flag for whether the alarm automatically acknowledges alarm when alarm severity returns to Okay.</li>
  <li><strong>isLatchable:</strong> true/false flag whether alarm latches at highest severity until reset.</li>
  <li><strong>activationStatus:</strong> true/false flag for whether alarm is currently active (and considered in aggregated severity and health calculations)</li>
</ul>
<dl>
  <dt>alarms.conf
  </dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/main/resources/valid-alarms.conf#L4-L61" target="_blank" title="Go to snippet source"></a><code class="language-conf">alarms: [
  {
    subsystem = NFIRAOS
    component = trombone
    name = tromboneAxisLowLimitAlarm
    description = &quot;Warns when trombone axis has reached the low limit&quot;
    location = &quot;south side&quot;
    alarmType = Absolute
    supportedSeverities = [Warning, Major, Critical]
    probableCause = &quot;the trombone software has failed or the stage was driven into the low limit&quot;
    operatorResponse = &quot;go to the NFIRAOS engineering user interface and select the datum axis command&quot;
    isAutoAcknowledgeable = false
    isLatchable = true
    activationStatus = Active
  },
  {
    subsystem = NFIRAOS
    component = trombone
    name = tromboneAxisHighLimitAlarm
    description = &quot;Warns when trombone axis has reached the high limit&quot;
    location = &quot;south side&quot;
    alarmType = Absolute
    supportedSeverities = [Warning, Major]
    probableCause = &quot;the trombone software has failed or the stage was driven into the high limit&quot;
    operatorResponse = &quot;go to the NFIRAOS engineering user interface and select the datum axis command&quot;
    isAutoAcknowledgeable = true
    isLatchable = true
    activationStatus = Active
  },
  {
    subsystem = TCS
    component = tcsPk
    name = cpuExceededAlarm
    description = &quot;This alarm is activated when the tcsPk Assembly can no longer calculate all of its pointing values in the time allocated. The CPU may lock power, or there may be pointing loops running that are not needed. Response: Check to see if pointing loops are executing that are not needed or see about a more powerful CPU.&quot;
    location = &quot;in computer...&quot;
    alarmType = Absolute
    supportedSeverities = [Warning, Major, Critical]
    probableCause = &quot;too fast...&quot;
    operatorResponse = &quot;slow it down...&quot;
    isAutoAcknowledgeable = true
    isLatchable = false
    activationStatus = Active
  },
  {
    subsystem = LGSF
    component = tcsPkInactive
    name = cpuIdleAlarm
    description = &quot;This alarm is activated CPU is idle&quot;
    location = &quot;in computer...&quot;
    alarmType = Absolute
    supportedSeverities = [Warning, Major, Critical]
    probableCause = &quot;too fast...&quot;
    operatorResponse = &quot;slow it down...&quot;
    isAutoAcknowledgeable = true
    isLatchable = false
    activationStatus = Inactive
  }
]</code></pre></dd>
</dl>
<h3><a href="#acknowledge" name="acknowledge" class="anchor"><span class="anchor-link"></span></a>acknowledge</h3>
<p>Acknowledges the given alarm which is raised to a higher severity</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/main/scala/example/alarm/AlarmServiceClientExampleApp.scala#L60" target="_blank" title="Go to snippet source"></a><code class="language-scala">val result3F: Future[Done] = adminAPI.acknowledge(alarmKey)</code></pre></dd>
</dl>
<h3><a href="#shelve" name="shelve" class="anchor"><span class="anchor-link"></span></a>shelve</h3>
<p>Shelves the given alarm. Alarms will be un-shelved automatically at a specific time(i.e. 8 AM local time by default) if it is not un-shelved manually before that. The time to automatically un-shelve can be configured in application.conf for e.g csw-alarm.shelve-timeout = h:m:s a .</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/main/scala/example/alarm/AlarmServiceClientExampleApp.scala#L64" target="_blank" title="Go to snippet source"></a><code class="language-scala">val result4F: Future[Done] = adminAPI.shelve(alarmKey)</code></pre></dd>
</dl><div class="callout note "><div class="callout-title">Note</div>
<p>Shelved alarms are also considered in aggregation severity or health calculation of alarms.</p></div>
<h3><a href="#unshelve" name="unshelve" class="anchor"><span class="anchor-link"></span></a>unshelve</h3>
<p>Unshelves the given alarm</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/main/scala/example/alarm/AlarmServiceClientExampleApp.scala#L68" target="_blank" title="Go to snippet source"></a><code class="language-scala">val result5F: Future[Done] = adminAPI.unshelve(alarmKey)</code></pre></dd>
</dl>
<h3><a href="#reset" name="reset" class="anchor"><span class="anchor-link"></span></a>reset</h3>
<p>Resets the status of the given latched alarm by updating the latched severity same as current severity and acknowledgement status to acknowledged without changing any other properties of the alarm.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/main/scala/example/alarm/AlarmServiceClientExampleApp.scala#L72" target="_blank" title="Go to snippet source"></a><code class="language-scala">val result6F: Future[Done] = adminAPI.reset(alarmKey)</code></pre></dd>
</dl>
<h3><a href="#getmetadata" name="getmetadata" class="anchor"><span class="anchor-link"></span></a>getMetadata</h3>
<p>Gets the metadata of an alarm, component, subsystem, or whole TMT system. The following information is returned for each alarm:</p>
<ul>
  <li>subsystem</li>
  <li>component</li>
  <li>name</li>
  <li>description</li>
  <li>location</li>
  <li>alarmType</li>
  <li>supported severities</li>
  <li>probable cause</li>
  <li>operator response</li>
  <li>is autoAcknowledgeable</li>
  <li>is latchable</li>
  <li>activation status</li>
</ul>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/main/scala/example/alarm/AlarmServiceClientExampleApp.scala#L76-L80" target="_blank" title="Go to snippet source"></a><code class="language-scala">val metadataF: Future[AlarmMetadata] = adminAPI.getMetadata(alarmKey)
metadataF.onComplete {
  case Success(metadata)  =&gt; println(s&quot;${metadata.name}: ${metadata.description}&quot;)
  case Failure(exception) =&gt; println(s&quot;Error getting metadata: ${exception.getMessage}&quot;)
}</code></pre></dd>
</dl><div class="callout note "><div class="callout-title">Note</div>
<p>Inactive alarms will not be taking part in aggregation of severity or health. Alarms are set active or inactive in the alarm configuration file, and not through either API.</p></div>
<h3><a href="#getstatus" name="getstatus" class="anchor"><span class="anchor-link"></span></a>getStatus</h3>
<p>Gets the status of the alarm which contains fields like:</p>
<ul>
  <li>latched severity</li>
  <li>acknowledgement status</li>
  <li>shelve status</li>
  <li>alarm time</li>
</ul>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/main/scala/example/alarm/AlarmServiceClientExampleApp.scala#L84-L88" target="_blank" title="Go to snippet source"></a><code class="language-scala">val statusF: Future[AlarmStatus] = adminAPI.getStatus(alarmKey)
statusF.onComplete {
  case Success(status)    =&gt; println(s&quot;${status.alarmTime}: ${status.latchedSeverity}&quot;)
  case Failure(exception) =&gt; println(s&quot;Error getting status: ${exception.getMessage}&quot;)
}</code></pre></dd>
</dl>
<h3><a href="#getcurrentseverity" name="getcurrentseverity" class="anchor"><span class="anchor-link"></span></a>getCurrentSeverity</h3>
<p>Gets the severity of the alarm.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/main/scala/example/alarm/AlarmServiceClientExampleApp.scala#L92-L96" target="_blank" title="Go to snippet source"></a><code class="language-scala">val severityF: Future[FullAlarmSeverity] = adminAPI.getCurrentSeverity(alarmKey)
severityF.onComplete {
  case Success(severity)  =&gt; println(s&quot;${severity.name}: ${severity.level}&quot;)
  case Failure(exception) =&gt; println(s&quot;Error getting severity: ${exception.getMessage}&quot;)
}</code></pre></dd>
</dl>
<h3><a href="#getaggregatedseverity" name="getaggregatedseverity" class="anchor"><span class="anchor-link"></span></a>getAggregatedSeverity</h3>
<p>Gets the aggregated severity for the given alarm/component/subsystem/whole TMT system. Aggregation of the severity represents the most severe alarm amongst multiple alarms.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/main/scala/example/alarm/AlarmServiceClientExampleApp.scala#L100-L105" target="_blank" title="Go to snippet source"></a><code class="language-scala">val componentKey                                   = ComponentKey(NFIRAOS, &quot;tromboneAssembly&quot;)
val aggregatedSeverityF: Future[FullAlarmSeverity] = adminAPI.getAggregatedSeverity(componentKey)
aggregatedSeverityF.onComplete {
  case Success(severity)  =&gt; println(s&quot;aggregate severity: ${severity.name}: ${severity.level}&quot;)
  case Failure(exception) =&gt; println(s&quot;Error getting aggregate severity: ${exception.getMessage}&quot;)
}</code></pre></dd>
</dl>
<h3><a href="#getaggregatedhealth" name="getaggregatedhealth" class="anchor"><span class="anchor-link"></span></a>getAggregatedHealth</h3>
<p>Gets the aggregated health for the given alarm/component/subsystem/whole TMT system. Aggregation of health is either <code>Good</code>, <code>ill</code> or <code>Bad</code> based on the most severe alarm amongst multiple alarms.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/main/scala/example/alarm/AlarmServiceClientExampleApp.scala#L109-L114" target="_blank" title="Go to snippet source"></a><code class="language-scala">val subsystemKey                 = SubsystemKey(IRIS)
val healthF: Future[AlarmHealth] = adminAPI.getAggregatedHealth(subsystemKey)
healthF.onComplete {
  case Success(health)    =&gt; println(s&quot;${subsystemKey.subsystem.name} health = ${health.entryName}&quot;)
  case Failure(exception) =&gt; println(s&quot;Error getting health: ${exception.getMessage}&quot;)
}</code></pre></dd>
</dl>
<h3><a href="#subscribeaggregatedseveritycallback" name="subscribeaggregatedseveritycallback" class="anchor"><span class="anchor-link"></span></a>subscribeAggregatedSeverityCallback</h3>
<p>Subscribes to the changes of aggregated severity for given alarm/component/subsystem/whole TMT system by providing a callback which gets executed for every change.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/main/scala/example/alarm/AlarmServiceClientExampleApp.scala#L118-L123" target="_blank" title="Go to snippet source"></a><code class="language-scala">val alarmSubscription: AlarmSubscription = adminAPI.subscribeAggregatedSeverityCallback(
  ComponentKey(NFIRAOS, &quot;tromboneAssembly&quot;),
  aggregatedSeverity ⇒ { /* do something*/ }
)
// to unsubscribe:
val unsubscribe1F: Future[Done] = alarmSubscription.unsubscribe()</code></pre></dd>
</dl>
<h3><a href="#subscribeaggregatedseverityactorref" name="subscribeaggregatedseverityactorref" class="anchor"><span class="anchor-link"></span></a>subscribeAggregatedSeverityActorRef</h3>
<p>Subscribes to the changes of aggregated severity for given alarm/component/subsystem/whole TMT system by providing an actor which will receive a message of aggregated severity on every change.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/main/scala/example/alarm/AlarmServiceClientExampleApp.scala#L127-L132" target="_blank" title="Go to snippet source"></a><code class="language-scala">val severityActorRef = typed.ActorSystem(behaviour[FullAlarmSeverity], &quot;fullSeverityActor&quot;)
val alarmSubscription2: AlarmSubscription =
  adminAPI.subscribeAggregatedSeverityActorRef(SubsystemKey(NFIRAOS), severityActorRef)

// to unsubscribe:
val unsubscribe2F: Future[Done] = alarmSubscription2.unsubscribe()</code></pre></dd>
</dl>
<h3><a href="#subscribeaggregatedhealthcallback" name="subscribeaggregatedhealthcallback" class="anchor"><span class="anchor-link"></span></a>subscribeAggregatedHealthCallback</h3>
<p>Subscribe to the changes of aggregated health for given alarm/component/subsystem/whole TMT system by providing a callback which gets executed for every change.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/main/scala/example/alarm/AlarmServiceClientExampleApp.scala#L136-L142" target="_blank" title="Go to snippet source"></a><code class="language-scala">val alarmSubscription3: AlarmSubscription = adminAPI.subscribeAggregatedHealthCallback(
  ComponentKey(IRIS, &quot;ImagerDetectorAssembly&quot;),
  aggregatedHealth ⇒ { /* do something*/ }
)

// to unsubscribe
val unsubscribe3F: Future[Done] = alarmSubscription3.unsubscribe()</code></pre></dd>
</dl>
<h3><a href="#subscribeaggregatedhealthactorref" name="subscribeaggregatedhealthactorref" class="anchor"><span class="anchor-link"></span></a>subscribeAggregatedHealthActorRef</h3>
<p>Subscribes to the changes of aggregated health for given alarm/component/subsystem/whole TMT system by providing an actor which will receive a message of aggregated severity on every change.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/main/scala/example/alarm/AlarmServiceClientExampleApp.scala#L146-L150" target="_blank" title="Go to snippet source"></a><code class="language-scala">val healthActorRef                        = typed.ActorSystem(behaviour[AlarmHealth], &quot;healthActor&quot;)
val alarmSubscription4: AlarmSubscription = adminAPI.subscribeAggregatedHealthActorRef(SubsystemKey(IRIS), healthActorRef)

// to unsubscribe
val unsubscribe4F: Future[Done] = alarmSubscription4.unsubscribe()</code></pre></dd>
</dl>
<h2><a href="#source-code-for-examples" name="source-code-for-examples" class="anchor"><span class="anchor-link"></span></a>Source code for examples</h2>
<ul>
  <li><a href="https://github.com/tmtsoftware/csw/tree/master/examples/src/main/scala/example/alarm/AlarmServiceClientExampleApp.scala">Scala Example</a></li>
  <li><a href="https://github.com/tmtsoftware/csw/tree/master/examples/src/main/java/example/alarm/JAlarmServiceClientExampleApp.java">Java Example</a></li>
</ul>
</div>
<div>
<a href="https://github.com/tmtsoftware/csw/tree/master/docs/src/main/services/alarm.md" title="Edit this page" class="md-source-file md-edit">
Edit this page
</a>
</div>
<div class="print-only">
<span class="md-source-file md-version">
0.1*
</span>
</div>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-nav">
<nav class="md-footer-nav__inner md-grid">
<a href="../services/event.html" title="Event Service" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
</div>
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Previous
</span>
Event Service
</span>
</div>
</a>
<a href="../services/time.html" title="Time Service" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Next
</span>
Time Service
</span>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
</div>
</a>
</nav>
</div>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
Powered by
<a href="https://github.com/lightbend/paradox">Paradox</a>
and
<a href="https://jonas.github.io/paradox-material-theme/">Paradox Material Theme</a>

</div>
</div>
</div>
</footer>

</div>
<script src="../assets/javascripts/application.583bbe55.js"></script>
<script src="../assets/javascripts/paradox-material-theme.js"></script>
<script>app.initialize({version:"0.17",url:{base:"../."}})</script>
<script type="text/javascript" src="../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function(event) {
window.prettyPrint && prettyPrint();
});
</script>
</body>
</html>
