<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="description" content="docs">
<meta name="generator" content="Paradox, paradox-material-theme=0.4.0, mkdocs-material=2.2.2">

<meta name="lang:clipboard.copy" content="Copy to clipboard">
<meta name="lang:clipboard.copied" content="Copied to clipboard">
<meta name="lang:search.result.none" content="No matching documents">
<meta name="lang:search.result.one" content="1 matching document">
<meta name="lang:search.result.other" content="# matching documents">
<meta name="lang:search.language" content="">
<meta name="lang:search.tokenizer" content="[\s\-]+">


<meta name="description" content="docs">
<link rel="shortcut icon" href="../assets/tmt_favicon.ico">
<title>Database Service · TMT Common Software (CSW)</title>
<link rel="stylesheet" href="../assets/stylesheets/application.7a4cdee3.css">
<link rel="stylesheet" href="../lib/material__tabs/dist/mdc.tabs.min.css">
<link rel="stylesheet" href="../lib/prettify/prettify.css">
<script src="../lib/modernizr/modernizr.min.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
<style>
body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}
code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}
</style>
<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="../assets/stylesheets/paradox-material-theme.css">
</head>
<body
>
<input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
<input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
<label class="md-overlay" data-md-component="overlay" for="drawer"></label>
<header class="md-header" data-md-component="header">
<nav class="md-header-nav md-grid">
<div class="md-flex">
<div class="md-flex__cell md-flex__cell--shrink">
<a href="../index.html" title="TMT Common Software (CSW)" class="md-header-nav__button md-logo">
<i class="md-icon">local_library</i>
</a>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
</div>
<div class="md-flex__cell md-flex__cell--stretch">
<div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
<span class="md-header-nav__topic">
TMT Common Software (CSW)
</span>
<span class="md-header-nav__topic">
Database Service
</span>
</div>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="search"></label>
<div class="md-search__inner">
<form class="md-search__form" name="search">
<input type="text" class="md-search__input" name="query" required placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query">
<label class="md-icon md-search__icon" for="search"></label>
<button type="reset" class="md-icon md-search__icon" data-md-component="reset">&#xE5CD;</button>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix>
<div class="md-search-result" data-md-component="result">
<div class="md-search-result__meta">
Type to start searching
</div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>

</div>
<div class="md-flex__cell md-flex__cell--shrink">
<div class="md-header-nav__source">
<a href="https://github.com/tmtsoftware/csw"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
tmtsoftware/csw
</div>
</a>

</div>
</div>
</div>
</nav>
</header>

<div class="md-container">
<main class="md-main">
<div class="md-main__inner md-grid" data-md-component="container">
<div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--primary" data-md-level="0" style="visibility: hidden">
<label class="md-nav__title md-nav__title--site" for="drawer">
<span class="md-nav__button md-logo">
<i class="md-icon">local_library</i>
</span>
<a href="../index.html" title="TMT Common Software (CSW)">
TMT Common Software (CSW)
</a>
</label>
<div class="md-nav__source">
<a href="https://github.com/tmtsoftware/csw"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
tmtsoftware/csw
</div>
</a>

</div>
<ul>
  <li><a href="../commons/getting-started.html" class="page">Getting Started</a></li>
  <li><a href="../commons/create-component.html" class="page">Creating a Component</a></li>
  <li><a href="../commons/multiple-components.html" class="page">Multiple Components</a></li>
  <li><a href="../commons/using-alarms.html" class="page">Using Alarms</a></li>
  <li><a href="../commons/unit-tests.html" class="page">Adding Unit Tests</a></li>
  <li><a href="../commons/messages.html" class="page">Messages</a>
  <ul>
    <li><a href="../messages/keys-parameters.html" class="page">Keys and Parameters</a></li>
    <li><a href="../messages/units.html" class="page">Units</a></li>
    <li><a href="../messages/subsystem.html" class="page">Subsystem</a></li>
    <li><a href="../messages/commands.html" class="page">Commands</a></li>
    <li><a href="../messages/events.html" class="page">Events</a></li>
    <li><a href="../messages/states.html" class="page">State Variables</a></li>
    <li><a href="../messages/result.html" class="page">Result</a></li>
  </ul></li>
  <li><a href="../commons/framework.html" class="page">Framework for creating components (HCD, Assembly, Container)</a>
  <ul>
    <li><a href="../framework/describing-components.html" class="page">ComponentInfo</a></li>
    <li><a href="../framework/creating-components.html" class="page">Creating an Assembly or Hcd Component</a></li>
    <li><a href="../framework/handling-lifecycle.html" class="page">Component Handlers</a></li>
    <li><a href="../framework/managing-command-state.html" class="page">Managing Command State</a></li>
    <li><a href="../framework/tracking-connections.html" class="page">Tracking Connections</a></li>
    <li><a href="../framework/publishing-state.html" class="page">Publishing State</a></li>
    <li><a href="../framework/handling-exceptions.html" class="page">Handling Exceptions</a></li>
    <li><a href="../framework/deploying-components.html" class="page">Deploying Components</a></li>
  </ul></li>
  <li><a href="../commons/command.html" class="page">Communication using Commands</a></li>
  <li><a href="../commons/services.html" class="page">Services</a>
  <ul>
    <li><a href="../services/location.html" class="page">Location Service</a></li>
    <li><a href="../services/config.html" class="page">Configuration Service</a></li>
    <li><a href="../services/logging.html" class="page">Logging Service</a></li>
    <li><a href="../services/event.html" class="page">Event Service</a></li>
    <li><a href="../services/alarm.html" class="page">Alarm Service</a></li>
    <li><a href="../services/time.html" class="page">Time Service</a></li>
    <li><a href="../services/database.html" class="active page">Database Service</a></li>
    <li><a href="../services/aas.html" class="page">Authentication and Authorization Service (AAS)</a></li>
  </ul></li>
  <li><a href="../commons/apps.html" class="page">Applications</a>
  <ul>
    <li><a href="../apps/cswlocationserver.html" class="page">csw-location-server</a></li>
    <li><a href="../apps/cswadminserver.html" class="page">csw-admin-server</a></li>
    <li><a href="../apps/cswlocationagent.html" class="page">csw-location-agent</a></li>
    <li><a href="../apps/cswonfigserverapp.html" class="page">csw-config-server</a></li>
    <li><a href="../apps/cswconfigcli.html" class="page">csw-config-cli</a></li>
    <li><a href="../apps/csweventcli.html" class="page">csw-event-cli</a></li>
    <li><a href="../apps/cswalarmcli.html" class="page">csw-alarm-cli</a></li>
    <li><a href="../apps/hostconfig.html" class="page">csw-host-config</a></li>
  </ul></li>
  <li><a href="../commons/testing.html" class="page">Testing</a></li>
  <li><a href="../commons/sbt-tasks.html" class="page">sbt Tasks</a></li>
  <li><a href="../commons/manuals.html" class="page">Manuals</a></li>
</ul>
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="toc">Table of contents</label>
<ul>
  <li><a href="../services/database.html#database-service" class="header">Database Service</a>
  <ul>
    <li><a href="../services/database.html#dependencies" class="header">Dependencies</a></li>
    <li><a href="../services/database.html#accessing-database-service" class="header">Accessing Database Service</a></li>
    <li><a href="../services/database.html#database-service-factory" class="header">Database Service Factory</a></li>
    <li><a href="../services/database.html#using-dslcontext" class="header">Using DSLContext</a></li>
    <li><a href="../services/database.html#source-code-for-examples" class="header">Source code for examples</a></li>
  </ul></li>
</ul>
</nav>

<div class="md-nav__title--site md-version" title="Version">
<i class="md-icon">label_outline</i> 0.1*
</div>
</nav>

</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="toc">Table of contents</label>
<ul>
  <li><a href="../services/database.html#database-service" class="header">Database Service</a>
  <ul>
    <li><a href="../services/database.html#dependencies" class="header">Dependencies</a></li>
    <li><a href="../services/database.html#accessing-database-service" class="header">Accessing Database Service</a></li>
    <li><a href="../services/database.html#database-service-factory" class="header">Database Service Factory</a></li>
    <li><a href="../services/database.html#using-dslcontext" class="header">Using DSLContext</a></li>
    <li><a href="../services/database.html#source-code-for-examples" class="header">Source code for examples</a></li>
  </ul></li>
</ul>
</nav>

</div>
</div>
</div>
<div class="md-content">
<article class="md-content__inner md-typeset">
<div class="md-content__searchable">
<h1><a href="#database-service" name="database-service" class="anchor"><span class="anchor-link"></span></a>Database Service</h1>
<p>The Database Service provides API to manage database connections and access data in the TMT software system. The service expects <code>Postgres</code> as database server. It uses <code>Jooq</code> library underneath to manage database access, connection pooling, etc. To describe <code>Jooq</code> briefly, it is a java library that provides api for accessing data i.e. DDL support, DML support, fetch, batch execution, prepared statements, etc. safety against sql injection, connection pooling, etc. To know more about Jooq and it&rsquo;s features please refer this <a href="https://www.jooq.org/learn/">link</a>.</p>
<!-- introduction to the service -->
<h2><a href="#dependencies" name="dependencies" class="anchor"><span class="anchor-link"></span></a>Dependencies</h2>
<p>To use the Database service, add this to your <code>build.sbt</code> file:</p>
<dl>
  <dt>sbt</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">libraryDependencies += &quot;com.github.tmtsoftware.csw&quot; %% &quot;csw-database&quot; % &quot;0.1-SNAPSHOT&quot;
</code></pre></dd>
</dl>
<h2><a href="#accessing-database-service" name="accessing-database-service" class="anchor"><span class="anchor-link"></span></a>Accessing Database Service</h2>
<p>Database service is different from any other csw services in a way that it is not passed in through <code>CswContext/JCswContext</code> in ComponentHandlers. So, to access database service, it is expected from developers to create <code>DatabaseServiceFactory</code>. DatabaseServiceFactory can be created from anywhere using an <code>ActorSystem</code> and it&rsquo;s creation is explained in next section. </p><div class="callout note "><div class="callout-title">Note</div>
<p>Creating a new DatabaseServiceFactory does not mean a new connection will be created to postgres server. Hence, creating multiple DatabaseServiceFactory per component can be considered pretty cheap and harmless.</p></div>
<h2><a href="#database-service-factory" name="database-service-factory" class="anchor"><span class="anchor-link"></span></a>Database Service Factory</h2>
<p>Database service requires <code>postgres</code> server to be running on the machine. To start the postgres server for development and testing purposes, refer <a href="../commons/apps.html#starting-apps-for-development">Starting apps for development</a>.</p>
<p>Once the postgres is up and running, database service can be used to connect and access the data. It is assumed that there will be more than one user types registered with postgres i.e. for read access, for write access, for admin access, etc.</p>
<p>By default while connecting to postgres, database service will provide read access for data. To achieve that, create an instance of <code>DatabaseServiceFactory</code> and use it as shown below:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val dbFactory = new DatabaseServiceFactory(ctx.system)

dbFactory
  .makeDsl(locationService, &quot;postgres&quot;) // postgres is dbName
  .foreach((dsl: DSLContext) ⇒ this.dsl = dsl)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">dbFactory = new DatabaseServiceFactory(ctx.getSystem());

dbFactory
        .jMakeDsl(cswCtx.locationService(), &quot;postgres&quot;) // postgres is dbName
        .thenAccept((DSLContext dsl) -&gt; this.dsl = dsl);</code></pre></dd>
</dl>
<p><code>makeDsl</code>/<code>jMakeDsl</code> takes <code>locationService</code> to locate the postgres server running and connect to it. It connects to the database by the provided <code>dbName</code>. It picks username and password for read access profile from environment variables i.e. it looks at <code>dbReadUsername</code> for username and <code>dbReadPassword</code> for password, hence it is expected from developers to set these environment variables prior to using <code>DatabaseServiceFactory</code>. </p>
<p><code>makeDsl</code>/<code>jMakeDsl</code> returns a <code>Jooq</code> type <code>DSLContext</code>. DSLContext provides mechanism to access the data stored in postgres using JDBC driver underneath. The usage of DSLContext in component development will be explained in later sections. </p><div class="callout note "><div class="callout-title">Note</div>
<ul>
  <li>Any exception encountered while connecting to postgres server will be wrapped in <code>DatabaseException</code>.</li>
</ul></div>
<h3><a href="#connect-for-write-access" name="connect-for-write-access" class="anchor"><span class="anchor-link"></span></a>Connect for write access</h3>
<p>In order to connect to postgres for write access (or any other access other than read), use the <code>DatabaseServiceFactory</code> as shown below: </p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">dbFactory
  .makeDsl(locationService, &quot;postgres&quot;, &quot;dbWriteUsername&quot;, &quot;dbWritePassword&quot;)
  .foreach((dsl: DSLContext) ⇒ this.dsl = dsl)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">dbFactory
        .jMakeDsl(cswCtx.locationService(), &quot;postgres&quot;, &quot;dbWriteUsername&quot;, &quot;dbWritePassword&quot;)
        .thenAccept((DSLContext dsl) -&gt; this.dsl = dsl);</code></pre></dd>
</dl>
<p>Here the username is picked from <code>dbWriteUsername</code> and password is picked from <code>dbWritePassword</code> environment variables. Hence, it is expected from developers to set environment variables prior to using this method. </p>
<h3><a href="#connect-for-development-or-testing" name="connect-for-development-or-testing" class="anchor"><span class="anchor-link"></span></a>Connect for development or testing</h3>
<p>For development and testing purposes, all database connection properties can be provided from <code>application.conf</code> including username and password. This will not require to set environment variables for credentials as described in previous sections. In order to do so, use the <code>DatabaseServiceFactory</code> as shown below:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">dbFactory
  .makeDsl()
  .foreach((dsl: DSLContext) ⇒ this.dsl = dsl)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">dbFactory
        .jMakeDsl()
        .thenAccept((DSLContext dsl) -&gt; this.dsl = dsl);</code></pre></dd>
</dl>
<p>The reference for providing database properties is shown below:</p>
<dl>
  <dt>reference.conf
  </dt>
  <dd>
  <pre class="prettyprint"><code class="language-conf">csw-database = {
  databaseDialect = POSTGRES_10
  hikari-datasource {
    dataSourceClassName = org.postgresql.ds.PGSimpleDataSource
//    dataSource {
      //  serverName = &lt;server_name&gt;
      //  portNumber = &lt;port_number&gt;
      //  databaseName = &lt;database_name&gt;
      //  user = &lt;username&gt;
      //  password = &lt;password&gt;
//    }

    // Below are the default properties of HikariCP
    //autoCommit = true
    //connectionTimeout = 30000 (30 seconds)
    //idleTimeout = 600000 (10 minutes)
    //maxLifetime = 600000 (10 minutes)
    //maximumPoolSize = 10
    //minimumIdle = 10 (same as max pool size)
  }
}</code></pre></dd>
</dl>
<p>In order to override any property shown above, it needs to be defined in <code>application.conf</code> for e.g. a sample application.conf can look as follows:</p>
<pre><code>csw-database.hikari-datasource.dataSource {
  serverName = localhost
  portNumber = 5432
  databaseName = postgres
  user = postgres
  password = postgres
}
</code></pre><div class="callout note "><div class="callout-title">Note</div>
<p>By default csw configures <code>HikariCP</code> connection pool for managing connections with postgres server. To know more about <code>HikariCP</code> please refer this <a href="http://brettwooldridge.github.io/HikariCP/">link</a>. </p></div>
<h2><a href="#using-dslcontext" name="using-dslcontext" class="anchor"><span class="anchor-link"></span></a>Using DSLContext</h2>
<p>Once the DSLContext is returned from <code>makeDsl/jMakeDsl</code>, it can be used to provide plain SQL to database service and get it executed on postgres server. </p>
<h3><a href="#create" name="create" class="anchor"><span class="anchor-link"></span></a>Create</h3>
<p>To create a table, use the DSLContext as follows:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val createQuery: Query = dsl.query(&quot;CREATE TABLE films (id SERIAL PRIMARY KEY, Name VARCHAR (10) NOT NULL)&quot;)

import csw.database.scaladsl.JooqExtentions.RichQuery
val createResultF: Future[Integer] = createQuery.executeAsyncScala()
createResultF.foreach(result ⇒ println(s&quot;Films table created with $result&quot;))</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">Query createQuery = dsl.query(&quot;CREATE TABLE films (id SERIAL PRIMARY KEY, Name VARCHAR (10) NOT NULL)&quot;);
CompletionStage&lt;Integer&gt; createResultF = createQuery.executeAsync();
createResultF.thenAccept(result -&gt; System.out.println(&quot;Films table created with &quot; + result));</code></pre></dd>
</dl>
<h3><a href="#insert" name="insert" class="anchor"><span class="anchor-link"></span></a>Insert</h3>
<p>To insert data in batch, use the DSLContext as follows:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val movie_2 = &quot;movie_2&quot;

val queries = dsl.queries(
  dsl.query(&quot;INSERT INTO films(name) VALUES (?)&quot;, &quot;movie_1&quot;),
  dsl.query(&quot;INSERT INTO films(id, name) VALUES (?, ?)&quot;, &quot;2&quot;, movie_2)
)

import csw.database.scaladsl.JooqExtentions.RichQueries
val batchResultF: Future[List[Int]] = queries.executeBatchAsync()
batchResultF.foreach(results ⇒ println(s&quot;executed queries [$queries] with results [$results]&quot;))</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">String movie_2 = &quot;movie_2&quot;;

Queries queries = dsl.queries(
        dsl.query(&quot;INSERT INTO films(name) VALUES (?)&quot;, &quot;movie_1&quot;),
        dsl.query(&quot;INSERT INTO films(id, name) VALUES (?, ?)&quot;, 2, movie_2)
);

CompletableFuture&lt;int[]&gt; batchResultF = JooqHelper.executeBatch(queries);
batchResultF.thenAccept(results -&gt;
        System.out.println(&quot;executed queries [&quot; + queries + &quot;] with results [&quot; + Arrays.toString(results) + &quot;]&quot;));</code></pre></dd>
</dl><div class="callout note "><div class="callout-title">Note</div>
<ul>
  <li>The insert statements above gets mapped to prepared statements underneath at JDBC layer and values like <code>movie_1</code>,  <code>movie_2</code> and <code>2</code> from the example are bound to the dynamic parameters of these generated prepared statements.</li>
  <li>As prepared statements provide safety against SQL injection, it is recommended to use prepared statements instead of static  SQL statements whenever there is a need to dynamically bind values.</li>
  <li>In the above example, two insert statements are batched together and sent to postgres server in a single call.  <code>executeBatchAsync/executeBatch</code> maps to batch statements underneath at JDBC layer.</li>
</ul></div>
<h3><a href="#select" name="select" class="anchor"><span class="anchor-link"></span></a>Select</h3>
<p>To select data from table, use the DSLContext as follows:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">// domain model
case class Films(id: Int, name: String) // variable name and type should be same as column&#39;s name and type in database

// fetch data from table and map it to Films class
val selectQuery = dsl.resultQuery(&quot;SELECT id, name FROM films WHERE id = ?&quot;, &quot;1&quot;)

import csw.database.scaladsl.JooqExtentions.RichResultQuery
val selectResultF: Future[List[Films]] = selectQuery.fetchAsyncScala[Films]
selectResultF.foreach(names ⇒ s&quot;Fetched names of films $names&quot;)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">// domain model
class Films {
    private Integer id;  // variable name (id) and type (Integer) should be same as column&#39;s name and type in database
    private String name; // variable name (name) and type (String) should be same as column&#39;s name and type in database
};

// fetch data from table and map it to Films class
ResultQuery&lt;Record&gt; selectQuery = dsl.resultQuery(&quot;SELECT id, name FROM films WHERE id = ?&quot;, 1);
CompletableFuture&lt;List&lt;Films&gt;&gt; selectResultF = JooqHelper.fetchAsync(selectQuery, Films.class);
selectResultF.thenAccept(names -&gt; System.out.println(&quot;Fetched names of films &quot; + names));</code></pre></dd>
</dl><div class="callout note "><div class="callout-title">Note</div>
<p>Make sure that variable name and type of Films class is same as column&rsquo;s name and type in database. This is necessary for successful mapping of table fields to domain model class.</p></div>
<h3><a href="#stored-function" name="stored-function" class="anchor"><span class="anchor-link"></span></a>Stored Function</h3>
<p>To create a stored function, use the DSLContext as follows:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">val functionQuery = dsl
  .query(
    &quot;&quot;&quot;
    |CREATE FUNCTION inc(val integer) RETURNS integer AS $$
    |BEGIN
    |RETURN val + 1;
    |END; $$
    |LANGUAGE PLPGSQL;
    &quot;&quot;&quot;.stripMargin
  )

val functionResultF: Future[Integer] = functionQuery.executeAsyncScala()
functionResultF.foreach(result ⇒ println(s&quot;Function inc created with $result&quot;))</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">Query functionQuery = dsl.query(&quot;CREATE FUNCTION inc(val integer) RETURNS integer AS $$\n&quot; +
        &quot;BEGIN\n&quot; +
        &quot;RETURN val + 1;\n&quot; +
        &quot;END; $$\n&quot; +
        &quot;LANGUAGE PLPGSQL;&quot;);

CompletionStage&lt;Integer&gt; functionResultF = functionQuery.executeAsync();
functionResultF.thenAccept(result -&gt; System.out.println(&quot;Function inc created with  &quot; + result));</code></pre></dd>
</dl>
<p>Similarly, any SQL queries can be written with the help of DSLContext including stored procedures.</p><div class="callout note "><div class="callout-title">Note</div>
<p>If there is a syntax error in SQL queries the <code>Future/CompletableFuture</code> returned will fail with <code>CompletionException</code> and <code>CompletionStage</code> will fail with <code>ExecutionException</code>. But both <code>CompletionException</code> and <code>ExecutionException</code> will have Jooq&rsquo;s <code>DataAccessException</code> underneath as cause. </p></div>
<h2><a href="#source-code-for-examples" name="source-code-for-examples" class="anchor"><span class="anchor-link"></span></a>Source code for examples</h2>
<ul>
  <li><a href="https://github.com/tmtsoftware/csw/tree/master/examples/src/main/scala/csw/database/AssemblyComponentHandlers.scala">Scala Example</a></li>
  <li><a href="https://github.com/tmtsoftware/csw/tree/master/examples/src/main/java/csw/database/JAssemblyComponentHandlers.java">Java Example</a></li>
</ul>
</div>
<div>
<a href="https://github.com/tmtsoftware/csw/tree/master/docs/src/main/services/database.md" title="Edit this page" class="md-source-file md-edit">
Edit this page
</a>
</div>
<div class="print-only">
<span class="md-source-file md-version">
0.1*
</span>
</div>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-nav">
<nav class="md-footer-nav__inner md-grid">
<a href="../services/time.html" title="Time Service" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
</div>
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Previous
</span>
Time Service
</span>
</div>
</a>
<a href="../services/aas.html" title="Authentication and Authorization Service (AAS)" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Next
</span>
Authentication and Authorization Service (AAS)
</span>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
</div>
</a>
</nav>
</div>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
Powered by
<a href="https://github.com/lightbend/paradox">Paradox</a>
and
<a href="https://jonas.github.io/paradox-material-theme/">Paradox Material Theme</a>

</div>
</div>
</div>
</footer>

</div>
<script src="../assets/javascripts/application.5165553b.js"></script>
<script src="../assets/javascripts/paradox-material-theme.js"></script>
<script>app.initialize({version:"0.17",url:{base:"../."}})</script>
<script type="text/javascript" src="../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function(event) {
window.prettyPrint && prettyPrint();
});
</script>
</body>
</html>
