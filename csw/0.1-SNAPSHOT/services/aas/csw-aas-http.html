<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="description" content="docs">
<meta name="generator" content="Paradox, paradox-material-theme=0.6.0, mkdocs-material=3.0.3">

<meta name="lang:clipboard.copy" content="Copy to clipboard">
<meta name="lang:clipboard.copied" content="Copied to clipboard">
<meta name="lang:search.language" content="">
<meta name="lang:search.pipeline.stopwords" content="true">
<meta name="lang:search.pipeline.trimmer" content="true">
<meta name="lang:search.result.none" content="No matching documents">
<meta name="lang:search.result.one" content="1 matching document">
<meta name="lang:search.result.other" content="# matching documents">
<meta name="lang:search.tokenizer" content="[\s\-]+">


<meta name="description" content="docs">
<link rel="shortcut icon" href="../../assets/tmt_favicon.ico">
<title>Akka HTTP Adapter (csw-aas-http) · TMT Common Software (CSW)</title>
<link rel="stylesheet" href="../../assets/stylesheets/application.451f80e5.css">
<link rel="stylesheet" href="../../lib/material__tabs/dist/mdc.tabs.min.css">
<link rel="stylesheet" href="../../lib/prettify/prettify.css">
<script src="../../assets/javascripts/modernizr.1aa3b519.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
<style>
body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}
code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}
</style>
<link rel="stylesheet" href="../../assets/fonts/font-awesome.css">
<link rel="stylesheet" href="../../assets/fonts/material-icons.css">
<link rel="stylesheet" href="../../assets/stylesheets/paradox-material-theme.css">
</head>
<body
>
<input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
<input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
<label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
<header class="md-header" data-md-component="header">
<nav class="md-header-nav md-grid">
<div class="md-flex">
<div class="md-flex__cell md-flex__cell--shrink">
<a href="../../index.html" title="TMT Common Software (CSW)" class="md-header-nav__button md-logo">
<i class="md-icon">local_library</i>
</a>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
</div>
<div class="md-flex__cell md-flex__cell--stretch">
<div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
<span class="md-header-nav__topic">
TMT Common Software (CSW)
</span>
<span class="md-header-nav__topic">
Akka HTTP Adapter (csw-aas-http)
</span>
</div>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
<label class="md-icon md-search__icon" for="__search"></label>
<button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">&#xE5CD;</button>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix>
<div class="md-search-result" data-md-component="result">
<div class="md-search-result__meta">
Type to start searching
</div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>

</div>
<div class="md-flex__cell md-flex__cell--shrink">
<div class="md-header-nav__source">
<a href="https://github.com/tmtsoftware/csw"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
tmtsoftware/csw
</div>
</a>

</div>
</div>
</div>
</nav>
</header>

<div class="md-container">
<main class="md-main">
<div class="md-main__inner md-grid" data-md-component="container">
<div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--primary" data-md-level="0" style="visibility: hidden">
<label class="md-nav__title md-nav__title--site" for="drawer">
<a href="../../index.html" title="TMT Common Software (CSW)" class="md-nav__button md-logo">
<span class="md-nav__button md-logo">
<i class="md-icon">local_library</i>
</a>
<a href="../../index.html" title="TMT Common Software (CSW)">
TMT Common Software (CSW)
</a>
</label>
<div class="md-nav__source">
<a href="https://github.com/tmtsoftware/csw"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
tmtsoftware/csw
</div>
</a>

</div>
<ul>
  <li><a href="../../commons/getting-started.html" class="page">Getting Started</a></li>
  <li><a href="../../commons/create-component.html" class="page">Creating a Component</a></li>
  <li><a href="../../commons/multiple-components.html" class="page">Multiple Components</a></li>
  <li><a href="../../commons/using-alarms.html" class="page">Using Alarms</a></li>
  <li><a href="../../commons/unit-tests.html" class="page">Adding Unit Tests</a></li>
  <li><a href="../../commons/messages.html" class="page">Messages</a>
  <ul>
    <li><a href="../../messages/keys-parameters.html" class="page">Keys and Parameters</a></li>
    <li><a href="../../messages/units.html" class="page">Units</a></li>
    <li><a href="../../messages/subsystem.html" class="page">Subsystem</a></li>
    <li><a href="../../messages/commands.html" class="page">Commands</a></li>
    <li><a href="../../messages/events.html" class="page">Events</a></li>
    <li><a href="../../messages/states.html" class="page">State Variables</a></li>
    <li><a href="../../messages/result.html" class="page">Result</a></li>
  </ul></li>
  <li><a href="../../commons/framework.html" class="page">Framework for creating components (HCD, Assembly, Container)</a>
  <ul>
    <li><a href="../../framework/describing-components.html" class="page">ComponentInfo</a></li>
    <li><a href="../../framework/creating-components.html" class="page">Creating an Assembly or Hcd Component</a></li>
    <li><a href="../../framework/handling-lifecycle.html" class="page">Component Handlers</a></li>
    <li><a href="../../framework/managing-command-state.html" class="page">Managing Command State</a></li>
    <li><a href="../../framework/tracking-connections.html" class="page">Tracking Connections</a></li>
    <li><a href="../../framework/publishing-state.html" class="page">Publishing State</a></li>
    <li><a href="../../framework/handling-exceptions.html" class="page">Handling Exceptions</a></li>
    <li><a href="../../framework/deploying-components.html" class="page">Deploying Components</a></li>
  </ul></li>
  <li><a href="../../commons/command.html" class="page">Communication using Commands</a></li>
  <li><a href="../../commons/services.html" class="page">Services</a>
  <ul>
    <li><a href="../../services/location.html" class="page">Location Service</a></li>
    <li><a href="../../services/config.html" class="page">Configuration Service</a></li>
    <li><a href="../../services/logging.html" class="page">Logging Service</a></li>
    <li><a href="../../services/event.html" class="page">Event Service</a></li>
    <li><a href="../../services/alarm.html" class="page">Alarm Service</a></li>
    <li><a href="../../services/time.html" class="page">Time Service</a></li>
    <li><a href="../../services/database.html" class="page">Database Service</a></li>
    <li><a href="../../services/aas.html" class="page">Authentication and Authorization Service (AAS)</a></li>
  </ul></li>
  <li><a href="../../commons/apps.html" class="page">Applications</a>
  <ul>
    <li><a href="../../apps/cswlocationserver.html" class="page">csw-location-server</a></li>
    <li><a href="../../apps/cswadminserver.html" class="page">csw-admin-server</a></li>
    <li><a href="../../apps/cswlocationagent.html" class="page">csw-location-agent</a></li>
    <li><a href="../../apps/cswonfigserverapp.html" class="page">csw-config-server</a></li>
    <li><a href="../../apps/cswconfigcli.html" class="page">csw-config-cli</a></li>
    <li><a href="../../apps/csweventcli.html" class="page">csw-event-cli</a></li>
    <li><a href="../../apps/cswalarmcli.html" class="page">csw-alarm-cli</a></li>
    <li><a href="../../apps/hostconfig.html" class="page">csw-host-config</a></li>
  </ul></li>
  <li><a href="../../commons/testing.html" class="page">Testing</a></li>
  <li><a href="../../commons/sbt-tasks.html" class="page">sbt Tasks</a></li>
  <li><a href="../../commons/manuals.html" class="page">Manuals</a></li>
</ul>
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../../services/aas/csw-aas-http.html#akka-http-adapter-csw-aas-http-" class="header">Akka HTTP Adapter (csw-aas-http)</a>
  <ul>
    <li><a href="../../services/aas/csw-aas-http.html#dependencies" class="header">Dependencies</a></li>
    <li><a href="../../services/aas/csw-aas-http.html#prerequisites" class="header">Prerequisites</a></li>
    <li><a href="../../services/aas/csw-aas-http.html#application-configurations" class="header">Application Configurations</a></li>
    <li><a href="../../services/aas/csw-aas-http.html#building-a-secure-akka-http-server-application" class="header">Building a Secure Akka-HTTP server application</a></li>
    <li><a href="../../services/aas/csw-aas-http.html#authorization-policies" class="header">Authorization Policies</a></li>
    <li><a href="../../services/aas/csw-aas-http.html#security-directives" class="header">Security Directives</a></li>
    <li><a href="../../services/aas/csw-aas-http.html#using-access-token" class="header">Using Access Token</a></li>
    <li><a href="../../services/aas/csw-aas-http.html#policy-expressions" class="header">Policy Expressions</a></li>
    <li><a href="../../services/aas/csw-aas-http.html#directive-composition" class="header">Directive Composition</a></li>
    <li><a href="../../services/aas/csw-aas-http.html#source-code-for-above-examples" class="header">Source code for above examples</a></li>
  </ul></li>
</ul>
</nav>

</nav>
<ul style="display: none">
<li class="md-nav__item md-version" id="project.version">
<label class="md-nav__link" for="__version">
<i class="md-icon" title="Version">label_outline</i> 0.1*
</label>
</li>
</ul>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../../services/aas/csw-aas-http.html#akka-http-adapter-csw-aas-http-" class="header">Akka HTTP Adapter (csw-aas-http)</a>
  <ul>
    <li><a href="../../services/aas/csw-aas-http.html#dependencies" class="header">Dependencies</a></li>
    <li><a href="../../services/aas/csw-aas-http.html#prerequisites" class="header">Prerequisites</a></li>
    <li><a href="../../services/aas/csw-aas-http.html#application-configurations" class="header">Application Configurations</a></li>
    <li><a href="../../services/aas/csw-aas-http.html#building-a-secure-akka-http-server-application" class="header">Building a Secure Akka-HTTP server application</a></li>
    <li><a href="../../services/aas/csw-aas-http.html#authorization-policies" class="header">Authorization Policies</a></li>
    <li><a href="../../services/aas/csw-aas-http.html#security-directives" class="header">Security Directives</a></li>
    <li><a href="../../services/aas/csw-aas-http.html#using-access-token" class="header">Using Access Token</a></li>
    <li><a href="../../services/aas/csw-aas-http.html#policy-expressions" class="header">Policy Expressions</a></li>
    <li><a href="../../services/aas/csw-aas-http.html#directive-composition" class="header">Directive Composition</a></li>
    <li><a href="../../services/aas/csw-aas-http.html#source-code-for-above-examples" class="header">Source code for above examples</a></li>
  </ul></li>
</ul>
</nav>

</div>
</div>
</div>
<div class="md-content">
<article class="md-content__inner md-typeset">
<div class="md-content__searchable">
<h1><a href="#akka-http-adapter-csw-aas-http-" name="akka-http-adapter-csw-aas-http-" class="anchor"><span class="anchor-link"></span></a>Akka HTTP Adapter (csw-aas-http)</h1>
<p>This library is a security adapter for akka-http server applications. csw-aas uses <a href="https://openid.net/connect/">OpenId Connect</a> for authentication and authorization. The authentication server used by aas is <a href="https://www.keycloak.org/">keycloak</a>. we recommend that you get familiar with keycloak&rsquo;s documentation and configurations to fully leverage this adapters features.</p>
<p>This adapter provides authentication via security directives such as sGet, sPost, sPut, etc. For authorization, these secure directives accept a wide range of policy expressions.</p>
<h2><a href="#dependencies" name="dependencies" class="anchor"><span class="anchor-link"></span></a>Dependencies</h2>
<p>To use the Akka HTTP Adapter (csw-aas-http), add this to your <code>build.sbt</code> file:</p>
<dl>
  <dt>sbt</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">libraryDependencies += &quot;com.github.tmtsoftware.csw&quot; %% &quot;csw-aas-http&quot; % &quot;0.1-SNAPSHOT&quot;
</code></pre></dd>
</dl>
<h2><a href="#prerequisites" name="prerequisites" class="anchor"><span class="anchor-link"></span></a>Prerequisites</h2>
<p>To run an akka-http server app, which uses this adapter, we need</p>
<ul>
  <li>location service running</li>
  <li>Keycloak instance running and registered with location service</li>
</ul>
<p>Location service and keycloak can be running on different machines. To start location service &amp; keycloak server on a local machine, you make make use of csw-services.sh script.</p>
<h2><a href="#application-configurations" name="application-configurations" class="anchor"><span class="anchor-link"></span></a>Application Configurations</h2>
<p>All auth related configurations go inside <code>auth-config</code> block. There are tree configurations applicable for a akka-http server application i.e. <code>realm</code>, <code>client-id</code> &amp; <code>enable-permissions</code>. </p>
<p><code>realm</code> has a default value of <code>TMT</code> if not specified. Ideally all apps in TMT should not have to override this, however it might be useful to override this while testing your app.</p>
<p><code>enable-permissions</code> is optional config with a default value of false. If your akka-http server application uses permission based authorization policies, this config needs to set to true.</p>
<p><code>client-id</code> is a mandatory configuration which specifies the client id of the app as per registration in keycloak.</p>
<pre class="prettyprint"><code class="language-hocon">auth-config {
  realm = TMT # DEFAULT
  enable-permissions = false # DEFAULT
  client-id = demo-cli # REQUIRED
} 
</code></pre>
<h2><a href="#building-a-secure-akka-http-server-application" name="building-a-secure-akka-http-server-application" class="anchor"><span class="anchor-link"></span></a>Building a Secure Akka-HTTP server application</h2>
<p>The core of this adapter is the <code>SecurityDirectives</code> class. The recommended way to instantiate <code>SecurityDirectives</code> is as shown below.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/main/scala/example/auth/ExampleServer.scala#L184-L207" target="_blank" title="Go to snippet source"></a><code class="language-scala">object SampleHttpApp extends HttpApp with App {

  implicit val actorSystem: ActorSystem = ActorSystem()
  implicit val ec: ExecutionContext     = ExecutionContext.global
  implicit val mat: ActorMaterializer   = ActorMaterializer()

  val locationService = HttpLocationServiceFactory.makeLocalClient
  val directives      = SecurityDirectives(locationService)
  import directives._

  override protected def routes: Route = pathPrefix(&quot;api&quot;) {
    get {
      complete(&quot;SUCCESS&quot;)
    } ~
    sPost(RealmRolePolicy(&quot;admin&quot;)) {
      complete(&quot;SUCCESS&quot;)
    }
  }

  private val host = &quot;0.0.0.0&quot;
  private val port = 9003

  startServer(host, port)
}</code></pre></dd>
</dl>
<p>Importing everything from security directives is recommended as it imports some implicit methods along with all security directives.</p>
<p>In the above example, <code>GET http://localhost:9003/api</code> does not use any security directive and hence is accessible to all. <code>POST http://localhost:9003/api</code> uses <code>sPost</code> which is secure directive. This directive takes care of authentication (access token signature &amp; expiration validation). For authorization it needs an <a href="#authorization-policies">authorization policy</a>. Authorizing policy specifies one or more conditions for request validation. </p>
<p>In this instance, <code>sPost</code> directive has been given <code>RealmRolePolicy</code> policy with parameter value <code>admin</code>.</p>
<p>This results into following sequence of actions when a request arrives for a secure directive route</p>
<ol>
  <li>Secure directive will check request header to look for an access token</li>
  <li>Validate token signature and expiry</li>
  <li>Check the token for roles and validate that it has <code>admin</code> <a href="https://www.keycloak.org/docs/latest/server_admin/index.html#realm-roles">realm role</a></li>
  <li>After all the above checks/validations pass, execute the route logic</li>
</ol>
<p>If any of the validations fails, an appropriate http status code is returned to the requester. For authentication failure 401 is sent and for authorization failure 403 is sent.</p><div class="callout note "><div class="callout-title">Note</div>
<p>To know more about realm roles, check out <a href="https://www.keycloak.org/docs/latest/server_admin/index.html#realm-roles">keycloak documentation</a></p></div>
<h2><a href="#authorization-policies" name="authorization-policies" class="anchor"><span class="anchor-link"></span></a>Authorization Policies</h2>
<p>An authorization policy is a way to provide filter incoming HTTP requests based on standard rules. Following policies can be applied to protect routes.</p>
<ul>
  <li><a href="#realmrolepolicy">ReamRolePolicy</a></li>
  <li><a href="#clientrolepolicy">ClientRolePolicy</a></li>
  <li><a href="#permissionpolicy">PermissionPolicy</a></li>
  <li><a href="#custompolicy">CustomPolicy</a></li>
  <li><a href="#custompolicyasync">CustomPolicyAsync</a></li>
  <li><a href="#emptypolicy">EmptyPolicy</a></li>
</ul>
<h3><a href="#realmrolepolicy" name="realmrolepolicy" class="anchor"><span class="anchor-link"></span></a>RealmRolePolicy</h3>
<p>This policy filters requests based on Realm Role. A Realm Role is global and is applicable for all clients within realm.</p>
<p>In the following example policy will authorize request if user has assigned <code>admin</code></p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/main/scala/example/auth/ExampleServer.scala#L134-L136" target="_blank" title="Go to snippet source"></a><code class="language-scala">val routeWithRealmRolePolicy: Route = sGet(RealmRolePolicy(&quot;admin&quot;)) {
  complete(&quot;OK&quot;)
}</code></pre></dd>
</dl>
<h3><a href="#clientrolepolicy" name="clientrolepolicy" class="anchor"><span class="anchor-link"></span></a>ClientRolePolicy</h3>
<p>Client roles are basically a namespace dedicated to a client. Each client gets its own namespace.</p>
<p>This policy filters requests based on Client Role. In the following example policy will authorize request if user has assigned <code>accounts-admin</code> for clientId specified in configurations</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/main/scala/example/auth/ExampleServer.scala#L140-L142" target="_blank" title="Go to snippet source"></a><code class="language-scala">val routeWithClientRolePolicy: Route = sGet(ClientRolePolicy(&quot;accounts-admin&quot;)) {
  complete(&quot;OK&quot;)
}</code></pre></dd>
</dl>
<h3><a href="#permissionpolicy" name="permissionpolicy" class="anchor"><span class="anchor-link"></span></a>PermissionPolicy</h3>
<p>This policy filters requests based on permissions. It expects name of scope and name of resource on which permission is created in keycloak. Scope and Resource forms a &ldquo;Permission&rdquo;. For example, &ldquo;scope: Sell; resource: Vehicle&rdquo; combined specifies that the user with this scope and resource combination can &ldquo;sell vehicles&rdquo;.</p>
<p>In the following example policy will authorize request if user has appropriate permission associated in keycloak which specifies <code>delete</code> scope for <code>account</code> resource.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/main/scala/example/auth/ExampleServer.scala#L152-L154" target="_blank" title="Go to snippet source"></a><code class="language-scala">val routeWithPermissions = sDelete(PermissionPolicy(&quot;delete&quot;, &quot;account&quot;)) {
  complete(&quot;OK&quot;)
}</code></pre></dd>
</dl>
<h3><a href="#custompolicy" name="custompolicy" class="anchor"><span class="anchor-link"></span></a>CustomPolicy</h3>
<p>This policy allows custom request filtering based on access token properties. It expects predicate function which accepts an access token and returns a boolean. If the predicate returns true, it indicates user is authorized.</p>
<p>In the following example policy will authorize request if user&rsquo;s given name contains <code>test-user</code></p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/main/scala/example/auth/ExampleServer.scala#L146-L148" target="_blank" title="Go to snippet source"></a><code class="language-scala">val routeWithCustomPolicy: Route = sPost(CustomPolicy(token ⇒ token.given_name.contains(&quot;test-user&quot;))) {
  complete(&quot;OK&quot;)
}</code></pre></dd>
</dl>
<h3><a href="#custompolicyasync" name="custompolicyasync" class="anchor"><span class="anchor-link"></span></a>CustomPolicyAsync</h3>
<p>This policy is similar to CustomPolicy with only difference that it expects a predicate which returns a Future of Boolean instead of a Boolean. This could be very useful for custom validations which need to make an IO call. For example,</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/main/scala/example/auth/ExampleServer.scala#L115-L121" target="_blank" title="Go to snippet source"></a><code class="language-scala">//GET http://[host]:[port]/files?fileId=[fileId]
val route: Route =
  path(&quot;files&quot; / LongNumber) { fileId =&gt;
    sGet(CustomPolicyAsync(token =&gt; Database.doesUserOwnFile(token.preferred_username, fileId))) {
      complete(Database.getFileContents(fileId))
    }
  }</code></pre></dd>
</dl>
<p>This forms a an http route for a secure GET request for path <code>/files/[fileId]</code> and expects a path parameter of type <code>Long</code>. The async custom policy makes an async database call to check whether the file being requested belongs to the user who made http request.</p>
<h3><a href="#emptypolicy" name="emptypolicy" class="anchor"><span class="anchor-link"></span></a>EmptyPolicy</h3>
<p>This policy is used this when only authentication is needed but not authorization. EmptyPolicy is an object and not a class like other policies and it does not need any parameters.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/main/scala/example/auth/ExampleServer.scala#L125-L130" target="_blank" title="Go to snippet source"></a><code class="language-scala">val authenticationOnlyRoute: Route = // GET http://[host]:[post]/api
  path(&quot;api&quot;) {
    sGet(EmptyPolicy) {
      complete(&quot;OK&quot;)
    }
  }</code></pre></dd>
</dl>
<h2><a href="#security-directives" name="security-directives" class="anchor"><span class="anchor-link"></span></a>Security Directives</h2>
<p>csw-aas-http adapter supports following secure HTTP verbs:</p>
<table>
  <thead>
    <tr>
      <th>Name </th>
      <th>Description </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>sGet </td>
      <td>Rejects all un-authorized and non-GET requests </td>
    </tr>
    <tr>
      <td>sPost </td>
      <td>Rejects all un-authorized and non-POST requests </td>
    </tr>
    <tr>
      <td>sPut </td>
      <td>Rejects all un-authorized and non-PUT requests </td>
    </tr>
    <tr>
      <td>sDelete </td>
      <td>Rejects all un-authorized and non-DELETE requests </td>
    </tr>
    <tr>
      <td>sHead </td>
      <td>Rejects all un-authorized and non-HEAD requests </td>
    </tr>
    <tr>
      <td>sConnect </td>
      <td>Rejects all un-authorized and non-CONNECT requests </td>
    </tr>
  </tbody>
</table>
<h2><a href="#using-access-token" name="using-access-token" class="anchor"><span class="anchor-link"></span></a>Using Access Token</h2>
<p>A handle of access token is given to to all secure routes. It is optional to define parameter for it.</p>
<p>For example:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/main/scala/example/auth/ExampleServer.scala#L98-L110" target="_blank" title="Go to snippet source"></a><code class="language-scala">val routeExampleWithToken: Route = sDelete(EmptyPolicy) { token =&gt;
  parameter(&quot;entityId&quot;.as[Long]) { entityId =&gt;
    ThirdPartyService.deleteEntity(entityId, token.preferred_username)
    complete(s&quot;user ${token.given_name} ${token.family_name} deleted entity $entityId&quot;)
  }
}

val routeExampleWithoutToken: Route = sDelete(EmptyPolicy) {
  parameter(&quot;entityId&quot;.as[Long]) { entityId =&gt;
    ThirdPartyService.deleteEntity(entityId)
    complete(s&quot;entity $entityId deleted&quot;)
  }
}</code></pre></dd>
</dl>
<p>Both of the above approaches compile and are valid. Access token holds basic information about the user or the client who has made request.</p>
<p>Please go through api documentation to know more about Access Token.</p>
<h2><a href="#policy-expressions" name="policy-expressions" class="anchor"><span class="anchor-link"></span></a>Policy Expressions</h2>
<p>So far, we have seen that security directives can accept an authorization policy. It can however accept an expression of multiple authorization policies too. This could be useful to express complex authorization logic. For example:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/main/scala/example/auth/ExampleServer.scala#L160-L166" target="_blank" title="Go to snippet source"></a><code class="language-scala">val routes: Route =
sGet(RealmRolePolicy(&quot;admin&quot;) | CustomPolicy(_.email.contains(&quot;super-admin@tmt.org&quot;))) {
  complete(&quot;OK&quot;)
} ~
sPost(ClientRolePolicy(&quot;finance_user&quot;) &amp; PermissionPolicy(&quot;edit&quot;)) {
  complete(&quot;OK&quot;)
}</code></pre></dd>
</dl>
<p>Note the <code>|</code> , <code>&amp;</code> operators which helps compose an expression. A Policy expression could be more complex than this and can contain braces to group more expressions. For example:</p>
<pre class="prettyprint"><code class="language-scala">val policy = policy1 | (policy2 &amp; (policy3 | policy4)) | policy5
</code></pre>
<h2><a href="#directive-composition" name="directive-composition" class="anchor"><span class="anchor-link"></span></a>Directive Composition</h2>
<p>Since security directives extend from <code>akka.http.scaladsl.server.Directive</code> they give you all the benefits of a usual directive. These benefits include being able to label &amp; <a href="https://doc.akka.io/docs/akka-http/current/routing-dsl/directives/custom-directives.html#custom-directives">compose higher level directives</a>.</p>
<p>With the help of directive labeling you could write a route like below:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/main/scala/example/auth/ExampleServer.scala#L176" target="_blank" title="Go to snippet source"></a><code class="language-scala">sGet(RealmRolePolicy(&quot;admin&quot;)) &amp; sGet(ClientRolePolicy(&quot;sales_admin&quot;))</code></pre></dd>
</dl>
<p>The same can be achieved via <a href="csw-aas-http.html#policy-expressions">Policy Expressions</a> as shown below</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/main/scala/example/auth/ExampleServer.scala#L172" target="_blank" title="Go to snippet source"></a><code class="language-scala">sGet(RealmRolePolicy(&quot;admin&quot;) &amp; ClientRolePolicy(&quot;sales_admin&quot;))</code></pre></dd>
</dl>
<p>If you want to combine two directives <strong><em>and both of them are csw security directives</em></strong>, we strongly recommend that you use <a href="csw-aas-http.html#policy-expressions">Policy Expressions</a>. The reason for this is that, when you combine two csw security directives authentication check happens twice (or multiple times based on how many csw security directives are combined) which was meant to happen only once thus causing performance slowdown. You can however combine csw security directives with other directives freely without worrying about performance.</p>
<h2><a href="#source-code-for-above-examples" name="source-code-for-above-examples" class="anchor"><span class="anchor-link"></span></a>Source code for above examples</h2>
<ul>
  <li><a href="https://github.com/tmtsoftware/csw/tree/master/examples/src/main/scala/example/auth/ExampleServer.scala">Example http server</a></li>
</ul>
</div>
<div>
<a href="https://github.com/tmtsoftware/csw/tree/master/docs/src/main/services/aas/csw-aas-http.md" title="Edit this page" class="md-source-file md-edit">
Edit this page
</a>
</div>
<div class="print-only">
<span class="md-source-file md-version">
0.1*
</span>
</div>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-nav">
<nav class="md-footer-nav__inner md-grid">
<a href="../../services/aas/core-concepts-and-terms.html" title="Core concepts and terms" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
</div>
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Previous
</span>
Core concepts and terms
</span>
</div>
</a>
<a href="../../services/aas/csw-aas-js.html" title="Javascript Adapter (csw-aas-js)" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Next
</span>
Javascript Adapter (csw-aas-js)
</span>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
</div>
</a>
</nav>
</div>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
Powered by
<a href="https://github.com/lightbend/paradox">Paradox</a>
and
<a href="https://jonas.github.io/paradox-material-theme/">Paradox Material Theme</a>

</div>
</div>
</div>
</footer>

</div>
<script src="../../assets/javascripts/application.583bbe55.js"></script>
<script src="../../assets/javascripts/paradox-material-theme.js"></script>
<script>app.initialize({version:"0.17",url:{base:"../../."}})</script>
<script type="text/javascript" src="../../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function(event) {
window.prettyPrint && prettyPrint();
});
</script>
</body>
</html>
