<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="description" content="docs">
<meta name="generator" content="Paradox, paradox-material-theme=0.6.0, mkdocs-material=3.0.3">

<meta name="lang:clipboard.copy" content="Copy to clipboard">
<meta name="lang:clipboard.copied" content="Copied to clipboard">
<meta name="lang:search.language" content="">
<meta name="lang:search.pipeline.stopwords" content="true">
<meta name="lang:search.pipeline.trimmer" content="true">
<meta name="lang:search.result.none" content="No matching documents">
<meta name="lang:search.result.one" content="1 matching document">
<meta name="lang:search.result.other" content="# matching documents">
<meta name="lang:search.tokenizer" content="[\s\-]+">


<meta name="description" content="docs">
<link rel="shortcut icon" href="../../assets/tmt_favicon.ico">
<title>Params Â· TMT Common Software (CSW)</title>
<link rel="stylesheet" href="../../assets/stylesheets/application.451f80e5.css">
<link rel="stylesheet" href="../../lib/material__tabs/dist/mdc.tabs.min.css">
<link rel="stylesheet" href="../../lib/prettify/prettify.css">
<script src="../../assets/javascripts/modernizr.1aa3b519.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
<style>
body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}
code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}
</style>
<link rel="stylesheet" href="../../assets/fonts/font-awesome.css">
<link rel="stylesheet" href="../../assets/fonts/material-icons.css">
<link rel="stylesheet" href="../../assets/stylesheets/paradox-material-theme.css">
</head>
<body
>
<input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
<input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
<label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
<header class="md-header" data-md-component="header">
<nav class="md-header-nav md-grid">
<div class="md-flex">
<div class="md-flex__cell md-flex__cell--shrink">
<a href="../../index.html" title="TMT Common Software (CSW)" class="md-header-nav__button md-logo">
<i class="md-icon">local_library</i>
</a>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
</div>
<div class="md-flex__cell md-flex__cell--stretch">
<div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
<span class="md-header-nav__topic">
TMT Common Software (CSW)
</span>
<span class="md-header-nav__topic">
Params
</span>
</div>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
<label class="md-icon md-search__icon" for="__search"></label>
<button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">&#xE5CD;</button>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix>
<div class="md-search-result" data-md-component="result">
<div class="md-search-result__meta">
Type to start searching
</div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>

</div>
<div class="md-flex__cell md-flex__cell--shrink">
<div class="md-header-nav__source">
<a href="https://github.com/tmtsoftware/csw"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
tmtsoftware/csw
</div>
</a>

</div>
</div>
</div>
</nav>
</header>

<div class="md-container">
<main class="md-main">
<div class="md-main__inner md-grid" data-md-component="container">
<div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--primary" data-md-level="0" style="visibility: hidden">
<label class="md-nav__title md-nav__title--site" for="drawer">
<a href="../../index.html" title="TMT Common Software (CSW)" class="md-nav__button md-logo">
<span class="md-nav__button md-logo">
<i class="md-icon">local_library</i>
</a>
<a href="../../index.html" title="TMT Common Software (CSW)">
TMT Common Software (CSW)
</a>
</label>
<div class="md-nav__source">
<a href="https://github.com/tmtsoftware/csw"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
tmtsoftware/csw
</div>
</a>

</div>
<ul>
  <li><a href="../../commons/getting-started.html" class="page">Getting Started</a></li>
  <li><a href="../../commons/create-component.html" class="page">Creating a Component</a></li>
  <li><a href="../../commons/multiple-components.html" class="page">Multiple Components</a></li>
  <li><a href="../../commons/using-alarms.html" class="page">Using Alarms</a></li>
  <li><a href="../../commons/unit-tests.html" class="page">Adding Unit Tests</a></li>
  <li><a href="../../commons/params.html" class="page">Params</a>
  <ul>
    <li><a href="../../params/keys-parameters.html" class="page">Keys and Parameters</a></li>
    <li><a href="../../params/units.html" class="page">Units</a></li>
    <li><a href="../../params/subsystem.html" class="page">Subsystem</a></li>
    <li><a href="../../params/commands.html" class="page">Commands</a></li>
    <li><a href="../../params/events.html" class="page">Events</a></li>
    <li><a href="../../params/states.html" class="page">State Variables</a></li>
    <li><a href="../../params/result.html" class="page">Result</a></li>
  </ul></li>
  <li><a href="../../commons/framework.html" class="page">Framework for creating components (HCD, Assembly, Container)</a>
  <ul>
    <li><a href="../../framework/describing-components.html" class="page">ComponentInfo</a></li>
    <li><a href="../../framework/creating-components.html" class="page">Creating an Assembly or Hcd Component</a></li>
    <li><a href="../../framework/handling-lifecycle.html" class="page">Component Handlers</a></li>
    <li><a href="../../framework/managing-command-state.html" class="page">Managing Command State</a></li>
    <li><a href="../../framework/tracking-connections.html" class="page">Tracking Connections</a></li>
    <li><a href="../../framework/publishing-state.html" class="page">Publishing State</a></li>
    <li><a href="../../framework/handling-exceptions.html" class="page">Handling Exceptions</a></li>
    <li><a href="../../framework/deploying-components.html" class="page">Deploying Components</a></li>
  </ul></li>
  <li><a href="../../commons/command.html" class="page">Communication using Commands</a></li>
  <li><a href="../../commons/logging_aggregator.html" class="page">Logging Aggregator</a></li>
  <li><a href="../../commons/services.html" class="page">Services</a>
  <ul>
    <li><a href="../../services/location.html" class="page">Location Service</a></li>
    <li><a href="../../services/config.html" class="page">Configuration Service</a></li>
    <li><a href="../../services/logging.html" class="page">Logging Service</a></li>
    <li><a href="../../services/event.html" class="page">Event Service</a></li>
    <li><a href="../../services/alarm.html" class="page">Alarm Service</a></li>
    <li><a href="../../services/time.html" class="page">Time Service</a></li>
    <li><a href="../../services/database.html" class="page">Database Service</a></li>
    <li><a href="../../services/aas.html" class="page">Authentication and Authorization Service (AAS)</a></li>
    <li><a href="../../services/sequencerCommandService.html" class="page">Sequencer Command Service</a></li>
  </ul></li>
  <li><a href="../../commons/apps.html" class="page">Applications</a>
  <ul>
    <li><a href="../../apps/cswlocationserver.html" class="page">csw-location-server</a></li>
    <li><a href="../../apps/cswlocationagent.html" class="page">csw-location-agent</a></li>
    <li><a href="../../apps/cswonfigserverapp.html" class="page">csw-config-server</a></li>
    <li><a href="../../apps/cswconfigcli.html" class="page">csw-config-cli</a></li>
    <li><a href="../../apps/csweventcli.html" class="page">csw-event-cli</a></li>
    <li><a href="../../apps/cswalarmcli.html" class="page">csw-alarm-cli</a></li>
    <li><a href="../../apps/hostconfig.html" class="page">csw-host-config</a></li>
  </ul></li>
  <li><a href="../../commons/deployment.html" class="page">Deployment</a>
  <ul>
    <li><a href="../../deployment/env-vars.html" class="page">Environment variables</a></li>
  </ul></li>
  <li><a href="../../commons/testing.html" class="page">Testing</a></li>
  <li><a href="../../commons/sbt-tasks.html" class="page">sbt Tasks</a></li>
  <li><a href="../../commons/manuals.html" class="page">Manuals</a></li>
  <li><a href="../../technical/technical.html" class="page">Technical Design Documents</a>
  <ul>
    <li><a href="../../technical/framework/framework.html" class="page">Framework</a></li>
    <li><a href="../../technical/command/command.html" class="page">Command</a></li>
    <li><a href="../../technical/params/params.html" class="active page">Params</a></li>
    <li><a href="../../technical/location/location.html" class="page">Location Service</a></li>
    <li><a href="../../technical/configuration/configuration.html" class="page">Configuration Service</a></li>
    <li><a href="../../technical/logging/logging.html" class="page">Logging Service</a></li>
    <li><a href="../../technical/event/event.html" class="page">Event Service</a></li>
    <li><a href="../../technical/alarm/alarm.html" class="page">Alarm Service</a></li>
    <li><a href="../../technical/time/time.html" class="page">Time Service</a></li>
    <li><a href="../../technical/database/database.html" class="page">Database Service</a></li>
    <li><a href="../../technical/aas/aas.html" class="page">Authentication and Authorization Service</a></li>
  </ul></li>
</ul>
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../../technical/params/params.html#params" class="header">Params</a>
  <ul>
    <li><a href="../../technical/params/params.html#cbor" class="header">Cbor</a></li>
    <li><a href="../../technical/params/params.html#tooling" class="header">Tooling</a></li>
  </ul></li>
</ul>
</nav>

</nav>
<ul style="display: none">
<li class="md-nav__item md-version" id="project.version">
<label class="md-nav__link" for="__version">
<i class="md-icon" title="Version">label_outline</i> 0.1*
</label>
</li>
</ul>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../../technical/params/params.html#params" class="header">Params</a>
  <ul>
    <li><a href="../../technical/params/params.html#cbor" class="header">Cbor</a></li>
    <li><a href="../../technical/params/params.html#tooling" class="header">Tooling</a></li>
  </ul></li>
</ul>
</nav>

</div>
</div>
</div>
<div class="md-content">
<article class="md-content__inner md-typeset">
<div class="md-content__searchable">
<h1><a href="#params" name="params" class="anchor"><span class="anchor-link"></span></a>Params</h1>
<p>The <code>csw-params</code> project contains models like Events, Commands, ParameterSet etc which are cross-compiled to Scala and <a href="https://www.scala-js.org/">Scala.js</a>. CSW Framework and CSW Services like Command Service, Event Service, Alarm Service etc rely on this project for these models. Since these models are needed across platforms like C/Cpp, Scala/Java, Python etc this project also contains serialization support for these models. <a href="https://cbor.io/">Cbor</a> is used as default for Serialization and Deserialization of these models. Comparisons were done with other popular formats like <a href="https://developers.google.com/protocol-buffers/">Protocol Buffers</a>, <a href="https://msgpack.org/index.html">Message Pack</a> before finalizing on Cbor. Cbor was finalized as it offers better performance and has much lesser overhead of maintenance as compared to protocol buffers.</p>
<h2><a href="#cbor" name="cbor" class="anchor"><span class="anchor-link"></span></a>Cbor</h2>
<p>We use scala <a href="https://github.com/sirthias/borer">Borer</a> library for cbor. <a href="https://tmtsoftware.github.io/csw/0.1-SNAPSHOT/api/scala/csw/params/core/formats/CborSupport$.html">CborSupport</a> object in <code>csw-params</code> contains codecs (encoders and decoders) for all the models defined in this project that need to be serialized.</p>
<p><code>CborSupport</code> needs to be imported wherever you need to encode/decode a model. This makes all the implicit codecs defined in <code>CborSupport</code> available in the current scope. When any new models are added, their corresponding codecs also need to be added in the <code>CborSupport</code>.</p>
<p>Cbor offers Array-Based Encoding and Map-Based Encoding. Map-based encoding carries keys/labels along with values unlike array-based encoding which encodes only values. We use the Map-Based encoding since it makes it easy to debug the problems if any in the encoded cbor object. Though the size of map based encoded cbor objects is slightly more than that of array-based, it does not affect the performance as much.</p>
<p><a href="https://tmtsoftware.github.io/csw/0.1-SNAPSHOT/api/scala/csw/params/core/formats/AdtCbor.html">AdtCbor</a> is a helper trait to encode and decode ADTs (Abstract Data Types) with Cbor. This is needed due to the way ADTs are encoded in Borer library. Having this abstraction ensures all the types in an ADT (Base types plus concrete types) are encoded in a similar manner. In Borer, encoding of base-types carries the type information which differs than the way concrete-types are encoded (without type information). The problem is described in detail in the issue <a href="https://github.com/sirthias/borer/issues/17">here</a>. Going via <code>AdtCbor</code> ensures the Adt types(base as well concrete) are all encoded as <strong>Base-type</strong> containing type information. So if you are writing new types which are ADTs, make sure you add your own helper next to <a href="https://tmtsoftware.github.io/csw/0.1-SNAPSHOT/api/scala/csw/params/core/formats/EventCbor$.html">EventCbor</a> or <a href="https://tmtsoftware.github.io/csw/0.1-SNAPSHOT/api/scala/csw/params/core/formats/CommandCbor$.html">CommandCbor</a> to ensure proper encoding and decoding of ADTs.</p>
<p>Usage of Cbor for Event encoding and decoding is shown below:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/test/scala/example/params/EventsTest.scala#L254-L279" target="_blank" title="Go to snippet source"></a><code class="language-scala">//Key
val raDecKey = RaDecKey.make(&quot;raDecKey&quot;)

//values
val raDec1 = RaDec(10.20, 40.20)
val raDec2 = RaDec(11.20, 50.20)

//parameters
val param = raDecKey.set(raDec1, raDec2).withUnits(arcmin)

val prefix = Prefix(&quot;tcs.pk&quot;)
val name   = EventName(&quot;targetCoords&quot;)
//events
val observeEvent: ObserveEvent = ObserveEvent(prefix, name).add(param)
val systemEvent1: SystemEvent  = SystemEvent(prefix, name).add(param)
val systemEvent2: SystemEvent  = SystemEvent(prefix, name).add(param)

//convert events to cbor bytestring
val byteArray2 = EventCbor.encode(observeEvent)
val byteArray3 = EventCbor.encode(systemEvent1)
val byteArray4 = EventCbor.encode(systemEvent2)

//convert cbor bytestring to events
val pbObserveEvent: ObserveEvent = EventCbor.decode(byteArray2)
val pbSystemEvent1: SystemEvent  = EventCbor.decode(byteArray3)
val pbSystemEvent2: SystemEvent  = EventCbor.decode(byteArray4)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/test/java/example/params/JEventsTest.java#L253-L283" target="_blank" title="Go to snippet source"></a><code class="language-java"><br/>//prefixes
Prefix prefix1 = new Prefix(JSubsystem.TCS(), &quot;pk&quot;);
EventName name1 = new EventName(&quot;targetCoords&quot;);
Prefix prefix2 = new Prefix(JSubsystem.TCS(), &quot;cm&quot;);
EventName name2 = new EventName(&quot;guiderCoords&quot;);

//Key
Key&lt;RaDec&gt; raDecKey = JKeyType.RaDecKey().make(&quot;raDecKey&quot;);

//values
RaDec raDec1 = new RaDec(10.20, 40.20);
RaDec raDec2 = new RaDec(11.20, 50.20);

//parameters
Parameter&lt;RaDec&gt; param = raDecKey.set(raDec1, raDec2).withUnits(JUnits.arcmin());

//events
ObserveEvent observeEvent = new ObserveEvent(prefix1, name1).add(param);
SystemEvent systemEvent1 = new SystemEvent(prefix1, name1).add(param);
SystemEvent systemEvent2 = new SystemEvent(prefix2, name2).add(param);

//convert events to cbor bytestring
byte[] byteArray2 = EventCbor$.MODULE$.encode(observeEvent);
byte[] byteArray3 = EventCbor$.MODULE$.encode(systemEvent1);
byte[] byteArray4 = EventCbor$.MODULE$.encode(systemEvent2);

//convert cbor bytestring to events
ObserveEvent pbObserveEvent = EventCbor$.MODULE$.decode(byteArray2);
SystemEvent pbSystemEvent1 = EventCbor$.MODULE$.decode(byteArray3);
SystemEvent pbSystemEvent2 = EventCbor$.MODULE$.decode(byteArray4);</code></pre></dd>
</dl>
<h2><a href="#tooling" name="tooling" class="anchor"><span class="anchor-link"></span></a>Tooling</h2>
<p>A number of tools are available around Cbor for diagnostic purposes. This <a href="https://cbor.io/tools.html">link</a> contains list of all the tools available. A couple of useful utilities are available <a href="https://github.com/cabo/cbor-diag">here</a>. Follow the readme for details regarding installation and usage.</p>
<p>Utilities like <code>cbor2json</code> or <code>cbor2diag</code> could be very helpful while debugging. Often in development/debugging we wish to look at the actual encoded object, but since cbor is a binary format, looking at it does not help in debugging. That&rsquo;s when these tools come in handy.</p>
<p>For example:</p>
<p>This will return the json representation of the given Cbor object.</p>
<pre><code>cbor2json.rb csw-params/shared/src/test/cbor/data/event.cbor
</code></pre>
<p>A lot of other similar utilities are present in the same package which you can play with.</p>
<p>Cbor is schema-less. But you could define a schema (.cddl) and validate it against your cbor object. This is very similar to the json format. Json does not have a predefined schema, but you can define your schema and validate an object against it.</p>
<p><a href="https://rubygems.org/gems/cddl/versions/0.8.8">CDDL</a> tool allows you to give a schema and a cbor/json object, and it will validate and tell you if the object adheres to the given schema.</p>
<p><code>cddl csw-params/shared/src/test/cbor/schema/event_command.cddl validate csw-params/shared/src/test/cbor/data/event.cbor</code></p>
<p>Cddl schema for events and commands has been defined <a href="https://github.com/tmtsoftware/csw/tree/master/csw-params/shared/src/test/cbor/schema/event_command.cddl.txt">here</a>.</p>
</div>
<div>
<a href="https://github.com/tmtsoftware/csw/tree/master/docs/src/main/technical/params/params.md" title="Edit this page" class="md-source-file md-edit">
Edit this page
</a>
</div>
<div class="print-only">
<span class="md-source-file md-version">
0.1*
</span>
</div>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-nav">
<nav class="md-footer-nav__inner md-grid">
<a href="../../technical/command/command.html" title="Command" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
</div>
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Previous
</span>
Command
</span>
</div>
</a>
<a href="../../technical/location/location.html" title="Location Service" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Next
</span>
Location Service
</span>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
</div>
</a>
</nav>
</div>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
Powered by
<a href="https://github.com/lightbend/paradox">Paradox</a>
and
<a href="https://jonas.github.io/paradox-material-theme/">Paradox Material Theme</a>

</div>
</div>
</div>
</footer>

</div>
<script src="../../assets/javascripts/application.583bbe55.js"></script>
<script src="../../assets/javascripts/paradox-material-theme.js"></script>
<script>app.initialize({version:"0.17",url:{base:"../../."}})</script>
<script type="text/javascript" src="../../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function(event) {
window.prettyPrint && prettyPrint();
});
</script>
</body>
</html>
