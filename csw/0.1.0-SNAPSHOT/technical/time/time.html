<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="description" content="docs">
<meta name="generator" content="Paradox, paradox-material-theme=0.6.0, mkdocs-material=3.0.3">

<meta name="lang:clipboard.copy" content="Copy to clipboard">
<meta name="lang:clipboard.copied" content="Copied to clipboard">
<meta name="lang:search.language" content="">
<meta name="lang:search.pipeline.stopwords" content="true">
<meta name="lang:search.pipeline.trimmer" content="true">
<meta name="lang:search.result.none" content="No matching documents">
<meta name="lang:search.result.one" content="1 matching document">
<meta name="lang:search.result.other" content="# matching documents">
<meta name="lang:search.tokenizer" content="[\s\-]+">


<meta name="description" content="docs">
<link rel="shortcut icon" href="../../assets/tmt_favicon.ico">
<title>Time Service · TMT Common Software (CSW)</title>
<link rel="stylesheet" href="../../assets/stylesheets/application.451f80e5.css">
<link rel="stylesheet" href="../../lib/material__tabs/dist/mdc.tabs.min.css">
<link rel="stylesheet" href="../../lib/prettify/prettify.css">
<script src="../../assets/javascripts/modernizr.1aa3b519.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
<style>
body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}
code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}
</style>
<link rel="stylesheet" href="../../assets/fonts/font-awesome.css">
<link rel="stylesheet" href="../../assets/fonts/material-icons.css">
<link rel="stylesheet" href="../../assets/stylesheets/paradox-material-theme.css">
</head>
<body
>
<input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
<input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
<label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
<header class="md-header" data-md-component="header">
<nav class="md-header-nav md-grid">
<div class="md-flex">
<div class="md-flex__cell md-flex__cell--shrink">
<a href="../../index.html" title="TMT Common Software (CSW)" class="md-header-nav__button md-logo">
<i class="md-icon">local_library</i>
</a>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
</div>
<div class="md-flex__cell md-flex__cell--stretch">
<div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
<span class="md-header-nav__topic">
TMT Common Software (CSW)
</span>
<span class="md-header-nav__topic">
Time Service
</span>
</div>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
<label class="md-icon md-search__icon" for="__search"></label>
<button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">&#xE5CD;</button>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix>
<div class="md-search-result" data-md-component="result">
<div class="md-search-result__meta">
Type to start searching
</div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>

</div>
<div class="md-flex__cell md-flex__cell--shrink">
<div class="md-header-nav__source">
<a href="https://github.com/tmtsoftware/csw"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
tmtsoftware/csw
</div>
</a>

</div>
</div>
</div>
</nav>
</header>

<div class="md-container">
<main class="md-main">
<div class="md-main__inner md-grid" data-md-component="container">
<div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--primary" data-md-level="0" style="visibility: hidden">
<label class="md-nav__title md-nav__title--site" for="drawer">
<a href="../../index.html" title="TMT Common Software (CSW)" class="md-nav__button md-logo">
<span class="md-nav__button md-logo">
<i class="md-icon">local_library</i>
</a>
<a href="../../index.html" title="TMT Common Software (CSW)">
TMT Common Software (CSW)
</a>
</label>
<div class="md-nav__source">
<a href="https://github.com/tmtsoftware/csw"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
tmtsoftware/csw
</div>
</a>

</div>
<ul>
  <li><a href="../../commons/getting-started.html" class="page">Getting Started</a></li>
  <li><a href="../../commons/create-component.html" class="page">Creating a Component</a></li>
  <li><a href="../../commons/multiple-components.html" class="page">Multiple Components</a></li>
  <li><a href="../../commons/using-alarms.html" class="page">Using Alarms</a></li>
  <li><a href="../../commons/unit-tests.html" class="page">Adding Unit Tests</a></li>
  <li><a href="../../commons/params.html" class="page">Params</a>
  <ul>
    <li><a href="../../params/keys-parameters.html" class="page">Keys and Parameters</a></li>
    <li><a href="../../params/units.html" class="page">Units</a></li>
    <li><a href="../../params/subsystem.html" class="page">Subsystem</a></li>
    <li><a href="../../params/commands.html" class="page">Commands</a></li>
    <li><a href="../../params/events.html" class="page">Events</a></li>
    <li><a href="../../params/states.html" class="page">State Variables</a></li>
    <li><a href="../../params/result.html" class="page">Result</a></li>
  </ul></li>
  <li><a href="../../commons/framework.html" class="page">Framework for creating components (HCD, Assembly, Container)</a>
  <ul>
    <li><a href="../../framework/describing-components.html" class="page">ComponentInfo</a></li>
    <li><a href="../../framework/creating-components.html" class="page">Creating an Assembly or Hcd Component</a></li>
    <li><a href="../../framework/handling-lifecycle.html" class="page">Component Handlers</a></li>
    <li><a href="../../framework/managing-command-state.html" class="page">Managing Command State</a></li>
    <li><a href="../../framework/tracking-connections.html" class="page">Tracking Connections</a></li>
    <li><a href="../../framework/publishing-state.html" class="page">Publishing State</a></li>
    <li><a href="../../framework/handling-exceptions.html" class="page">Handling Exceptions</a></li>
    <li><a href="../../framework/deploying-components.html" class="page">Deploying Components</a></li>
  </ul></li>
  <li><a href="../../commons/command.html" class="page">Communication using Commands</a></li>
  <li><a href="../../commons/logging_aggregator.html" class="page">Logging Aggregator</a></li>
  <li><a href="../../commons/services.html" class="page">Services</a>
  <ul>
    <li><a href="../../services/location.html" class="page">Location Service</a></li>
    <li><a href="../../services/config.html" class="page">Configuration Service</a></li>
    <li><a href="../../services/logging.html" class="page">Logging Service</a></li>
    <li><a href="../../services/event.html" class="page">Event Service</a></li>
    <li><a href="../../services/alarm.html" class="page">Alarm Service</a></li>
    <li><a href="../../services/time.html" class="page">Time Service</a></li>
    <li><a href="../../services/database.html" class="page">Database Service</a></li>
    <li><a href="../../services/aas.html" class="page">Authentication and Authorization Service (AAS)</a></li>
    <li><a href="../../services/sequencer-command-service.html" class="page">Sequencer Command Service</a></li>
  </ul></li>
  <li><a href="../../commons/apps.html" class="page">Applications</a>
  <ul>
    <li><a href="../../apps/cswlocationserver.html" class="page">csw-location-server</a></li>
    <li><a href="../../apps/cswlocationagent.html" class="page">csw-location-agent</a></li>
    <li><a href="../../apps/cswonfigserverapp.html" class="page">csw-config-server</a></li>
    <li><a href="../../apps/cswconfigcli.html" class="page">csw-config-cli</a></li>
    <li><a href="../../apps/csweventcli.html" class="page">csw-event-cli</a></li>
    <li><a href="../../apps/cswalarmcli.html" class="page">csw-alarm-cli</a></li>
    <li><a href="../../apps/hostconfig.html" class="page">csw-host-config</a></li>
  </ul></li>
  <li><a href="../../commons/deployment.html" class="page">Deployment</a>
  <ul>
    <li><a href="../../deployment/env-vars.html" class="page">Environment variables</a></li>
    <li><a href="../../deployment/network-topology.html" class="page">Network Topology</a></li>
  </ul></li>
  <li><a href="../../commons/testing.html" class="page">Testing</a></li>
  <li><a href="../../commons/sbt-tasks.html" class="page">sbt Tasks</a></li>
  <li><a href="../../commons/manuals.html" class="page">Manuals</a></li>
  <li><a href="../../migration_guide/migration-guides.html" class="page">Migration Guides</a>
  <ul>
    <li><a href="../../migration_guide/migration_guide_1.0.0_to_2.0.0/migration-guide-1.0.0-to-2.0.0.html" class="page">Migration Guide from 1.0.0 to 2.0.0</a></li>
  </ul></li>
  <li><a href="../../commons/contract.html" class="page">CSW Service contract</a></li>
  <li><a href="../../technical/technical.html" class="page">Technical Design Documents</a>
  <ul>
    <li><a href="../../technical/framework/framework.html" class="page">Framework</a></li>
    <li><a href="../../technical/command/command.html" class="page">Command</a></li>
    <li><a href="../../technical/params/params.html" class="page">Params</a></li>
    <li><a href="../../technical/location/location.html" class="page">Location Service</a></li>
    <li><a href="../../technical/configuration/configuration.html" class="page">Configuration Service</a></li>
    <li><a href="../../technical/logging/logging.html" class="page">Logging Service</a></li>
    <li><a href="../../technical/event/event.html" class="page">Event Service</a></li>
    <li><a href="../../technical/alarm/alarm.html" class="page">Alarm Service</a></li>
    <li><a href="../../technical/time/time.html" class="active page">Time Service</a></li>
    <li><a href="../../technical/database/database.html" class="page">Database Service</a></li>
    <li><a href="../../technical/aas/aas.html" class="page">Authentication and Authorization Service</a></li>
  </ul></li>
</ul>
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../../technical/time/time.html#time-service" class="header">Time Service</a>
  <ul>
    <li><a href="../../technical/time/time.html#introduction" class="header">Introduction</a></li>
    <li><a href="../../technical/time/time.html#summary-of-relevant-time-metrics" class="header">Summary of relevant time metrics</a></li>
    <li><a href="../../technical/time/time.html#overview-of-ieee-1588" class="header">Overview of IEEE 1588</a></li>
    <li><a href="../../technical/time/time.html#tmt-time-service-architecture" class="header">TMT Time service architecture</a></li>
    <li><a href="../../technical/time/time.html#internals-of-a-network-component" class="header">Internals of a Network Component</a></li>
    <li><a href="../../technical/time/time.html#usage-of-ptp-time" class="header">Usage of PTP time</a></li>
  </ul></li>
</ul>
</nav>

</nav>
<ul style="display: none">
<li class="md-nav__item md-version" id="project.version">
<label class="md-nav__link" for="__version">
<i class="md-icon" title="Version">label_outline</i> 0.1.0*
</label>
</li>
</ul>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../../technical/time/time.html#time-service" class="header">Time Service</a>
  <ul>
    <li><a href="../../technical/time/time.html#introduction" class="header">Introduction</a></li>
    <li><a href="../../technical/time/time.html#summary-of-relevant-time-metrics" class="header">Summary of relevant time metrics</a></li>
    <li><a href="../../technical/time/time.html#overview-of-ieee-1588" class="header">Overview of IEEE 1588</a></li>
    <li><a href="../../technical/time/time.html#tmt-time-service-architecture" class="header">TMT Time service architecture</a></li>
    <li><a href="../../technical/time/time.html#internals-of-a-network-component" class="header">Internals of a Network Component</a></li>
    <li><a href="../../technical/time/time.html#usage-of-ptp-time" class="header">Usage of PTP time</a></li>
  </ul></li>
</ul>
</nav>

</div>
</div>
</div>
<div class="md-content">
<article class="md-content__inner md-typeset">
<div class="md-content__searchable">
<h1><a href="#time-service" name="time-service" class="anchor"><span class="anchor-link"></span></a>Time Service</h1>
<h2><a href="#introduction" name="introduction" class="anchor"><span class="anchor-link"></span></a>Introduction</h2>
<p>The time service implementation provides API for managing time across various components within the TMT architecture. TMT has standardised on the use of Precision Time Protocol (PTP), an IEEE 1588 standard, as the basis of observatory time to achieve sub-microsecond accuracy and precision. The PTP grand master clock (a hardware device) is synchronized to the Global Positioning System (GPS) time. Each computer system participating in the PTP network synchronizes to Observatory Time using the PTP protocol. For higher accuracy in time measurements, hardware time stamping is recommended and the network entities should be fitted with PTP capable Network Interface Cards (NIC).</p>
<p>The TMT time service relies on making native calls (Linux kernel C methods invocation) to get the nanosecond precise time overcoming the limitations of Scala and Java libraries which support only microsecond precision till date. These native calls are provided as wrapper over Java and Scala APIs for easy use by component developers familiar with Java/Scala. The TMT time service is responsible for primarily providing time in <a href="time.html#summary-of-relevant-time-metrics">Coordinated Universal Time (UTC)</a> and <a href="time.html#summary-of-relevant-time-metrics">International Atomic Time (TAI)</a> time scales. The handling of <a href="time.html#summary-of-relevant-time-metrics">leap second</a> event is taken care by the TMT time service automatically(without human intervention) as the PTP grandmaster distributes the accurate information when received through GPS.</p>
<p>The time service also allows for scheduling tasks either periodically or once using both UTC and TAI time. These schedulers are optimised for handling scheduled tasks at 1KHz frequency or 1 task every 1 millisecond. However, there can be jitters due to JVM garbage collection, CPU loads and concurrent task execution.</p>
<h2><a href="#summary-of-relevant-time-metrics" name="summary-of-relevant-time-metrics" class="anchor"><span class="anchor-link"></span></a>Summary of relevant time metrics</h2>
<ul>
  <li>
  <p>Second – A second is defined as 9,192,631,770 cycles of radiation corresponding to the transition between two hyperfine levels of the ground state of caesium 133</p></li>
  <li>
  <p>Leap Second – A second which is introduced to compensate for slight error in Earth’s rotation.</p></li>
</ul>
<p><img src="leap-seconds.png" alt="leap seconds" /></p>
<ul>
  <li>
    <p>Time zones</p>
    <ul>
      <li>
      <p>TAI – International Atomic Time (Temps Atomique International) is defined as the weighted average of the time kept by about 200 atomic clocks in over 50 national laboratories worldwide. TAI was introduced in Jan 1, 1958.</p></li>
      <li>
      <p>UT – Universal Time (UT1 or UT) is a time standard based on Earth&rsquo;s rotation. It is a modern continuation of Greenwich Mean Time (GMT) i.e., mean solar time.</p></li>
      <li>
      <p>UTC – Coordinated Universal Time (UTC) is the primary time standard by which the world regulates clocks and time. It is always within 1 second of UT. UTC differs from TAI by an integral number of seconds (currently 37). When needed, leap seconds are updated in UTC. UTC was introduced in 1972.</p></li>
      <li>
      <p>GPS – Global Positioning System Time is a uniformly counting time scale beginning at 00:00 of January 6, 1980. No leap seconds are inserted into GPS time. GPS time is always 19 seconds behind TAI.</p></li>
    </ul>
  </li>
  <li>
  <p>Various <a href="http://www.ntp.org/ntpfaq/NTP-s-sw-clocks-quality.htm">clock quality factors</a> determine the effectiveness of a time implementation.</p></li>
</ul>
<h2><a href="#overview-of-ieee-1588" name="overview-of-ieee-1588" class="anchor"><span class="anchor-link"></span></a>Overview of IEEE 1588</h2>
<p>The IEEE 1588 standard describes a protocol, PTP, used to synchronize clocks throughout a computer network using either UDP or TCP network packets. On an ethernet based local area network, it achieves clock accuracy in the sub-microsecond range, making it suitable for measurement and control systems. PTP is currently employed in diverse distributed domains and networks that require precise timing but lack access to satellite navigation signals. The recommended timescale of PTP is the same as TAI. PTP provides two mechanisms namely, hardware time stamping and software time stamping to achieve such a high accuracy.</p>
<h2><a href="#tmt-time-service-architecture" name="tmt-time-service-architecture" class="anchor"><span class="anchor-link"></span></a>TMT Time service architecture</h2>
<p>The IEEE 1588 standards describe a hierarchical master-slave architecture for clock distribution. TMT Time service architecture follows the same topology as shown in the figure.</p>
<p>Under this architecture, a time distribution system consists of one or more network segments, and one or more clocks. The standard offers an automatic way for the configuration of the synchronization network, based on the nodes pre-programmed capabilities. A synchronization network consists one or more of the following entities:</p>
<ul>
  <li>
  <p>Ordinary Clock - An ordinary clock is a device with a single network connection and is either the source of (master) or destination for (slave) a synchronization reference.</p></li>
  <li>
  <p>Grandmaster - The root timing reference of a distributed network is called the grandmaster. The grandmaster transmits synchronization information to the clocks residing on its network segment.</p></li>
  <li>
  <p>Boundary Clock (Optional) - A boundary clock has multiple network connections and can accurately synchronize one network segment to another. Once a boundary clock residing in a network segment having a grandmaster is synchronized it can then relay accurate time to the other connected network segments.</p></li>
  <li>
  <p>Transparent Clock (Optional) - The transparent clock modifies PTP messages as they pass through the device. Timestamps in the messages are corrected for time spent traversing the network equipment. This scheme improves distribution accuracy by compensating for delivery variability across the network.</p></li>
  <li>
  <p>Refer <a href="https://blog.meinbergglobal.com/2013/10/21/ieee-1588-clock-types/">this</a> for more details on various clocks.</p></li>
</ul>
<p><img src="time-service-architecture.png" alt="architecture" /></p>
<p>For TMT, a simplified PTP system consisting of ordinary clocks connected to a single network, and no boundary clocks can be used. A grandmaster is elected and all other clocks synchronize directly to it. The grandmaster is a special entity which is configured to receive the accurate GPS time information (TAI time, TAI-UTC offset etc.) through a TMT GPS receiver. A master clock has the capability to serve the other nodes in the network when a grandmaster has failed. Such a master clock is elected as a grandmaster using the <a href="https://en.wikipedia.org/wiki/Precision_Time_Protocol#Best_master_clock_algorithm">Best Master Clock Algorithm</a>. A clock in the network distribution can be ‘*slave only*’ which will enforce it to be a slave, always. In case a new network segment is introduced a boundary clock can be set up to synchronize with the TMT grandmaster time. <a href="https://en.wikipedia.org/wiki/Precision_Time_Protocol#Synchronization">Synchronization</a> and management of a PTP system is achieved through the exchange of <a href="https://en.wikipedia.org/wiki/Precision_Time_Protocol#Protocol_details">protocol messages</a> across the network segments.</p>
<h2><a href="#internals-of-a-network-component" name="internals-of-a-network-component" class="anchor"><span class="anchor-link"></span></a>Internals of a Network Component</h2>
<p>In case of TMT most of the synchronization components will be based on Linux operating system. For understanding the internal working of Linux clock one can refer to <a href="http://btorpey.github.io/blog/2014/02/18/clock-sources-in-linux/#fnref:1">this short description</a> or follow ‘Chapter 6’ of <a href="https://doc.lagout.org/operating%20system%20/linux/Understanding%20Linux%20Kernel.pdf">the detailed document</a>. The block diagram of an ordinary clock is shown in the following figure.</p>
<p><img src="block-diagram-ordinary-clock.png" alt="block diagram" /></p>
<p>A reference time is transmitted through the Ethernet LAN from a master/grandmaster clock. To achieve sub-microsecond accuracy and precision, the Network Interface Card (NIC) of the component must have the capability to perform hardware timestamping, and an internal PTP Hardware Clock(PHC). Here&rsquo;s a <a href="https://id.atlassian.com/login?continue=https%3A%2F%2Ftmt-project.atlassian.net%2Flogin%3FredirectCount%3D1%26dest-url%3D%252Fwiki%252Fspaces%252FDEOPSCSW%252Fpages%252F452296820%252FPTP%252BDriver%252BMatrix%252BSupport%26application%3Dconfluence&application=confluence">list</a> which mentions of such capable NICs while there are various new additions in the market. Most of the current NICs are able to handle PTP protocol by default. Run the following command to find the details of a NIC.</p>
<pre class="prettyprint"><code class="language-bash">sudo lshw -class network
</code></pre>
<p>The PHC API is an application programming interface which serves as a simplified tool to access and program the on–board clocks on the network adapters. This API is a part of the Linux kernel and synchronizes Linux clock with external time. The PTP Daemon protocol stack implements the specified rules of the synchronization by the IEEE 1588:2008 standard. The reliable and popular <a href="http://linuxptp.sourceforge.net/">LinuxPTP project</a> is utilised as the PTP Daemon for TMT since it meets the general requirements of supporting PTP synchronization across the network. LinuxPTP updates the PHC API to set the correct time on the Linux kernel as well as the system wall clock.</p><div class="callout note "><div class="callout-title">Note</div>
<p>The ports 319 and 320 should be open for PTP to transmit messages. Run the following commands to update iptables.</p>
<pre class="prettyprint"><code class="language-bash"> iptables -I INPUT -p udp -m udp --dport 319 -j ACCEPT
 iptables -I INPUT -p udp -m udp --dport 320 -j ACCEPT
 
 firewall-cmd --permanent --zone=public --add-port=319/udp
 firewall-cmd --permanent --zone=public --add-port=320/udp
</code></pre></div>
<p>The recommendation is to utilise the PTP Hardware Timestamping(available at the PHY layer in a network stack) mechanism for TMT to meet the nanosecond requirement. <a href="https://id.atlassian.com/login?continue=https%3A%2F%2Ftmt-project.atlassian.net%2Flogin%3FredirectCount%3D1%26dest-url%3D%252Fwiki%252Fspaces%252FDEOPSCSW%252Fpages%252F279543820%252FPTP%252BHardware%252BTimeStamping%26application%3Dconfluence&application=confluence">Various tests</a> are performed and documented to support the sub-microsecond capability of IEEE 1588 standard using H/W timestamping. In contrast, the PTP software timestamping makes use of the application layer timestamp having a latency overhead.</p>
<h2><a href="#usage-of-ptp-time" name="usage-of-ptp-time" class="anchor"><span class="anchor-link"></span></a>Usage of PTP time</h2>
<p>The PTP synchronization assures that the whole TMT system is following an accurate UTC/TAI time with high precision. All the applications running inside TMT should make use of the PTP time to perform time related operations like logging, scheduling etc.</p>
<h3><a href="#extracting-time" name="extracting-time" class="anchor"><span class="anchor-link"></span></a>Extracting time</h3>
<p>The CSW provides the time service APIs written in Scala and Java for the component developers. Once the Linux kernel is set with PTP time, these APIs use Java Native Access (JNA) based kernel calls to fetch the time information. The class <a href="https://tmtsoftware.github.io/csw/0.1.0-SNAPSHOT/api/java/?csw/time/clock/natives/TimeLibrary.java.html" title="csw/time/clock/natives/TimeLibrary.java"><code>TimeLibrary</code></a> is responsible for loading the Linux kernel C libraries and declare the native methods relevant for extracting time information. The clock id determines the clock to fetch time.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/csw-time/csw-time-clock/jvm/src/main/scala/csw/time/clock/natives/models/ClockId.scala#L23-L24" target="_blank" title="Go to snippet source"></a><code class="language-scala">val ClockRealtime = 0  // system-wide realtime clock. Its time represents seconds and nanoseconds since the Epoch
val ClockTAI      = 11 // It is basically defined as CLOCK_REALTIME(UTC) + tai_offset.</code></pre></dd>
</dl>
<p>The following snippet defines the usage of JNA kernel call to fetch UTC/TAI time and tai_offset(kernel variable) in the Scala API.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/csw-time/csw-time-clock/jvm/src/main/scala/csw/time/clock/natives/models/TMTClock.scala#L26-L37" target="_blank" title="Go to snippet source"></a><code class="language-scala">private def now(clockId: Int): Instant = {
  val timeSpec = new TimeSpec()
  TimeLibrary.clock_gettime(clockId, timeSpec)
  Instant.ofEpochSecond(timeSpec.seconds.longValue(), timeSpec.nanoseconds.longValue())
}

override def offset: Int = {
  val timeVal = new NTPTimeVal()
  TimeLibrary.ntp_gettimex(timeVal)
  if (timeVal.tai == 0) printWarning()
  timeVal.tai
}</code></pre></dd>
</dl><div class="callout note "><div class="callout-title">Note</div>
<p>Based on the <a href="https://id.atlassian.com/login?continue=https%3A%2F%2Ftmt-project.atlassian.net%2Flogin%3FredirectCount%3D1%26dest-url%3D%252Fwiki%252Fspaces%252FDEOPSCSW%252Fpages%252F305102849%252FComparative%252Bstudy%252Bof%252BJNI%252Bvs%252BJNA%26application%3Dconfluence&application=confluence">comparison between JNA and JNI</a></p>
<p>and stakeholder agreement, JNA was fixed to make the low level kernel calls.</p></div>
<h3><a href="#scheduling" name="scheduling" class="anchor"><span class="anchor-link"></span></a>Scheduling</h3>
<p>TMT time service provides scheduler for scheduling tasks once or periodically. The schedulers can be used to handle tasks at 1KHz frequency or 1 task every millisecond. However, jitters and JVM garbage collection can degrade the performance of the schedulers at such a high frequency. Internally, the scheduler APIs makes use of ‘<a href="https://doc.akka.io/docs/akka/current/scheduler.html">Akka Scheduler Library</a>’. The results published in <a href="https://id.atlassian.com/login?continue=https%3A%2F%2Ftmt-project.atlassian.net%2Flogin%3FredirectCount%3D1%26dest-url%3D%252Fwiki%252Fspaces%252FDEOPSCSW%252Fpages%252F298680332%252FComparative%252Bstudy%252Bof%252Bscheduler%252Boptions%252Bfor%252B1KHz%252B1ms%252Bscheduling%252Brate%26application%3Dconfluence&application=confluence">here</a> compares some of the options and makes strong recommendation to use the Akka Schedulers. The snippets in the API documentation defines the schedule APIs in the CSW library.</p>
<p>One of the major challenge in designing the scheduler was to handle the leap second event. The leap second plays an important role in affecting the UTC time. Therefore, a scheduler accepting future UTC time as a start time can behave unpredictably and less accurately. Time service scheduler APIs provide capability to schedule tasks on the absolute TAI time synchronized using the IEEE 1588 standard. This approach eliminates anomaly of a leap second event and provide robustness in the scheduling mechanism. Depending on developer’s choice, scheduled tasks are queued in either UTC or TAI time encapsulated inside <a href="https://tmtsoftware.github.io/csw/0.1.0-SNAPSHOT/api/scala/csw/time/core/models/TMTTime.html" title="csw/time/core/models/TMTTime"><code>TMTTime</code></a>.</p>
</div>
<div>
<a href="https://github.com/tmtsoftware/csw/tree/master/docs/src/main/technical/time/time.md" title="Edit this page" class="md-source-file md-edit">
Edit this page
</a>
</div>
<div class="print-only">
<span class="md-source-file md-version">
0.1.0*
</span>
</div>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-nav">
<nav class="md-footer-nav__inner md-grid">
<a href="../../technical/alarm/alarm.html" title="Alarm Service" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
</div>
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Previous
</span>
Alarm Service
</span>
</div>
</a>
<a href="../../technical/database/database.html" title="Database Service" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Next
</span>
Database Service
</span>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
</div>
</a>
</nav>
</div>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
Powered by
<a href="https://github.com/lightbend/paradox">Paradox</a>
and
<a href="https://jonas.github.io/paradox-material-theme/">Paradox Material Theme</a>

</div>
</div>
</div>
</footer>

</div>
<script src="../../assets/javascripts/application.583bbe55.js"></script>
<script src="../../assets/javascripts/paradox-material-theme.js"></script>
<script>app.initialize({version:"0.17",url:{base:"../../."}})</script>
<script type="text/javascript" src="../../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function(event) {
window.prettyPrint && prettyPrint();
});
</script>
</body>
</html>
