<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="description" content="docs">
<meta name="generator" content="Paradox, paradox-material-theme=0.6.0, mkdocs-material=3.0.3">

<meta name="lang:clipboard.copy" content="Copy to clipboard">
<meta name="lang:clipboard.copied" content="Copied to clipboard">
<meta name="lang:search.language" content="">
<meta name="lang:search.pipeline.stopwords" content="true">
<meta name="lang:search.pipeline.trimmer" content="true">
<meta name="lang:search.result.none" content="No matching documents">
<meta name="lang:search.result.one" content="1 matching document">
<meta name="lang:search.result.other" content="# matching documents">
<meta name="lang:search.tokenizer" content="[\s\-]+">


<meta name="description" content="docs">
<link rel="shortcut icon" href="../../assets/tmt_favicon.ico">
<title>Framework Â· TMT Common Software (CSW)</title>
<link rel="stylesheet" href="../../assets/stylesheets/application.451f80e5.css">
<link rel="stylesheet" href="../../lib/material__tabs/dist/mdc.tabs.min.css">
<link rel="stylesheet" href="../../lib/prettify/prettify.css">
<script src="../../assets/javascripts/modernizr.1aa3b519.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
<style>
body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}
code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}
</style>
<link rel="stylesheet" href="../../assets/fonts/font-awesome.css">
<link rel="stylesheet" href="../../assets/fonts/material-icons.css">
<link rel="stylesheet" href="../../assets/stylesheets/paradox-material-theme.css">
</head>
<body
>
<input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
<input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
<label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
<header class="md-header" data-md-component="header">
<nav class="md-header-nav md-grid">
<div class="md-flex">
<div class="md-flex__cell md-flex__cell--shrink">
<a href="../../index.html" title="TMT Common Software (CSW)" class="md-header-nav__button md-logo">
<i class="md-icon">local_library</i>
</a>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
</div>
<div class="md-flex__cell md-flex__cell--stretch">
<div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
<span class="md-header-nav__topic">
TMT Common Software (CSW)
</span>
<span class="md-header-nav__topic">
Framework
</span>
</div>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
<label class="md-icon md-search__icon" for="__search"></label>
<button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">&#xE5CD;</button>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix>
<div class="md-search-result" data-md-component="result">
<div class="md-search-result__meta">
Type to start searching
</div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>

</div>
<div class="md-flex__cell md-flex__cell--shrink">
<div class="md-header-nav__source">
<a href="https://github.com/tmtsoftware/csw"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
tmtsoftware/csw
</div>
</a>

</div>
</div>
</div>
</nav>
</header>

<div class="md-container">
<main class="md-main">
<div class="md-main__inner md-grid" data-md-component="container">
<div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--primary" data-md-level="0" style="visibility: hidden">
<label class="md-nav__title md-nav__title--site" for="drawer">
<a href="../../index.html" title="TMT Common Software (CSW)" class="md-nav__button md-logo">
<span class="md-nav__button md-logo">
<i class="md-icon">local_library</i>
</a>
<a href="../../index.html" title="TMT Common Software (CSW)">
TMT Common Software (CSW)
</a>
</label>
<div class="md-nav__source">
<a href="https://github.com/tmtsoftware/csw"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
tmtsoftware/csw
</div>
</a>

</div>
<ul>
  <li><a href="../../commons/getting-started.html" class="page">Getting Started</a></li>
  <li><a href="../../commons/create-component.html" class="page">Creating a Component</a></li>
  <li><a href="../../commons/multiple-components.html" class="page">Multiple Components</a></li>
  <li><a href="../../commons/using-alarms.html" class="page">Using Alarms</a></li>
  <li><a href="../../commons/unit-tests.html" class="page">Adding Unit Tests</a></li>
  <li><a href="../../commons/params.html" class="page">Params</a>
  <ul>
    <li><a href="../../params/keys-parameters.html" class="page">Keys and Parameters</a></li>
    <li><a href="../../params/units.html" class="page">Units</a></li>
    <li><a href="../../params/subsystem.html" class="page">Subsystem</a></li>
    <li><a href="../../params/commands.html" class="page">Commands</a></li>
    <li><a href="../../params/events.html" class="page">Events</a></li>
    <li><a href="../../params/states.html" class="page">State Variables</a></li>
    <li><a href="../../params/result.html" class="page">Result</a></li>
  </ul></li>
  <li><a href="../../commons/framework.html" class="page">Framework for creating components (HCD, Assembly, Container)</a>
  <ul>
    <li><a href="../../framework/describing-components.html" class="page">ComponentInfo</a></li>
    <li><a href="../../framework/creating-components.html" class="page">Creating an Assembly or Hcd Component</a></li>
    <li><a href="../../framework/handling-lifecycle.html" class="page">Component Handlers</a></li>
    <li><a href="../../framework/managing-command-state.html" class="page">Managing Command State</a></li>
    <li><a href="../../framework/tracking-connections.html" class="page">Tracking Connections</a></li>
    <li><a href="../../framework/publishing-state.html" class="page">Publishing State</a></li>
    <li><a href="../../framework/handling-exceptions.html" class="page">Handling Exceptions</a></li>
    <li><a href="../../framework/deploying-components.html" class="page">Deploying Components</a></li>
  </ul></li>
  <li><a href="../../commons/command.html" class="page">Communication using Commands</a></li>
  <li><a href="../../commons/logging_aggregator.html" class="page">Logging Aggregator</a></li>
  <li><a href="../../commons/services.html" class="page">Services</a>
  <ul>
    <li><a href="../../services/location.html" class="page">Location Service</a></li>
    <li><a href="../../services/config.html" class="page">Configuration Service</a></li>
    <li><a href="../../services/logging.html" class="page">Logging Service</a></li>
    <li><a href="../../services/event.html" class="page">Event Service</a></li>
    <li><a href="../../services/alarm.html" class="page">Alarm Service</a></li>
    <li><a href="../../services/time.html" class="page">Time Service</a></li>
    <li><a href="../../services/database.html" class="page">Database Service</a></li>
    <li><a href="../../services/aas.html" class="page">Authentication and Authorization Service (AAS)</a></li>
  </ul></li>
  <li><a href="../../commons/apps.html" class="page">Applications</a>
  <ul>
    <li><a href="../../apps/cswlocationserver.html" class="page">csw-location-server</a></li>
    <li><a href="../../apps/cswadminserver.html" class="page">csw-admin-server</a></li>
    <li><a href="../../apps/cswlocationagent.html" class="page">csw-location-agent</a></li>
    <li><a href="../../apps/cswonfigserverapp.html" class="page">csw-config-server</a></li>
    <li><a href="../../apps/cswconfigcli.html" class="page">csw-config-cli</a></li>
    <li><a href="../../apps/csweventcli.html" class="page">csw-event-cli</a></li>
    <li><a href="../../apps/cswalarmcli.html" class="page">csw-alarm-cli</a></li>
    <li><a href="../../apps/hostconfig.html" class="page">csw-host-config</a></li>
  </ul></li>
  <li><a href="../../commons/deployment.html" class="page">Deployment</a>
  <ul>
    <li><a href="../../deployment/env-vars.html" class="page">Environment variables</a></li>
  </ul></li>
  <li><a href="../../commons/testing.html" class="page">Testing</a></li>
  <li><a href="../../commons/sbt-tasks.html" class="page">sbt Tasks</a></li>
  <li><a href="../../commons/manuals.html" class="page">Manuals</a></li>
  <li><a href="../../technical/technical.html" class="page">Technical Design Documents</a>
  <ul>
    <li><a href="../../technical/framework/framework.html" class="active page">Framework</a></li>
    <li><a href="../../technical/params/params.html" class="page">Params</a></li>
    <li><a href="../../technical/location/location.html" class="page">Location Service</a></li>
    <li><a href="../../technical/configuration/configuration.html" class="page">Configuration Service</a></li>
    <li><a href="../../technical/logging/logging.html" class="page">Logging Service</a></li>
    <li><a href="../../technical/event/event.html" class="page">Event Service</a></li>
    <li><a href="../../technical/alarm/alarm.html" class="page">Alarm Service</a></li>
    <li><a href="../../technical/time/time.html" class="page">Time Service</a></li>
    <li><a href="../../technical/database/database.html" class="page">Database Service</a></li>
    <li><a href="../../technical/aas/aas.html" class="page">Authentication and Authorization Service</a></li>
  </ul></li>
</ul>
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../../technical/framework/framework.html#framework" class="header">Framework</a>
  <ul>
    <li><a href="../../technical/framework/framework.html#introduction" class="header">Introduction</a></li>
    <li><a href="../../technical/framework/framework.html#creation-of-a-component" class="header">Creation of A Component</a></li>
    <li><a href="../../technical/framework/framework.html#discovering-other-components" class="header">Discovering Other Components</a></li>
    <li><a href="../../technical/framework/framework.html#receiving-messages-from-outside-the-component" class="header">Receiving Messages from Outside the Component</a></li>
    <li><a href="../../technical/framework/framework.html#sending-commands-from-the-component" class="header">Sending Commands from the Component</a></li>
    <li><a href="../../technical/framework/framework.html#receiving-responses-from-components" class="header">Receiving Responses from Components</a></li>
    <li><a href="../../technical/framework/framework.html#deploying-component-in-container-or-standalone-mode" class="header">Deploying Component in Container or Standalone Mode</a></li>
  </ul></li>
</ul>
</nav>

</nav>
<ul style="display: none">
<li class="md-nav__item md-version" id="project.version">
<label class="md-nav__link" for="__version">
<i class="md-icon" title="Version">label_outline</i> 0.7.0
</label>
</li>
</ul>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../../technical/framework/framework.html#framework" class="header">Framework</a>
  <ul>
    <li><a href="../../technical/framework/framework.html#introduction" class="header">Introduction</a></li>
    <li><a href="../../technical/framework/framework.html#creation-of-a-component" class="header">Creation of A Component</a></li>
    <li><a href="../../technical/framework/framework.html#discovering-other-components" class="header">Discovering Other Components</a></li>
    <li><a href="../../technical/framework/framework.html#receiving-messages-from-outside-the-component" class="header">Receiving Messages from Outside the Component</a></li>
    <li><a href="../../technical/framework/framework.html#sending-commands-from-the-component" class="header">Sending Commands from the Component</a></li>
    <li><a href="../../technical/framework/framework.html#receiving-responses-from-components" class="header">Receiving Responses from Components</a></li>
    <li><a href="../../technical/framework/framework.html#deploying-component-in-container-or-standalone-mode" class="header">Deploying Component in Container or Standalone Mode</a></li>
  </ul></li>
</ul>
</nav>

</div>
</div>
</div>
<div class="md-content">
<article class="md-content__inner md-typeset">
<div class="md-content__searchable">
<h1><a href="#framework" name="framework" class="anchor"><span class="anchor-link"></span></a>Framework</h1>
<h2><a href="#introduction" name="introduction" class="anchor"><span class="anchor-link"></span></a>Introduction</h2>
<p>The common software framework is a library that provides set of APIs used for:</p>
<ul>
  <li>creation of components(Assemblies, HCDs)</li>
  <li>discovering other components</li>
  <li>receiving messages from external world</li>
  <li>sending messages/commands to other components</li>
  <li>receiving responses from components</li>
  <li>deploying component in container or standalone mode</li>
</ul>
<p>The CSW framework is implemented using <a href="https://doc.akka.io/docs/akka/current/typed/index.html">Akka typed actors</a>.</p><div class="callout note "><div class="callout-title">IMPORTANT!!!</div>
<p>Actors provide a single control of execution by processing messages received one by one, but it is still necessary to be careful with actor state. If a Future is spawned inside an actor then on completion of that Future, it is a common mistake to mutate actor state. It can cause critical problems of state corruption because some other message might be in the process of execution and accessing the actor state. The ideal way to handle Futures inside actors is by sending message to self on Future completion. This will make sure the mutation of state happens in order of one by one via messages. Example code can be seen <a href="https://github.com/tmtsoftware/csw/tree/v0.7.0/csw-framework/src/main/scala/csw/framework/internal/supervisor/SupervisorBehavior.scala#L279">here</a>.</p></div>
<h2><a href="#creation-of-a-component" name="creation-of-a-component" class="anchor"><span class="anchor-link"></span></a>Creation of A Component</h2>
<p>A component consists of couple of actors and classes created by framework on behalf of the component and some actors/classes that are expected to be created by component writers using the CSW framework.</p>
<h3><a href="#framework-actors-classes" name="framework-actors-classes" class="anchor"><span class="anchor-link"></span></a>Framework Actors/Classes</h3>
<p>During component creation the CSW framework creates a <a href="https://github.com/tmtsoftware/csw/tree/v0.7.0/csw-framework/src/main/scala/csw/framework/internal/supervisor/SupervisorBehavior.scala">Supervisor</a> actor as the first thing when creating any component. Each component has its own Supervisor. That Supervisor then goes on to create the <a href="https://github.com/tmtsoftware/csw/tree/v0.7.0/csw-framework/src/main/scala/csw/framework/internal/component/ComponentBehavior.scala">Top Level Actor</a> using the component&rsquo;s unique <code>Handlers</code>, <a href="https://github.com/tmtsoftware/csw/tree/v0.7.0/csw-framework/src/main/scala/csw/framework/internal/pubsub/PubSubBehavior.scala">Pub-Sub Manager</a> actor and <a href="https://github.com/tmtsoftware/csw/tree/v0.7.0/csw-command/csw-command-client/src/main/scala/csw/command/client/CommandResponseManagerActor.scala">Command Response Manager</a> actor as part of the TMT framework supporting a component.</p>
<p><img src="media/anatomy.gif" alt="anatomy" /></p><div class="callout note "><div class="callout-title">Note</div>
<ul>
  <li>The actors shown in blue are created by CSW framework and actors/classes shown in green are expected to be written by the component developer.</li>
  <li>The <code>Handlers</code> shown above is implemented by extending <a href="https://github.com/tmtsoftware/csw/tree/v0.7.0/csw-framework/src/main/scala/csw/framework/scaladsl/ComponentHandlers.scala">ComponentHandlers</a>/ <a href="https://github.com/tmtsoftware/csw/tree/v0.7.0/csw-framework/src/main/scala/csw/framework/javadsl/JComponentHandlers.scala">JComponentHandlers</a> framework class. So, the TLA decides when to call a specific handler method or <code>hooks</code> and implementation of <code>ComponentHandlers/JComponentHandlers</code> decides what to do when it is called, for e.g. TLA decides when to call <a href="https://github.com/tmtsoftware/csw/tree/v0.7.0/examples/src/main/scala/org/tmt/nfiraos/sampleassembly/SampleAssemblyHandlers.scala#L128">intialize</a> handler and handler provides implementation of how to initialize a component, may be by putting the hardware in default position, etc.</li>
  <li>From the framework&rsquo;s viewpoint, the TLA is created with an instance of <a href="https://github.com/tmtsoftware/csw/tree/v0.7.0/csw-framework/src/main/scala/csw/framework/internal/component/ComponentBehavior">ComponentBehavior</a> and the <code>Handlers</code> created by the developer. The ComponentBehavior actor has the framework behavior such as lifecycle. It manages incoming messages and calls the <code>Handlers</code> when appropriate.</li>
</ul></div>
<p>To know more about the responsibility of Supervisor and Top Level Actor please refer this <a href="../../commons/create-component.html#anatomy-of-component">section</a>.</p>
<p>The interaction between supervisor and Top Level Actor when creating the component is shown below:</p>
<p><img src="media/creation.png" alt="creation" /> </p>
<p>The code base that implements the creation of Top Level Actor and watching it from its Supervisor can be found <a href="https://github.com/tmtsoftware/csw/tree/v0.7.0/csw-framework/src/main/scala/csw/framework/internal/supervisor/SupervisorBehavior.scala#L301">here</a>. The code that implements the startup lifecycle and the calling of the <code>intialize</code> handler of Top Level Actor can be found <a href="https://github.com/tmtsoftware/csw/tree/v0.7.0/csw-framework/src/main/scala/csw/framework/internal/component/ComponentBehavior.scala#L84">here</a>. An explanation of the <code>Idle</code> state can be found <a href="../../commons/create-component.html#idle">here</a>. </p><div class="callout note "><div class="callout-title">Note</div>
<p>If there is any exception thrown while executing <code>initialize</code> handler then the exception is bubbled up to Supervisor, and it restarts Top Level Actor which in turn calls <code>initialize</code> handler again hoping the error fixes on restart. For this, Supervisor uses a restart strategy with maximum of 3 restarts possible that must be finished within 5 seconds. To know more about the Akka supervision failure strategy please refer to the <a href="https://doc.akka.io/docs/akka/current/typed/fault-tolerance.html">Akka Fault Tolerance</a> document. The Supervisor code base wiring restart strategy can be found <a href="https://github.com/tmtsoftware/csw/tree/v0.7.0/csw-framework/src/main/scala/csw/framework/internal/supervisor/SupervisorBehavior.scala#L309">here</a>. </p></div>
<p>Once the handler is spawned it receives an <code>ActorContext</code> and <a href="https://github.com/tmtsoftware/csw/tree/v0.7.0/csw-framework/src/main/scala/csw/framework/models/CswContext.scala">CswContext</a> in its constructor. The <code>ActorContext</code> is used to get the <code>ActorSystem</code> of the component and maybe spawn other actors i.e worker actors for maintaining state. The <code>CswContext</code> can be used to get the handle of all the services provided by CSW. To know more about these services please refer to this <a href="../../commons/create-component.html#csw-services-injection">section</a>.</p>
<h3><a href="#component-info-file-for-component-startup" name="component-info-file-for-component-startup" class="anchor"><span class="anchor-link"></span></a>Component Info File for Component Startup</h3>
<p>Every component needs to provide a startup config file called the Component Info File that contains component details such as name, type, handler class name, tracking details, etc. The contents of this file is used by Supervisor to create and setup the component as well as some customization. To know more about what is it and how to write the Component Info File please refer this <a href="../../framework/describing-components.html">section</a> and a <a href="../../commons/multiple-components.html#component-configuration-componentinfo">sample file</a>. </p>
<p>The name of the Component Info File needs to be passed to <a href="../../framework/deploying-components.html">Container/Standalone app</a> at the time of startup. The file is either fetched from <code>Configuration Service</code> or taken from local path on the machine to parse to a <a href="https://github.com/tmtsoftware/csw/tree/v0.7.0/csw-command/csw-command-client/src/main/scala/csw/command/client/models/framework/ComponentInfo.scala">ComponentInfo</a> object. The <code>ComponentInfo</code> object is then passed to <code>Handlers</code> in <code>CswContext</code>.</p>
<p>A component may be created in <a href="../../commons/multiple-components.html">standalone or container</a> mode. In standlone mode, the component is created in its own JVM process. In container mode, multiple components may be started together within the same JVM process. When an HCD or Assembly is <a href="../../framework/creating-components.html">created</a>, depending on the mode, either the <a href="https://github.com/tmtsoftware/csw/tree/v0.7.0/csw-framework/src/main/scala/csw/framework/internal/container/ContainerBehaviorFactory.scala">ContainerBehaviorFactory</a> or the <a href="https://github.com/tmtsoftware/csw/tree/v0.7.0/csw-framework/src/main/scala/csw/framework/internal/supervisor/SupervisorBehaviorFactory.scala">SupervisorBehaviorFactory</a> class is used to create the initial TLA behavior. </p>
<p>In container mode, a Supervisor actor is created for each component and a single <a href="https://github.com/tmtsoftware/csw/tree/v0.7.0/csw-framework/src/main/scala/csw/framework/internal/container/ContainerBehavior.scala">container actor</a> accepts control messages for the container (subtypes of <code>ContainerActorMessage</code>). These container messages can be used to manage the lifecycle of the components in the container. </p>
<h3><a href="#actorsystem-for-the-component" name="actorsystem-for-the-component" class="anchor"><span class="anchor-link"></span></a>ActorSystem for the Component</h3>
<p>While creating a component a new ActorSystem is spawned, which means if there are more than one components running in single JVM process there will be more than one ActorSystem created in the single JVM. Having different ActorSystems in an application is not recommended by <a href="https://doc.akka.io/docs/akka/current/general/actor-systems.html">akka</a> but it is still kept multiple per JVM so that any delay in executing in one component does not affect the execution of other components running in the same JVM. The code base for creating an ActorSystem for each component is written in <a href="https://github.com/tmtsoftware/csw/tree/v0.7.0/csw-framework/src/main/scala/csw/framework/internal/supervisor/SupervisorInfoFactory.scala#L35">SupervisorInfoFactory</a>.</p>
<h2><a href="#discovering-other-components" name="discovering-other-components" class="anchor"><span class="anchor-link"></span></a>Discovering Other Components</h2>
<p>Sometimes one component needs to discover other components. For discovering other components, there are two ways:</p>
<ul>
  <li>
  <p>provide tracking information in the Component Info File as explained <a href="../../commons/multiple-components.html#tracking-dependencies">here</a>. Whenever  there is location update of tracked components <a href="../../commons/multiple-components.html#onlocationtrackingevent-handler">onLocationTrackingEvent</a> handler  is called in the TLA.</p></li>
  <li>
  <p>track using <a href="../../commons/multiple-components.html#trackconnection">trackConnection</a> method that is available in the TLA. This allows tracking to start at runtime based on activities of the component.</p></li>
</ul>
<h2><a href="#receiving-messages-from-outside-the-component" name="receiving-messages-from-outside-the-component" class="anchor"><span class="anchor-link"></span></a>Receiving Messages from Outside the Component</h2>
<p>Messages sent to the component are first received and handled by Supervisor. It decides which messages should be passed to downstream actors (i.e. Top Level Actor, Command Response Manager actor or Pub-Sub Manager actor).</p>
<h3><a href="#restart" name="restart" class="anchor"><span class="anchor-link"></span></a>Restart</h3>
<p>An external administrative message to the Supervisor can cause the component to restart. An explanation of the <code>Restart</code> state and subsequent actions can be found <a href="../../commons/create-component.html#restart">here</a>. The code base that implements restart can be found <a href="https://github.com/tmtsoftware/csw/tree/v0.7.0/csw-framework/src/main/scala/csw/framework/internal/supervisor/SupervisorBehavior.scala#L242">here</a>.</p>
<p><img src="media/restart.png" alt="restart" /></p>
<h3><a href="#shutdown" name="shutdown" class="anchor"><span class="anchor-link"></span></a>Shutdown</h3>
<p>An external administrative command to the Supervisor can cause the component to shutdown and exit. The explanation about <code>Shutdown</code> state and subsequent actions can be found <a href="../../commons/create-component.html#shutdown">here</a>. The code base that implements shutdown can be found <a href="https://github.com/tmtsoftware/csw/tree/v0.7.0/csw-framework/src/main/scala/csw/framework/internal/supervisor/SupervisorBehavior.scala#L247">here</a>.</p>
<p><img src="media/shutdown.png" alt="shutdown" /></p>
<h3><a href="#changing-log-level" name="changing-log-level" class="anchor"><span class="anchor-link"></span></a>Changing log level</h3>
<p>An external messages to change the component&rsquo;s log level (via <code>SetComponentLogLevel</code>) or get log metadata for a component (via <code>GetComponentLogMetadata</code>) gets handled by Supervisor. The code base implements this message can be found <a href="https://github.com/tmtsoftware/csw/tree/v0.7.0/csw-framework/src/main/scala/csw/framework/internal/supervisor/SupervisorBehavior.scala#L118">here</a>. </p>
<h3><a href="#lock" name="lock" class="anchor"><span class="anchor-link"></span></a>Lock</h3>
<p>An external client component can restrict messages and allow only messages from itself using the <code>lock</code> command. An explanation of the <code>Lock</code> state can be found <a href="../../commons/create-component.html#lock">here</a>. The code base that implements Lock can be found <a href="https://github.com/tmtsoftware/csw/tree/v0.7.0/csw-framework/src/main/scala/csw/framework/internal/supervisor/SupervisorBehavior.scala#L205">here</a>.</p>
<p><img src="media/lock.png" alt="lock" /></p>
<h2><a href="#sending-commands-from-the-component" name="sending-commands-from-the-component" class="anchor"><span class="anchor-link"></span></a>Sending Commands from the Component</h2>
<p>The types of commands that can be sent by a component are discussed <a href="../../commons/create-component.html#receiving-commands">here</a>. In order to send commands to other components, a <a href="https://github.com/tmtsoftware/csw/tree/v0.7.0/csw-command/csw-command-api/src/main/scala/csw/command/api/scaladsl/CommandService.scala">CommandService</a> helper is needed. <code>CommandService</code> helper is used to send commands to a component in the form of methods instead of sending messages directly to a component&rsquo;s Supervisor actor. The creation of a CommandService instance can be found <a href="../../commons/multiple-components.html#sending-commands">here</a>.</p>
<p>The operations allowed through <code>CommandService</code> helper are as follows:</p>
<ul>
  <li><a href="https://github.com/tmtsoftware/csw/tree/v0.7.0/csw-command/csw-command-client/src/main/scala/csw/command/client/internal/CommandServiceImpl.scala#L38">validate</a></li>
  <li><a href="https://github.com/tmtsoftware/csw/tree/v0.7.0/csw-command/csw-command-client/src/main/scala/csw/command/client/internal/CommandServiceImpl.scala#L43">submit</a></li>
  <li><a href="https://github.com/tmtsoftware/csw/tree/v0.7.0/csw-command/csw-command-client/src/main/scala/csw/command/client/internal/CommandServiceImpl.scala#L51">submitAll</a></li>
  <li><a href="https://github.com/tmtsoftware/csw/tree/v0.7.0/csw-command/csw-command-client/src/main/scala/csw/command/client/internal/CommandServiceImpl.scala#L74">oneway</a></li>
  <li><a href="https://github.com/tmtsoftware/csw/tree/v0.7.0/csw-command/csw-command-client/src/main/scala/csw/command/client/internal/CommandServiceImpl.scala#L77">onewayAndMatch</a></li>
  <li><a href="https://github.com/tmtsoftware/csw/tree/v0.7.0/csw-command/csw-command-client/src/main/scala/csw/command/client/internal/CommandServiceImpl.scala#L96">query</a></li>
  <li><a href="https://github.com/tmtsoftware/csw/tree/v0.7.0/csw-command/csw-command-client/src/main/scala/csw/command/client/internal/CommandServiceImpl.scala#L104">queryFinal</a></li>
  <li><a href="https://github.com/tmtsoftware/csw/tree/v0.7.0/csw-command/csw-command-client/src/main/scala/csw/command/client/internal/CommandServiceImpl.scala#L107">subscribeCurrentState</a></li>
</ul>
<h2><a href="#receiving-responses-from-components" name="receiving-responses-from-components" class="anchor"><span class="anchor-link"></span></a>Receiving Responses from Components</h2>
<h3><a href="#submit" name="submit" class="anchor"><span class="anchor-link"></span></a>Submit</h3>
<p>To understand the flow of the Submit command please refer to this <a href="../../commons/command.html#the-submit-message">section</a>. </p>
<p><img src="media/submit.png" alt="submit" /></p>
<h3><a href="#oneway" name="oneway" class="anchor"><span class="anchor-link"></span></a>Oneway</h3>
<p>To understand the flow of Oneway please refer to this <a href="../../commons/command.html#the-oneway-message">section</a>.</p>
<p><img src="media/oneway.png" alt="oneway" /></p>
<h3><a href="#validate" name="validate" class="anchor"><span class="anchor-link"></span></a>Validate</h3>
<p>To understand the flow of the Validate command please refer to this <a href="../../commons/command.html#the-validate-message">section</a> and the code base for the implementation can be found <a href="https://github.com/tmtsoftware/csw/tree/v0.7.0/csw-framework/src/main/scala/csw/framework/internal/component/ComponentBehavior.scala#L154">here</a>.</p>
<h3><a href="#command-response-manager" name="command-response-manager" class="anchor"><span class="anchor-link"></span></a>Command Response Manager</h3>
<p>Upon receiving a <code>Submit</code> command by a component (for example an Assembly receives a Submit command), the component can choose to send one or more commands to HCD(s) as part of the Submit command&rsquo;s execution. Once, all the response(s) are received from downstream HCD(s), the Assembly needs to complete the <code>Submit</code> as either <code>Completed</code> or <code>Error</code>. The <a href="https://github.com/tmtsoftware/csw/tree/v0.7.0/csw-command/csw-command-client/src/main/scala/csw/command/client/CommandResponseManagerActor.scala">CommandResponseManager</a> provides different mechanisms to assist in generating the original <code>Submit</code> command&rsquo;s final state.</p>
<p><img src="media/crm.png" alt="crm" /></p>
<p>The Assembly worker can communicate with <code>CommandResponseManagerActor</code> using <a href="https://github.com/tmtsoftware/csw/tree/v0.7.0/docs/src/main/technical/framework/csw-command/csw-command-client/src/main/scala/csw/command/client/CommandResponseManager.scala">CommandResponseManager</a> coming via <a href="https://github.com/tmtsoftware/csw/tree/v0.7.0/csw-framework/src/main/scala/csw/framework/models/CswContext.scala#L43">CswContext</a>.</p>
<h3><a href="#current-state-pub-sub-functionality" name="current-state-pub-sub-functionality" class="anchor"><span class="anchor-link"></span></a>Current State Pub/Sub Functionality</h3>
<p>The framework provides a way, based only on Akka, for one component to subscribe to <code>CurrentState</code> events provided in another component. This can be used by an HCD to keep an Assembly up to date on its internal state asynchronously outside of commands. This can also be coupled with the use of <code>Oneway</code> commands that do not provide completion responses to the sender as is done for <code>Submit</code>. The provider of CurrentState can use <a href="https://github.com/tmtsoftware/csw/tree/v0.7.0/csw-framework/src/main/scala/csw/framework/models/CswContext.scala#L42">CurrentStatePublisher</a> to publish its state from <code>CswContext</code> and the sender component can receive state using <a href="https://github.com/tmtsoftware/csw/tree/v0.7.0/csw-command/csw-command-client/src/main/scala/csw/command/client/internal/CommandServiceImpl.scala#L107">subscribeCurrentState</a> from <code>CommandService</code>.</p>
<p>The Current State Pub/Sub is implemented in <a href="https://github.com/tmtsoftware/csw/tree/v0.7.0/csw-framework/src/main/scala/csw/framework/internal/pubsub/PubSubBehavior.scala">PubSubBehavior</a></p>
<h2><a href="#deploying-component-in-container-or-standalone-mode" name="deploying-component-in-container-or-standalone-mode" class="anchor"><span class="anchor-link"></span></a>Deploying Component in Container or Standalone Mode</h2>
<p>Component(s) can start within a <a href="../../framework/deploying-components.html#container-for-deployment">container</a> or a single component can start as a <a href="../../framework/deploying-components.html#standalone-components">standalone</a>. The code implementing deployment for Container is <a href="https://github.com/tmtsoftware/csw/tree/v0.7.0/csw-framework/src/main/scala/csw/framework/internal/container/ContainerBehavior.scala">here</a> and for Standalone <a href="https://github.com/tmtsoftware/csw/tree/v0.7.0/csw-framework/src/main/scala/csw/framework/internal/wiring/Standalone.scala">here</a>. </p>
<p>The name of the Component Information File can be passed as a command line argument to an application using the <a href="https://github.com/tmtsoftware/csw/tree/v0.7.0/csw-framework/src/main/scala/csw/framework/deploy/containercmd/ContainerCmd.scala">ContainerCmd</a> class to <a href="../../framework/deploying-components.html">deploy</a> the component.</p>
<p>In a production environment, it is planned that components will be started at boot time using a <a href="../../apps/hostconfig.html">HostConfig</a> based application.</p>
<p>Since Akka Typed is used throughout the TMT framework, there are seperate messages understood by Container, Supervisor, Top level Actor and other actors of the CSW framework. The architecture/relations of and between messages can be found <a href="https://github.com/tmtsoftware/csw/tree/v0.7.0/csw-command/csw-command-client/src/main/scala/csw/command/client/messages/MessagesArchitecture.scala">here</a>. </p>
</div>
<div>
<a href="https://github.com/tmtsoftware/csw/tree/v0.7.0/docs/src/main/technical/framework/framework.md" title="Edit this page" class="md-source-file md-edit">
Edit this page
</a>
</div>
<div class="print-only">
<span class="md-source-file md-version">
0.7.0
</span>
</div>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-nav">
<nav class="md-footer-nav__inner md-grid">
<a href="../../technical/technical.html" title="Technical Design Documents" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
</div>
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Previous
</span>
Technical Design Documents
</span>
</div>
</a>
<a href="../../technical/params/params.html" title="Params" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Next
</span>
Params
</span>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
</div>
</a>
</nav>
</div>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
Powered by
<a href="https://github.com/lightbend/paradox">Paradox</a>
and
<a href="https://jonas.github.io/paradox-material-theme/">Paradox Material Theme</a>

</div>
</div>
</div>
</footer>

</div>
<script src="../../assets/javascripts/application.583bbe55.js"></script>
<script src="../../assets/javascripts/paradox-material-theme.js"></script>
<script>app.initialize({version:"0.17",url:{base:"../../."}})</script>
<script type="text/javascript" src="../../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function(event) {
window.prettyPrint && prettyPrint();
});
</script>
</body>
</html>
