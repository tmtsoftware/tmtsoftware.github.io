<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="description" content="docs">
<meta name="generator" content="Paradox, paradox-material-theme=0.7.0, mkdocs-material=3.0.3">

<meta name="lang:clipboard.copy" content="Copy to clipboard">
<meta name="lang:clipboard.copied" content="Copied to clipboard">
<meta name="lang:search.language" content="">
<meta name="lang:search.pipeline.stopwords" content="true">
<meta name="lang:search.pipeline.trimmer" content="true">
<meta name="lang:search.result.none" content="No matching documents">
<meta name="lang:search.result.one" content="1 matching document">
<meta name="lang:search.result.other" content="# matching documents">
<meta name="lang:search.tokenizer" content="[\s\-]+">


<meta name="description" content="docs">
<link rel="shortcut icon" href="../assets/images/favicon.png">
<title>Testing Â· TMT Common Software (CSW)</title>
<link rel="stylesheet" href="../assets/stylesheets/application.451f80e5.css">
<link rel="stylesheet" href="../lib/material__tabs/dist/mdc.tabs.min.css">
<link rel="stylesheet" href="../lib/prettify/prettify.css">
<script src="../assets/javascripts/modernizr.1aa3b519.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
<style>
body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}
code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}
</style>
<link rel="stylesheet" href="../assets/fonts/font-awesome.css">
<link rel="stylesheet" href="../assets/fonts/material-icons.css">
<link rel="stylesheet" href="../assets/stylesheets/paradox-material-theme.css">
</head>
<body
>
<input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
<input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
<label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
<header class="md-header" data-md-component="header">
<nav class="md-header-nav md-grid">
<div class="md-flex">
<div class="md-flex__cell md-flex__cell--shrink">
<a href="../index.html" title="TMT Common Software (CSW)" class="md-header-nav__button md-logo">
<i class="md-icon">local_library</i>
</a>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
</div>
<div class="md-flex__cell md-flex__cell--stretch">
<div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
<span class="md-header-nav__topic">
TMT Common Software (CSW)
</span>
<span class="md-header-nav__topic">
Testing
</span>
</div>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
<label class="md-icon md-search__icon" for="__search"></label>
<button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">&#xE5CD;</button>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix>
<div class="md-search-result" data-md-component="result">
<div class="md-search-result__meta">
Type to start searching
</div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>

</div>
</div>
</nav>
</header>

<div class="md-container">
<main class="md-main">
<div class="md-main__inner md-grid" data-md-component="container">
<div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--primary" data-md-level="0" style="visibility: hidden">
<label class="md-nav__title md-nav__title--site" for="drawer">
<a href="../index.html" title="TMT Common Software (CSW)" class="md-nav__button md-logo">
<span class="md-nav__button md-logo">
<i class="md-icon">local_library</i>
</a>
<a href="../index.html" title="TMT Common Software (CSW)">
TMT Common Software (CSW)
</a>
</label>
<ul>
  <li><a href="../commons/getting-started.html" class="page">Getting Started</a></li>
  <li><a href="../commons/create-component.html" class="page">Creating a Component</a></li>
  <li><a href="../commons/multiple-components.html" class="page">Multiple Components</a></li>
  <li><a href="../commons/using-alarms.html" class="page">Using Alarms</a></li>
  <li><a href="../commons/unit-tests.html" class="page">Adding Unit Tests</a></li>
  <li><a href="../commons/params.html" class="page">Params</a>
  <ul>
    <li><a href="../params/keys-parameters.html" class="page">Keys and Parameters</a></li>
    <li><a href="../params/units.html" class="page">Units</a></li>
    <li><a href="../params/subsystem.html" class="page">Subsystem</a></li>
    <li><a href="../params/commands.html" class="page">Commands</a></li>
    <li><a href="../params/events.html" class="page">Events</a></li>
    <li><a href="../params/states.html" class="page">State Variables</a></li>
    <li><a href="../params/result.html" class="page">Result</a></li>
  </ul></li>
  <li><a href="../commons/framework.html" class="page">Framework for creating components (HCD, Assembly, Container)</a>
  <ul>
    <li><a href="../framework/describing-components.html" class="page">ComponentInfo</a></li>
    <li><a href="../framework/creating-components.html" class="page">Creating an Assembly or Hcd Component</a></li>
    <li><a href="../framework/handling-lifecycle.html" class="page">Component Handlers</a></li>
    <li><a href="../framework/managing-command-state.html" class="page">Managing Command State</a></li>
    <li><a href="../framework/tracking-connections.html" class="page">Tracking Connections</a></li>
    <li><a href="../framework/publishing-state.html" class="page">Publishing State</a></li>
    <li><a href="../framework/handling-exceptions.html" class="page">Handling Exceptions</a></li>
    <li><a href="../framework/deploying-components.html" class="page">Deploying Components</a></li>
  </ul></li>
  <li><a href="../commons/command.html" class="page">Communication using Commands</a></li>
  <li><a href="../commons/logging_aggregator.html" class="page">Logging Aggregator</a></li>
  <li><a href="../commons/services.html" class="page">Services</a>
  <ul>
    <li><a href="../services/location.html" class="page">Location Service</a></li>
    <li><a href="../services/config.html" class="page">Configuration Service</a></li>
    <li><a href="../services/logging.html" class="page">Logging Service</a></li>
    <li><a href="../services/event.html" class="page">Event Service</a></li>
    <li><a href="../services/alarm.html" class="page">Alarm Service</a></li>
    <li><a href="../services/time.html" class="page">Time Service</a></li>
    <li><a href="../services/database.html" class="page">Database Service</a></li>
    <li><a href="../services/aas.html" class="page">Authentication and Authorization Service (AAS)</a></li>
    <li><a href="../services/sequencer-command-service.html" class="page">Sequencer Command Service</a></li>
  </ul></li>
  <li><a href="../commons/apps.html" class="page">Applications</a>
  <ul>
    <li><a href="../apps/csinstallation.html" class="page">Coursier Installation</a></li>
    <li><a href="../apps/cswservices.html" class="page">csw-services</a></li>
    <li><a href="../apps/cswlocationserver.html" class="page">csw-location-server</a></li>
    <li><a href="../apps/cswlocationagent.html" class="page">csw-location-agent</a></li>
    <li><a href="../apps/cswonfigserverapp.html" class="page">csw-config-server</a></li>
    <li><a href="../apps/cswconfigcli.html" class="page">csw-config-cli</a></li>
    <li><a href="../apps/csweventcli.html" class="page">csw-event-cli</a></li>
    <li><a href="../apps/cswalarmcli.html" class="page">csw-alarm-cli</a></li>
    <li><a href="../apps/hostconfig.html" class="page">csw-host-config</a></li>
  </ul></li>
  <li><a href="../commons/deployment.html" class="page">Deployment</a>
  <ul>
    <li><a href="../deployment/env-vars.html" class="page">Environment variables</a></li>
    <li><a href="../deployment/network-topology.html" class="page">Network Topology</a></li>
  </ul></li>
  <li><a href="../commons/testing.html" class="active page">Testing</a></li>
  <li><a href="../commons/sbt-tasks.html" class="page">sbt Tasks</a></li>
  <li><a href="../commons/manuals.html" class="page">Manuals</a></li>
  <li><a href="../migration_guide/migration-guides.html" class="page">Migration Guides</a>
  <ul>
    <li><a href="../migration_guide/migration_guide_1.0.0_to_2.0.0/migration-guide-1.0.0-to-2.0.0.html" class="page">Migration Guide from 1.0.0 to 2.0.0</a></li>
    <li><a href="../migration_guide/migration_guide_2.0_to_3.0/migration-guide-2.0-to-3.0.html" class="page">Migration Guide from 2.0 to 3.0</a></li>
    <li><a href="../migration_guide/migration_guide_3.0.0_to_4.0.0/migration-guide-3.0.0-to-4.0.0.html" class="page">Migration Guide from 3.0.0 to 4.0.0</a></li>
    <li><a href="../migration_guide/migration_guide_4.0.0_to_5.0.0/migration-guide-4.0.0-to-5.0.0.html" class="page">Migration Guide from 4.0.0 to 5.0.0</a></li>
    <li><a href="../migration_guide/migration_guide_5.0.0_to_6.0.0/migration-guide-5.0.0-to-6.0.0.html" class="page">Migration Guide from 5.0.0 to 6.0.0</a></li>
  </ul></li>
  <li><a href="../commons/contract.html" class="page">CSW Service contract</a></li>
  <li><a href="../technical/technical.html" class="page">Technical Design Documents</a>
  <ul>
    <li><a href="../technical/framework/framework.html" class="page">Framework</a></li>
    <li><a href="../technical/command/command.html" class="page">Command</a></li>
    <li><a href="../technical/params/params.html" class="page">Params</a></li>
    <li><a href="../technical/units/adding-unit.html" class="page">Adding a new unit</a></li>
    <li><a href="../technical/location/location.html" class="page">Location Service</a></li>
    <li><a href="../technical/configuration/configuration.html" class="page">Configuration Service</a></li>
    <li><a href="../technical/logging/logging.html" class="page">Logging Service</a></li>
    <li><a href="../technical/event/event.html" class="page">Event Service</a></li>
    <li><a href="../technical/alarm/alarm.html" class="page">Alarm Service</a></li>
    <li><a href="../technical/time/time.html" class="page">Time Service</a></li>
    <li><a href="../technical/database/database.html" class="page">Database Service</a></li>
    <li><a href="../technical/aas/aas.html" class="page">Authentication and Authorization Service</a></li>
  </ul></li>
</ul>
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../commons/testing.html#testing" class="header">Testing</a>
  <ul>
    <li><a href="../commons/testing.html#dependencies" class="header">Dependencies</a></li>
    <li><a href="../commons/testing.html#introduction" class="header">Introduction</a></li>
    <li><a href="../commons/testing.html#testkits" class="header">TestKits</a></li>
    <li><a href="../commons/testing.html#spawning-a-hcd" class="header">Spawning a HCD</a></li>
    <li><a href="../commons/testing.html#spawning-an-assembly" class="header">Spawning an Assembly</a></li>
    <li><a href="../commons/testing.html#test-framework-integration" class="header">Test Framework Integration</a></li>
    <li><a href="../commons/testing.html#unit-tests" class="header">Unit Tests</a></li>
    <li><a href="../commons/testing.html#multi-jvm-tests" class="header">Multi-JVM Tests</a></li>
    <li><a href="../commons/testing.html#mockito" class="header">Mockito</a></li>
  </ul></li>
</ul>
</nav>

</nav>
<ul style="display: none">
<li class="md-nav__item md-version" id="project.version">
<label class="md-nav__link" for="__version">
<i class="md-icon" title="Version">label_outline</i> 6.0.0-M4
</label>
</li>
</ul>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../commons/testing.html#testing" class="header">Testing</a>
  <ul>
    <li><a href="../commons/testing.html#dependencies" class="header">Dependencies</a></li>
    <li><a href="../commons/testing.html#introduction" class="header">Introduction</a></li>
    <li><a href="../commons/testing.html#testkits" class="header">TestKits</a></li>
    <li><a href="../commons/testing.html#spawning-a-hcd" class="header">Spawning a HCD</a></li>
    <li><a href="../commons/testing.html#spawning-an-assembly" class="header">Spawning an Assembly</a></li>
    <li><a href="../commons/testing.html#test-framework-integration" class="header">Test Framework Integration</a></li>
    <li><a href="../commons/testing.html#unit-tests" class="header">Unit Tests</a></li>
    <li><a href="../commons/testing.html#multi-jvm-tests" class="header">Multi-JVM Tests</a></li>
    <li><a href="../commons/testing.html#mockito" class="header">Mockito</a></li>
  </ul></li>
</ul>
</nav>

</div>
</div>
</div>
<div class="md-content">
<article class="md-content__inner md-typeset">
<div class="md-content__searchable">
<h1><a href="#testing" name="testing" class="anchor"><span class="anchor-link"></span></a>Testing</h1>
<h2><a href="#dependencies" name="dependencies" class="anchor"><span class="anchor-link"></span></a>Dependencies</h2>
<p>To use the CSW Testkit, you must add the following dependency in your project:</p>
<dl>
  <dt>sbt</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">libraryDependencies += &quot;com.github.tmtsoftware.csw&quot; %% &quot;csw-testkit&quot; % &quot;6.0.0-M4&quot;
</code></pre></dd>
</dl>
<h2><a href="#introduction" name="introduction" class="anchor"><span class="anchor-link"></span></a>Introduction</h2>
<p>CSW comes with a dedicated <code>csw-testkit</code> module for supporting tests. This module includes following multiple individual testkits:</p>
<ul>
  <li><code>LocationTestKit</code> : starts and stops the Location Server</li>
  <li><code>ConfigTestKit</code> : starts and stops the Config Server</li>
  <li><code>EventTestKit</code> : starts and stops the Event Service (Note : This uses <code>embedded-redis</code> to start redis sentinel and master)</li>
  <li><code>AlarmTestKit</code> : starts and stops the Alarm Service (Note : This uses <code>embedded-redis</code> to start redis sentinel and master)</li>
  <li><code>DatabaseTestKit</code> : starts and stops the Database Service (Note : This uses <code>embedded postgres</code>)</li>
  <li><code>FrameworkTestKit</code> : in most of the cases, you will end up using this testkit. <code>FrameworkTestKit</code> is created by composing all the above mentioned testkits. Hence, it supports starting and stopping all provided CSW services.</li>
</ul><div class="callout note "><div class="callout-title">Note</div>
<p>All the testkits require the Location Server to be up and running. Hence, the first thing all testkits do is to start a Location Server. You do not need to start it explicitly.</p></div>
<h2><a href="#testkits" name="testkits" class="anchor"><span class="anchor-link"></span></a>TestKits</h2>
<p>When you really want granular level access to testkits, then only you would want to use <code>LocationTestKit</code>|<code>ConfigTestKit</code>|<code>EventTestKit</code>|<code>AlarmTestKit</code>|<code>DatabaseTestKit</code>|<code>FrameworkTestKit</code> directly. You can create instance of <code>FrameworkTestKit</code> as shown below:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/test/scala/example/teskit/TestKitsExample.scala#L31-L38" target="_blank" title="Go to snippet source">source</a><code class="language-scala">// create instance of framework testkit
private val frameworkTestKit = FrameworkTestKit()

// starts Config Server and Event Service
override protected def beforeAll(): Unit = frameworkTestKit.start(ConfigServer, EventServer)

// stops all services started by this testkit
override protected def afterAll(): Unit = frameworkTestKit.shutdown()</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/test/java/example/testkit/JTestKitsExample.java#L33-L43" target="_blank" title="Go to snippet source">source</a><code class="language-java">private static final FrameworkTestKit frameworkTestKit = FrameworkTestKit.create();

@BeforeClass
public static void beforeAll() {
    frameworkTestKit.start(JCSWService.ConfigServer, JCSWService.EventServer);
}

@AfterClass
public static void afterAll() {
    frameworkTestKit.shutdown();
}</code></pre></dd>
</dl><div class="callout note "><div class="callout-title">Note</div>
<p>Similarly, you can use other testkits. Please refer to API docs for more details.</p></div>
<h3><a href="#enabling-logging" name="enabling-logging" class="anchor"><span class="anchor-link"></span></a>Enabling Logging</h3>
<p>You can enable logging service using <code>LoggingSystemFactory.forTestingOnly()</code> factory. This is useful for debugging purpose. It logs messages to console.</p>
<pre class="prettyprint"><code class="language-scala">import csw.logging.client.scaladsl.LoggingSystemFactory

// make sure you have implicit actor system in scope or provide it explicitly
LoggingSystemFactory.forTestingOnly()
</code></pre>
<h3><a href="#spawning-components" name="spawning-components" class="anchor"><span class="anchor-link"></span></a>Spawning components</h3>
<p><code>FrameworkTestKit</code> provides an easy way to spawn components in <code>Container</code> or <code>Standalone</code> mode. Use the <code>spawnContainer</code> method provided by <code>FrameworkTestKit</code> to start components in container mode and<code>spawnStandalone</code> method to start a component in standalone mode.</p>
<p>The example below shows how to spawn container or component in standalone mode using the Framework testkit.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/test/scala/example/teskit/TestKitsExample.scala#L45-L52" target="_blank" title="Go to snippet source">source</a><code class="language-scala"><br/>// starting container from container config using testkit
frameworkTestKit.spawnContainer(ConfigFactory.load(&quot;SampleContainer.conf&quot;))

// starting standalone component from config using testkit
// val componentRef: ActorRef[ComponentMessage] =
//   frameworkTestKit.spawnStandaloneComponent(ConfigFactory.load(&quot;SampleHcdStandalone.conf&quot;))
</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/test/java/example/testkit/JTestKitsExample.java#L53-L60" target="_blank" title="Go to snippet source">source</a><code class="language-java"><br/>// starting container from container config using testkit
frameworkTestKit.spawnContainer(ConfigFactory.load(&quot;JSampleContainer.conf&quot;));

// starting standalone component from config using testkit
// ActorRef&lt;ComponentMessage&gt; componentRef =
//      frameworkTestKit.spawnStandaloneComponent(ConfigFactory.load(&quot;SampleHcdStandalone.conf&quot;));
</code></pre></dd>
</dl>
<p>Other ways to spawn Assembly and HCD in the standalone mode using Framework testkit.</p>
<h2><a href="#spawning-a-hcd" name="spawning-a-hcd" class="anchor"><span class="anchor-link"></span></a>Spawning a HCD</h2>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/test/scala/example/teskit/TestKitsExample.scala#L71" target="_blank" title="Go to snippet source">source</a><code class="language-scala">frameworkTestKit.spawnHCD(Prefix(&quot;TCS.sampleHcd&quot;), (ctx, cswCtx) =&gt; new SampleHcdHandlers(ctx, cswCtx))</code></pre></dd>
</dl>
<h2><a href="#spawning-an-assembly" name="spawning-an-assembly" class="anchor"><span class="anchor-link"></span></a>Spawning an Assembly</h2>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/test/scala/example/teskit/TestKitsExample.scala#L63" target="_blank" title="Go to snippet source">source</a><code class="language-scala">frameworkTestKit.spawnAssembly(Prefix(&quot;TCS.sampleAssembly&quot;), (ctx, cswCtx) =&gt; new SampleHandlers(ctx, cswCtx))</code></pre></dd>
</dl>
<p>Full source at GitHub</p>
<ul>
  <li><a href="https://github.com/tmtsoftware/csw/blob/v6.0.0-M4/examples/src/test/scala/example/teskit/TestKitsExample.scala">Scala</a></li>
  <li><a href="https://github.com/tmtsoftware/csw/blob/v6.0.0-M4/examples/src/test/java/example/testkit/JTestKitsExample.java">Java</a></li>
</ul>
<h2><a href="#test-framework-integration" name="test-framework-integration" class="anchor"><span class="anchor-link"></span></a>Test Framework Integration</h2>
<h3><a href="#scalatest" name="scalatest" class="anchor"><span class="anchor-link"></span></a>ScalaTest</h3>
<p>If you are using ScalaTest, then you can extend <code>csw.testkit.scaladsl.ScalaTestFrameworkTestKit</code> to have the Framework testkit automatically start the provided services before running tests and shut them down when the tests are complete. This is done in <code>beforeAll</code> and <code>afterAll</code> from the <code>BeforeAndAfterAll</code> trait. If you override that method you should call <code>super.beforeAll</code> to start services and <code>super.afterAll</code> to shutdown the test kit.</p>
<h3><a href="#junit" name="junit" class="anchor"><span class="anchor-link"></span></a>JUnit</h3>
<p>If you are using JUnit then you can use <code>csw.testkit.javadsl.FrameworkTestKitJunitResource</code> to have the framework test kit automatically start the provided services before running tests and shut them down when the tests are complete.</p>
<h3><a href="#supported-csw-services-by-frameworktestkit" name="supported-csw-services-by-frameworktestkit" class="anchor"><span class="anchor-link"></span></a>Supported CSW Services by FrameworkTestKit</h3>
<p><code>ScalaTestFrameworkTestKit</code> and <code>FrameworkTestKitJunitResource</code> both support starting one or more of the following services.</p>
<table>
  <thead>
    <tr>
      <th>Scala </th>
      <th>Java </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>CSWService.LocationServer </td>
      <td>JCSWService.LocationServer </td>
    </tr>
    <tr>
      <td>CSWService.ConfigServer </td>
      <td>JCSWService.ConfigServer </td>
    </tr>
    <tr>
      <td>CSWService.EventServer </td>
      <td>JCSWService.EventServer </td>
    </tr>
    <tr>
      <td>CSWService.AlarmServer </td>
      <td>JCSWService.AlarmServer </td>
    </tr>
    <tr>
      <td>CSWService.DatabaseServer </td>
      <td>JCSWService.DatabaseServer </td>
    </tr>
  </tbody>
</table>
<p>The example below shows the usage of <code>ScalaTestFrameworkTestKit</code> and <code>FrameworkTestKitJunitResource</code> and how you can start the above mentioned services as per your need.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/test/scala/example/teskit/ScalaTestIntegrationExample.scala#L9-L22" target="_blank" title="Go to snippet source">source</a><code class="language-scala">import com.typesafe.config.ConfigFactory
import csw.testkit.scaladsl.CSWService.{AlarmServer, EventServer}
import csw.testkit.scaladsl.ScalaTestFrameworkTestKit
import org.scalatest.funsuite.AnyFunSuiteLike

class ScalaTestIntegrationExample extends ScalaTestFrameworkTestKit(AlarmServer, EventServer) with AnyFunSuiteLike {

  test(&quot;test spawning component in standalone mode&quot;) {
    spawnStandalone(ConfigFactory.load(&quot;SampleHcdStandalone.conf&quot;))

    // .. assertions etc.

  }
}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/test/java/example/testkit/JUnitIntegrationExample.java#L9-L30" target="_blank" title="Go to snippet source">source</a><code class="language-java"><br/>import com.typesafe.config.ConfigFactory;
import csw.testkit.javadsl.FrameworkTestKitJunitResource;
import csw.testkit.javadsl.JCSWService;
import org.junit.ClassRule;
import org.junit.Test;

import java.util.Arrays;

public class JUnitIntegrationExample {

    @ClassRule
    public static final FrameworkTestKitJunitResource testKit =
            new FrameworkTestKitJunitResource(Arrays.asList(JCSWService.AlarmServer, JCSWService.EventServer));

    @Test
    public void testSpawningComponentInStandaloneMode() {
        testKit.spawnStandalone(ConfigFactory.load(&quot;JSampleHcdStandalone.conf&quot;));

        // ... assertions etc.
    }
}</code></pre></dd>
</dl><div class="callout note "><div class="callout-title">Note</div>
<p>You do not need to externally start any services like the Event Service, Config Service, Location Service etc. via <code>csw-services</code> application. Testkits will start required services as a part of initialization. For the Event and Alarm service, it uses an instance of <code>embedded-redis</code>.</p></div>
<h3><a href="#initializing-alarms-getting-severity-of-alarms" name="initializing-alarms-getting-severity-of-alarms" class="anchor"><span class="anchor-link"></span></a>Initializing alarms &amp; getting severity of alarms</h3>
<p>To use alarms in your tests, the list of available alarms must be defined prior to starting the Alarm Service. This will create alarms in the Alarm Store, and then the alarm severities can be set individually.<br/>See the <a href="../services/alarm.html">Alarm Service Documentation</a> for more information on the alarm configuration file.</p>
<p>The <code>AlarmTestKit</code> provides methods to initialize the alarm store, as well as get the current severity of an alarm for testing purposes.</p>
<p>The example below shows the usage <code>initAlarms</code> &amp; <code>getCurrentSeverity</code> methods using <code>AlarmTestKit</code>.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/test/scala/example/teskit/ScalaAlarmTestKitExample.scala#L17-L29" target="_blank" title="Go to snippet source">source</a><code class="language-scala">class ScalaAlarmTestKitExample extends ScalaTestFrameworkTestKit(AlarmServer) with AnyFunSuiteLike {
  import frameworkTestKit.alarmTestKit._
  test(&quot;test initializing alarms via config&quot;) {
    initAlarms(ConfigFactory.parseResources(&quot;valid-alarms.conf&quot;))

    // .. assertions etc.
  }

  test(&quot;use getCurrentSeverity to fetch severity of initialized alarms&quot;) {
    val severity = getCurrentSeverity(AlarmKey(Prefix(NFIRAOS, &quot;trombone&quot;), &quot;tromboneAxisLowLimitAlarm&quot;))
    // .. assertions etc.
  }
}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/test/java/example/testkit/JUnitAlarmTestKitExample.java#L22-L40" target="_blank" title="Go to snippet source">source</a><code class="language-java">class JUnitAlarmTestKitExample {

    @ClassRule
    public static final FrameworkTestKitJunitResource testKit =
            new FrameworkTestKitJunitResource(Arrays.asList(JCSWService.AlarmServer));
    private AlarmTestKit alarmTestKit = testKit.frameworkTestKit().alarmTestKit();

    @Test
    public void testInitAlarms() {
        alarmTestKit.initAlarms(ConfigFactory.load(&quot;valid-alarms.conf&quot;), true);
        // ... assertions etc.
    }
    @Test
    public void useGetCurrentSeverityToFetchSeverityOfInitializedAlarms() {
        Key.AlarmKey key = new Key.AlarmKey(new Prefix(JSubsystem.NFIRAOS, &quot;trombone&quot;),&quot;tromboneAxisLowLimitAlarm&quot;);
        FullAlarmSeverity alarmSeverity = alarmTestKit.getCurrentSeverity(key);
        // ... assertions etc.
    }
}</code></pre></dd>
</dl>
<h3><a href="#using-dslcontext-provided-by-databasetestkit" name="using-dslcontext-provided-by-databasetestkit" class="anchor"><span class="anchor-link"></span></a>Using dslContext provided by DatabaseTestKit</h3>
<p><code>DatabaseTestKit</code> starts embedded postgres with default database, user and password. You can override these defaults by adding custom configurations. For more details refer <a href="../services/database.html">Database Service Documentation</a></p>
<p>The <code>DatabaseTestKit</code> also provides methods to create database client and execute queries.</p>
<p>The example below shows the usage <code>dslContext</code> &amp; <code>databaseServiceFactory</code> methods using <code>DatabaseTestKit</code>.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/test/scala/example/teskit/ScalaDatabaseTestKitExample.scala#L17-L30" target="_blank" title="Go to snippet source">source</a><code class="language-scala">class ScalaDatabaseTestKitExample extends ScalaTestFrameworkTestKit(DatabaseServer) with AnyFunSuiteLike {
  import frameworkTestKit.databaseTestKit.*

  test(&quot;test using dsl context&quot;) {
    val queryDsl = dslContext()
    // .. queries, assertions etc.
  }

  test(&quot;test using database service factory&quot;) {
    // Usage of Await.result is fine in test scope here, as `databaseServiceFactory().makeDsl()` returns Future.
    val queryDsl = Await.result(databaseServiceFactory().makeDsl(frameworkTestKit.locationService, &quot;postgres&quot;), 2.seconds)
    // .. queries, assertions etc.
  }
}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/test/java/example/testkit/JUnitDatabaseTestKitExample.java#L22-L40" target="_blank" title="Go to snippet source">source</a><code class="language-java">class JUnitDatabaseTestKitExample {

    @ClassRule
    public static final FrameworkTestKitJunitResource testKit =
            new FrameworkTestKitJunitResource(Arrays.asList(JCSWService.DatabaseServer));
    private DatabaseTestKit databaseTestKit = testKit.frameworkTestKit().databaseTestKit();

    @Test
    public void testUsingDslContext() {
        DSLContext queryDsl = databaseTestKit.dslContext(&quot;postgres&quot;);
        // ... queries, assertions etc.
    }

    @Test
    public void testUsingDatabaseServiceFactory() throws ExecutionException, InterruptedException, TimeoutException {
        DSLContext queryDsl = databaseTestKit.databaseServiceFactory(&quot;postgres&quot;, &quot;postgres&quot;).jMakeDsl(testKit.jLocationService(), &quot;postgres&quot;).get(5, TimeUnit.SECONDS);
        // ... queries, assertions etc.
    }
}</code></pre></dd>
</dl>
<h2><a href="#unit-tests" name="unit-tests" class="anchor"><span class="anchor-link"></span></a>Unit Tests</h2>
<p>The goal of unit testing is to break your application into the smallest testable units and test them individually, isolating a specific piece of functionality and ensuring it is working correctly. It is always a good idea to write more unit test cases and relatively fewer component and integration tests. If you want to get an idea of how many tests you should have in different types of testing phases (Unit/Component/Integration), refer to this <a href="https://martinfowler.com/articles/practical-test-pyramid.html">blog</a></p>
<p>Unit testing simple Scala/Java classes or objects is straightforward. You can mock external dependencies using Mockito. Refer to the <a href="testing.html#mockito">Mockito</a> section for more details.</p>
<p>The following links provide guides for testing applications using different modules of Pekko:</p>
<ul>
  <li><a href="https://pekko.apache.org/docs/pekko/current/testing.html">Pekko Untyped Actors</a></li>
  <li><a href="https://pekko.apache.org/docs/pekko/current/typed/testing.html">Pekko Typed Actors</a></li>
  <li><a href="https://pekko.apache.org/docs/pekko/current/stream/stream-testkit.html?language=scala">Pekko Streams</a></li>
</ul>
<h2><a href="#multi-jvm-tests" name="multi-jvm-tests" class="anchor"><span class="anchor-link"></span></a>Multi-JVM Tests</h2>
<p>Testing asynchronous distributed systems requires special tooling/framework support. Sbt has a plugin called <a href="https://github.com/sbt/sbt-multi-jvm">sbt-multi-jvm</a> which helps to test systems across multiple JVMs or machines. This is especially useful for integration testing where multiple systems communicate with each other.</p>
<p>You can find more details on multi-JVM tests <a href="https://pekko.apache.org/docs/pekko/current/multi-jvm-testing.html">here</a>.</p>
<p>You can also refer to some examples in <a href="https://github.com/tmtsoftware/csw">CSW</a> for writing your own multi-JVM tests. For example: <a href="https://github.com/tmtsoftware/csw/blob/v6.0.0-M4/integration/src/multi-jvm/scala/csw/framework/command/CommandServiceTest.scala">CommandServiceTest.scala</a> </p>
<p>In case you want to run your multi-JVM tests across machines, refer to this multi-node testing guide <a href="https://pekko.apache.org/docs/pekko/current/multi-node-testing.html">here</a>.</p>
<h2><a href="#mockito" name="mockito" class="anchor"><span class="anchor-link"></span></a>Mockito</h2>
<p>Mocks are used so that unit tests can be written independent of dependencies.<br/><a href="https://github.com/tmtsoftware/csw">CSW</a> uses <a href="https://site.mockito.org/">Mockito</a> for writing unit tests. ScalaTest comes with the <a href="https://www.scalatest.org/plus/mockito">MockitoSugar</a> trait which provides some basic syntax sugar for Mockito.</p>
<p>For example: <a href="https://github.com/tmtsoftware/csw/blob/v6.0.0-M4/csw-framework/src/test/scala/csw/framework/internal/container/ContainerBehaviorTest.scala">ContainerBehaviorTest.scala</a></p>
</div>
<div>
<a href="https://github.com/tmtsoftware/csw/tree/master/docs/src/main/commons/testing.md" title="Edit this page" class="md-source-file md-edit">
Edit this page
</a>
</div>
<div class="print-only">
<span class="md-source-file md-version">
6.0.0-M4
</span>
</div>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-nav">
<nav class="md-footer-nav__inner md-grid">
<a href="../deployment/network-topology.html" title="Network Topology" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
</div>
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Previous
</span>
Network Topology
</span>
</div>
</a>
<a href="../commons/sbt-tasks.html" title="sbt Tasks" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Next
</span>
sbt Tasks
</span>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
</div>
</a>
</nav>
</div>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
Powered by
<a href="https://github.com/lightbend/paradox">Paradox</a>
and
<a href="https://jonas.github.io/paradox-material-theme/">Paradox Material Theme</a>

</div>
</div>
</div>
</footer>

</div>
<script src="../assets/javascripts/application.583bbe55.js"></script>
<script src="../assets/javascripts/paradox-material-theme.js"></script>
<script>app.initialize({version:"0.17",url:{base:"../."}})</script>
<script type="text/javascript" src="../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function(event) {
window.prettyPrint && prettyPrint();
});
</script>
</body>
</html>
