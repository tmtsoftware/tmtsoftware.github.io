<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="description" content="docs">
<meta name="generator" content="Paradox, paradox-material-theme=0.7.0, mkdocs-material=3.0.3">

<meta name="lang:clipboard.copy" content="Copy to clipboard">
<meta name="lang:clipboard.copied" content="Copied to clipboard">
<meta name="lang:search.language" content="">
<meta name="lang:search.pipeline.stopwords" content="true">
<meta name="lang:search.pipeline.trimmer" content="true">
<meta name="lang:search.result.none" content="No matching documents">
<meta name="lang:search.result.one" content="1 matching document">
<meta name="lang:search.result.other" content="# matching documents">
<meta name="lang:search.tokenizer" content="[\s\-]+">


<meta name="description" content="docs">
<link rel="shortcut icon" href="../assets/images/favicon.png">
<title>Configuration Service Â· TMT Common Software (CSW)</title>
<link rel="stylesheet" href="../assets/stylesheets/application.451f80e5.css">
<link rel="stylesheet" href="../lib/material__tabs/dist/mdc.tabs.min.css">
<link rel="stylesheet" href="../lib/prettify/prettify.css">
<script src="../assets/javascripts/modernizr.1aa3b519.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
<style>
body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}
code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}
</style>
<link rel="stylesheet" href="../assets/fonts/font-awesome.css">
<link rel="stylesheet" href="../assets/fonts/material-icons.css">
<link rel="stylesheet" href="../assets/stylesheets/paradox-material-theme.css">
</head>
<body
>
<input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
<input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
<label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
<header class="md-header" data-md-component="header">
<nav class="md-header-nav md-grid">
<div class="md-flex">
<div class="md-flex__cell md-flex__cell--shrink">
<a href="../index.html" title="TMT Common Software (CSW)" class="md-header-nav__button md-logo">
<i class="md-icon">local_library</i>
</a>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
</div>
<div class="md-flex__cell md-flex__cell--stretch">
<div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
<span class="md-header-nav__topic">
TMT Common Software (CSW)
</span>
<span class="md-header-nav__topic">
Configuration Service
</span>
</div>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
<label class="md-icon md-search__icon" for="__search"></label>
<button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">&#xE5CD;</button>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix>
<div class="md-search-result" data-md-component="result">
<div class="md-search-result__meta">
Type to start searching
</div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>

</div>
</div>
</nav>
</header>

<div class="md-container">
<main class="md-main">
<div class="md-main__inner md-grid" data-md-component="container">
<div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--primary" data-md-level="0" style="visibility: hidden">
<label class="md-nav__title md-nav__title--site" for="drawer">
<a href="../index.html" title="TMT Common Software (CSW)" class="md-nav__button md-logo">
<span class="md-nav__button md-logo">
<i class="md-icon">local_library</i>
</a>
<a href="../index.html" title="TMT Common Software (CSW)">
TMT Common Software (CSW)
</a>
</label>
<ul>
  <li><a href="../commons/getting-started.html" class="page">Getting Started</a></li>
  <li><a href="../commons/create-component.html" class="page">Creating a Component</a></li>
  <li><a href="../commons/multiple-components.html" class="page">Multiple Components</a></li>
  <li><a href="../commons/using-alarms.html" class="page">Using Alarms</a></li>
  <li><a href="../commons/unit-tests.html" class="page">Adding Unit Tests</a></li>
  <li><a href="../commons/params.html" class="page">Params</a>
  <ul>
    <li><a href="../params/keys-parameters.html" class="page">Keys and Parameters</a></li>
    <li><a href="../params/units.html" class="page">Units</a></li>
    <li><a href="../params/subsystem.html" class="page">Subsystem</a></li>
    <li><a href="../params/commands.html" class="page">Commands</a></li>
    <li><a href="../params/events.html" class="page">Events</a></li>
    <li><a href="../params/states.html" class="page">State Variables</a></li>
    <li><a href="../params/result.html" class="page">Result</a></li>
  </ul></li>
  <li><a href="../commons/framework.html" class="page">Framework for creating components (HCD, Assembly, Container)</a>
  <ul>
    <li><a href="../framework/describing-components.html" class="page">ComponentInfo</a></li>
    <li><a href="../framework/creating-components.html" class="page">Creating an Assembly or Hcd Component</a></li>
    <li><a href="../framework/handling-lifecycle.html" class="page">Component Handlers</a></li>
    <li><a href="../framework/managing-command-state.html" class="page">Managing Command State</a></li>
    <li><a href="../framework/tracking-connections.html" class="page">Tracking Connections</a></li>
    <li><a href="../framework/publishing-state.html" class="page">Publishing State</a></li>
    <li><a href="../framework/handling-exceptions.html" class="page">Handling Exceptions</a></li>
    <li><a href="../framework/deploying-components.html" class="page">Deploying Components</a></li>
  </ul></li>
  <li><a href="../commons/command.html" class="page">Communication using Commands</a></li>
  <li><a href="../commons/logging_aggregator.html" class="page">Logging Aggregator</a></li>
  <li><a href="../commons/services.html" class="page">Services</a>
  <ul>
    <li><a href="../services/location.html" class="page">Location Service</a></li>
    <li><a href="../services/config.html" class="active page">Configuration Service</a></li>
    <li><a href="../services/logging.html" class="page">Logging Service</a></li>
    <li><a href="../services/event.html" class="page">Event Service</a></li>
    <li><a href="../services/alarm.html" class="page">Alarm Service</a></li>
    <li><a href="../services/time.html" class="page">Time Service</a></li>
    <li><a href="../services/database.html" class="page">Database Service</a></li>
    <li><a href="../services/aas.html" class="page">Authentication and Authorization Service (AAS)</a></li>
    <li><a href="../services/sequencer-command-service.html" class="page">Sequencer Command Service</a></li>
  </ul></li>
  <li><a href="../commons/apps.html" class="page">Applications</a>
  <ul>
    <li><a href="../apps/csinstallation.html" class="page">Coursier Installation</a></li>
    <li><a href="../apps/cswservices.html" class="page">csw-services</a></li>
    <li><a href="../apps/cswlocationserver.html" class="page">csw-location-server</a></li>
    <li><a href="../apps/cswlocationagent.html" class="page">csw-location-agent</a></li>
    <li><a href="../apps/cswonfigserverapp.html" class="page">csw-config-server</a></li>
    <li><a href="../apps/cswconfigcli.html" class="page">csw-config-cli</a></li>
    <li><a href="../apps/csweventcli.html" class="page">csw-event-cli</a></li>
    <li><a href="../apps/cswalarmcli.html" class="page">csw-alarm-cli</a></li>
    <li><a href="../apps/hostconfig.html" class="page">csw-host-config</a></li>
  </ul></li>
  <li><a href="../commons/deployment.html" class="page">Deployment</a>
  <ul>
    <li><a href="../deployment/env-vars.html" class="page">Environment variables</a></li>
    <li><a href="../deployment/network-topology.html" class="page">Network Topology</a></li>
  </ul></li>
  <li><a href="../commons/testing.html" class="page">Testing</a></li>
  <li><a href="../commons/sbt-tasks.html" class="page">sbt Tasks</a></li>
  <li><a href="../commons/manuals.html" class="page">Manuals</a></li>
  <li><a href="../migration_guide/migration-guides.html" class="page">Migration Guides</a>
  <ul>
    <li><a href="../migration_guide/migration_guide_1.0.0_to_2.0.0/migration-guide-1.0.0-to-2.0.0.html" class="page">Migration Guide from 1.0.0 to 2.0.0</a></li>
    <li><a href="../migration_guide/migration_guide_2.0_to_3.0/migration-guide-2.0-to-3.0.html" class="page">Migration Guide from 2.0 to 3.0</a></li>
    <li><a href="../migration_guide/migration_guide_3.0.0_to_4.0.0/migration-guide-3.0.0-to-4.0.0.html" class="page">Migration Guide from 3.0.0 to 4.0.0</a></li>
    <li><a href="../migration_guide/migration_guide_4.0.0_to_5.0.0/migration-guide-4.0.0-to-5.0.0.html" class="page">Migration Guide from 4.0.0 to 5.0.0</a></li>
    <li><a href="../migration_guide/migration_guide_5.0.0_to_6.0.0/migration-guide-5.0.0-to-6.0.0.html" class="page">Migration Guide from 5.0.0 to 6.0.0</a></li>
  </ul></li>
  <li><a href="../commons/contract.html" class="page">CSW Service contract</a></li>
  <li><a href="../technical/technical.html" class="page">Technical Design Documents</a>
  <ul>
    <li><a href="../technical/framework/framework.html" class="page">Framework</a></li>
    <li><a href="../technical/command/command.html" class="page">Command</a></li>
    <li><a href="../technical/params/params.html" class="page">Params</a></li>
    <li><a href="../technical/units/adding-unit.html" class="page">Adding a new unit</a></li>
    <li><a href="../technical/location/location.html" class="page">Location Service</a></li>
    <li><a href="../technical/configuration/configuration.html" class="page">Configuration Service</a></li>
    <li><a href="../technical/logging/logging.html" class="page">Logging Service</a></li>
    <li><a href="../technical/event/event.html" class="page">Event Service</a></li>
    <li><a href="../technical/alarm/alarm.html" class="page">Alarm Service</a></li>
    <li><a href="../technical/time/time.html" class="page">Time Service</a></li>
    <li><a href="../technical/database/database.html" class="page">Database Service</a></li>
    <li><a href="../technical/aas/aas.html" class="page">Authentication and Authorization Service</a></li>
  </ul></li>
</ul>
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../services/config.html#configuration-service" class="header">Configuration Service</a>
  <ul>
    <li><a href="../services/config.html#dependencies" class="header">Dependencies</a></li>
    <li><a href="../services/config.html#rules-and-checks" class="header">Rules and Checks</a></li>
    <li><a href="../services/config.html#model-classes" class="header">Model Classes</a></li>
    <li><a href="../services/config.html#api-flavors" class="header">API Flavors</a></li>
    <li><a href="../services/config.html#accessing-clientapi-and-adminapi" class="header">Accessing clientAPI and adminAPI</a></li>
    <li><a href="../services/config.html#exists" class="header">exists</a></li>
    <li><a href="../services/config.html#getactive" class="header">getActive</a></li>
    <li><a href="../services/config.html#create" class="header">create</a></li>
    <li><a href="../services/config.html#update" class="header">update</a></li>
    <li><a href="../services/config.html#delete" class="header">delete</a></li>
    <li><a href="../services/config.html#getbyid" class="header">getById</a></li>
    <li><a href="../services/config.html#getlatest" class="header">getLatest</a></li>
    <li><a href="../services/config.html#getbytime" class="header">getByTime</a></li>
    <li><a href="../services/config.html#list" class="header">list</a></li>
    <li><a href="../services/config.html#history" class="header">history</a></li>
    <li><a href="../services/config.html#managing-active-versions" class="header">Managing active versions</a></li>
    <li><a href="../services/config.html#getmetadata" class="header">getMetaData</a></li>
    <li><a href="../services/config.html#admin-protected-routes" class="header">Admin Protected Routes</a></li>
    <li><a href="../services/config.html#technical-description" class="header">Technical Description</a></li>
    <li><a href="../services/config.html#source-code-for-examples" class="header">Source code for examples</a></li>
  </ul></li>
</ul>
</nav>

</nav>
<ul style="display: none">
<li class="md-nav__item md-version" id="project.version">
<label class="md-nav__link" for="__version">
<i class="md-icon" title="Version">label_outline</i> 6.0.0-M4
</label>
</li>
</ul>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../services/config.html#configuration-service" class="header">Configuration Service</a>
  <ul>
    <li><a href="../services/config.html#dependencies" class="header">Dependencies</a></li>
    <li><a href="../services/config.html#rules-and-checks" class="header">Rules and Checks</a></li>
    <li><a href="../services/config.html#model-classes" class="header">Model Classes</a></li>
    <li><a href="../services/config.html#api-flavors" class="header">API Flavors</a></li>
    <li><a href="../services/config.html#accessing-clientapi-and-adminapi" class="header">Accessing clientAPI and adminAPI</a></li>
    <li><a href="../services/config.html#exists" class="header">exists</a></li>
    <li><a href="../services/config.html#getactive" class="header">getActive</a></li>
    <li><a href="../services/config.html#create" class="header">create</a></li>
    <li><a href="../services/config.html#update" class="header">update</a></li>
    <li><a href="../services/config.html#delete" class="header">delete</a></li>
    <li><a href="../services/config.html#getbyid" class="header">getById</a></li>
    <li><a href="../services/config.html#getlatest" class="header">getLatest</a></li>
    <li><a href="../services/config.html#getbytime" class="header">getByTime</a></li>
    <li><a href="../services/config.html#list" class="header">list</a></li>
    <li><a href="../services/config.html#history" class="header">history</a></li>
    <li><a href="../services/config.html#managing-active-versions" class="header">Managing active versions</a></li>
    <li><a href="../services/config.html#getmetadata" class="header">getMetaData</a></li>
    <li><a href="../services/config.html#admin-protected-routes" class="header">Admin Protected Routes</a></li>
    <li><a href="../services/config.html#technical-description" class="header">Technical Description</a></li>
    <li><a href="../services/config.html#source-code-for-examples" class="header">Source code for examples</a></li>
  </ul></li>
</ul>
</nav>

</div>
</div>
</div>
<div class="md-content">
<article class="md-content__inner md-typeset">
<div class="md-content__searchable">
<h1><a href="#configuration-service" name="configuration-service" class="anchor"><span class="anchor-link"></span></a>Configuration Service</h1>
<p>The Configuration Service provides a centralized persistent store for any configuration file used in the TMT Software System. All versions of configuration files are retained, providing a historical record of each configuration file.</p>
<p>Note that in order to use the APIs described here, the <a href="location.html">Location Service</a> (<a href="../apps/cswlocationserver.html">csw-location-server</a>) and <a href="../apps/cswonfigserverapp.html">Configuration Service Server</a> needs to be running somewhere in the local network and the necessary configuration, environment variables or system properties should be defined to point to the correct host and port number(s) for the Location Service nodes.</p>
<p>This service will be part of the observatory cluster and exposes Rest endpoints that can be accessed over HTTP. Component developers can use the <code>csw-config-client</code> library in their code. The library wraps the low level communication with Configuration Service Server and exposes simple to use methods to access and manage configuration files.</p>
<h2><a href="#dependencies" name="dependencies" class="anchor"><span class="anchor-link"></span></a>Dependencies</h2>
<p>To use the Configuration Service without using the framework, add this to your <code>build.sbt</code> file:</p>
<dl>
  <dt>sbt</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">libraryDependencies += &quot;com.github.tmtsoftware.csw&quot; %% &quot;csw-config-client&quot; % &quot;6.0.0-M4&quot;
</code></pre></dd>
</dl>
<h2><a href="#rules-and-checks" name="rules-and-checks" class="anchor"><span class="anchor-link"></span></a>Rules and Checks</h2>
<ul>
  <li>The config file path must not contain <code>!#&lt;&gt;$%&amp;&#39;@^``~+,;=</code> or <code>any whitespace character</code></li>
  <li>If the input file is &gt; 10MB or has lot of non ASCII characters, then for optimization, server will archive it in <code>annex</code> store.</li>
  <li>Large and binary files can be forced to go to the &lsquo;annex&rsquo; store by using a <code>annex=true</code> flag in the <code>create</code> operation.</li>
  <li>API functions accept date-time values in UTC timezone. (e.g. 2017-05-17T08:00:24.246Z)</li>
</ul>
<h2><a href="#model-classes" name="model-classes" class="anchor"><span class="anchor-link"></span></a>Model Classes</h2>
<ul>
  <li><strong>ConfigData</strong> : Represents the contents of the files being managed. It wraps a stream of ByteString.</li>
  <li><strong>ConfigFileInfo</strong> : Represents information about a config file stored in the Config Service.</li>
  <li><strong>ConfigFileRevision</strong> : Represents information about a specific version of a config file.</li>
  <li><strong>ConfigId</strong> : Represents an identifier associated with a revision of a configuration file, often generated by <code>create</code> or <code>update</code> methods.</li>
  <li><strong>ConfigMetadata</strong> : Represents metadata information about the Config Server.</li>
  <li><strong>FileType</strong> : Represents the type of storage for a configuration file. Currently two types are supported <code>Normal</code>(small, text files) and <code>Annex</code>(Large, Binary files).</li>
</ul>
<h2><a href="#api-flavors" name="api-flavors" class="anchor"><span class="anchor-link"></span></a>API Flavors</h2>
<p>The Configuration Service is used to provide the runtime settings for components. When a component is started, it will use a limited &ldquo;clientAPI&rdquo; to obtain the &ldquo;active&rdquo; configuration from the Configuration Service, and use those settings for its execution.</p>
<p>To change the active configuration, an administrative tool with access to the full &ldquo;admin API&rdquo; must be used. These tools would have the ability to create, delete, and update configurations, as well as retrieve past configurations and their history. Any time a new configuration is to be used by a component, the user must use one of these tools (via <a href="../apps/cswconfigcli.html">CLI</a>, perhaps) to set the active configuration for a component. Since a history of active configurations is maintained by the service, the settings of each component each time it is run can be retrieved, and the system configuration at any moment can be recreated.</p>
<p>Some of the methods provided by the admin API, the methods that change the Config Server content, are protected so that a record can be kept about who is making the modifications. This is done by using a token obtained from the Authentication and Authorization Service. See <a href="config.html#admin-protected-routes">Admin Protected Routes</a> for more information.</p>
<ul>
  <li><strong>clientAPI</strong> : Must be used in Assembly and HCD components. Available functions are: <code>{exists | getActive}</code></li>
  <li><strong>adminAPI</strong> : Full functionality exposed by Configuration Service Server is available with this API. Expected to be used administrators. Available functions are: <code>{create | update | getById | getLatest | getByTime | delete | list | history | historyActive | setActiveVersion | resetActiveVersion | getActiveVersion | getActiveByTime | getMetadata | exists | getActive}</code></li>
</ul>
<h2><a href="#accessing-clientapi-and-adminapi" name="accessing-clientapi-and-adminapi" class="anchor"><span class="anchor-link"></span></a>Accessing clientAPI and adminAPI</h2>
<p>The <code>ConfigClientFactory</code> exposes functions to get the clientAPI and adminAPI. Both the functions require the Location Service instance which is used to resolve the <code>ConfigServer</code>.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/test/scala/example/config/ConfigClientExample.scala#L43-L46" target="_blank" title="Go to snippet source">source</a><code class="language-scala">// config client API
val clientApi: ConfigClientService = ConfigClientFactory.clientApi(actorSystem, locationService)
// config admin API
val adminApi: ConfigService = ConfigClientFactory.adminApi(actorSystem, locationService, factory)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/test/java/example/config/JConfigClientExample.java#L52-L55" target="_blank" title="Go to snippet source">source</a><code class="language-java">//config client API
final IConfigClientService clientApi = JConfigClientFactory.clientApi(actorSystem, clientLocationService);
//config admin API
final IConfigService adminApi = JConfigClientFactory.adminApi(actorSystem, clientLocationService, mocks.factory());</code></pre></dd>
</dl><div class="callout note "><div class="callout-title">Note</div>
<p>Creating <code>adminAPI</code> requires instance of <code>TokenFactory</code>. <code>TokenFactory</code> has a <code>getToken</code> method which returns a raw access token string which is used by the config client to provide access to the Config Server. For more details, refer to bottom section on <a href="config.html#admin-protected-routes">Admin Protected Routes</a></p></div>
<h2><a href="#exists" name="exists" class="anchor"><span class="anchor-link"></span></a>exists</h2>
<p>This function checks if the file exists at specified path in the repository. It returns Future of a Boolean, whether the file exists or not.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/test/scala/example/config/ConfigClientExample.scala#L58-L67" target="_blank" title="Go to snippet source">source</a><code class="language-scala">// construct the path
val filePath = Paths.get(&quot;/tmt/trmobone/assembly/hcd.conf&quot;)

val doneF = async {
  // create file using admin API
  await(adminApi.create(filePath, ConfigData.fromString(defaultStrConf), annex = false, &quot;First commit&quot;))

  // check if file exists with config service
  val exists: Boolean = await(clientApi.exists(filePath))
  // exists returns true/false</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/test/java/example/config/JConfigClientExample.java#L75-L80" target="_blank" title="Go to snippet source">source</a><code class="language-java">Path filePath = Paths.get(&quot;/tmt/trmobone/assembly/hcd.conf&quot;);

// create file using admin API
adminApi.create(filePath, ConfigData.fromString(defaultStrConf), false, &quot;commit config file&quot;).get();

Boolean exists = clientApi.exists(filePath).get();</code></pre></dd>
</dl>
<h2><a href="#getactive" name="getactive" class="anchor"><span class="anchor-link"></span></a>getActive</h2>
<p>This function retrieves the currently active file for a given path from config service. It returns a Future of Option of ConfigData.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/test/scala/example/config/ConfigClientExample.scala#L53" target="_blank" title="Go to snippet source">source</a><code class="language-scala">val defaultStrConf: String = &quot;foo { bar { baz : 1234 } }&quot;
val doneF = async {
  // construct the path
  val filePath = Paths.get(&quot;/tmt/trmobone/assembly/hcd.conf&quot;)

  await(adminApi.create(filePath, ConfigData.fromString(defaultStrConf), annex = false, &quot;First commit&quot;))

  val activeFile: Option[ConfigData] = await(clientApi.getActive(filePath))
  // activeFile.get returns content of defaultStrConf</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/test/java/example/config/JConfigClientExample.java#L59" target="_blank" title="Go to snippet source">source</a><code class="language-java">final String defaultStrConf = &quot;foo { bar { baz : 1234 } }&quot;;
// construct the path
Path filePath = Paths.get(&quot;/tmt/trmobone/assembly/hcd.conf&quot;);

adminApi.create(filePath, ConfigData.fromString(defaultStrConf), false, &quot;First commit&quot;).get();

ConfigData activeFile = clientApi.getActive(filePath).get().orElseThrow();
String value = activeFile.toJConfigObject(actorSystem).get().getString(&quot;foo.bar.baz&quot;);
// value = 1234</code></pre></dd>
</dl>
<h2><a href="#create" name="create" class="anchor"><span class="anchor-link"></span></a>create</h2>
<p>Takes input ConfigData and creates the configuration in the repository at a specified path</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/test/scala/example/config/ConfigClientExample.scala#L94-L129" target="_blank" title="Go to snippet source">source</a><code class="language-scala">async {
  // construct ConfigData from String containing ASCII text
  val configString: String =
    &quot;&quot;&quot;
  // Name: ComponentType ConnectionType
  {
    name: lgsTromboneHCD
    type: Hcd
    connectionType: [pekko]
  }
  &quot;&quot;&quot;.stripMargin
  val config1: ConfigData = ConfigData.fromString(configString)

  // construct ConfigData from a local file containing binary data
  val srcFilePath         = ResourceReader.copyToTmp(&quot;/smallBinary.bin&quot;)
  val config2: ConfigData = ConfigData.fromPath(srcFilePath)

  // construct ConfigData from Array[Byte] by reading a local file
  val stream: InputStream    = getClass.getClassLoader.getResourceAsStream(&quot;smallBinary.bin&quot;)
  def byteArray: Array[Byte] = LazyList.continually(stream.read).takeWhile(_ != -1).map(_.toByte).toArray
  val config3                = ConfigData.fromBytes(byteArray)

  // store the config, at a specified path as normal text file
  val id1: ConfigId =
    await(adminApi.create(Paths.get(&quot;/hcd/trombone/overnight.conf&quot;), config1, annex = false, &quot;review done&quot;))

  // store the config, at a specified path as a binary file in annex store
  val id2: ConfigId =
    await(adminApi.create(Paths.get(&quot;/hcd/trombone/firmware.bin&quot;), config2, annex = true, &quot;smoke test done&quot;))

  // store the config, at a specified path as a binary file in annex store
  val id3: ConfigId =
    await(adminApi.create(Paths.get(&quot;/hcd/trombone/debug.bin&quot;), config3, annex = true, &quot;new file from vendor&quot;))
  // id1 returns ConfigId(1)
  // id2 returns ConfigId(3)
  // id3 returns ConfigId(5)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/test/java/example/config/JConfigClientExample.java#L105-L116" target="_blank" title="Go to snippet source">source</a><code class="language-java">//construct ConfigData from String containing ASCII text
String configString = &quot;axisName11111 = tromboneAxis\naxisName22222 = tromboneAxis2\naxisName3 = tromboneAxis3333&quot;;
ConfigData config1 = ConfigData.fromString(configString);

//construct ConfigData from a local file containing binary data
URI srcFilePath = getClass().getClassLoader().getResource(&quot;smallBinary.bin&quot;).toURI();
ConfigData config2 = ConfigData.fromPath(Paths.get(srcFilePath));

ConfigId id1 = adminApi.create(Paths.get(&quot;/hcd/trombone/overnight.conf&quot;), config1, false, &quot;review done&quot;).get();
ConfigId id2 = adminApi.create(Paths.get(&quot;/hcd/trombone/firmware.bin&quot;), config2, true, &quot;smoke test done&quot;).get();
//id1 = 1
//id2 = 3</code></pre></dd>
</dl>
<h2><a href="#update" name="update" class="anchor"><span class="anchor-link"></span></a>update</h2>
<p>Takes input ConfigData and overwrites the configuration specified in the repository</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/test/scala/example/config/ConfigClientExample.scala#L140-L146" target="_blank" title="Go to snippet source">source</a><code class="language-scala">val futU = async {
  val destPath = Paths.get(&quot;/hcd/trombone/debug.bin&quot;)
  val newId = await(
    adminApi
      .update(destPath, ConfigData.fromString(defaultStrConf), comment = &quot;debug statements&quot;)
  )
  // newId returns ConfigId(7)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/test/java/example/config/JConfigClientExample.java#L123-L125" target="_blank" title="Go to snippet source">source</a><code class="language-java">Path destPath = Paths.get(&quot;/hcd/trombone/overnight.conf&quot;);
ConfigId newId = adminApi.update(destPath, ConfigData.fromString(defaultStrConf), &quot;added debug statements&quot;).get();
//newId = 5</code></pre></dd>
</dl>
<h2><a href="#delete" name="delete" class="anchor"><span class="anchor-link"></span></a>delete</h2>
<p>Deletes a file located at specified path in the repository</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/test/scala/example/config/ConfigClientExample.scala#L154-L159" target="_blank" title="Go to snippet source">source</a><code class="language-scala">val futD = async {
  val unwantedFilePath = Paths.get(&quot;/hcd/trombone/debug.bin&quot;)
  await(adminApi.delete(unwantedFilePath, &quot;no longer needed&quot;))
  // validates the file is deleted
  val maybeConfigData = await(adminApi.getLatest(unwantedFilePath))
  // maybeConfigData returns None</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/test/java/example/config/JConfigClientExample.java#L131-L135" target="_blank" title="Go to snippet source">source</a><code class="language-java">Path unwantedFilePath = Paths.get(&quot;/hcd/trombone/overnight.conf&quot;);
adminApi.delete(unwantedFilePath, &quot;no longer needed&quot;).get();
Optional&lt;ConfigData&gt; expected = adminApi.getLatest(unwantedFilePath).get();
// expected = Optional.empty()
</code></pre></dd>
</dl>
<h2><a href="#getbyid" name="getbyid" class="anchor"><span class="anchor-link"></span></a>getById</h2>
<p>Returns the file at a given path and matching revision Id</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/test/scala/example/config/ConfigClientExample.scala#L168-L176" target="_blank" title="Go to snippet source">source</a><code class="language-scala">val doneF = async {
  // create a file using API first
  val filePath = Paths.get(&quot;/tmt/trmobone/assembly/hcd.conf&quot;)
  val id: ConfigId =
    await(adminApi.create(filePath, ConfigData.fromString(defaultStrConf), annex = false, &quot;First commit&quot;))

  // validate
  val actualData = await(adminApi.getById(filePath, id)).get
  // actualData returns defaultStrConf</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/test/java/example/config/JConfigClientExample.java#L144-L148" target="_blank" title="Go to snippet source">source</a><code class="language-java">Path filePath = Paths.get(&quot;/tmt/trombone/assembly/hcd.conf&quot;);
ConfigId id = adminApi.create(filePath, ConfigData.fromString(defaultStrConf), false, &quot;First commit&quot;).get();

ConfigData actualData = adminApi.getById(filePath, id).get().orElseThrow();
// actualData.toJStringF(actorSystem).get() = defaultStrConf</code></pre></dd>
</dl>
<h2><a href="#getlatest" name="getlatest" class="anchor"><span class="anchor-link"></span></a>getLatest</h2>
<p>Returns the latest version of the file stored at the given path.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/test/scala/example/config/ConfigClientExample.scala#L185-L197" target="_blank" title="Go to snippet source">source</a><code class="language-scala">val assertionF: Future[Assertion] = async {
  // create a file
  val filePath = Paths.get(&quot;/test.conf&quot;)
  await(adminApi.create(filePath, ConfigData.fromString(defaultStrConf), annex = false, &quot;initial configuration&quot;))

  // override the contents
  val newContent = &quot;I changed the contents!!!&quot;
  await(adminApi.update(filePath, ConfigData.fromString(newContent), &quot;changed!!&quot;))

  // get the latest file
  val newConfigData = await(adminApi.getLatest(filePath)).get
  // validate
  // newConfigData returns newContent</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/test/java/example/config/JConfigClientExample.java#L158-L169" target="_blank" title="Go to snippet source">source</a><code class="language-java">//create a file
Path filePath = Paths.get(&quot;/test.conf&quot;);
adminApi.create(filePath, ConfigData.fromString(defaultStrConf), false, &quot;initial configuration&quot;).get();

//override the contents
String newContent = &quot;I changed the contents!!!&quot;;
adminApi.update(filePath, ConfigData.fromString(newContent), &quot;changed!!&quot;).get();

//get the latest file
ConfigData newConfigData = adminApi.getLatest(filePath).get().orElseThrow();
String filePathContent = newConfigData.toJStringF(actorSystem).get();
//filePathContent = newContent</code></pre></dd>
</dl>
<h2><a href="#getbytime" name="getbytime" class="anchor"><span class="anchor-link"></span></a>getByTime</h2>
<p>Gets the file at the given path as it existed at a given time-instance. Note: </p>
<ul>
  <li>If time-instance is before the file was created, the initial version is returned.</li>
  <li>If time-instance is after the last change, the most recent version is returned.</li>
</ul>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/test/scala/example/config/ConfigClientExample.scala#L206-L220" target="_blank" title="Go to snippet source">source</a><code class="language-scala">val assertionF = async {
  val tInitial = Instant.MIN
  // create a file
  val filePath = Paths.get(&quot;/a/b/c/test.conf&quot;)
  await(adminApi.create(filePath, ConfigData.fromString(defaultStrConf), annex = false, &quot;initial configuration&quot;))

  // override the contents
  val newContent = &quot;I changed the contents!!!&quot;
  await(adminApi.update(filePath, ConfigData.fromString(newContent), &quot;changed!!&quot;))

  val initialData: ConfigData = await(adminApi.getByTime(filePath, tInitial)).get
  // initialData returns defaultStrConf

  val latestData = await(adminApi.getByTime(filePath, Instant.now())).get
  // latestData returns defaultStrConf</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/test/java/example/config/JConfigClientExample.java#L179-L192" target="_blank" title="Go to snippet source">source</a><code class="language-java">Instant tInitial = Instant.now();

//create a file
Path filePath = Paths.get(&quot;/test.conf&quot;);
adminApi.create(filePath, ConfigData.fromString(defaultStrConf), false, &quot;initial configuration&quot;).get();

//override the contents
String newContent = &quot;I changed the contents!!!&quot;;
adminApi.update(filePath, ConfigData.fromString(newContent), &quot;changed!!&quot;).get();

ConfigData initialData = adminApi.getByTime(filePath, tInitial).get().orElseThrow();
//initialData.toJStringF(actorSystem).get() = defaultStrConf
ConfigData latestData = adminApi.getByTime(filePath, Instant.now()).get().orElseThrow();
//latestData.toJStringF(actorSystem).get() = newContent</code></pre></dd>
</dl>
<h2><a href="#list" name="list" class="anchor"><span class="anchor-link"></span></a>list</h2>
<p>For a given FileType (Annex or Normal) and an optional pattern string, it will list all files whose path matches the given pattern. Some pattern examples are: &ldquo;/path/hcd/*.*&rdquo;, &ldquo;a/b/c/d.*&rdquo;, &ldquo;.*.conf&rdquo;, &ldquo;.*hcd.*&rdquo;</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/test/scala/example/config/ConfigClientExample.scala#L231-L267" target="_blank" title="Go to snippet source">source</a><code class="language-scala">// Here&#39;s a list of tuples containing FilePath and FileTyepe(Annex / Normal)
val paths: List[(Path, FileType)] = List[(Path, FileType)](
  (Paths.get(&quot;a/c/trombone.conf&quot;), Annex),
  (Paths.get(&quot;a/b/c/hcd/hcd.conf&quot;), Normal),
  (Paths.get(&quot;a/b/assembly/assembly1.fits&quot;), Annex),
  (Paths.get(&quot;a/b/c/assembly/assembly2.fits&quot;), Normal),
  (Paths.get(&quot;testing/test.conf&quot;), Normal)
)

// create config files at those paths
paths map { case (path, fileType) =&gt;
  val createF = async {
    await(
      adminApi.create(path, ConfigData.fromString(defaultStrConf), Annex == fileType, &quot;initial commit&quot;)
    )
  }
}

val responsesF = async {
  // retrieve list of all files;
  val allFilesF = await(adminApi.list()).map(info =&gt; info.path).toSet

  // retrieve list of files based on type;
  val allAnnexFilesF  = await(adminApi.list(Some(Annex))).map(info =&gt; info.path).toSet
  val allNormalFilesF = await(adminApi.list(Some(FileType.Normal))).map(info =&gt; info.path).toSet

  // retrieve list using pattern;
  val confFilesByPatternF = await(adminApi.list(None, Some(&quot;.*.conf&quot;))).map(info =&gt; info.path.toString).toSet

  // retrieve list using pattern and file type;
  val allNormalConfFilesF = await(adminApi.list(Some(FileType.Normal), Some(&quot;.*.conf&quot;))).map(info =&gt; info.path.toString).toSet

  val testConfF          = await(adminApi.list(Some(FileType.Normal), Some(&quot;test.*&quot;))).map(info =&gt; info.path.toString).toSet
  val allAnnexConfFilesF = await(adminApi.list(Some(Annex), Some(&quot;a/c.*&quot;))).map(info =&gt; info.path.toString).toSet</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/test/java/example/config/JConfigClientExample.java#L202-L222" target="_blank" title="Go to snippet source">source</a><code class="language-java">Path trombonePath = Paths.get(&quot;a/c/trombone.conf&quot;);
Path hcdPath = Paths.get(&quot;a/b/c/hcd/hcd.conf&quot;);
Path fits1Path = Paths.get(&quot;a/b/assembly/assembly1.fits&quot;);
Path fits2Path = Paths.get(&quot;a/b/c/assembly/assembly2.fits&quot;);
Path testConfPath = Paths.get(&quot;testing/test.conf&quot;);

String comment = &quot;initial commit&quot;;

//create files
ConfigId tromboneId = adminApi.create(trombonePath, ConfigData.fromString(defaultStrConf), true, comment).get();
ConfigId hcdId = adminApi.create(hcdPath, ConfigData.fromString(defaultStrConf), false, comment).get();
ConfigId fits1Id = adminApi.create(fits1Path, ConfigData.fromString(defaultStrConf), true, comment).get();
ConfigId fits2Id = adminApi.create(fits2Path, ConfigData.fromString(defaultStrConf), false, comment).get();
ConfigId testId = adminApi.create(testConfPath, ConfigData.fromString(defaultStrConf), true, comment).get();
//adminApi.list().get() = Set.of(tromboneId, hcdId, fits1Id, fits2Id, testId))
//adminApi.list(JFileType.Annex).get() = Set.of(tromboneId, fits1Id, testId)
//adminApi.list(JFileType.Normal).get() = Set.of(hcdId, fits2Id)
//adminApi.list(&quot;.*.conf&quot;).get() = Set.of(tromboneId, hcdId, testId)
//adminApi.list(JFileType.Annex, &quot;.*.conf&quot;).get() = Set.of(tromboneId, testId)
//adminApi.list(JFileType.Annex, &quot;a/c.*&quot;).get() = Set.of(tromboneId)
//adminApi.list(JFileType.Annex, &quot;test.*&quot;).get() = Set.of(testId)</code></pre></dd>
</dl>
<h2><a href="#history" name="history" class="anchor"><span class="anchor-link"></span></a>history</h2>
<p>Returns the history of revisions of the file at the given path for a range of period specified by <code>from</code> and <code>to</code>. The size of the list can be restricted using <code>maxResults</code>.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/test/scala/example/config/ConfigClientExample.scala#L294-L311" target="_blank" title="Go to snippet source">source</a><code class="language-scala">val assertionF = async {
  val filePath = Paths.get(&quot;/a/test.conf&quot;)
  val id0      = await(adminApi.create(filePath, ConfigData.fromString(defaultStrConf), annex = false, &quot;first commit&quot;))

  // override the contents twice
  val tBeginUpdate = Instant.now()
  val id1          = await(adminApi.update(filePath, ConfigData.fromString(&quot;changing contents&quot;), &quot;second commit&quot;))
  val id2          = await(adminApi.update(filePath, ConfigData.fromString(&quot;changing contents again&quot;), &quot;third commit&quot;))
  val tEndUpdate   = Instant.now()

  // full file history
  val fullHistory = await(adminApi.history(filePath))

  // drop initial revision and take only update revisions
  val revisionsBetweenF = await(adminApi.history(filePath, tBeginUpdate, tEndUpdate)).map(_.id)

  // take last two revisions
  val last2RevisionsF = await(adminApi.history(filePath, maxResults = 2)).map(_.id)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/test/java/example/config/JConfigClientExample.java#L250-L262" target="_blank" title="Go to snippet source">source</a><code class="language-java">Path filePath = Paths.get(&quot;/a/test.conf&quot;);
ConfigId id0 = adminApi.create(filePath, ConfigData.fromString(defaultStrConf), false, &quot;first commit&quot;).get();

//override the contents twice
Instant tBeginUpdate = Instant.now();
ConfigId id1 = adminApi.update(filePath, ConfigData.fromString(&quot;changing contents&quot;), &quot;second commit&quot;).get();
ConfigId id2 = adminApi.update(filePath, ConfigData.fromString(&quot;changing contents again&quot;), &quot;third commit&quot;).get();
Instant tEndUpdate = Instant.now();
//adminApi.history(filePath).get().stream().map(ConfigFileRevision::id) = List.of(id2, id1, id0)
//adminApi.history(filePath).get().stream().map(ConfigFileRevision::comment) = List.of(&quot;third commit&quot;, &quot;second commit&quot;, &quot;first commit&quot;)
//adminApi.history(filePath, tBeginUpdate, tEndUpdate).get() = List.of(id2, id1)
//adminApi.history(filePath, 2).get().stream().map(ConfigFileRevision::id) = List.of(id2, id1)
//full file history</code></pre></dd>
</dl>
<h2><a href="#managing-active-versions" name="managing-active-versions" class="anchor"><span class="anchor-link"></span></a>Managing active versions</h2>
<p>Following API functions are available to manage the active version of a config file. In its lifetime, a config file undergoes many revisions. An active version is a specific revision from a file&rsquo;s history and it is set by administrators. </p>
<ul>
  <li><strong>historyActive</strong> : Returns the history of active revisions of the file at the given path for a range of period specified by <code>from</code> and <code>to</code>. The size of the list can be restricted using <code>maxResults</code>.</li>
  <li><strong>setActiveVersion</strong> : Sets the &ldquo;active version&rdquo; to be the version provided for the file at the given path. If this method is never called in a config&rsquo;s lifetime, the active version will always be the version returned by <code>create</code> function.</li>
  <li><strong>resetActiveVersion</strong> : Resets the &ldquo;active version&rdquo; of the file at the given path to the latest version.</li>
  <li><strong>getActiveVersion</strong> : Returns the revision ID which represents the &ldquo;active version&rdquo; of the file at the given path.</li>
  <li><strong>getActiveByTime</strong> : Returns the content of active version of the file existed at given instant</li>
</ul>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/test/scala/example/config/ConfigClientExample.scala#L324-L366" target="_blank" title="Go to snippet source">source</a><code class="language-scala">val assertionF = async {
  val tBegin   = Instant.now()
  val filePath = Paths.get(&quot;/a/test.conf&quot;)
  // create will make the 1st revision active with a default comment
  val id1      = await(adminApi.create(filePath, ConfigData.fromString(defaultStrConf), annex = false, &quot;first&quot;))
  val activeId = await(adminApi.historyActive(filePath)).map(_.id)

  // ensure active version is set
  val activeVersionF = await(adminApi.getActiveVersion(filePath)).get

  // override the contents four times
  await(adminApi.update(filePath, ConfigData.fromString(&quot;changing contents&quot;), &quot;second&quot;))
  val id3 = await(adminApi.update(filePath, ConfigData.fromString(&quot;changing contents again&quot;), &quot;third&quot;))
  val id4 = await(adminApi.update(filePath, ConfigData.fromString(&quot;final contents&quot;), &quot;fourth&quot;))
  val id5 = await(adminApi.update(filePath, ConfigData.fromString(&quot;final final contents&quot;), &quot;fifth&quot;))

  // update doesn&#39;t change the active revision
  val idList = await(adminApi.historyActive(filePath)).map(_.id)
  // play with active version
  await(adminApi.setActiveVersion(filePath, id3, s&quot;$id3 active&quot;))
  await(adminApi.setActiveVersion(filePath, id4, s&quot;$id4 active&quot;))
  val id4F = await(adminApi.getActiveVersion(filePath)).get
  val tEnd = Instant.now()
  // reset active version to latest
  await(adminApi.resetActiveVersion(filePath, &quot;latest active&quot;))
  val id5F = await(adminApi.getActiveVersion(filePath)).get

  // finally set initial version as active
  await(adminApi.setActiveVersion(filePath, id1, s&quot;$id1 active&quot;))
  val id1F = await(adminApi.getActiveVersion(filePath)).get

  //  get full history
  val fullHistory = await(adminApi.historyActive(filePath))

  // drop initial revision and take only update revisions
  val fragmentedHistory = await(adminApi.historyActive(filePath, tBegin, tEnd))

  // take last three revisions
  val last3Revisions = await(adminApi.historyActive(filePath, maxResults = 3)).map(_.id)

  // get contents of active version at a specified instance
  val initialContents       = await(adminApi.getActiveByTime(filePath, tBegin)).get
  val initialContentsParseF = await(initialContents.toStringF(actorSystem))</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/test/java/example/config/JConfigClientExample.java#L282-L338" target="_blank" title="Go to snippet source">source</a><code class="language-java">Instant tBegin = Instant.now();
Path filePath = Paths.get(&quot;/a/test.conf&quot;);

//create will make the 1st revision active with a default comment
ConfigId id1 = adminApi.create(filePath, ConfigData.fromString(defaultStrConf), false, &quot;first commit&quot;).get();
//adminApi.historyActive(filePath).get() = List.of(id1)
List&lt;ConfigFileRevision&gt; configFileRevisions = adminApi.historyActive(filePath).get();
//configFileRevisions = List.of(id1)
//ensure active version is set
Optional&lt;ConfigId&gt; configId1 = adminApi.getActiveVersion(filePath).get();
//configId1 = id1

//override the contents four times
adminApi.update(filePath, ConfigData.fromString(&quot;changing contents&quot;), &quot;second&quot;).get();
ConfigId id3 = adminApi.update(filePath, ConfigData.fromString(&quot;changing contents again&quot;), &quot;third&quot;).get();
ConfigId id4 = adminApi.update(filePath, ConfigData.fromString(&quot;final contents&quot;), &quot;fourth&quot;).get();
ConfigId id5 = adminApi.update(filePath, ConfigData.fromString(&quot;final final contents&quot;), &quot;fifth&quot;).get();

//update doesn&#39;t change the active revision
Optional&lt;ConfigId&gt; configIdNow = adminApi.getActiveVersion(filePath).get();
//configIdNow = id1

//play with active version
adminApi.setActiveVersion(filePath, id3, &quot;id3 active&quot;).get();
adminApi.setActiveVersion(filePath, id4, &quot;id4 active&quot;).get();
Optional&lt;ConfigId&gt; configId4 = adminApi.getActiveVersion(filePath).get();

Instant tEnd = Instant.now();

//reset active version to latest
adminApi.resetActiveVersion(filePath, &quot;latest active&quot;).get();
Optional&lt;ConfigId&gt; configId5 = adminApi.getActiveVersion(filePath).get();
//configId5 = id5
//finally set initial version as active
adminApi.setActiveVersion(filePath, id1, &quot;id1 active&quot;).get();
Optional&lt;ConfigId&gt; configIdInitial = adminApi.getActiveVersion(filePath).get();
//configIdInitial = id1

//validate full history
List&lt;ConfigFileRevision&gt; fullHistory = adminApi.historyActive(filePath).get();
//fullHistory.stream().map(ConfigFileRevision::id) = List.of(id1, id5, id4, id3, id1)
//fullHistory.stream().map(ConfigFileRevision::comment) = List.of(&quot;id1 active&quot;, &quot;latest active&quot;, &quot;id4 active&quot;, &quot;id3 active&quot;,
//                &quot;initializing active file with the first version&quot;)


//drop initial revision and take only update revisions
List&lt;ConfigFileRevision&gt; fragmentedHistory = adminApi.historyActive(filePath, tBegin, tEnd).get();
//fragmentedHistory.size() = 3

//take last three revisions
CompletableFuture&lt;List&lt;ConfigFileRevision&gt;&gt; maxHistory = adminApi.historyActive(filePath, 3);
//maxHistory.get() = List.of(id1, id5, id4)


//get contents of active version at a specified instance
String initialContents = adminApi.getActiveByTime(filePath, tBegin).get().orElseThrow().toJStringF(actorSystem).get();
//initialContents = defaultStrConf</code></pre></dd>
</dl>
<h2><a href="#getmetadata" name="getmetadata" class="anchor"><span class="anchor-link"></span></a>getMetaData</h2>
<p>Used to get metadata information about the Config Service. It includes:</p>
<ul>
  <li>repository directory</li>
  <li>annex directory</li>
  <li>min annex file size</li>
  <li>max config file size</li>
</ul>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/test/scala/example/config/ConfigClientExample.scala#L392-L394" target="_blank" title="Go to snippet source">source</a><code class="language-scala">val assertF = async {
  val metaData: ConfigMetadata = await(adminApi.getMetadata)
  //  metaData.repoPath returns repository path</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/test/java/example/config/JConfigClientExample.java#L361-L363" target="_blank" title="Go to snippet source">source</a><code class="language-java">ConfigMetadata metadata = adminApi.getMetadata().get();
//repository path must not be empty
//metadata.repoPath() != &quot;&quot;</code></pre></dd>
</dl>
<h2><a href="#admin-protected-routes" name="admin-protected-routes" class="anchor"><span class="anchor-link"></span></a>Admin Protected Routes</h2>
<p>The following Config Server routes are <code>Admin Protected</code>. To use these routes, the user must be authenticated and authorized.</p>
<ul>
  <li>create</li>
  <li>update</li>
  <li>delete</li>
  <li>setActiveVersion</li>
  <li>resetActiveVersion</li>
</ul>
<p><code>csw-config-client</code> provides factory to create admin config service which allows access to these protected routes. This requires you to implement <a href="https://github.com/tmtsoftware/csw/blob/v6.0.0-M4/csw-config/csw-config-api/src/main/scala/csw/config/api/TokenFactory.scala">TokenFactory</a> interface. Currently <code>csw-config-cli</code> is the only user of config service admin api. Refer to <a href="https://github.com/tmtsoftware/csw/blob/v6.0.0-M4/csw-config/csw-config-cli/src/main/scala/csw/config/cli/CliTokenFactory.scala">CliTokenFactory</a> which implements <code>TokenFactory</code> interface.</p><div class="callout note "><div class="callout-title">Note</div>
<p>Refer to <a href="aas.html">csw-aas</a> docs to know more about how to authenticate and authorize with AAS and get an access token.</p></div>
<h2><a href="#technical-description" name="technical-description" class="anchor"><span class="anchor-link"></span></a>Technical Description</h2>
<p>See <a href="../technical/configuration/configuration.html">Configuration Service Technical Description</a>.</p>
<h2><a href="#source-code-for-examples" name="source-code-for-examples" class="anchor"><span class="anchor-link"></span></a>Source code for examples</h2>
<ul>
  <li><a href="https://github.com/tmtsoftware/csw/blob/v6.0.0-M4/examples/src/test/scala/example/config/ConfigClientExample.scala">Scala Example</a></li>
  <li><a href="https://github.com/tmtsoftware/csw/blob/v6.0.0-M4/examples/src/test/java/example/config/JConfigClientExample.java">Java Example</a></li>
</ul>
</div>
<div>
<a href="https://github.com/tmtsoftware/csw/tree/master/docs/src/main/services/config.md" title="Edit this page" class="md-source-file md-edit">
Edit this page
</a>
</div>
<div class="print-only">
<span class="md-source-file md-version">
6.0.0-M4
</span>
</div>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-nav">
<nav class="md-footer-nav__inner md-grid">
<a href="../services/location.html" title="Location Service" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
</div>
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Previous
</span>
Location Service
</span>
</div>
</a>
<a href="../services/logging.html" title="Logging Service" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Next
</span>
Logging Service
</span>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
</div>
</a>
</nav>
</div>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
Powered by
<a href="https://github.com/lightbend/paradox">Paradox</a>
and
<a href="https://jonas.github.io/paradox-material-theme/">Paradox Material Theme</a>

</div>
</div>
</div>
</footer>

</div>
<script src="../assets/javascripts/application.583bbe55.js"></script>
<script src="../assets/javascripts/paradox-material-theme.js"></script>
<script>app.initialize({version:"0.17",url:{base:"../."}})</script>
<script type="text/javascript" src="../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function(event) {
window.prettyPrint && prettyPrint();
});
</script>
</body>
</html>
