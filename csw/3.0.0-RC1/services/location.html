<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="description" content="docs">
<meta name="generator" content="Paradox, paradox-material-theme=0.7.0, mkdocs-material=3.0.3">

<meta name="lang:clipboard.copy" content="Copy to clipboard">
<meta name="lang:clipboard.copied" content="Copied to clipboard">
<meta name="lang:search.language" content="">
<meta name="lang:search.pipeline.stopwords" content="true">
<meta name="lang:search.pipeline.trimmer" content="true">
<meta name="lang:search.result.none" content="No matching documents">
<meta name="lang:search.result.one" content="1 matching document">
<meta name="lang:search.result.other" content="# matching documents">
<meta name="lang:search.tokenizer" content="[\s\-]+">


<meta name="description" content="docs">
<link rel="shortcut icon" href="../assets/images/favicon.png">
<title>Location Service · TMT Common Software (CSW)</title>
<link rel="stylesheet" href="../assets/stylesheets/application.451f80e5.css">
<link rel="stylesheet" href="../lib/material__tabs/dist/mdc.tabs.min.css">
<link rel="stylesheet" href="../lib/prettify/prettify.css">
<script src="../assets/javascripts/modernizr.1aa3b519.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
<style>
body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}
code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}
</style>
<link rel="stylesheet" href="../assets/fonts/font-awesome.css">
<link rel="stylesheet" href="../assets/fonts/material-icons.css">
<link rel="stylesheet" href="../assets/stylesheets/paradox-material-theme.css">
</head>
<body
>
<input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
<input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
<label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
<header class="md-header" data-md-component="header">
<nav class="md-header-nav md-grid">
<div class="md-flex">
<div class="md-flex__cell md-flex__cell--shrink">
<a href="../index.html" title="TMT Common Software (CSW)" class="md-header-nav__button md-logo">
<i class="md-icon">local_library</i>
</a>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
</div>
<div class="md-flex__cell md-flex__cell--stretch">
<div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
<span class="md-header-nav__topic">
TMT Common Software (CSW)
</span>
<span class="md-header-nav__topic">
Location Service
</span>
</div>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
<label class="md-icon md-search__icon" for="__search"></label>
<button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">&#xE5CD;</button>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix>
<div class="md-search-result" data-md-component="result">
<div class="md-search-result__meta">
Type to start searching
</div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>

</div>
</div>
</nav>
</header>

<div class="md-container">
<main class="md-main">
<div class="md-main__inner md-grid" data-md-component="container">
<div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--primary" data-md-level="0" style="visibility: hidden">
<label class="md-nav__title md-nav__title--site" for="drawer">
<a href="../index.html" title="TMT Common Software (CSW)" class="md-nav__button md-logo">
<span class="md-nav__button md-logo">
<i class="md-icon">local_library</i>
</a>
<a href="../index.html" title="TMT Common Software (CSW)">
TMT Common Software (CSW)
</a>
</label>
<ul>
  <li><a href="../commons/getting-started.html" class="page">Getting Started</a></li>
  <li><a href="../commons/create-component.html" class="page">Creating a Component</a></li>
  <li><a href="../commons/multiple-components.html" class="page">Multiple Components</a></li>
  <li><a href="../commons/using-alarms.html" class="page">Using Alarms</a></li>
  <li><a href="../commons/unit-tests.html" class="page">Adding Unit Tests</a></li>
  <li><a href="../commons/params.html" class="page">Params</a>
  <ul>
    <li><a href="../params/keys-parameters.html" class="page">Keys and Parameters</a></li>
    <li><a href="../params/units.html" class="page">Units</a></li>
    <li><a href="../params/subsystem.html" class="page">Subsystem</a></li>
    <li><a href="../params/commands.html" class="page">Commands</a></li>
    <li><a href="../params/events.html" class="page">Events</a></li>
    <li><a href="../params/states.html" class="page">State Variables</a></li>
    <li><a href="../params/result.html" class="page">Result</a></li>
  </ul></li>
  <li><a href="../commons/framework.html" class="page">Framework for creating components (HCD, Assembly, Container)</a>
  <ul>
    <li><a href="../framework/describing-components.html" class="page">ComponentInfo</a></li>
    <li><a href="../framework/creating-components.html" class="page">Creating an Assembly or Hcd Component</a></li>
    <li><a href="../framework/handling-lifecycle.html" class="page">Component Handlers</a></li>
    <li><a href="../framework/managing-command-state.html" class="page">Managing Command State</a></li>
    <li><a href="../framework/tracking-connections.html" class="page">Tracking Connections</a></li>
    <li><a href="../framework/publishing-state.html" class="page">Publishing State</a></li>
    <li><a href="../framework/handling-exceptions.html" class="page">Handling Exceptions</a></li>
    <li><a href="../framework/deploying-components.html" class="page">Deploying Components</a></li>
  </ul></li>
  <li><a href="../commons/command.html" class="page">Communication using Commands</a></li>
  <li><a href="../commons/logging_aggregator.html" class="page">Logging Aggregator</a></li>
  <li><a href="../commons/services.html" class="page">Services</a>
  <ul>
    <li><a href="../services/location.html" class="active page">Location Service</a></li>
    <li><a href="../services/config.html" class="page">Configuration Service</a></li>
    <li><a href="../services/logging.html" class="page">Logging Service</a></li>
    <li><a href="../services/event.html" class="page">Event Service</a></li>
    <li><a href="../services/alarm.html" class="page">Alarm Service</a></li>
    <li><a href="../services/time.html" class="page">Time Service</a></li>
    <li><a href="../services/database.html" class="page">Database Service</a></li>
    <li><a href="../services/aas.html" class="page">Authentication and Authorization Service (AAS)</a></li>
    <li><a href="../services/sequencer-command-service.html" class="page">Sequencer Command Service</a></li>
  </ul></li>
  <li><a href="../commons/apps.html" class="page">Applications</a>
  <ul>
    <li><a href="../apps/csinstallation.html" class="page">Coursier Installation</a></li>
    <li><a href="../apps/cswservices.html" class="page">csw-services</a></li>
    <li><a href="../apps/cswlocationserver.html" class="page">csw-location-server</a></li>
    <li><a href="../apps/cswlocationagent.html" class="page">csw-location-agent</a></li>
    <li><a href="../apps/cswonfigserverapp.html" class="page">csw-config-server</a></li>
    <li><a href="../apps/cswconfigcli.html" class="page">csw-config-cli</a></li>
    <li><a href="../apps/csweventcli.html" class="page">csw-event-cli</a></li>
    <li><a href="../apps/cswalarmcli.html" class="page">csw-alarm-cli</a></li>
    <li><a href="../apps/hostconfig.html" class="page">csw-host-config</a></li>
  </ul></li>
  <li><a href="../commons/deployment.html" class="page">Deployment</a>
  <ul>
    <li><a href="../deployment/env-vars.html" class="page">Environment variables</a></li>
    <li><a href="../deployment/network-topology.html" class="page">Network Topology</a></li>
  </ul></li>
  <li><a href="../commons/testing.html" class="page">Testing</a></li>
  <li><a href="../commons/sbt-tasks.html" class="page">sbt Tasks</a></li>
  <li><a href="../commons/manuals.html" class="page">Manuals</a></li>
  <li><a href="../migration_guide/migration-guides.html" class="page">Migration Guides</a>
  <ul>
    <li><a href="../migration_guide/migration_guide_1.0.0_to_2.0.0/migration-guide-1.0.0-to-2.0.0.html" class="page">Migration Guide from 1.0.0 to 2.0.0</a></li>
  </ul></li>
  <li><a href="../commons/contract.html" class="page">CSW Service contract</a></li>
  <li><a href="../technical/technical.html" class="page">Technical Design Documents</a>
  <ul>
    <li><a href="../technical/framework/framework.html" class="page">Framework</a></li>
    <li><a href="../technical/command/command.html" class="page">Command</a></li>
    <li><a href="../technical/params/params.html" class="page">Params</a></li>
    <li><a href="../technical/location/location.html" class="page">Location Service</a></li>
    <li><a href="../technical/configuration/configuration.html" class="page">Configuration Service</a></li>
    <li><a href="../technical/logging/logging.html" class="page">Logging Service</a></li>
    <li><a href="../technical/event/event.html" class="page">Event Service</a></li>
    <li><a href="../technical/alarm/alarm.html" class="page">Alarm Service</a></li>
    <li><a href="../technical/time/time.html" class="page">Time Service</a></li>
    <li><a href="../technical/database/database.html" class="page">Database Service</a></li>
    <li><a href="../technical/aas/aas.html" class="page">Authentication and Authorization Service</a></li>
  </ul></li>
</ul>
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../services/location.html#location-service" class="header">Location Service</a>
  <ul>
    <li><a href="../services/location.html#dependencies" class="header">Dependencies</a></li>
    <li><a href="../services/location.html#create-location-service" class="header">Create Location Service</a></li>
    <li><a href="../services/location.html#creating-components-connections-and-registrations" class="header">Creating Components, Connections and Registrations</a></li>
    <li><a href="../services/location.html#creating-actorref-for-registration" class="header">Creating ActorRef for Registration</a></li>
    <li><a href="../services/location.html#resolving-connections" class="header">Resolving Connections</a></li>
    <li><a href="../services/location.html#filtering" class="header">Filtering</a></li>
    <li><a href="../services/location.html#tracking-and-subscribing" class="header">Tracking and Subscribing</a></li>
    <li><a href="../services/location.html#unregistering" class="header">Unregistering</a></li>
    <li><a href="../services/location.html#protected-routes" class="header">Protected Routes</a></li>
    <li><a href="../services/location.html#technical-description" class="header">Technical Description</a></li>
    <li><a href="../services/location.html#source-code-for-examples" class="header">Source code for examples</a></li>
  </ul></li>
</ul>
</nav>

</nav>
<ul style="display: none">
<li class="md-nav__item md-version" id="project.version">
<label class="md-nav__link" for="__version">
<i class="md-icon" title="Version">label_outline</i> 3.0.0-RC1
</label>
</li>
</ul>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../services/location.html#location-service" class="header">Location Service</a>
  <ul>
    <li><a href="../services/location.html#dependencies" class="header">Dependencies</a></li>
    <li><a href="../services/location.html#create-location-service" class="header">Create Location Service</a></li>
    <li><a href="../services/location.html#creating-components-connections-and-registrations" class="header">Creating Components, Connections and Registrations</a></li>
    <li><a href="../services/location.html#creating-actorref-for-registration" class="header">Creating ActorRef for Registration</a></li>
    <li><a href="../services/location.html#resolving-connections" class="header">Resolving Connections</a></li>
    <li><a href="../services/location.html#filtering" class="header">Filtering</a></li>
    <li><a href="../services/location.html#tracking-and-subscribing" class="header">Tracking and Subscribing</a></li>
    <li><a href="../services/location.html#unregistering" class="header">Unregistering</a></li>
    <li><a href="../services/location.html#protected-routes" class="header">Protected Routes</a></li>
    <li><a href="../services/location.html#technical-description" class="header">Technical Description</a></li>
    <li><a href="../services/location.html#source-code-for-examples" class="header">Source code for examples</a></li>
  </ul></li>
</ul>
</nav>

</div>
</div>
</div>
<div class="md-content">
<article class="md-content__inner md-typeset">
<div class="md-content__searchable">
<h1><a href="#location-service" name="location-service" class="anchor"><span class="anchor-link"></span></a>Location Service</h1>
<p>The Location Service handles component (i.e., Applications, Sequencers, Assemblies, HCDs, and Services) registration and discovery in the distributed TMT software system.</p>
<p>The CSW Location Service cluster must be running, and appropriate environment variables set to run apps. See <a href="../apps/cswlocationserver.html">CSW Location Server</a>.</p>
<p>A component’s location information can be used by other components and services to connect to it and use it. An example of location information is:</p>
<ul>
  <li>host address/port pairs</li>
  <li>URL/URIs paths</li>
  <li>connection protocols</li>
</ul>
<h2><a href="#dependencies" name="dependencies" class="anchor"><span class="anchor-link"></span></a>Dependencies</h2>
<p>To use the Location Service without using the framework, add this to your <code>build.sbt</code> file:</p>
<dl>
  <dt>sbt</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">libraryDependencies += &quot;com.github.tmtsoftware.csw&quot; %% &quot;csw-location-server&quot; % &quot;3.0.0-RC1&quot;
</code></pre></dd>
</dl>
<h2><a href="#create-location-service" name="create-location-service" class="anchor"><span class="anchor-link"></span></a>Create Location Service</h2>
<p>Note that before using this API, the <a href="../apps/cswlocationserver.html">csw-location-server</a> application should be running at a known location in the network (or at multiple locations) and the necessary configuration, environment variables or system properties should be defined to point to the correct host and port number(s).</p>
<p><code>LocationServiceFactory</code> provides a make method to create an instance of the LocationService API. This call will look for configuration or environment variable settings.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/main/scala/example/location/LocationServiceExampleClientApp.scala#L51" target="_blank" title="Go to snippet source"></a><code class="language-scala">private val locationService = HttpLocationServiceFactory.makeLocalClient(typedSystem)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/main/java/example/location/JLocationServiceExampleClient.java#L55-L56" target="_blank" title="Go to snippet source"></a><code class="language-java">private akka.actor.ActorSystem system = context().system();
private ILocationService locationService = JHttpLocationServiceFactory.makeLocalClient(Adapter.toTyped(system));</code></pre></dd>
</dl>
<h2><a href="#creating-components-connections-and-registrations" name="creating-components-connections-and-registrations" class="anchor"><span class="anchor-link"></span></a>Creating Components, Connections and Registrations</h2>
<p>An Application, Sequencer, Assembly, HCD, or Service may need to be used by another component as part of normal observatory operations. It must register its location information with Location Service so that other components can find it. Location information is comprised of:</p>
<ul>
  <li>
    <p><strong>ComponentId</strong> : A component ID consisting of</p>
    <ul>
      <li><strong>ComponentName</strong> : a name describing the component.</li>
      <li><strong>ComponentType</strong> : such as Container, Sequencer, HCD, Assembly, Service.</li>
    </ul>
  </li>
  <li>
  <p><strong>ConnectionType</strong> : the means to reach components. These are categorized as <code>Akka</code>, <code>HTTP</code>, or <code>Tcp</code> type connections.</p></li>
</ul>
<p>The location information is stored in the Location Service as <strong>Registrations</strong>.</p>
<p>Some of the examples of the string representation of a connection are:</p>
<ul>
  <li>TromboneAssembly-assembly-akka</li>
  <li>TromboneHcd-hcd-akka</li>
  <li>ConfigServer-service-http</li>
  <li>EventService-service-tcp</li>
</ul>
<p>The <code>register</code> API takes a <code>Registration</code> parameter and returns a future registration result. If registration fails for some reason, the returned future will fail with an exception. (Registration will fail if the <code>csw-location-server</code> application is not running or could not be found, or if the given component name was already registered.)</p>
<p><code>AkkaRegistrationFactory</code> can be used to instantiate <code>AkkaRegistration</code> using <code>AkkaConnection</code>, <code>Actor Ref</code> and optional <code>Metadata</code>. The following example shows registration of both an UnTyped ActorRef and a Typed ActorRef:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/main/scala/example/location/LocationServiceExampleClientApp.scala#L124-L175" target="_blank" title="Go to snippet source"></a><code class="language-scala"><br/>// add some dummy registrations for illustrative purposes

// dummy http connection
val httpPort       = 8080
val httpConnection = HttpConnection(api.models.ComponentId(Prefix(Subsystem.CSW, &quot;configuration&quot;), ComponentType.Service))

// When no network type is provided in httpRegistration, default is NetworkType.Private
val httpRegistration                  = HttpRegistration(httpConnection, httpPort, &quot;path123&quot;)
val httpRegResult: RegistrationResult = Await.result(locationService.register(httpRegistration), 2.seconds)

// When a service wants to register itself on Public network, it can provide NetworkType.Public in httpRegistration
val httpRegistrationOnPublicNetwork = HttpRegistration(httpConnection, httpPort, &quot;path123&quot;, NetworkType.Outside)
val httpRegResultOnPublicNetwork: RegistrationResult =
  Await.result(locationService.register(httpRegistrationOnPublicNetwork), 2.seconds)

// ************************************************************************************************************

// import scaladsl adapter to implicitly convert UnTyped ActorRefs to Typed ActorRef[Nothing]
import akka.actor.typed.scaladsl.adapter._

// dummy HCD connection
val hcdConnection = AkkaConnection(api.models.ComponentId(Prefix(Subsystem.NFIRAOS, &quot;hcd1&quot;), ComponentType.HCD))
val hcdRegistration: AkkaRegistration = AkkaRegistrationFactory.make(
  hcdConnection,
  context
    .actorOf(
      Props(new Actor {
        override def receive: Receive = {
          case &quot;print&quot; =&gt; log.info(&quot;hello world&quot;)
        }
      }),
      name = &quot;my-actor-1&quot;
    )
    .toTyped
)

// Register UnTyped ActorRef with Location service. Import scaladsl adapter to implicitly convert
// UnTyped ActorRefs to Typed ActorRef[Nothing]
val hcdRegResult: RegistrationResult = Await.result(locationService.register(hcdRegistration), 2.seconds)

// ************************************************************************************************************

def behavior(): Behavior[String]    = Behaviors.setup { ctx =&gt; Behaviors.receiveMessage { msg =&gt; Behaviors.same } }
val typedActorRef: ActorRef[String] = context.system.spawn(behavior(), &quot;typed-actor-ref&quot;)

val assemblyConnection = AkkaConnection(ComponentId(Prefix(Subsystem.NFIRAOS, &quot;assembly1&quot;), ComponentType.Assembly))

// Register Typed ActorRef[String] with Location Service
val assemblyRegistration: AkkaRegistration = AkkaRegistrationFactory.make(assemblyConnection, typedActorRef)

val assemblyRegResult: RegistrationResult = Await.result(locationService.register(assemblyRegistration), 2.seconds)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/main/java/example/location/JLocationServiceExampleClient.java#L93-L140" target="_blank" title="Go to snippet source"></a><code class="language-java"><br/>// dummy http connection
HttpConnection httpConnection = new HttpConnection(new ComponentId(new Prefix(JSubsystem.CSW,
        &quot;configuration&quot;), JComponentType.Service));

// When no network type is provided in httpRegistration, default is JNetworkType.Private
HttpRegistration httpRegistration = new HttpRegistration(httpConnection, 8080, &quot;path123&quot;);
httpRegResult = locationService.register(httpRegistration).get();

// When a service wants to register itself on Public network, it can provide JNetworkType.Public in httpRegistration
HttpRegistration httpRegistrationOnPublicNetwork = new HttpRegistration(httpConnection, 8080, &quot;path123&quot;,
        JNetworkType.Outside);
httpRegResultonPublicNetwork = locationService.register(httpRegistrationOnPublicNetwork).get();

// ************************************************************************************************************

// dummy HCD connection
AkkaConnection hcdConnection = new AkkaConnection(new ComponentId(new Prefix(JSubsystem.NFIRAOS, &quot;hcd1&quot;),
        JComponentType.HCD));
ActorRef actorRefUntyped = getContext().actorOf(Props.create(AbstractActor.class, () -&gt; new AbstractActor() {
            @Override
            public Receive createReceive() {
                return ReceiveBuilder.create().build();
            }
        }),
        &quot;my-actor-1&quot;
);

// Register UnTyped ActorRef with Location service. Use javadsl Adapter to convert UnTyped ActorRefs
// to Typed ActorRef[Nothing]

akka.actor.typed.ActorRef actorRef = Adapter.toTyped(actorRefUntyped);
AkkaRegistration hcdRegistration = JAkkaRegistrationFactory.make(hcdConnection, actorRef);
hcdRegResult = locationService.register(hcdRegistration).get();

// ************************************************************************************************************

Behavior&lt;String&gt; behavior = Behaviors.setup(ctx -&gt; Behaviors.same());
akka.actor.typed.ActorRef&lt;String&gt; typedActorRef = Adapter.spawn(context(), behavior, &quot;typed-actor-ref&quot;);

AkkaConnection assemblyConnection = new AkkaConnection(new ComponentId(new Prefix(JSubsystem.NFIRAOS,
        &quot;assembly1&quot;), JComponentType.Assembly));

// Register Typed ActorRef[String] with Location Service
AkkaRegistration assemblyRegistration = JAkkaRegistrationFactory.make(assemblyConnection, typedActorRef);


assemblyRegResult = locationService.register(assemblyRegistration).get();</code></pre></dd>
</dl>
<h3><a href="#capability-to-add-metadata-while-registering-connection" name="capability-to-add-metadata-while-registering-connection" class="anchor"><span class="anchor-link"></span></a>Capability to add metadata while registering connection</h3>
<p>Location service supports to add additional information while registering connection. This information is metadata for that registration. Metadata given at point of registration is reflected in location model. This metadata information can be used to store additional info e.g. agentId for any component running on that agent. Metadata field is optional while registration, if not provided location will be reflected with empty metadata</p>
<p>Following example shows adding metadata in <code>HttpRegistration</code>. Similarly, metadata can be added in <code>AkkaRegistration</code> as well as <code>TcpRegistration</code>. Once location is registered <code>Metadata</code> associated can be used for any computation.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/main/scala/example/location/LocationServiceExampleClientApp.scala#L179-L190" target="_blank" title="Go to snippet source"></a><code class="language-scala">// add some dummy registrations for illustrative purposes

// dummy http connection
val httpPortForService = 8080
val httpConnectionForService = HttpConnection(
  api.models.ComponentId(Prefix(Subsystem.CSW, &quot;configuration&quot;), ComponentType.Service)
)

// When no network type is provided in httpRegistration, default is NetworkType.Private
val httpRegistrationForService =
  HttpRegistration(httpConnectionForService, httpPortForService, &quot;path123&quot;, Metadata(Map(&quot;key1&quot; -&gt; &quot;value1&quot;)))
val httpRegResultForService: RegistrationResult = Await.result(locationService.register(httpRegistrationForService), 2.seconds)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/main/java/example/location/JLocationServiceExampleClient.java#L144-L154" target="_blank" title="Go to snippet source"></a><code class="language-java"><br/>// dummy http connection
HttpConnection httpConnectionForService = new HttpConnection(new ComponentId(new Prefix(JSubsystem.CSW,
        &quot;configuration&quot;), JComponentType.Service));

// When no network type is provided in httpRegistration, default is JNetworkType.Private
HttpRegistration httpRegistrationForService = new HttpRegistration(httpConnectionForService, 8080, &quot;path123&quot;, new Metadata(Map.of(&quot;key1&quot;, &quot;value1&quot;)));
httpRegResult = locationService.register(httpRegistrationForService).get();

// usage of metadata
Map metadataMap = httpRegResult.location().metadata().jValue();</code></pre></dd>
</dl><div class="callout note "><div class="callout-title">Note</div>
<p>The <code>AkkaRegistration</code> api takes only Typed ActorRefs. Hence, to register an UnTyped ActorRef for an akka connection, it needs to be adapted to Typed <code>ActorRef[Nothing]</code>, using adapters provided by Akka. The usage of the adapter is shown in the above snippet for both Scala and Java. </p>
<p>Also, note that for components, the registration will be taken care of via <code>csw-framework</code>. Hence, component developers won&rsquo;t register any connections during their development. So, the above demonstration of registering connections is for explanatory and testing purposes only. </p></div>
<h2><a href="#creating-actorref-for-registration" name="creating-actorref-for-registration" class="anchor"><span class="anchor-link"></span></a>Creating ActorRef for Registration</h2>
<p>The ActorSystem used to start actors that will be registered in the Location Service must be created using an <code>ActorSystemFactory</code> as follows:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/main/scala/example/location/LocationServiceExampleClientApp.scala#L46-L47" target="_blank" title="Go to snippet source"></a><code class="language-scala">val typedSystem: typed.ActorSystem[SpawnProtocol.Command] =
  ActorSystemFactory.remote(SpawnProtocol(), &quot;csw-examples-locationServiceClient&quot;)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/main/java/example/location/JLocationServiceExampleClient.java#L352-L353" target="_blank" title="Go to snippet source"></a><code class="language-java">ActorSystem&lt;SpawnProtocol.Command&gt; typedSystem = ActorSystemFactory.remote(SpawnProtocol.create(), &quot;csw&quot; +
        &quot;-examples-locationServiceClient&quot;);</code></pre></dd>
</dl>
<p>This is required to start a remote ActorSystem on the same network interface where the csw-cluster is running. All the ActorRefs created using this ActorSystem will be available for communication from other components that are part of the CSW Cluster.</p>
<h2><a href="#resolving-connections" name="resolving-connections" class="anchor"><span class="anchor-link"></span></a>Resolving Connections</h2>
<p>The <code>list</code> API returns a list of the currently registered connections from the Location Service.</p>
<p>A connection of interest can be looked up using the <code>resolve</code> or <code>find</code> methods: </p>
<p><code>resolve</code> gets the location for a connection from the local cache. If not found in the cache, it waits for the event to arrive within the specified time limit and returns None on failure. </p>
<p><code>find</code> returns the location for a connection from the local cache and returns None if not immediately found there. </p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/main/scala/example/location/LocationServiceExampleClientApp.scala#L194-L207" target="_blank" title="Go to snippet source"></a><code class="language-scala">// find connection to LocationServiceExampleComponent in location service
// [do this before starting LocationServiceExampleComponent.  this should return Future[None]]
val exampleConnection: AkkaConnection = LocationServiceExampleComponent.connection

log.info(
  s&quot;Attempting to find $exampleConnection&quot;,
  Map(Keys.OBS_ID -&gt; &quot;foo_obs_id&quot;, &quot;exampleConnection&quot; -&gt; exampleConnection.name)
)
val findResult: Option[AkkaLocation] = Await.result(locationService.find(exampleConnection), timeout)

log.info(s&quot;Result of the find call: $findResult&quot;)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/main/java/example/location/JLocationServiceExampleClient.java#L161-L179" target="_blank" title="Go to snippet source"></a><code class="language-java">// find connection to LocationServiceExampleComponent in location service
// [do this before starting LocationServiceExampleComponent.  this should return Future[None]]

log.info(&quot;Attempting to find &quot; + exampleConnection,
        Map.of(
                JKeys.OBS_ID, &quot;foo_obs_id&quot;,
                &quot;exampleConnection&quot;, exampleConnection.name()
        ));

Optional&lt;AkkaLocation&gt; findResult = locationService.find(exampleConnection).get();
if (findResult.isPresent()) {
    log.info(&quot;Find result: &quot; + connectionInfo(findResult.orElseThrow().connection()));
} else {
    log.info(() -&gt; &quot;Result of the find call : None&quot;);
}</code></pre></dd>
</dl>
<p>The logging output from the above example when the given component is not registered should include:</p>
<pre><code>[INFO] Attempting to find connection AkkaConnection(ComponentId(LocationServiceExampleComponent,Assembly))
[INFO] Result of the find call: None 
</code></pre>
<p>An example of the resolve command is shown in the following: </p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/main/scala/example/location/LocationServiceExampleClientApp.scala#L221-L232" target="_blank" title="Go to snippet source"></a><code class="language-scala">// resolve connection to LocationServiceExampleComponent
// [start LocationServiceExampleComponent after this command but before timeout]
log.info(s&quot;Attempting to resolve $exampleConnection with a wait of $waitForResolveLimit ...&quot;)

val resolveResultF: Future[Option[AkkaLocation]] = locationService.resolve(exampleConnection, waitForResolveLimit)
val resolveResult: Option[AkkaLocation]          = Await.result(resolveResultF, waitForResolveLimit + timeout)
resolveResult match {
  case Some(result) =&gt;
    log.info(s&quot;Resolve result: ${locationInfoToString(result)}&quot;)
  case None =&gt;
    log.info(s&quot;Timeout waiting for location $exampleConnection to resolve.&quot;)
}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/main/java/example/location/JLocationServiceExampleClient.java#L194-L213" target="_blank" title="Go to snippet source"></a><code class="language-java">// resolve connection to LocationServiceExampleComponent
// [start LocationServiceExampleComponent after this command but before timeout]
Duration waitForResolveLimit = Duration.ofSeconds(30);

log.info(() -&gt; &quot;Attempting to resolve &quot; + exampleConnection + &quot; with a wait of &quot; + waitForResolveLimit + &quot;..&quot; +
        &quot;.&quot;, () -&gt; Map.of(
        JKeys.OBS_ID, &quot;foo_obs_id&quot;,
        &quot;exampleConnection&quot;, exampleConnection.name()
));

Optional&lt;AkkaLocation&gt; resolveResult = locationService.resolve(exampleConnection, waitForResolveLimit).get();
if (resolveResult.isPresent()) {
    log.info(() -&gt; &quot;Resolve result: &quot; + connectionInfo(resolveResult.orElseThrow().connection()));
} else {
    log.info(() -&gt; &quot;Timeout waiting for location &quot; + exampleConnection + &quot; to resolve.&quot;);
}</code></pre></dd>
</dl>
<p>The logging output from the above example should include:</p>
<pre><code>[INFO] Attempting to resolve AkkaConnection(ComponentId(LocationServiceExampleComponent,Assembly)) with a wait of 30 seconds ...
</code></pre>
<p>If you then start the LocationServiceExampleComponentApp, the following message will be logged:</p>
<pre><code>[INFO] Resolve result: LocationServiceExampleComponent-assembly-akka, component type=Assembly, connection type=AkkaType
</code></pre>
<p>If not, eventually the operation will timeout and the output should read:</p>
<pre><code>[INFO] Timeout waiting for location AkkaConnection(ComponentId(LocationServiceExampleComponent,Assembly)) to resolve.
</code></pre><div class="callout note "><div class="callout-title">Note</div>
<p>The <code>resolve</code> and <code>find</code> api returns the concrete <code>Location</code> type i.e. <code>Akkalocation</code>, <code>HttpLocation</code> or <code>TcpLocation</code> as demonstrated in this section. Once the Akka location is found or resolved, we need to ascribe the type to the ActorRef, since the explicit type annotation is removed from the program before it is executed at run-time (see <a href="https://en.wikipedia.org/wiki/Type_erasure">type erasure</a>). Use following <code>AkkaLocation</code> API to get the correct Typed ActorRef:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/main/scala/example/location/LocationServiceExampleClientApp.scala#L213-L217" target="_blank" title="Go to snippet source"></a><code class="language-scala">// If the component type is HCD or Assembly, use this to get the correct ActorRef
val typedComponentRef: ActorRef[ComponentMessage] = akkaLocation.componentRef

// If the component type is Container, use this to get the correct ActorRef
val typedContainerRef: ActorRef[ContainerMessage] = akkaLocation.containerRef</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/main/java/example/location/JLocationServiceExampleClient.java#L184-L190" target="_blank" title="Go to snippet source"></a><code class="language-java">// If the component type is HCD or Assembly, use this to get the correct ActorRef
akka.actor.typed.ActorRef&lt;ComponentMessage&gt; typedComponentRef =
        AkkaLocationExt.RichAkkaLocation(akkaLocation).componentRef(typedSystem);

// If the component type is Container, use this to get the correct ActorRef
akka.actor.typed.ActorRef&lt;ContainerMessage&gt; typedContainerRef =
        AkkaLocationExt.RichAkkaLocation(akkaLocation).containerRef(typedSystem);</code></pre></dd>
</dl></div>
<h2><a href="#filtering" name="filtering" class="anchor"><span class="anchor-link"></span></a>Filtering</h2>
<p>The <code>list</code> API and its variants offer means to inquire about available connections with the Location Service. The <em>parameter-less</em> <code>list</code> returns all available connections</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/main/scala/example/location/LocationServiceExampleClientApp.scala#L236-L239" target="_blank" title="Go to snippet source"></a><code class="language-scala">// list connections in location service
val connectionList: List[Location] = Await.result(locationService.list, timeout)
log.info(&quot;All Registered Connections:&quot;)
connectionList.foreach(c =&gt; log.info(s&quot;--- ${locationInfoToString(c)}&quot;))</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/main/java/example/location/JLocationServiceExampleClient.java#L226-L231" target="_blank" title="Go to snippet source"></a><code class="language-java">// list connections in location service
List&lt;Location&gt; connectionList = locationService.list().get();
log.info(&quot;All Registered Connections:&quot;);
for (Location loc : connectionList) {
    log.info(&quot;--- &quot; + connectionInfo(loc.connection()));
}</code></pre></dd>
</dl>
<p>The log output from the above should contain:</p>
<pre><code>[INFO] All Registered Connections:
[INFO] --- configuration-service-http, component type=Service, connection type=HttpType
[INFO] --- hcd1-hcd-akka, component type=HCD, connection type=AkkaType
[INFO] --- LocationServiceExampleComponent-assembly-akka, component type=Assembly, connection type=AkkaType
[INFO] --- redis-service-tcp, component type=Service, connection type=TcpType
[INFO] --- assembly1-assembly-akka, component type=Assembly, connection type=AkkaType
</code></pre>
<p>Other variants are filters using <code>ConnectionType</code>, <code>ComponentType</code>, and <code>hostname</code>.</p>
<p>Filtering by component type is shown below:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/main/scala/example/location/LocationServiceExampleClientApp.scala#L243-L246" target="_blank" title="Go to snippet source"></a><code class="language-scala">// filter connections based on component type
val componentList: List[Location] = Await.result(locationService.list(ComponentType.Assembly), timeout)
log.info(&quot;Registered Assemblies:&quot;)
componentList.foreach(c =&gt; log.info(s&quot;--- ${locationInfoToString(c)}&quot;))</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/main/java/example/location/JLocationServiceExampleClient.java#L235-L240" target="_blank" title="Go to snippet source"></a><code class="language-java">// filter connections based on component type
List&lt;Location&gt; componentList = locationService.list(JComponentType.Assembly).get();
log.info(&quot;Registered Assemblies:&quot;);
for (Location loc : componentList) {
    log.info(&quot;--- &quot; + connectionInfo(loc.connection()));
}</code></pre></dd>
</dl>
<p>The log output from the above code should contain:</p>
<pre><code>[INFO] Registered Assemblies:
[INFO] --- LocationServiceExampleComponent-assembly-akka, component type=Assembly, connection type=AkkaType
[INFO] --- assembly1-assembly-akka, component type=Assembly, connection type=AkkaType
</code></pre>
<p>Filtering by connection type is shown below:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/main/scala/example/location/LocationServiceExampleClientApp.scala#L250-L253" target="_blank" title="Go to snippet source"></a><code class="language-scala">// filter connections based on connection type
val akkaList: List[Location] = Await.result(locationService.list(ConnectionType.AkkaType), timeout)
log.info(&quot;Registered Akka connections:&quot;)
akkaList.foreach(c =&gt; log.info(s&quot;--- ${locationInfoToString(c)}&quot;))</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/main/java/example/location/JLocationServiceExampleClient.java#L245-L250" target="_blank" title="Go to snippet source"></a><code class="language-java">// filter connections based on connection type
List&lt;Location&gt; akkaList = locationService.list(JConnectionType.AkkaType).get();
log.info(&quot;Registered Akka connections:&quot;);
for (Location loc : akkaList) {
    log.info(&quot;--- &quot; + connectionInfo(loc.connection()));
}</code></pre></dd>
</dl>
<p>The log output should contain:</p>
<pre><code>[INFO] Registered Akka connections:
[INFO] --- hcd1-hcd-akka, component type=HCD, connection type=AkkaType
[INFO] --- LocationServiceExampleComponent-assembly-akka, component type=Assembly, connection type=AkkaType
[INFO] --- assembly1-assembly-akka, component type=Assembly, connection type=AkkaType
</code></pre>
<p>Filtering akka connections by prefix is shown below:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/main/scala/example/location/LocationServiceExampleClientApp.scala#L257-L260" target="_blank" title="Go to snippet source"></a><code class="language-scala">// filter akka locations based on prefix
val akkaLocations: List[Location] = Await.result(locationService.listByPrefix(&quot;NFIRAOS.ncc&quot;), timeout)
log.info(&quot;Registered akka locations for nfiraos.ncc&quot;)
akkaLocations.foreach(c =&gt; log.info(s&quot;--- ${locationInfoToString(c)}&quot;))</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/main/java/example/location/JLocationServiceExampleClient.java#L254-L258" target="_blank" title="Go to snippet source"></a><code class="language-java">List&lt;Location&gt; locations = locationService.listByPrefix(&quot;NFIRAOS.ncc&quot;).get();
log.info(&quot;Registered akka locations for nfiraos.ncc&quot;);
for (Location loc : locations) {
    log.info(&quot;--- &quot; + connectionInfo(loc.connection()));
}</code></pre></dd>
</dl>
<p>The log output should contain:</p>
<pre><code>[INFO] Registered akka locations for nfiraos.ncc
[INFO] --- nfiraos.ncc.hcd1-hcd-akka, component type=HCD, connection type=AkkaType
[INFO] --- nfiraos.ncc.assembly1-assembly-akka, component type=Assembly, connection type=AkkaType
</code></pre>
<h2><a href="#tracking-and-subscribing" name="tracking-and-subscribing" class="anchor"><span class="anchor-link"></span></a>Tracking and Subscribing</h2>
<p>The lifecycle of a connection of interest can be followed using either the <code>track</code> API or the <code>subscribe</code> API. </p>
<p>These methods take a <code>Connection</code> instance as a parameter. <strong>A <code>Connection</code> need not already be registered with Location Service.</strong> It&rsquo;s okay to track connections that will be registered in future. </p>
<p>The <code>track</code> API returns two values:<br/> * A <strong>source</strong> that will emit a stream of <code>TrackingEvents</code> for the connection.<br/> * A <strong>KillSwitch</strong> to turn off the stream when no longer needed. </p>
<p>The Akka stream API provides many building blocks to process this stream, such as Flow and Sink. In the example below, <code>Sink.actorRef</code> is used to forward any location messages received to the current actor (self).</p>
<p>A consumer can shut down the stream using the KillSwitch.</p>
<p>The <code>subscribe</code> API allows the caller to track a connection and receive the TrackingEvent notifications via a callback. </p>
<p>The API expects following parameters:<br/> * An existing connection or a connection to be registered in the future.<br/> * A callback that implements <code>Consumer</code> and receives the TrackEvent as a parameter. </p><div class="callout note "><div class="callout-title">Note</div>
<p>Callbacks are not thread-safe on the JVM. If you are doing side effects/mutations inside the callback, you should ensure that it is done in a thread-safe way inside an actor. Here is an <a href="https://github.com/tmtsoftware/csw/blob/v3.0.0-RC1/examples/src/main/scala/example/event/ConcurrencyInCallbacksExample.scala">example</a> of how it can be done.</p></div>
<p>This API returns a KillSwitch that can be used to turn off the event notifications and release the supplied callback, if required.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/main/scala/example/location/LocationServiceExampleClientApp.scala#L83-L298" target="_blank" title="Go to snippet source"></a><code class="language-scala">def sinkBehavior: Behaviors.Receive[ExampleMessages] =
  Behaviors.receive[ExampleMessages] { (ctx, msg) =&gt;
    {
      val log: Logger = new LoggerFactory(Prefix(&quot;csw.my-component-name&quot;)).getLogger(ctx)

      msg match {
        case TrackingEventAdapter(LocationUpdated(loc)) =&gt; log.info(s&quot;Location updated ${locationInfoToString(loc)}&quot;)
        case TrackingEventAdapter(LocationRemoved(conn)) =&gt;
          log.warn(s&quot;Location removed $conn&quot;, Map(&quot;connection&quot; -&gt; conn.toString))
        case AllDone(exampleConnection) =&gt; log.info(s&quot;Tracking of $exampleConnection complete.&quot;)
        case CustomException(throwable) =&gt; log.error(throwable.getMessage, ex = throwable)
      }
      Behaviors.same
    }
  }
  // the following two methods are examples of two ways to track a connection.
  // both are implemented but only one is really needed.

  // Method1: track connection to LocationServiceExampleComponent
  // Calls track method for example connection and forwards location messages to this actor
  //
  log.info(s&quot;Starting to track $exampleConnection&quot;)
  val sinfActorRef = typedSystem.spawn(LocationServiceExampleClient.sinkBehavior, &quot;&quot;)
  locationService
    .track(exampleConnection)
    .map(TrackingEventAdapter)
    .to(ActorSink.actorRef[ExampleMessages](sinfActorRef, AllDone(exampleConnection), CustomException))
    .run()
  //track returns a Killswitch, that can be used to turn off notifications arbitarily
  //in this case track a connection for 5 seconds, after that schedule switching off the stream
  val killswitch = locationService
    .track(httpConnection)
    .toMat(Sink.foreach(println))(Keep.left)
    .run()
  context.system.scheduler.scheduleOnce(5.seconds) {
    killswitch.cancel()
  }

  // Method2: subscribe to LocationServiceExampleComponent events
  log.info(s&quot;Starting a subscription to $exampleConnection&quot;)
  locationService.subscribe(
    exampleConnection,
    trackingEvent =&gt; {
      // the following println is to distinguish subscription events from tracking events
      log.info(&quot;subscription event&quot;)
      self ! trackingEvent
    }
  )</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/main/java/example/location/JLocationServiceExampleClient.java#L264-L285" target="_blank" title="Go to snippet source"></a><code class="language-java">// the following two methods are examples of two ways to track a connection.
// both are implemented but only one is really needed.

// track connection to LocationServiceExampleComponent
// Calls track method for example connection and forwards location messages to this actor
log.info(&quot;Starting to track &quot; + exampleConnection);
locationService.track(exampleConnection).toMat(Sink.actorRef(getSelf(), AllDone.class), Keep.both()).run(typedSystem);

//track returns a Killswitch, that can be used to turn off notifications arbitarily
//in this case track a connection for 5 seconds, after that schedule switching off the stream
Pair pair = locationService.track(exampleConnection).toMat(Sink.ignore(), Keep.both()).run(typedSystem);
context().system().scheduler().scheduleOnce(
        Duration.ofSeconds(5),
        () -&gt; ((KillSwitch) pair.first()).shutdown(),
        context().system().dispatcher());

// subscribe to LocationServiceExampleComponent events
log.info(&quot;Starting a subscription to &quot; + exampleConnection);
locationService.subscribe(exampleConnection, trackingEvent -&gt; {
    log.info(&quot;subscription event&quot;);
    getSelf().tell(trackingEvent, ActorRef.noSender());
});</code></pre></dd>
</dl>
<p>The log output should contain the following:</p>
<pre><code>[INFO] Starting to track AkkaConnection(ComponentId(LocationServiceExampleComponent,Assembly)) LocationUpdated(HttpLocation(HttpConnection(ComponentId(configuration,Service)),http://131.215.210.170:8080/path123))
[INFO] Starting a subscription to AkkaConnection(ComponentId(LocationServiceExampleComponent,Assembly))
[INFO] Subscribing to connection LocationServiceExampleComponent-assembly-akka
[INFO] Location updated LocationServiceExampleComponent-assembly-akka, component type=Assembly, connection type=AkkaType
[INFO] subscription event
[INFO] Location updated LocationServiceExampleComponent-assembly-akka, component type=Assembly, connection type=AkkaType
</code></pre>
<p>If you now stop the LocationServiceExampleComponentApp, it would log:</p>
<pre><code>[INFO] subscription event
[INFO] Location removed AkkaConnection(ComponentId(LocationServiceExampleComponent,Assembly))
[INFO] Location removed AkkaConnection(ComponentId(LocationServiceExampleComponent,Assembly))
</code></pre>
<p>If you start the LocationServiceExampleComponentApp again, the log output should be:</p>
<pre><code>[INFO] subscription event
[INFO] Location updated LocationServiceExampleComponent-assembly-akka, component type=Assembly, connection type=AkkaType
[INFO] Location updated LocationServiceExampleComponent-assembly-akka, component type=Assembly, connection type=AkkaType
</code></pre>
<p>Note: the line after the words &ldquo;subscription event&rdquo; in our example is generated by the subscription, and the other line is from tracking. These two events could come in any order.</p>
<h2><a href="#unregistering" name="unregistering" class="anchor"><span class="anchor-link"></span></a>Unregistering</h2>
<p>One of the ways to <code>unregister</code> a service is by calling unregister on registration result received from <code>register</code> API.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/main/scala/example/location/LocationServiceExampleClientApp.scala#L311-L317" target="_blank" title="Go to snippet source"></a><code class="language-scala">val unregisterF: Future[Done] = async {
  await(httpRegResult.unregister())
  await(httpRegResultOnPublicNetwork.unregister())
  await(hcdRegResult.unregister())
  await(assemblyRegResult.unregister())
}
Await.result(unregisterF, 5.seconds)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/csw/tree/master/examples/src/main/java/example/location/JLocationServiceExampleClient.java#L301-L304" target="_blank" title="Go to snippet source"></a><code class="language-java">httpRegResult.unregister();
httpRegResultonPublicNetwork.unregister();
hcdRegResult.unregister();
assemblyRegResult.unregister();</code></pre></dd>
</dl>
<h2><a href="#protected-routes" name="protected-routes" class="anchor"><span class="anchor-link"></span></a>Protected Routes</h2>
<p>The following Location Server routes are <code>Protected</code>. To use these routes, the user must be authenticated and authorized with <code>location-admin</code> role.</p>
<ul>
  <li>register</li>
  <li>unregister</li>
  <li>unregisterAll</li>
</ul><div class="callout note "><div class="callout-title">Note</div>
<p>Refer to <a href="aas.html">csw-aas</a> docs to know more about how to authenticate and authorize with AAS and get an access token.</p></div>
<h2><a href="#technical-description" name="technical-description" class="anchor"><span class="anchor-link"></span></a>Technical Description</h2>
<p>See <a href="../technical/location/location.html">Location Service Technical Description</a>.</p>
<h2><a href="#source-code-for-examples" name="source-code-for-examples" class="anchor"><span class="anchor-link"></span></a>Source code for examples</h2>
<ul>
  <li><a href="https://github.com/tmtsoftware/csw/blob/v3.0.0-RC1/examples/src/main/scala/example/location/LocationServiceExampleClientApp.scala">Scala Example</a></li>
  <li><a href="https://github.com/tmtsoftware/csw/blob/v3.0.0-RC1/examples/src/main/java/example/location/JLocationServiceExampleClient.java">JavaBlocking Example</a></li>
</ul>
</div>
<div>
<a href="https://github.com/tmtsoftware/csw/tree/master/docs/src/main/services/location.md" title="Edit this page" class="md-source-file md-edit">
Edit this page
</a>
</div>
<div class="print-only">
<span class="md-source-file md-version">
3.0.0-RC1
</span>
</div>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-nav">
<nav class="md-footer-nav__inner md-grid">
<a href="../commons/services.html" title="Services" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
</div>
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Previous
</span>
Services
</span>
</div>
</a>
<a href="../services/config.html" title="Configuration Service" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Next
</span>
Configuration Service
</span>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
</div>
</a>
</nav>
</div>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
Powered by
<a href="https://github.com/lightbend/paradox">Paradox</a>
and
<a href="https://jonas.github.io/paradox-material-theme/">Paradox Material Theme</a>

</div>
</div>
</div>
</footer>

</div>
<script src="../assets/javascripts/application.583bbe55.js"></script>
<script src="../assets/javascripts/paradox-material-theme.js"></script>
<script>app.initialize({version:"0.17",url:{base:"../."}})</script>
<script type="text/javascript" src="../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function(event) {
window.prettyPrint && prettyPrint();
});
</script>
</body>
</html>
