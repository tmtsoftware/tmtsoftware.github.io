<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="description" content="docs">
<meta name="generator" content="Paradox, paradox-material-theme=0.7.0, mkdocs-material=3.0.3">

<meta name="lang:clipboard.copy" content="Copy to clipboard">
<meta name="lang:clipboard.copied" content="Copied to clipboard">
<meta name="lang:search.language" content="">
<meta name="lang:search.pipeline.stopwords" content="true">
<meta name="lang:search.pipeline.trimmer" content="true">
<meta name="lang:search.result.none" content="No matching documents">
<meta name="lang:search.result.one" content="1 matching document">
<meta name="lang:search.result.other" content="# matching documents">
<meta name="lang:search.tokenizer" content="[\s\-]+">


<meta name="description" content="docs">
<link rel="shortcut icon" href="../assets/tmt_favicon.ico">
<title>Component Handlers Â· TMT Common Software (CSW)</title>
<link rel="stylesheet" href="../assets/stylesheets/application.451f80e5.css">
<link rel="stylesheet" href="../lib/material__tabs/dist/mdc.tabs.min.css">
<link rel="stylesheet" href="../lib/prettify/prettify.css">
<script src="../assets/javascripts/modernizr.1aa3b519.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
<style>
body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}
code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}
</style>
<link rel="stylesheet" href="../assets/fonts/font-awesome.css">
<link rel="stylesheet" href="../assets/fonts/material-icons.css">
<link rel="stylesheet" href="../assets/stylesheets/paradox-material-theme.css">
<link rel="stylesheet" href="../assets/custom.css">
</head>
<body
>
<input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
<input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
<label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
<header class="md-header" data-md-component="header">
<nav class="md-header-nav md-grid">
<div class="md-flex">
<div class="md-flex__cell md-flex__cell--shrink">
<a href="../index.html" title="TMT Common Software (CSW)" class="md-header-nav__button md-logo">
<i class="md-icon">local_library</i>
</a>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
</div>
<div class="md-flex__cell md-flex__cell--stretch">
<div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
<span class="md-header-nav__topic">
TMT Common Software (CSW)
</span>
<span class="md-header-nav__topic">
Component Handlers
</span>
</div>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
<label class="md-icon md-search__icon" for="__search"></label>
<button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">&#xE5CD;</button>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix>
<div class="md-search-result" data-md-component="result">
<div class="md-search-result__meta">
Type to start searching
</div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>

</div>
<div class="md-flex__cell md-flex__cell--shrink">
<div class="md-header-nav__source">
<a href="https://github.com/tmtsoftware/csw"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
tmtsoftware/csw
</div>
</a>

</div>
</div>
</div>
</nav>
</header>

<div class="md-container">
<main class="md-main">
<div class="md-main__inner md-grid" data-md-component="container">
<div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--primary" data-md-level="0" style="visibility: hidden">
<label class="md-nav__title md-nav__title--site" for="drawer">
<a href="../index.html" title="TMT Common Software (CSW)" class="md-nav__button md-logo">
<span class="md-nav__button md-logo">
<i class="md-icon">local_library</i>
</a>
<a href="../index.html" title="TMT Common Software (CSW)">
TMT Common Software (CSW)
</a>
</label>
<div class="md-nav__source">
<a href="https://github.com/tmtsoftware/csw"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
tmtsoftware/csw
</div>
</a>

</div>
<ul>
  <li><a href="../commons/getting-started.html" class="page">Getting Started</a></li>
  <li><a href="../commons/create-component.html" class="page">Creating a Component</a></li>
  <li><a href="../commons/multiple-components.html" class="page">Multiple Components</a></li>
  <li><a href="../commons/using-alarms.html" class="page">Using Alarms</a></li>
  <li><a href="../commons/unit-tests.html" class="page">Adding Unit Tests</a></li>
  <li><a href="../commons/params.html" class="page">Params</a>
  <ul>
    <li><a href="../params/keys-parameters.html" class="page">Keys and Parameters</a></li>
    <li><a href="../params/units.html" class="page">Units</a></li>
    <li><a href="../params/subsystem.html" class="page">Subsystem</a></li>
    <li><a href="../params/commands.html" class="page">Commands</a></li>
    <li><a href="../params/events.html" class="page">Events</a></li>
    <li><a href="../params/states.html" class="page">State Variables</a></li>
    <li><a href="../params/result.html" class="page">Result</a></li>
  </ul></li>
  <li><a href="../commons/framework.html" class="page">Framework for creating components (HCD, Assembly, Container)</a>
  <ul>
    <li><a href="../framework/describing-components.html" class="page">ComponentInfo</a></li>
    <li><a href="../framework/creating-components.html" class="page">Creating an Assembly or Hcd Component</a></li>
    <li><a href="../framework/handling-lifecycle.html" class="active page">Component Handlers</a></li>
    <li><a href="../framework/managing-command-state.html" class="page">Managing Command State</a></li>
    <li><a href="../framework/tracking-connections.html" class="page">Tracking Connections</a></li>
    <li><a href="../framework/publishing-state.html" class="page">Publishing State</a></li>
    <li><a href="../framework/handling-exceptions.html" class="page">Handling Exceptions</a></li>
    <li><a href="../framework/deploying-components.html" class="page">Deploying Components</a></li>
  </ul></li>
  <li><a href="../commons/command.html" class="page">Communication using Commands</a></li>
  <li><a href="../commons/logging_aggregator.html" class="page">Logging Aggregator</a></li>
  <li><a href="../commons/services.html" class="page">Services</a>
  <ul>
    <li><a href="../services/location.html" class="page">Location Service</a></li>
    <li><a href="../services/config.html" class="page">Configuration Service</a></li>
    <li><a href="../services/logging.html" class="page">Logging Service</a></li>
    <li><a href="../services/event.html" class="page">Event Service</a></li>
    <li><a href="../services/alarm.html" class="page">Alarm Service</a></li>
    <li><a href="../services/time.html" class="page">Time Service</a></li>
    <li><a href="../services/database.html" class="page">Database Service</a></li>
    <li><a href="../services/aas.html" class="page">Authentication and Authorization Service (AAS)</a></li>
    <li><a href="../services/sequencer-command-service.html" class="page">Sequencer Command Service</a></li>
  </ul></li>
  <li><a href="../commons/apps.html" class="page">Applications</a>
  <ul>
    <li><a href="../apps/csinstallation.html" class="page">Coursier Installation</a></li>
    <li><a href="../apps/cswservices.html" class="page">csw-services</a></li>
    <li><a href="../apps/cswlocationserver.html" class="page">csw-location-server</a></li>
    <li><a href="../apps/cswlocationagent.html" class="page">csw-location-agent</a></li>
    <li><a href="../apps/cswonfigserverapp.html" class="page">csw-config-server</a></li>
    <li><a href="../apps/cswconfigcli.html" class="page">csw-config-cli</a></li>
    <li><a href="../apps/csweventcli.html" class="page">csw-event-cli</a></li>
    <li><a href="../apps/cswalarmcli.html" class="page">csw-alarm-cli</a></li>
    <li><a href="../apps/hostconfig.html" class="page">csw-host-config</a></li>
  </ul></li>
  <li><a href="../commons/deployment.html" class="page">Deployment</a>
  <ul>
    <li><a href="../deployment/env-vars.html" class="page">Environment variables</a></li>
    <li><a href="../deployment/network-topology.html" class="page">Network Topology</a></li>
  </ul></li>
  <li><a href="../commons/testing.html" class="page">Testing</a></li>
  <li><a href="../commons/sbt-tasks.html" class="page">sbt Tasks</a></li>
  <li><a href="../commons/manuals.html" class="page">Manuals</a></li>
  <li><a href="../migration_guide/migration-guides.html" class="page">Migration Guides</a>
  <ul>
    <li><a href="../migration_guide/migration_guide_1.0.0_to_2.0.0/migration-guide-1.0.0-to-2.0.0.html" class="page">Migration Guide from 1.0.0 to 2.0.0</a></li>
    <li><a href="../migration_guide/migration_guide_2.0_to_3.0/migration-guide-2.0-to-3.0.html" class="page">Migration Guide from 2.0 to 3.0</a></li>
    <li><a href="../migration_guide/migration_guide_3.0.0_to_4.0.0/migration-guide-3.0.0-to-4.0.0.html" class="page">Migration Guide from 3.0.0 to 4.0.0</a></li>
    <li><a href="../migration_guide/migration_guide_4.0.0_to_5.0.0/migration-guide-4.0.0-to-5.0.0.html" class="page">Migration Guide from 4.0.0 to 5.0.0</a></li>
  </ul></li>
  <li><a href="../commons/contract.html" class="page">CSW Service contract</a></li>
  <li><a href="../technical/technical.html" class="page">Technical Design Documents</a>
  <ul>
    <li><a href="../technical/framework/framework.html" class="page">Framework</a></li>
    <li><a href="../technical/command/command.html" class="page">Command</a></li>
    <li><a href="../technical/params/params.html" class="page">Params</a></li>
    <li><a href="../technical/units/adding-unit.html" class="page">Adding a new unit</a></li>
    <li><a href="../technical/location/location.html" class="page">Location Service</a></li>
    <li><a href="../technical/configuration/configuration.html" class="page">Configuration Service</a></li>
    <li><a href="../technical/logging/logging.html" class="page">Logging Service</a></li>
    <li><a href="../technical/event/event.html" class="page">Event Service</a></li>
    <li><a href="../technical/alarm/alarm.html" class="page">Alarm Service</a></li>
    <li><a href="../technical/time/time.html" class="page">Time Service</a></li>
    <li><a href="../technical/database/database.html" class="page">Database Service</a></li>
    <li><a href="../technical/aas/aas.html" class="page">Authentication and Authorization Service</a></li>
  </ul></li>
</ul>
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../framework/handling-lifecycle.html#component-handlers" class="header">Component Handlers</a>
  <ul>
    <li><a href="../framework/handling-lifecycle.html#component-lifecycle" class="header">Component Lifecycle</a></li>
    <li><a href="../framework/handling-lifecycle.html#shutting-down" class="header">Shutting Down</a></li>
    <li><a href="../framework/handling-lifecycle.html#component-online-and-offline" class="header">Component Online and Offline</a></li>
    <li><a href="../framework/handling-lifecycle.html#handling-commands" class="header">Handling commands</a></li>
    <li><a href="../framework/handling-lifecycle.html#handling-diagnostic-data" class="header">Handling Diagnostic Data</a></li>
  </ul></li>
</ul>
</nav>

</nav>
<ul style="display: none">
<li class="md-nav__item md-version" id="project.version">
<label class="md-nav__link" for="__version">
<i class="md-icon" title="Version">label_outline</i> 5.0.0-RC2
</label>
</li>
</ul>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../framework/handling-lifecycle.html#component-handlers" class="header">Component Handlers</a>
  <ul>
    <li><a href="../framework/handling-lifecycle.html#component-lifecycle" class="header">Component Lifecycle</a></li>
    <li><a href="../framework/handling-lifecycle.html#shutting-down" class="header">Shutting Down</a></li>
    <li><a href="../framework/handling-lifecycle.html#component-online-and-offline" class="header">Component Online and Offline</a></li>
    <li><a href="../framework/handling-lifecycle.html#handling-commands" class="header">Handling commands</a></li>
    <li><a href="../framework/handling-lifecycle.html#handling-diagnostic-data" class="header">Handling Diagnostic Data</a></li>
  </ul></li>
</ul>
</nav>

</div>
</div>
</div>
<div class="md-content">
<article class="md-content__inner md-typeset">
<div class="md-content__searchable">
<h1><a href="#component-handlers" name="component-handlers" class="anchor"><span class="anchor-link"></span></a>Component Handlers</h1>
<p>A component developer creates a Top Level Actor (TLA) by inheriting from an abstract class <a href="https://tmtsoftware.github.io/csw/5.0.0-RC2/api/scala/csw/framework/scaladsl/ComponentHandlers.html" title="csw.framework.scaladsl.ComponentHandlers"><code>ComponentHandlers</code></a> or <a href="https://tmtsoftware.github.io/csw/5.0.0-RC2/api/java/?csw/framework/javadsl/JComponentHandlers.html" title="csw.framework.javadsl.JComponentHandlers"><code>JComponentHandlers</code></a> for Scala or Java, respectively. Each of these abstract classes provides several <strong>handler</strong> methods that can be overridden by the developer to provide component-specific code as described below. </p>
<h2><a href="#component-lifecycle" name="component-lifecycle" class="anchor"><span class="anchor-link"></span></a>Component Lifecycle</h2>
<p>For each component, the CSW framework creates a <code>Supervisor</code> that creates the TLA, and along with the abstract behavior class provided by the framework, it starts up and initializes the component in a standardized way. At the conclusion of the startup of the component, it is ready to receive commands from the outside world. The following figure is used to describe the startup lifecycle interactions between the framework and the TLA.</p>
<p><img src="../images/framework/Lifecycle.png" alt="lifecycle" /></p>
<h3><a href="#initialize" name="initialize" class="anchor"><span class="anchor-link"></span></a>initialize</h3>
<p>As described in <a href="../commons/create-component.html">Creating a Component</a>, a <code>Supervisor</code> is created based on the contents of the <a href="describing-components.html">ComponentInfo</a> file. The figure shows that the Supervisor in the framework creates the specified TLA. Once the TLA is created, the framework calls the <code>initialize</code> handler. This is the opportunity for the component to perform any initialization needed before it is ready to receive commands.</p>
<p>The implementation of the <code>initialize</code> handler is up to the developer. A common task will be for the component to fetch a configuration from the Configuration Service. It may also determine the location of components or services it needs from the Location Service.</p>
<p>The TLA indicates a successful <code>initialize</code> by returning normally. If it cannot initialize, the handler should throw an exception, which will be caught and logged. The Supervisor will retry the creation and initialization of the TLA three times. If it fails after three times, the Supervisor will log a message and stop.</p>
<p>When <code>initialize</code> succeeds, the Supervisor in the framework and the component itself enter the Running state. When in the Running state, commands received from outside the component are passed to the TLA (see below).</p>
<dl>
  <dt>Assembly/Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/csw/tree/e13ffcf741fd8438f7de067220952249f110ebec/examples/src/main/scala/example/framework/components/assembly/AssemblyComponentHandlers.scala#L45-L74" target="_blank" title="Go to snippet source">source</a><code class="language-scala">override def initialize(): Unit = {

  // Initialization could include following steps :

  // 1. fetch config (preferably from configuration service)
  val calculationConfig = Await.result(getAssemblyConfig, timeout)

  // 2. create a worker actor which is used by this assembly
  val worker: ActorRef[WorkerActorMsg] = ctx.spawnAnonymous(WorkerActor.behavior(calculationConfig))

  // 3. find a Hcd connection from the connections provided in componentInfo
  val maybeConnection =
    componentInfo.connections.find(connection =&gt; connection.componentId.componentType == ComponentType.HCD)

  // 4. If an Hcd is found as a connection, resolve its location from location service and create other
  // required worker actors required by this assembly

  maybeConnection match {
    case Some(_) =&gt;
      resolveHcd().map {
        case Some(hcd) =&gt;
          runningHcds = runningHcds.updated(maybeConnection.get, Some(CommandServiceFactory.make(hcd)(ctx.system)))
          diagnosticsPublisher = ctx.spawnAnonymous(DiagnosticsPublisher.behavior(runningHcds(maybeConnection.get).get, worker))
          commandHandler = ctx.spawnAnonymous(CommandHandler.behavior(calculationConfig, runningHcds(maybeConnection.get)))
        case None =&gt; // do something
      }
    case None =&gt; ()
  }

}</code></pre></dd>
  <dt>Assembly/Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/csw/tree/e13ffcf741fd8438f7de067220952249f110ebec/examples/src/main/java/example/framework/components/assembly/JAssemblyComponentHandlers.java#L84-L124" target="_blank" title="Go to snippet source">source</a><code class="language-java">@Override
public void initialize() {

    // fetch config (preferably from configuration service)
    // create a worker actor which is used by this assembly
    ConfigData configData;
    ActorRef&lt;WorkerActorMsg&gt; worker;
    try {
        configData = getAssemblyConfig().get(timeout, timeUnit);
        worker = ctx.spawnAnonymous(WorkerActor.behavior(configData));
    } catch (InterruptedException | ExecutionException | TimeoutException ex) {
        throw new RuntimeException(&quot;Can not get config data&quot;, ex);
    }

    // find a Hcd connection from the connections provided in componentInfo
    Optional&lt;Connection&gt; mayBeConnection = componentInfo.getConnections().stream()
            .filter(connection -&gt; connection.componentId().componentType() == JComponentType.HCD)
            .findFirst();

    // If an Hcd is found as a connection, resolve its location from location service and create other
    // required worker actors required by this assembly, also subscribe to HCD&#39;s filter wheel event stream
    mayBeConnection.map(connection -&gt;
    {
        Optional&lt;AkkaLocation&gt; hcdLocation;
        try {
            hcdLocation = resolveHcd().get(timeout, timeUnit);
        } catch (InterruptedException | ExecutionException | TimeoutException ex) {
            throw new RuntimeException(&quot;Can not resolve HCD&quot;, ex);
        }

        if (hcdLocation.isEmpty())
            throw new HcdNotFoundException();
        else {
            runningHcds.put(connection, Optional.of(CommandServiceFactory.jMake(hcdLocation.get(), ctx.getSystem())));
        }
        diagnosticPublisher = ctx.spawnAnonymous(JDiagnosticsPublisher.behavior(CommandServiceFactory.jMake(hcdLocation.get(), ctx.getSystem()), worker));
        return null;
    });
    throw new RuntimeException(&quot;can not resolve connection for given HCD&quot;);
}</code></pre></dd>
  <dt>Hcd/Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/csw/tree/e13ffcf741fd8438f7de067220952249f110ebec/examples/src/main/scala/example/framework/components/hcd/HcdComponentHandlers.scala#L48-L59" target="_blank" title="Go to snippet source">source</a><code class="language-scala">override def initialize(): Unit = {

  // fetch config (preferably from configuration service)
  val hcdConfig = Await.result(getHcdConfig, timeout.duration)

  // create a worker actor which is used by this hcd
  val worker: ActorRef[WorkerActorMsg] = ctx.spawnAnonymous(WorkerActor.behavior(hcdConfig))

  // initialise some state by using the worker actor created above
  current = Await.result(worker ? InitialState, timeout.duration)
  stats = Await.result(worker ? GetStatistics, timeout.duration)
}</code></pre></dd>
  <dt>Hcd/Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/csw/tree/e13ffcf741fd8438f7de067220952249f110ebec/examples/src/main/java/example/framework/components/hcd/JHcdComponentHandlers.java#L72-L97" target="_blank" title="Go to snippet source">source</a><code class="language-java">@Override
public void initialize() {

    // fetch config (preferably from configuration service)
    try {
        hcdConfig = getConfig().get(timeout, timeUnit);
    } catch (InterruptedException | ExecutionException | TimeoutException ex) {
        throw new RuntimeException(&quot;Can not get config &quot;, ex);
    }

    // create a worker actor which is used by this hcd
    worker = ctx.spawnAnonymous(WorkerActor.behavior(hcdConfig));

    // initialise some state by using the worker actor created above
    try {
        CompletionStage&lt;Integer&gt; askCurrent = AskPattern.ask(worker, WorkerActorMsgs.JInitialState::new, Duration.ofSeconds(5), ctx.getSystem().scheduler());
        askCurrent.thenAccept(c -&gt; current = c).toCompletableFuture().get(timeout, timeUnit);

        CompletionStage&lt;Integer&gt; askStats = AskPattern.ask(worker, WorkerActorMsgs.JInitialState::new, Duration.ofSeconds(5), ctx.getSystem().scheduler());
        askStats.thenAccept(s -&gt; stats = s).toCompletableFuture().get(timeout, timeUnit);

    } catch (InterruptedException | ExecutionException | TimeoutException ex) {
        throw new RuntimeException(ex);
    }
}
</code></pre></dd>
</dl>
<h4><a href="#creation-timeout" name="creation-timeout" class="anchor"><span class="anchor-link"></span></a>Creation Timeout</h4>
<p>The <code>Supervisor</code> waits for the <code>initialize</code> to complete. If it times out, it will retry the creation of the TLA 3 times in the same way as with initialize failures. The timeout value is configurable by the TLA by setting the <code>initializeTimeout</code> value in <a href="describing-components.html">ComponentInfo</a>.</p>
<h4><a href="#location-service-interactions" name="location-service-interactions" class="anchor"><span class="anchor-link"></span></a>Location Service Interactions</h4>
<p>Once the Supervisor and TLA are in the Running state, the Supervisor registers the component with the Location Service. This allows the component to be located so it can be contacted. Registration with Location Service happens only if locationServiceUsage in <a href="describing-components.html">ComponentInfo</a> is not set to <code>DoNotRegister</code>.</p>
<p>If the component has connections and locationServiceUsage in <a href="describing-components.html">ComponentInfo</a> is set to <code>RegisterAndTrackServices</code>, the framework will resolve the components and deliver <code>TrackingEvent</code>s to the TLA through the <code>onTrackingEvent</code> <a href="tracking-connections.html"><code>onTrackingEvent</code></a> handler. </p>
<h2><a href="#shutting-down" name="shutting-down" class="anchor"><span class="anchor-link"></span></a>Shutting Down</h2>
<p>A component may be shutdown by an external administrative program whether it is deployed in a container or standalone. Shutting down may occur when the component is in the <code>Running</code> state, either <code>online</code> or <code>offline</code> (see below).</p>
<h3><a href="#onshutdown" name="onshutdown" class="anchor"><span class="anchor-link"></span></a>onShutdown</h3>
<p>The TLA provides a handler called <code>onShutdown</code> that is called by the Supervisor when shutting down to give the TLA an opportunity to perform any clean up it may require, such as freeing resources.</p>
<p>As with <code>initialize</code>, there is a timeout that the framework will wait for the component to return from <code>onShutdown</code>. This is currently set to 10 seconds and cannot be overridden. If it does not return, it is assumed that the TLA is damaged and the TLA is destroyed immediately. After a successful return from <code>onShutdown</code>, the Supervisor deletes the component. </p>
<dl>
  <dt>Assembly/Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/csw/tree/e13ffcf741fd8438f7de067220952249f110ebec/examples/src/main/scala/example/framework/components/assembly/AssemblyComponentHandlers.scala#L114-L116" target="_blank" title="Go to snippet source">source</a><code class="language-scala">override def onShutdown(): Unit = {
  // clean up resources
}</code></pre></dd>
  <dt>Assembly/Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/csw/tree/e13ffcf741fd8438f7de067220952249f110ebec/examples/src/main/java/example/framework/components/assembly/JAssemblyComponentHandlers.java#L188-L191" target="_blank" title="Go to snippet source">source</a><code class="language-java">@Override
public void onShutdown() {
    // clean up resources
}</code></pre></dd>
  <dt>Hcd/Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/csw/tree/e13ffcf741fd8438f7de067220952249f110ebec/examples/src/main/scala/example/framework/components/hcd/HcdComponentHandlers.scala#L99-L101" target="_blank" title="Go to snippet source">source</a><code class="language-scala">override def onShutdown(): Unit = {
  // clean up resources
}</code></pre></dd>
  <dt>Hcd/Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/csw/tree/e13ffcf741fd8438f7de067220952249f110ebec/examples/src/main/java/example/framework/components/hcd/JHcdComponentHandlers.java#L159-L162" target="_blank" title="Go to snippet source">source</a><code class="language-java">@Override
public void onShutdown() {
    // clean up resources
}</code></pre></dd>
</dl>
<h3><a href="#restarting" name="restarting" class="anchor"><span class="anchor-link"></span></a>Restarting</h3>
<p>A component may be restarted by an external administrative program whether it is deployed in a container or standalone. A restart may occur when the component is in the <code>Running</code> state, either <code>online</code> or <code>offline</code> (see below).</p>
<p>A <code>restart</code> causes the component to be destroyed and re-created with a new TLA. The <code>onShutdown</code> handler is called to allow the component to tidy up before it is destroyed. Then the Supervisor creates a new TLA and the startup proceeds as with <code>initialize</code> above.</p>
<h2><a href="#component-online-and-offline" name="component-online-and-offline" class="anchor"><span class="anchor-link"></span></a>Component Online and Offline</h2>
<p><code>Online</code> describes a component that is currently part of the observing system that is in use. When a component enters the Running state it is also &ldquo;online&rdquo;.</p>
<p>A component is <code>offline</code> when it is operating and available for active observing but is not currently in use.</p>
<p>If a component is to transition from the online state to the offline state, the <code>onGoOffLine</code> handler is called. The component should make any changes in its operation for offline use.</p>
<p>If a component is to transition from the offline state to the online state, the <code>onGoOnline</code> handler is called. The component should make any changes in its operation needed for online use.</p><div class="callout note "><div class="callout-title">Online vs Offline</div>
<p>Unless implemented by the developer, there is no fundamental difference in the inherent behavior of a component when in either state. These two states provide a standard way for code to be implemented via these handlers for the transition from one state to another, allowing the component to prepare itself to be online (ready for operations) or offline (stowed or dormant). Any call to transition to a online/offline state when the component is already in that state is a no op.</p>
<p>However, when offline, a component should take actions that make sense when offline. For instance, it should not follow the telescope motion or take actions as if online. </p></div>
<h3><a href="#isonline" name="isonline" class="anchor"><span class="anchor-link"></span></a>isOnline</h3>
<p>A component has access to the <code>isOnline</code> boolean flag, which can be used to determine if the component is in the online or offline state.</p>
<h3><a href="#ongooffline" name="ongooffline" class="anchor"><span class="anchor-link"></span></a>onGoOffline</h3>
<p>A component can be notified to run in offline mode in case it is not in use. The component can change its behavior if needed as a part of this handler.</p>
<dl>
  <dt>Assembly/Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/csw/tree/e13ffcf741fd8438f7de067220952249f110ebec/examples/src/main/scala/example/framework/components/assembly/AssemblyComponentHandlers.scala#L102-L104" target="_blank" title="Go to snippet source">source</a><code class="language-scala">override def onGoOffline(): Unit = {
  // do something when going offline
}</code></pre></dd>
  <dt>Assembly/Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/csw/tree/e13ffcf741fd8438f7de067220952249f110ebec/examples/src/main/java/example/framework/components/assembly/JAssemblyComponentHandlers.java#L166-L169" target="_blank" title="Go to snippet source">source</a><code class="language-java">@Override
public void onGoOffline() {
    // do something when going offline
}</code></pre></dd>
  <dt>Hcd/Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/csw/tree/e13ffcf741fd8438f7de067220952249f110ebec/examples/src/main/scala/example/framework/components/hcd/HcdComponentHandlers.scala#L87-L89" target="_blank" title="Go to snippet source">source</a><code class="language-scala">override def onGoOffline(): Unit = {
  // do something when going offline
}</code></pre></dd>
  <dt>Hcd/Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/csw/tree/e13ffcf741fd8438f7de067220952249f110ebec/examples/src/main/java/example/framework/components/hcd/JHcdComponentHandlers.java#L137-L140" target="_blank" title="Go to snippet source">source</a><code class="language-java">@Override
public void onGoOffline() {
    // do something when going offline
}</code></pre></dd>
</dl>
<h3><a href="#ongoonline" name="ongoonline" class="anchor"><span class="anchor-link"></span></a>onGoOnline</h3>
<p>A component can be notified to run in online mode again in case it was put to run in offline mode. The component can change its behavior if needed as a part of this handler.</p>
<dl>
  <dt>Assembly/Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/csw/tree/e13ffcf741fd8438f7de067220952249f110ebec/examples/src/main/scala/example/framework/components/assembly/AssemblyComponentHandlers.scala#L108-L110" target="_blank" title="Go to snippet source">source</a><code class="language-scala">override def onGoOnline(): Unit = {
  // do something when going online
}</code></pre></dd>
  <dt>Assembly/Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/csw/tree/e13ffcf741fd8438f7de067220952249f110ebec/examples/src/main/java/example/framework/components/assembly/JAssemblyComponentHandlers.java#L173-L176" target="_blank" title="Go to snippet source">source</a><code class="language-java">@Override
public void onGoOnline() {
    // do something when going online
}</code></pre></dd>
  <dt>Hcd/Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/csw/tree/e13ffcf741fd8438f7de067220952249f110ebec/examples/src/main/scala/example/framework/components/hcd/HcdComponentHandlers.scala#L93-L95" target="_blank" title="Go to snippet source">source</a><code class="language-scala">override def onGoOnline(): Unit = {
  // do something when going online
}</code></pre></dd>
  <dt>Hcd/Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/csw/tree/e13ffcf741fd8438f7de067220952249f110ebec/examples/src/main/java/example/framework/components/hcd/JHcdComponentHandlers.java#L144-L147" target="_blank" title="Go to snippet source">source</a><code class="language-java">@Override
public void onGoOnline() {
    // do something when going online
}</code></pre></dd>
</dl>
<h2><a href="#handling-commands" name="handling-commands" class="anchor"><span class="anchor-link"></span></a>Handling commands</h2>
<p>The remaining handlers are associated with handling incoming commands. There is a handler for submit commands called <code>onSubmit</code> and a handler for oneway called <code>onOneway</code>.</p>
<p>This section gives an introduction to the command handlers. For more information on how to send and monitor commands, see the <a href="../commons/command.html">Communication using Commands</a> page.</p>
<h3><a href="#validatecommand" name="validatecommand" class="anchor"><span class="anchor-link"></span></a>validateCommand</h3>
<p>The <code>validateCommand</code> handler allows the component to inspect a command and its parameters to determine if the actions related to the command can be executed or started. If it is okay, an <code>Accepted</code> response is returned. If not, <code>Invalid</code> is returned. Validation may also take into consideration the state of the component. For instance, if an Assembly or HCD can only handle one command at a time, <code>validateCommand</code> should return an return <code>Invalid</code> if a second command is received. The <code>Invalid</code> returns a <code>CommandIssue</code>, which are a number of pre-defined reasons for failing validation. These pre-defined reasons should be used whenever possible, but there is also an <code>OtherIssue</code> defined.</p><div class="callout note "><div class="callout-title">I have an issue you should add!</div>
<p>If you run across a validation issue you think should be added to <code>CommandIssue</code>, please submit a ticket to the CSW maintenance JIRA page at this <a href="/login.jsp?permissionViolation=true&os_destination=%2Fprojects%2FCSW%2Fissues&page_caps=&user_role=">location</a>. </p></div>
<p>The handler is called whenever a command is sent as a <code>Submit</code>, <code>SubmitAndWait</code>, or <code>Oneway</code> message to the component. If the handler returns <code>Accepted</code>, the corresponding <code>onSubmit</code> or <code>onOneway</code> handler is called.<br/>This handler can also be called when the Command Service method <code>validateCommand</code> is used, to preview the acceptance of a command before it is sent using <code>submit</code> or <code>oneway</code>. In this case, the <code>onSubmit</code> or <code>onOneway</code> handler is not called.</p>
<dl>
  <dt>Assembly/Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/csw/tree/e13ffcf741fd8438f7de067220952249f110ebec/examples/src/main/scala/example/tutorial/basic/sampleassembly/SampleAssemblyHandlers.scala#L119-L144" target="_blank" title="Go to snippet source">source</a><code class="language-scala">override def validateCommand(runId: Id, command: ControlCommand): ValidateCommandResponse =
  command match {
    case setup: Setup =&gt;
      setup.commandName match {
        case `sleep` =&gt;
          validateSleep(runId, setup)
        case `immediateCommand` | `shortCommand` | `mediumCommand` | `longCommand` | `complexCommand` =&gt;
          Accepted(runId)
        case _ =&gt;
          Invalid(runId, UnsupportedCommandIssue(s&quot;Command: ${setup.commandName.name} is not supported for sample Assembly.&quot;))
      }
    case _ =&gt;
      Invalid(runId, UnsupportedCommandIssue(s&quot;Command: ${command.commandName.name} is not supported for sample Assembly.&quot;))
  }

private def validateSleep(runId: Id, setup: Setup): ValidateCommandResponse =
  if (setup.exists(sleepTimeKey)) {
    val sleepTime: Long = setup(sleepTimeKey).head
    if (sleepTime &lt; maxSleep)
      Accepted(runId)
    else
      Invalid(runId, ParameterValueOutOfRangeIssue(&quot;sleepTime must be &lt; 2000&quot;))
  }
  else {
    Invalid(runId, MissingKeyIssue(s&quot;required sleep command key: $sleepTimeKey is missing.&quot;))
  }</code></pre></dd>
  <dt>Assembly/Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/csw/tree/e13ffcf741fd8438f7de067220952249f110ebec/examples/src/main/java/example/tutorial/basic/sampleassembly/JSampleAssemblyHandlers.java#L150-L175" target="_blank" title="Go to snippet source">source</a><code class="language-java">@Override
public ValidateCommandResponse validateCommand(Id runId, ControlCommand command) {
  CommandName cmd = command.commandName();
  if (command instanceof Setup) {
    Setup setup = (Setup) command;
    if (cmd.equals(sleep)) {
      return validateSleep(runId, setup);
    }
    if (cmd.equals(immediateCommand) || cmd.equals(shortCommand) || cmd.equals(mediumCommand) || cmd.equals(longCommand)|| cmd.equals(complexCommand)) {
      return new Accepted(runId);
    }
  }
  return new Invalid(runId, new UnsupportedCommandIssue(&quot;Command: &quot; + cmd.name() + &quot; is not supported for sample Assembly.&quot;));
}

private ValidateCommandResponse validateSleep(Id runId, Setup setup) {
  if (setup.exists(sleepTimeKey)) {
    Long sleepTime = setup.jGet(sleepTimeKey).get().head();
    if (sleepTime &lt; maxSleep)
      return new Accepted(runId);
    else
      return new Invalid(runId, new ParameterValueOutOfRangeIssue(&quot;sleepTime must be &lt; 2000&quot;));
  } else {
    return new Invalid(runId, new MissingKeyIssue(&quot;required sleep command key: &quot; + sleepTimeKey + &quot; is missing.&quot;));
  }
}</code></pre></dd>
  <dt>Hcd/Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/csw/tree/e13ffcf741fd8438f7de067220952249f110ebec/examples/src/main/scala/example/tutorial/basic/samplehcd/SampleHcdHandlers.scala#L94-L101" target="_blank" title="Go to snippet source">source</a><code class="language-scala">override def validateCommand(runId: Id, command: ControlCommand): ValidateCommandResponse =
  command.commandName match {
    case `hcdSleep` | `hcdImmediate` =&gt;
      Accepted(runId)
    case _ =&gt;
      log.error(s&quot;HCD: $prefix received an unsupported command: ${command.commandName.name}&quot;)
      Invalid(runId, UnsupportedCommandIssue(s&quot;Command: ${command.commandName.name} is not supported for HCD: $prefix.&quot;))
  }</code></pre></dd>
  <dt>Hcd/Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/csw/tree/e13ffcf741fd8438f7de067220952249f110ebec/examples/src/main/java/example/tutorial/basic/samplehcd/JSampleHcdHandlers.java#L103-L110" target="_blank" title="Go to snippet source">source</a><code class="language-java">@Override
public ValidateCommandResponse validateCommand(Id runId, ControlCommand command) {
    if (command.commandName().equals(hcdSleep) || command.commandName().equals(hcdImmediate)) {
        return new Accepted(runId);
    }
    log.error(&quot;HCD: &quot; + prefix + &quot; received an unsupported command: &quot; + command.commandName().name());
    return new Invalid(runId, new UnsupportedCommandIssue(&quot;Command &quot; + command.commandName().name() + &quot; is not supported fpr HCD: &quot; + prefix + &quot;.&quot;));
}</code></pre></dd>
</dl>
<h3><a href="#onsubmit" name="onsubmit" class="anchor"><span class="anchor-link"></span></a>onSubmit</h3>
<p>On receiving a command sent using a <code>submit</code> or <code>submitAndWait</code> message, the <code>onSubmit</code> handler is invoked only if the <code>validateCommand</code> handler returns <code>Accepted</code>. The <code>onSubmit</code> handler returns a <code>SubmitResponse</code> indicating if the command is completed immediately, or if it is long-running, by returning a <code>Started</code> response. Completion of long-running commands is tracked using the <code>CommandResponseManager</code>, described in more detail in the <a href="managing-command-state.html">Managing Command State</a> page. </p>
<p>The example shows one way to split <code>Setup</code> and <code>Observe</code> commands into separate handlers. In this case, the Assembly does not support <code>Observe</code> and returns <code>Invalid</code> with the <code>UnsupportedCommandIssue</code>. </p>
<dl>
  <dt>Assembly/Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/csw/tree/e13ffcf741fd8438f7de067220952249f110ebec/examples/src/main/scala/example/tutorial/basic/sampleassembly/SampleAssemblyHandlers.scala#L148-L153" target="_blank" title="Go to snippet source">source</a><code class="language-scala">override def onSubmit(runId: Id, command: ControlCommand): SubmitResponse =
  command match {
    case s: Setup =&gt; onSetup(runId, s)
    case _: Observe =&gt;
      Invalid(runId, UnsupportedCommandIssue(&quot;Observe commands not supported&quot;))
  }</code></pre></dd>
  <dt>Assembly/Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/csw/tree/e13ffcf741fd8438f7de067220952249f110ebec/examples/src/main/java/example/tutorial/basic/sampleassembly/JSampleAssemblyHandlers.java#L179-L185" target="_blank" title="Go to snippet source">source</a><code class="language-java">@Override
public SubmitResponse onSubmit(Id runId, ControlCommand command) {
  if (command instanceof Setup) {
    return onSetup(runId, (Setup) command);
  }
  return new Invalid(runId, new UnsupportedCommandIssue(&quot;Observe commands not supported&quot;));
}</code></pre></dd>
</dl>
<p>Ideally, in the above example, lack of support for <code>Observe</code> should be determined in the <code>validateCommand</code> handler and checking in <code>onSetup</code> should not be needed.</p><div class="callout note "><div class="callout-title">Invalid or Error?</div>
<p>The <code>Invalid</code> response should be used when an issue is found with validation of the command or other issues prior to starting actions. <code>Error</code> is reserved for issues with the actions started by the command.</p></div>
<h3><a href="#ononeway" name="ononeway" class="anchor"><span class="anchor-link"></span></a>onOneway</h3>
<p>On receiving a command as <code>oneway</code>, the <code>onOneway</code> handler is invoked for a component only if the <code>validateCommand</code> handler returns <code>Accepted</code>. The <code>onOneway</code> handler does not return a value and a command submitted with the <code>oneway</code> does not track completion of actions. </p>
<dl>
  <dt>Assembly/Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/csw/tree/e13ffcf741fd8438f7de067220952249f110ebec/examples/src/main/scala/example/framework/components/assembly/AssemblyComponentHandlers.scala#L94-L98" target="_blank" title="Go to snippet source">source</a><code class="language-scala">override def onOneway(runId: Id, controlCommand: ControlCommand): Unit =
  controlCommand match {
    case setup: Setup     =&gt; onewaySetup(runId, setup)     // includes logic to handle Oneway with Setup config command
    case observe: Observe =&gt; onewayObserve(runId, observe) // includes logic to handle Oneway with Observe config command
  }</code></pre></dd>
  <dt>Assembly/Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/csw/tree/e13ffcf741fd8438f7de067220952249f110ebec/examples/src/main/java/example/framework/components/assembly/JAssemblyComponentHandlers.java#L156-L162" target="_blank" title="Go to snippet source">source</a><code class="language-java">@Override
public void onOneway(Id runId, ControlCommand controlCommand) {
    if (controlCommand instanceof Setup)
        onewaySetup(runId, (Setup) controlCommand); // includes logic to handle Oneway with Setup config command
    else if (controlCommand instanceof Observe)
        onewayObserve(runId, (Observe) controlCommand); // includes logic to handle Oneway with Observe config command
}</code></pre></dd>
</dl>
<h2><a href="#handling-diagnostic-data" name="handling-diagnostic-data" class="anchor"><span class="anchor-link"></span></a>Handling Diagnostic Data</h2>
<h3><a href="#ondiagnosticmode" name="ondiagnosticmode" class="anchor"><span class="anchor-link"></span></a>onDiagnosticMode</h3>
<p>A Component can receive a <code>DiagnosticMode</code> command from other components at any time. The <code>onDiagnosticMode</code> handler of the component is invoked on receiving the command. Inside the handler, the components can start publishing some diagnostic data as desired. The <code>DiagnosticMode</code> command can be received by a component only in the Running state and is ignored otherwise. The diagnosticMode handler contains a <code>startTime</code> which is a <a href="https://tmtsoftware.github.io/csw/5.0.0-RC2/api/scala/csw/time/core/models/UTCTime.html" title="csw/time/core/models/UTCTime"><code>UTCTime</code></a> and a String parameter called <code>hint</code> with the name of the technical data mode. The component should read the hint and publish events accordingly.</p>
<p>The startTime is included so a diagnosticMode can be synchronized in time with diagnosticMode starting in other components. The Time Service can be used to schedule execution of some tasks at the specified startTime. Event Service publish API can also be used in order to start publishing events at the specified startTime. A component can only be in one technical data mode at a time. If the component is in one technical data, then on receiving command to go in another technical mode, the component should stop/halt the previous<br/>diagnosticMode handler, and should enter the new technical data mode. Even if the component does not define any diagnostic modes, it must be prepared to receive and process diagnosticMode handler without an error by completing with no changes. This is equivalent to leaving the handler empty.</p><div class="callout note "><div class="callout-title">Note</div>
<p>A component developer should be careful to make any changes in the component&rsquo;s internal state in any callbacks. For example,  while calling <code>timeServiceScheduler.schedule</code> or <code>eventPublisher.publish</code>, if you are trying to mutate state in  the callbacks passed to them, you might run into concurrency issues. Hence, in such scenarios, it is recommended to  use a <code>WorkerActor</code> to manage the state.</p></div>
<p>The supported diagnostic mode hints of a component are published in the component&rsquo;s model files. Unsupported hints should be rejected by a component.</p>
<p>The example shows one usage of <code>onDiagnosticMode</code> handler.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/csw/tree/e13ffcf741fd8438f7de067220952249f110ebec/examples/src/main/scala/org/tmt/csw/sample/CurrentStateExampleComponentHandlers.scala#L201-L213" target="_blank" title="Go to snippet source">source</a><code class="language-scala">// While dealing with mutable state, make sure you create a worker actor to avoid concurrency issues
// For functionality demonstration, we have simply used a mutable variable without worker actor
var diagModeCancellable: Option[Cancellable] = None

override def onDiagnosticMode(startTime: UTCTime, hint: String): Unit = {
  hint match {
    case &quot;engineering&quot; =&gt;
      val event = SystemEvent(prefix, diagnosticDataEventName).add(diagnosticModeParam)
      diagModeCancellable.foreach(_.cancel()) // cancel previous diagnostic publishing
      diagModeCancellable = Some(eventService.defaultPublisher.publish(Some(event), startTime, 200.millis))
    case _ =&gt;
  }
}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/csw/tree/e13ffcf741fd8438f7de067220952249f110ebec/examples/src/main/java/org/tmt/csw/sample/JCurrentStateExampleComponentHandlers.java#L259-L275" target="_blank" title="Go to snippet source">source</a><code class="language-java">@Override
public void onDiagnosticMode(UTCTime startTime, String hint) {
    if (hint.equals(&quot;engineering&quot;)) {
        var event = new SystemEvent(Prefix.apply(JSubsystem.TCS, &quot;prefix&quot;), new EventName(&quot;eventName&quot;))
                .add(JKeyType.IntKey().make(&quot;diagnostic-data&quot;, JUnits.NoUnits).set(1));
        diagModeCancellable.map(Cancellable::cancel); // cancel previous diagnostic publishing
        diagModeCancellable = Optional.of(
                eventService.defaultPublisher().publish(
                        () -&gt; Optional.of(event),
                        startTime,
                        Duration.ofMillis(200)
                )

        );
    }
    // other supported diagnostic modes go here
}</code></pre></dd>
</dl>
<h3><a href="#onoperationsmode" name="onoperationsmode" class="anchor"><span class="anchor-link"></span></a>onOperationsMode</h3>
<p>Components can receive an <code>OperationsMode</code> command which is used to halt all diagnostic modes. The <code>onOperationsMode</code> handler of the component will be invoked on receiving this command. Similar to <code>DiagnosticMode</code> command, the <code>OperationsMode</code> command is also handled only in the Running state and is ignored otherwise. If in a technical data mode, the component should immediately halt its diagnostic mode and return to normal operations behavior. Even if the component does not define any diagnostic modes, it must be prepared to receive and process an <code>onOperationsMode</code> handler call. The component should return completion without error.</p>
<p>The example shows one usage of <code>onOperationsMode</code> handler.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/csw/tree/e13ffcf741fd8438f7de067220952249f110ebec/examples/src/main/scala/org/tmt/csw/sample/CurrentStateExampleComponentHandlers.scala#L217-L219" target="_blank" title="Go to snippet source">source</a><code class="language-scala">override def onOperationsMode(): Unit = {
  diagModeCancellable.foreach(_.cancel())
}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/csw/tree/e13ffcf741fd8438f7de067220952249f110ebec/examples/src/main/java/org/tmt/csw/sample/JCurrentStateExampleComponentHandlers.java#L279-L282" target="_blank" title="Go to snippet source">source</a><code class="language-java">@Override
public void onOperationsMode() {
    diagModeCancellable.map(Cancellable::cancel); // cancel diagnostic mode
}</code></pre></dd>
</dl>
</div>
<div>
<a href="https://github.com/tmtsoftware/csw/tree/e13ffcf741fd8438f7de067220952249f110ebec/docs/src/main/framework/handling-lifecycle.md" title="Edit this page" class="md-source-file md-edit">
Edit this page
</a>
</div>
<div class="print-only">
<span class="md-source-file md-version">
5.0.0-RC2
</span>
</div>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-nav">
<nav class="md-footer-nav__inner md-grid">
<a href="../framework/creating-components.html" title="Creating an Assembly or Hcd Component" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
</div>
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Previous
</span>
Creating an Assembly or Hcd Component
</span>
</div>
</a>
<a href="../framework/managing-command-state.html" title="Managing Command State" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Next
</span>
Managing Command State
</span>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
</div>
</a>
</nav>
</div>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
Powered by
<a href="https://github.com/lightbend/paradox">Paradox</a>
and
<a href="https://jonas.github.io/paradox-material-theme/">Paradox Material Theme</a>

</div>
</div>
</div>
</footer>

</div>
<script src="../assets/javascripts/application.583bbe55.js"></script>
<script src="../assets/javascripts/paradox-material-theme.js"></script>
<script>app.initialize({version:"0.17",url:{base:"../."}})</script>
<script type="text/javascript" src="../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function(event) {
window.prettyPrint && prettyPrint();
});
</script>
</body>
</html>
