<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="description" content="docs">
<meta name="generator" content="Paradox, paradox-material-theme=0.4.0, mkdocs-material=2.2.2">

<meta name="lang:clipboard.copy" content="Copy to clipboard">
<meta name="lang:clipboard.copied" content="Copied to clipboard">
<meta name="lang:search.result.none" content="No matching documents">
<meta name="lang:search.result.one" content="1 matching document">
<meta name="lang:search.result.other" content="# matching documents">
<meta name="lang:search.language" content="">
<meta name="lang:search.tokenizer" content="[\s\-]+">


<meta name="description" content="docs">
<link rel="shortcut icon" href="../assets/tmt_favicon.ico">
<title>Component Handlers · TMT Common Software (CSW)</title>
<link rel="stylesheet" href="../assets/stylesheets/application.7a4cdee3.css">
<link rel="stylesheet" href="../lib/material__tabs/dist/mdc.tabs.min.css">
<link rel="stylesheet" href="../lib/prettify/prettify.css">
<script src="../lib/modernizr/modernizr.min.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
<style>
body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}
code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}
</style>
<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="../assets/stylesheets/paradox-material-theme.css">
</head>
<body
>
<input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
<input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
<label class="md-overlay" data-md-component="overlay" for="drawer"></label>
<header class="md-header" data-md-component="header">
<nav class="md-header-nav md-grid">
<div class="md-flex">
<div class="md-flex__cell md-flex__cell--shrink">
<a href="../index.html" title="TMT Common Software (CSW)" class="md-header-nav__button md-logo">
<i class="md-icon">local_library</i>
</a>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
</div>
<div class="md-flex__cell md-flex__cell--stretch">
<div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
<span class="md-header-nav__topic">
TMT Common Software (CSW)
</span>
<span class="md-header-nav__topic">
Component Handlers
</span>
</div>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="search"></label>
<div class="md-search__inner">
<form class="md-search__form" name="search">
<input type="text" class="md-search__input" name="query" required placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query">
<label class="md-icon md-search__icon" for="search"></label>
<button type="reset" class="md-icon md-search__icon" data-md-component="reset">&#xE5CD;</button>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix>
<div class="md-search-result" data-md-component="result">
<div class="md-search-result__meta">
Type to start searching
</div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>

</div>
<div class="md-flex__cell md-flex__cell--shrink">
<div class="md-header-nav__source">
<a href="https://github.com/tmtsoftware/csw-prod"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
tmtsoftware/csw-prod
</div>
</a>

</div>
</div>
</div>
</nav>
</header>

<div class="md-container">
<main class="md-main">
<div class="md-main__inner md-grid" data-md-component="container">
<div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--primary" data-md-level="0" style="visibility: hidden">
<label class="md-nav__title md-nav__title--site" for="drawer">
<span class="md-nav__button md-logo">
<i class="md-icon">local_library</i>
</span>
<a href="../index.html" title="TMT Common Software (CSW)">
TMT Common Software (CSW)
</a>
</label>
<div class="md-nav__source">
<a href="https://github.com/tmtsoftware/csw-prod"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
tmtsoftware/csw-prod
</div>
</a>

</div>
<ul>
  <li><a href="../commons/getting-started.html" class="page">Getting Started</a></li>
  <li><a href="../commons/create-component.html" class="page">Creating a Component</a></li>
  <li><a href="../commons/multiple-components.html" class="page">Multiple Components</a></li>
  <li><a href="../commons/messages.html" class="page">Messages</a>
  <ul>
    <li><a href="../messages/keys-parameters.html" class="page">Keys and Parameters</a></li>
    <li><a href="../messages/units.html" class="page">Units</a></li>
    <li><a href="../messages/subsystem.html" class="page">Subsystem</a></li>
    <li><a href="../messages/commands.html" class="page">Commands</a></li>
    <li><a href="../messages/events.html" class="page">Events</a></li>
    <li><a href="../messages/states.html" class="page">State Variables</a></li>
    <li><a href="../messages/result.html" class="page">Result</a></li>
  </ul></li>
  <li><a href="../commons/framework.html" class="page">Framework for creating components (HCD, Assembly, Container)</a>
  <ul>
    <li><a href="../framework/describing-components.html" class="page">ComponentInfo</a></li>
    <li><a href="../framework/creating-components.html" class="page">Creating an Assembly or Hcd Component</a></li>
    <li><a href="../framework/handling-lifecycle.html" class="active page">Component Handlers</a></li>
    <li><a href="../framework/managing-command-state.html" class="page">Managing Command State</a></li>
    <li><a href="../framework/tracking-connections.html" class="page">Tracking Connections</a></li>
    <li><a href="../framework/publishing-state.html" class="page">Publishing State</a></li>
    <li><a href="../framework/handling-exceptions.html" class="page">Handling Exceptions</a></li>
    <li><a href="../framework/deploying-components.html" class="page">Deploying Components</a></li>
  </ul></li>
  <li><a href="../commons/command.html" class="page">Communication using Commands</a></li>
  <li><a href="../commons/services.html" class="page">Services</a>
  <ul>
    <li><a href="../services/location.html" class="page">Location Service</a></li>
    <li><a href="../services/config.html" class="page">Configuration Service</a></li>
    <li><a href="../services/logging.html" class="page">Logging Service</a></li>
    <li><a href="../services/event.html" class="page">Event Service</a></li>
  </ul></li>
  <li><a href="../commons/apps.html" class="page">Applications</a>
  <ul>
    <li><a href="../apps/cswclusterseed.html" class="page">csw-cluster-seed</a></li>
    <li><a href="../apps/cswlocationagent.html" class="page">csw-location-agent</a></li>
    <li><a href="../apps/cswonfigserverapp.html" class="page">csw-config-server</a></li>
    <li><a href="../apps/cswconfigclientcli.html" class="page">csw-config-client-cli</a></li>
    <li><a href="../apps/csweventcli.html" class="page">csw-event-cli</a></li>
    <li><a href="../apps/hostconfig.html" class="page">csw-host-config</a></li>
  </ul></li>
  <li><a href="../commons/testing.html" class="page">Testing</a></li>
  <li><a href="../commons/sbt-tasks.html" class="page">sbt Tasks</a></li>
  <li><a href="../commons/manuals.html" class="page">Manuals</a></li>
</ul>
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="toc">Table of contents</label>
<ul>
  <li><a href="../framework/handling-lifecycle.html#component-handlers" class="header">Component Handlers</a>
  <ul>
    <li><a href="../framework/handling-lifecycle.html#component-lifecycle" class="header">Component Lifecycle</a></li>
    <li><a href="../framework/handling-lifecycle.html#shutting-down" class="header">Shutting Down</a></li>
    <li><a href="../framework/handling-lifecycle.html#component-online-and-offline" class="header">Component Online and Offline</a></li>
    <li><a href="../framework/handling-lifecycle.html#handling-commands" class="header">Handling commands</a></li>
  </ul></li>
</ul>
</nav>

<div class="md-nav__title--site md-version" title="Version">
<i class="md-icon">label_outline</i> 0.5.0
</div>
</nav>

</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="toc">Table of contents</label>
<ul>
  <li><a href="../framework/handling-lifecycle.html#component-handlers" class="header">Component Handlers</a>
  <ul>
    <li><a href="../framework/handling-lifecycle.html#component-lifecycle" class="header">Component Lifecycle</a></li>
    <li><a href="../framework/handling-lifecycle.html#shutting-down" class="header">Shutting Down</a></li>
    <li><a href="../framework/handling-lifecycle.html#component-online-and-offline" class="header">Component Online and Offline</a></li>
    <li><a href="../framework/handling-lifecycle.html#handling-commands" class="header">Handling commands</a></li>
  </ul></li>
</ul>
</nav>

</div>
</div>
</div>
<div class="md-content">
<article class="md-content__inner md-typeset">
<div class="md-content__searchable">
<h1><a href="#component-handlers" name="component-handlers" class="anchor"><span class="anchor-link"></span></a>Component Handlers</h1>
<p>A component developer creates a Top Level Actor (TLA) by inheriting from an abstract class <a href="https://tmtsoftware.github.io/csw-prod/0.5.0/api/scala/csw/framework/scaladsl/ComponentHandlers.html">ComponentHandlers</a> or <a href="https://tmtsoftware.github.io/csw-prod/0.5.0/api/java/?csw/framework/javadsl/JComponentHandlers.html">JComponentHandlers</a> for Scala or Java, respectively. Each of these abstract classes provides several <strong>handler</strong> methods that can be overridden by the developer to provide component-specific code as described below. </p>
<h2><a href="#component-lifecycle" name="component-lifecycle" class="anchor"><span class="anchor-link"></span></a>Component Lifecycle</h2>
<p>For each component, the CSW framework creates a <code>Supervisor</code> that creates the TLA, and along with the abstract behavior class provided by the framework, it starts up and intiailizes the component in a standardized way. At the conclusion of the startup of the component, it is ready to receive commands from the outside world. The following figure is used to describe the startup lifecycle interactions between the framework and the TLA.</p>
<p><img src="../images/framework/Lifecycle.png" alt="lifecycle" /></p>
<p>As described in <a href="../commons/create-component.html">Creating a Component</a>, in either standalone or when running within a container, a <code>Supervisor</code> is created with a <a href="describing-components.html">ComponentInfo</a> file. The figure shows that the Supervisor in the framework creates the specified TLA. Once the TLA is created, the framework calls the <code>initialize</code> handler. This is the oportunity for the component to perform initialization needed before it is ready to receive commands.</p>
<p>The TLA indicates a successful <code>initialize</code> by returning. If it cannot initialize, it can throw an exception, which will be caught and logged. The Supervisor will retry the creation and initialization of the TLA three times. If it fails after three times processing stops.</p><div class="callout note "><div class="callout-title">Note</div>
<p>After failing to create and initialize three times, the Supervisor will log a message and stop. In the future when the Alarm Service exists, there will probably be an alarm that will be set to notify the operator of a failure since there is serious problem.</p></div>
<p>When <code>initialize</code> succeeds, the Supervisor in the framework and the component itself enter the Running state. When in the Running state, commands received from outside the component are passed to the TLA (see below).</p>
<h3><a href="#initialize" name="initialize" class="anchor"><span class="anchor-link"></span></a>initialize</h3>
<p>The <code>initialize</code> handler is invoked when the component is created. This is different than constructor initialization to allow non-blocking asynchronous operations. The component can initialize state such as configuration to be fetched from Configuration Service, location of components or services to be fetched from Location Service etc. These vary from component to component.</p>
<dl>
  <dt>Assembly/Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">override def initialize(): Future[Unit] = async {

  // Initialization could include following steps :

  // 1. fetch config (preferably from configuration service)
  val calculationConfig = await(getAssemblyConfig)

  // 2. create a worker actor which is used by this assembly
  val worker: ActorRef[WorkerActorMsg] = ctx.spawnAnonymous(WorkerActor.make(calculationConfig))

  // 3. find a Hcd connection from the connections provided in componentInfo
  val maybeConnection =
    componentInfo.connections.find(connection ⇒ connection.componentId.componentType == ComponentType.HCD)

  // 4. If an Hcd is found as a connection, resolve its location from location service and create other
  // required worker actors required by this assembly

  maybeConnection match {
    case Some(_) ⇒
      resolveHcd().map {
        case Some(hcd) ⇒
          runningHcds = runningHcds.updated(maybeConnection.get, Some(new CommandService(hcd)(ctx.system)))
          diagnosticsPublisher = ctx.spawnAnonymous(DiagnosticsPublisher.make(runningHcds(maybeConnection.get).get, worker))
          commandHandler = ctx.spawnAnonymous(CommandHandler.make(calculationConfig, runningHcds(maybeConnection.get)))
        case None ⇒ // do something
      }
    case None ⇒ Future.successful(Unit)
  }

}</code></pre></dd>
  <dt>Assembly/Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">@Override
public CompletableFuture&lt;Void&gt; jInitialize() {

    // fetch config (preferably from configuration service)
    CompletableFuture&lt;ConfigData&gt; configDataCompletableFuture = getAssemblyConfig();

    // create a worker actor which is used by this assembly
    CompletableFuture&lt;ActorRef&lt;WorkerActorMsg&gt;&gt; worker =
            configDataCompletableFuture.thenApply(config -&gt; ctx.spawnAnonymous(WorkerActor.make(config)));

    // find a Hcd connection from the connections provided in componentInfo
    Optional&lt;Connection&gt; mayBeConnection = componentInfo.getConnections().stream()
            .filter(connection -&gt; connection.componentId().componentType() == JComponentType.HCD)
            .findFirst();

    // If an Hcd is found as a connection, resolve its location from location service and create other
    return mayBeConnection.map(connection -&gt;
            worker.thenAcceptBoth(resolveHcd(), (workerActor, hcdLocation) -&gt; {
                if (!hcdLocation.isPresent())
                    throw new HcdNotFoundException();
                else {
                    runningHcds.put(connection, Optional.of(new JCommandService(hcdLocation.get(), ctx.getSystem())));
                }
                diagnosticPublisher = ctx.spawnAnonymous(JDiagnosticsPublisherFactory.make(new JCommandService(hcdLocation.get(), ctx.getSystem()), workerActor));
            })).get();

}</code></pre></dd>
  <dt>Hcd/Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">override def initialize(): Future[Unit] = async {

  // fetch config (preferably from configuration service)
  val hcdConfig = await(getHcdConfig)

  // create a worker actor which is used by this hcd
  val worker: ActorRef[WorkerActorMsg] = ctx.spawnAnonymous(WorkerActor.make(hcdConfig))

  // initialise some state by using the worker actor created above
  current = await(worker ? InitialState)
  stats = await(worker ? GetStatistics)

}</code></pre></dd>
  <dt>Hcd/Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">@Override
public CompletableFuture&lt;Void&gt; jInitialize() {

    // fetch config (preferably from configuration service)
    getConfig().thenAccept(config -&gt; hcdConfig = config);

    // create a worker actor which is used by this hcd
    worker = ctx.spawnAnonymous(WorkerActor.make(hcdConfig));

    // initialise some state by using the worker actor created above
    CompletionStage&lt;Integer&gt; askCurrent = AskPattern.ask(worker, WorkerActorMsgs.JInitialState::new, new Timeout(5, TimeUnit.SECONDS), ctx.getSystem().scheduler());
    CompletableFuture&lt;Void&gt; currentFuture = askCurrent.thenAccept(c -&gt; current = c).toCompletableFuture();

    CompletionStage&lt;Integer&gt; askStats = AskPattern.ask(worker, WorkerActorMsgs.JInitialState::new, new Timeout(5, TimeUnit.SECONDS), ctx.getSystem().scheduler());
    CompletableFuture&lt;Void&gt; statsFuture = askStats.thenAccept(s -&gt; stats = s).toCompletableFuture();

    return CompletableFuture.allOf(currentFuture, statsFuture);
}
</code></pre></dd>
</dl>
<h4><a href="#creation-timeout" name="creation-timeout" class="anchor"><span class="anchor-link"></span></a>Creation Timeout</h4>
<p>The <code>Supervisor</code> waits for the <code>initialize</code> to complete. If it times out, it will retry the creation of the TLA 3 times in the same way as with initialize failures. The timeout value is configurable by the TLA by setting the <code>initializeTimeout</code> value in <a href="describing-components.html">ComponentInfo</a>.</p>
<h4><a href="#location-service-interactions" name="location-service-interactions" class="anchor"><span class="anchor-link"></span></a>Location Service Interactions</h4>
<p>Once the Supervisor and TLA are in the Running state, the Supervisor registers the component with the Location Service. This allows the component to be located so it can be contacted. Registration with Location Service happens only if locationServiceUsage in <a href="describing-components.html">ComponentInfo</a> is not set to <code>DoNotRegister</code>.</p>
<p>If the component has connections and locationServiceUsage in <a href="describing-components.html">ComponentInfo</a> is set to <code>RegisterAndTrackServices</code>, the framework will resolve the components and deliver <code>TrackingEvent</code>s to the TLA through the <code>onTrackingEvent</code> <a href="tracking-connections.html"><code>onTrackingEvent</code></a> handler. </p>
<h2><a href="#shutting-down" name="shutting-down" class="anchor"><span class="anchor-link"></span></a>Shutting Down</h2>
<p>A component may be shutdown by an external administrative program whether it is deployed in a container or standalone. Shutting down may occur when the component is <code>Running</code>/<code>onLine</code> or <code>offLine</code> (see below).</p>
<p>The TLA provides a handler called <code>onShutdown</code> that is called by the Supervisor when shutting down to give the TLA an opportunity to perform any clean up it may require such as freeing resources.</p>
<p>As with <code>initialize</code> the framework will only wait for 10 seconds for the component to return from <code>doShutdown</code>. If it does not return, it is assumed the TLA is damaged. After successful return from <code>doShutdown</code>, the Supervisor deletes the component. The <code>doShutdown</code> timeout cannot be changed.</p>
<h3><a href="#onshutdown" name="onshutdown" class="anchor"><span class="anchor-link"></span></a>onShutdown</h3>
<p>The <code>onShutdown</code> handler can be used for carrying out the tasks which will allow the component to shutdown gracefully. </p>
<dl>
  <dt>Assembly/Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">override def onShutdown(): Future[Unit] = async {
  // clean up resources
}</code></pre></dd>
  <dt>Assembly/Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">@Override
public CompletableFuture&lt;Void&gt; jOnShutdown() {
    // clean up resources
    return new CompletableFuture&lt;&gt;();
}</code></pre></dd>
  <dt>Hcd/Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">override def onShutdown(): Future[Unit] = async {
  // clean up resources
}</code></pre></dd>
  <dt>Hcd/Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">@Override
public CompletableFuture&lt;Void&gt; jOnShutdown() {
    return CompletableFuture.runAsync(() -&gt; {
        // clean up resources
    });
}</code></pre></dd>
</dl>
<h3><a href="#restarting" name="restarting" class="anchor"><span class="anchor-link"></span></a>Restarting</h3>
<p>A component may be restarted by an external administrative program whether it is deployed in a container or standalone. A restart may occur when the component is <code>Running</code>/<code>onLine</code> or <code>offLine</code> (see below).</p>
<p>A <code>restart</code> causes the component to be destroyed and re-created with a new TLA. The <code>onShutdown</code> handler is called to allow the component to tidy up before it is destroyed. Then the Supervisor creates a new TLA and the startup proceeds as with <code>initialize</code> above.</p>
<h2><a href="#component-online-and-offline" name="component-online-and-offline" class="anchor"><span class="anchor-link"></span></a>Component Online and Offline</h2>
<p><code>Online</code> describes a component that is currently part of the observing system that is in use. When a component enters the Running state it is also &ldquo;online&rdquo;.</p>
<p>A component is <code>offline</code> when it is operating and available for active observing but is not currently in use.</p>
<p>If a component is to transition from the online state to the offline state, the <code>onGoOffLine</code> handler is called. The component should make any changes in its operation for offline use.</p>
<p>If a component is to transition from the offline state to the online state, the <code>onGoOnline</code> handler is called. The component should make any changes in its operation needed for online use.</p>
<h3><a href="#isonline" name="isonline" class="anchor"><span class="anchor-link"></span></a>isOnline</h3>
<p>A component has access to the <code>isOnline</code> boolean flag, which can be used to determine if the component is in the online or offline state.</p>
<h3><a href="#ongooffline" name="ongooffline" class="anchor"><span class="anchor-link"></span></a>onGoOffline</h3>
<p>A component can be notified to run in offline mode in case it is not in use. The component can change its behavior if needed as a part of this handler.</p>
<dl>
  <dt>Assembly/Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">override def onGoOffline(): Unit = {
  // do something when going offline
}</code></pre></dd>
  <dt>Assembly/Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">@Override
public void onGoOffline() {
    // do something when going offline
}</code></pre></dd>
  <dt>Hcd/Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">override def onGoOffline(): Unit = {
  // do something when going offline
}</code></pre></dd>
  <dt>Hcd/Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">@Override
public void onGoOffline() {
    // do something when going offline
}</code></pre></dd>
</dl>
<h3><a href="#ongoonline" name="ongoonline" class="anchor"><span class="anchor-link"></span></a>onGoOnline</h3>
<p>A component can be notified to run in online mode again in case it was put to run in offline mode. The component can change its behavior if needed as a part of this handler.</p>
<dl>
  <dt>Assembly/Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">override def onGoOnline(): Unit = {
  // do something when going online
}</code></pre></dd>
  <dt>Assembly/Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">@Override
public void onGoOnline() {
    // do something when going online
}</code></pre></dd>
  <dt>Hcd/Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">override def onGoOnline(): Unit = {
  // do something when going online
}</code></pre></dd>
  <dt>Hcd/Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">@Override
public void onGoOnline() {
    // do something when going online
}</code></pre></dd>
</dl>
<h2><a href="#handling-commands" name="handling-commands" class="anchor"><span class="anchor-link"></span></a>Handling commands</h2>
<p>The remaining handlers are associated with handling incoming commands. There is a handler for submit commands called <code>onSubmit</code> and a handler for oneway called <code>onOneway</code>.</p>
<h3><a href="#validatecommand" name="validatecommand" class="anchor"><span class="anchor-link"></span></a>validateCommand</h3>
<p>Whenever a command is received by a component it is first validated. The component should inspect the command and its parameters to determine if the actions related to the command can be executed or started.</p>
<p>A command can be sent as a <code>Submit</code> or <code>Oneway</code> message to the component. If a command can be completed immediately, a <code>CommandResponse</code> indicating the final response for the command can be returned. If a command requires time for processing, the component is required to validate the <code>ControlCommand</code> received and return a validation result as <code>Accepted</code> or <code>Invalid</code>. The final response for a command sent as <code>Submit</code> can be obtained by the sender command by querying or subscribing for this response to the component as described here. </p>
<dl>
  <dt>Assembly/Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">override def validateCommand(controlCommand: ControlCommand): CommandResponse = controlCommand match {
  case _: Setup   ⇒ Accepted(controlCommand.runId) // validation for setup goes here
  case _: Observe ⇒ Accepted(controlCommand.runId) // validation for observe goes here
}</code></pre></dd>
  <dt>Assembly/Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">@Override
public CommandResponse validateCommand(ControlCommand controlCommand) {
    if (controlCommand instanceof Setup) {
        // validation for setup goes here
        // after validation of the controlCommand, update its status of successful validation as Accepted
        CommandResponse.Accepted accepted = new CommandResponse.Accepted(controlCommand.runId());
        commandResponseManager.addOrUpdateCommand(controlCommand.runId(), accepted);
        return new CommandResponse.Accepted(controlCommand.runId());
    } else if (controlCommand instanceof Observe) {
        // validation for observe goes here
        return new CommandResponse.Accepted(controlCommand.runId());
    } else {
        return new CommandResponse.Invalid(controlCommand.runId(), new CommandIssue.AssemblyBusyIssue(&quot;Command not supported&quot;));
    }
}</code></pre></dd>
  <dt>Hcd/Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">override def validateCommand(controlCommand: ControlCommand): CommandResponse = controlCommand match {
  case _: Setup   ⇒ Accepted(controlCommand.runId) // validation for setup goes here
  case _: Observe ⇒ Accepted(controlCommand.runId) // validation for observe goes here
}</code></pre></dd>
  <dt>Hcd/Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">@Override
public CommandResponse validateCommand(ControlCommand controlCommand) {
    if (controlCommand instanceof Setup) {
        // validation for setup goes here
        return new CommandResponse.Accepted(controlCommand.runId());
    } else if (controlCommand instanceof Observe) {
        // validation for observe goes here
        return new CommandResponse.Accepted(controlCommand.runId());
    } else {
        return new CommandResponse.CommandNotAvailable(controlCommand.runId());
    }
}</code></pre></dd>
</dl>
<p>If a response can be provided immediately, a final <code>CommandResponse</code> such as <code>CommandCompleted</code> or <code>Error</code> can be sent from this handler.</p>
<h3><a href="#onsubmit" name="onsubmit" class="anchor"><span class="anchor-link"></span></a>onSubmit</h3>
<p>On receiving a command as <code>Submit</code>, the <code>onSubmit</code> handler is invoked for a component only if the <code>validateCommand</code> handler returns <code>Accepted</code>. In case a command is received as a submit, the command response should be updated in the <code>CommandResponseManager</code>, which is an actor (A reference to it is passed to the component handler constructor). </p>
<dl>
  <dt>Assembly/Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">override def onSubmit(controlCommand: ControlCommand): Unit = controlCommand match {
  case setup: Setup     ⇒ submitSetup(setup) // includes logic to handle Submit with Setup config command
  case observe: Observe ⇒ submitObserve(observe) // includes logic to handle Submit with Observe config command
}</code></pre></dd>
  <dt>Assembly/Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">@Override
public void onSubmit(ControlCommand controlCommand) {
    if (controlCommand instanceof Setup)
        submitSetup((Setup) controlCommand); // includes logic to handle Submit with Setup config command
    else if (controlCommand instanceof Observe)
        submitObserve((Observe) controlCommand); // includes logic to handle Submit with Observe config command
}</code></pre></dd>
  <dt>Hcd/Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">override def onSubmit(controlCommand: ControlCommand): Unit = controlCommand match {
  case setup: Setup     ⇒ submitSetup(setup) // includes logic to handle Submit with Setup config command
  case observe: Observe ⇒ submitObserve(observe) // includes logic to handle Submit with Observe config command
}</code></pre></dd>
  <dt>Hcd/Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">@Override
public void onSubmit(ControlCommand controlCommand) {
    if (controlCommand instanceof Setup)
        submitSetup((Setup) controlCommand); // includes logic to handle Submit with Setup config command
    else if (controlCommand instanceof Observe)
        submitObserve((Observe) controlCommand); // includes logic to handle Submit with Observe config command
}</code></pre></dd>
</dl>
<h3><a href="#ononeway" name="ononeway" class="anchor"><span class="anchor-link"></span></a>onOneway</h3>
<p>On receiving a command as <code>Oneway</code>, the <code>onOneway</code> handler is invoked for a component only if the <code>validateCommand</code> handler returns <code>Accepted</code>.In case a command is received as a oneway, command response should not be provided to the sender.</p>
<dl>
  <dt>Assembly/Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">override def onOneway(controlCommand: ControlCommand): Unit = controlCommand match {
  case setup: Setup     ⇒ onewaySetup(setup) // includes logic to handle Oneway with Setup config command
  case observe: Observe ⇒ onewayObserve(observe) // includes logic to handle Oneway with Observe config command
}</code></pre></dd>
  <dt>Assembly/Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">@Override
public void onOneway(ControlCommand controlCommand) {
    if (controlCommand instanceof Setup)
        onewaySetup((Setup) controlCommand); // includes logic to handle Oneway with Setup config command
    else if (controlCommand instanceof Observe)
        onewayObserve((Observe) controlCommand); // includes logic to handle Oneway with Observe config command
}</code></pre></dd>
  <dt>Hcd/Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">override def onOneway(controlCommand: ControlCommand): Unit = controlCommand match {
  case setup: Setup     ⇒ onewaySetup(setup) // includes logic to handle Oneway with Setup config command
  case observe: Observe ⇒ onewayObserve(observe) // includes logic to handle Oneway with Setup config command
}</code></pre></dd>
  <dt>Hcd/Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">@Override
public void onOneway(ControlCommand controlCommand) {
    if (controlCommand instanceof Setup)
        onewaySetup((Setup) controlCommand); // includes logic to handle Oneway with Setup config command
    else if (controlCommand instanceof Observe)
        onewayObserve((Observe) controlCommand); // includes logic to handle Oneway with Observe config command
}</code></pre></dd>
</dl>
</div>
<div>
<a href="https://github.com/tmtsoftware/csw-prod/tree/v0.5.0/docs/src/main/framework/handling-lifecycle.md" title="Edit this page" class="md-source-file md-edit">
Edit this page
</a>
</div>
<div class="print-only">
<span class="md-source-file md-version">
0.5.0
</span>
</div>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-nav">
<nav class="md-footer-nav__inner md-grid">
<a href="../framework/creating-components.html" title="Creating an Assembly or Hcd Component" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
</div>
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Previous
</span>
Creating an Assembly or Hcd Component
</span>
</div>
</a>
<a href="../framework/managing-command-state.html" title="Managing Command State" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Next
</span>
Managing Command State
</span>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
</div>
</a>
</nav>
</div>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
Powered by
<a href="https://github.com/lightbend/paradox">Paradox</a>
and
<a href="https://jonas.github.io/paradox-material-theme/">Paradox Material Theme</a>

</div>
</div>
</div>
</footer>

</div>
<script src="../assets/javascripts/application.5165553b.js"></script>
<script src="../assets/javascripts/paradox-material-theme.js"></script>
<script>app.initialize({version:"0.17",url:{base:"../."}})</script>
<script type="text/javascript" src="../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function(event) {
window.prettyPrint && prettyPrint();
});
</script>
</body>
</html>
