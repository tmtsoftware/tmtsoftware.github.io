<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="description" content="docs">
<meta name="generator" content="Paradox, paradox-material-theme=0.6.0, mkdocs-material=3.0.3">

<meta name="lang:clipboard.copy" content="Copy to clipboard">
<meta name="lang:clipboard.copied" content="Copied to clipboard">
<meta name="lang:search.language" content="">
<meta name="lang:search.pipeline.stopwords" content="true">
<meta name="lang:search.pipeline.trimmer" content="true">
<meta name="lang:search.result.none" content="No matching documents">
<meta name="lang:search.result.one" content="1 matching document">
<meta name="lang:search.result.other" content="# matching documents">
<meta name="lang:search.tokenizer" content="[\s\-]+">


<meta name="description" content="docs">
<link rel="shortcut icon" href="../../assets/tmt_favicon.ico">
<title>Configuration Service Â· TMT Common Software (CSW)</title>
<link rel="stylesheet" href="../../assets/stylesheets/application.451f80e5.css">
<link rel="stylesheet" href="../../lib/material__tabs/dist/mdc.tabs.min.css">
<link rel="stylesheet" href="../../lib/prettify/prettify.css">
<script src="../../assets/javascripts/modernizr.1aa3b519.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
<style>
body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}
code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}
</style>
<link rel="stylesheet" href="../../assets/fonts/font-awesome.css">
<link rel="stylesheet" href="../../assets/fonts/material-icons.css">
<link rel="stylesheet" href="../../assets/stylesheets/paradox-material-theme.css">
</head>
<body
>
<input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
<input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
<label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
<header class="md-header" data-md-component="header">
<nav class="md-header-nav md-grid">
<div class="md-flex">
<div class="md-flex__cell md-flex__cell--shrink">
<a href="../../index.html" title="TMT Common Software (CSW)" class="md-header-nav__button md-logo">
<i class="md-icon">local_library</i>
</a>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
</div>
<div class="md-flex__cell md-flex__cell--stretch">
<div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
<span class="md-header-nav__topic">
TMT Common Software (CSW)
</span>
<span class="md-header-nav__topic">
Configuration Service
</span>
</div>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
<label class="md-icon md-search__icon" for="__search"></label>
<button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">&#xE5CD;</button>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix>
<div class="md-search-result" data-md-component="result">
<div class="md-search-result__meta">
Type to start searching
</div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>

</div>
<div class="md-flex__cell md-flex__cell--shrink">
<div class="md-header-nav__source">
<a href="https://github.com/tmtsoftware/csw"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
tmtsoftware/csw
</div>
</a>

</div>
</div>
</div>
</nav>
</header>

<div class="md-container">
<main class="md-main">
<div class="md-main__inner md-grid" data-md-component="container">
<div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--primary" data-md-level="0" style="visibility: hidden">
<label class="md-nav__title md-nav__title--site" for="drawer">
<a href="../../index.html" title="TMT Common Software (CSW)" class="md-nav__button md-logo">
<span class="md-nav__button md-logo">
<i class="md-icon">local_library</i>
</a>
<a href="../../index.html" title="TMT Common Software (CSW)">
TMT Common Software (CSW)
</a>
</label>
<div class="md-nav__source">
<a href="https://github.com/tmtsoftware/csw"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
tmtsoftware/csw
</div>
</a>

</div>
<ul>
  <li><a href="../../commons/getting-started.html" class="page">Getting Started</a></li>
  <li><a href="../../commons/create-component.html" class="page">Creating a Component</a></li>
  <li><a href="../../commons/multiple-components.html" class="page">Multiple Components</a></li>
  <li><a href="../../commons/using-alarms.html" class="page">Using Alarms</a></li>
  <li><a href="../../commons/unit-tests.html" class="page">Adding Unit Tests</a></li>
  <li><a href="../../commons/params.html" class="page">Params</a>
  <ul>
    <li><a href="../../params/keys-parameters.html" class="page">Keys and Parameters</a></li>
    <li><a href="../../params/units.html" class="page">Units</a></li>
    <li><a href="../../params/subsystem.html" class="page">Subsystem</a></li>
    <li><a href="../../params/commands.html" class="page">Commands</a></li>
    <li><a href="../../params/events.html" class="page">Events</a></li>
    <li><a href="../../params/states.html" class="page">State Variables</a></li>
    <li><a href="../../params/result.html" class="page">Result</a></li>
  </ul></li>
  <li><a href="../../commons/framework.html" class="page">Framework for creating components (HCD, Assembly, Container)</a>
  <ul>
    <li><a href="../../framework/describing-components.html" class="page">ComponentInfo</a></li>
    <li><a href="../../framework/creating-components.html" class="page">Creating an Assembly or Hcd Component</a></li>
    <li><a href="../../framework/handling-lifecycle.html" class="page">Component Handlers</a></li>
    <li><a href="../../framework/managing-command-state.html" class="page">Managing Command State</a></li>
    <li><a href="../../framework/tracking-connections.html" class="page">Tracking Connections</a></li>
    <li><a href="../../framework/publishing-state.html" class="page">Publishing State</a></li>
    <li><a href="../../framework/handling-exceptions.html" class="page">Handling Exceptions</a></li>
    <li><a href="../../framework/deploying-components.html" class="page">Deploying Components</a></li>
  </ul></li>
  <li><a href="../../commons/command.html" class="page">Communication using Commands</a></li>
  <li><a href="../../commons/logging_aggregator.html" class="page">Logging Aggregator</a></li>
  <li><a href="../../commons/services.html" class="page">Services</a>
  <ul>
    <li><a href="../../services/location.html" class="page">Location Service</a></li>
    <li><a href="../../services/config.html" class="page">Configuration Service</a></li>
    <li><a href="../../services/logging.html" class="page">Logging Service</a></li>
    <li><a href="../../services/event.html" class="page">Event Service</a></li>
    <li><a href="../../services/alarm.html" class="page">Alarm Service</a></li>
    <li><a href="../../services/time.html" class="page">Time Service</a></li>
    <li><a href="../../services/database.html" class="page">Database Service</a></li>
    <li><a href="../../services/aas.html" class="page">Authentication and Authorization Service (AAS)</a></li>
    <li><a href="../../services/sequencerCommandService.html" class="page">Sequencer Command Service</a></li>
  </ul></li>
  <li><a href="../../commons/apps.html" class="page">Applications</a>
  <ul>
    <li><a href="../../apps/cswlocationserver.html" class="page">csw-location-server</a></li>
    <li><a href="../../apps/cswadminserver.html" class="page">csw-admin-server</a></li>
    <li><a href="../../apps/cswlocationagent.html" class="page">csw-location-agent</a></li>
    <li><a href="../../apps/cswonfigserverapp.html" class="page">csw-config-server</a></li>
    <li><a href="../../apps/cswconfigcli.html" class="page">csw-config-cli</a></li>
    <li><a href="../../apps/csweventcli.html" class="page">csw-event-cli</a></li>
    <li><a href="../../apps/cswalarmcli.html" class="page">csw-alarm-cli</a></li>
    <li><a href="../../apps/hostconfig.html" class="page">csw-host-config</a></li>
  </ul></li>
  <li><a href="../../commons/deployment.html" class="page">Deployment</a>
  <ul>
    <li><a href="../../deployment/env-vars.html" class="page">Environment variables</a></li>
  </ul></li>
  <li><a href="../../commons/testing.html" class="page">Testing</a></li>
  <li><a href="../../commons/sbt-tasks.html" class="page">sbt Tasks</a></li>
  <li><a href="../../commons/manuals.html" class="page">Manuals</a></li>
  <li><a href="../../technical/technical.html" class="page">Technical Design Documents</a>
  <ul>
    <li><a href="../../technical/framework/framework.html" class="page">Framework</a></li>
    <li><a href="../../technical/command/command.html" class="page">Command</a></li>
    <li><a href="../../technical/params/params.html" class="page">Params</a></li>
    <li><a href="../../technical/location/location.html" class="page">Location Service</a></li>
    <li><a href="../../technical/configuration/configuration.html" class="active page">Configuration Service</a></li>
    <li><a href="../../technical/logging/logging.html" class="page">Logging Service</a></li>
    <li><a href="../../technical/event/event.html" class="page">Event Service</a></li>
    <li><a href="../../technical/alarm/alarm.html" class="page">Alarm Service</a></li>
    <li><a href="../../technical/time/time.html" class="page">Time Service</a></li>
    <li><a href="../../technical/database/database.html" class="page">Database Service</a></li>
    <li><a href="../../technical/aas/aas.html" class="page">Authentication and Authorization Service</a></li>
  </ul></li>
</ul>
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../../technical/configuration/configuration.html#configuration-service" class="header">Configuration Service</a>
  <ul>
    <li><a href="../../technical/configuration/configuration.html#introduction" class="header">Introduction</a></li>
    <li><a href="../../technical/configuration/configuration.html#architecture" class="header">Architecture</a></li>
    <li><a href="../../technical/configuration/configuration.html#configuration-server" class="header">Configuration Server</a></li>
    <li><a href="../../technical/configuration/configuration.html#internals" class="header">Internals</a></li>
  </ul></li>
</ul>
</nav>

</nav>
<ul style="display: none">
<li class="md-nav__item md-version" id="project.version">
<label class="md-nav__link" for="__version">
<i class="md-icon" title="Version">label_outline</i> 1.0.0-RC1
</label>
</li>
</ul>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../../technical/configuration/configuration.html#configuration-service" class="header">Configuration Service</a>
  <ul>
    <li><a href="../../technical/configuration/configuration.html#introduction" class="header">Introduction</a></li>
    <li><a href="../../technical/configuration/configuration.html#architecture" class="header">Architecture</a></li>
    <li><a href="../../technical/configuration/configuration.html#configuration-server" class="header">Configuration Server</a></li>
    <li><a href="../../technical/configuration/configuration.html#internals" class="header">Internals</a></li>
  </ul></li>
</ul>
</nav>

</div>
</div>
</div>
<div class="md-content">
<article class="md-content__inner md-typeset">
<div class="md-content__searchable">
<h1><a href="#configuration-service" name="configuration-service" class="anchor"><span class="anchor-link"></span></a>Configuration Service</h1>
<h2><a href="#introduction" name="introduction" class="anchor"><span class="anchor-link"></span></a>Introduction</h2>
<p>The Configuration Service maintains all the configuration files in version control system (<a href="https://wiki.svnkit.com/Subversion">Subversion</a> repository) which tracks the history of file and directory changes over time. We access <a href="https://wiki.svnkit.com/Subversion">Subversion</a> programmatically using <a href="https://wiki.svnkit.com">SVNKit</a> which is a pure Java Subversion client library.</p>
<p>For information on <em>using</em> the Configuration Service, see these sections:</p>
<ul>
  <li><a href="../../services/config.html">Configuration Service</a></li>
  <li><a href="../../apps/cswconfigcli.html">Config CLI</a></li>
</ul>
<h2><a href="#architecture" name="architecture" class="anchor"><span class="anchor-link"></span></a>Architecture</h2>
<p>Configuration service is divided into following modules:</p>
<ol>
  <li>
    <p><strong>Server</strong></p>
    <ol>
      <li>It exposes HTTP rest end points to store/retrieve configuration files from central repository.</li>
      <li>Internally server maintains two types of repositories:
        <ol>
          <li>SVN Repository: store for normal/small files</li>
          <li>Annex File Repository: store for large files</li>
        </ol>
      </li>
    </ol>
  </li>
  <li>
    <p><strong>Client</strong></p>
    <ol>
      <li>Config client is a convenient lightweight wrapper for accessing the CSW Configuration HTTP Server.</li>
      <li>It is build using Akka Http&rsquo;s <a href="https://doc.akka.io/docs/akka-http/current/client-side/request-level.html">request level</a> client API.</li>
    </ol>
  </li>
  <li>
    <p><strong>CLI</strong></p>
    <ol>
      <li>It is a command line application which internally uses Config Client and hides HTTP interaction with Config server.</li>
      <li>This CLI also provides additional <em>login/logout</em> commands to authenticate and authorize user to perform administrator actions such as <em>create/update/delete etc.</em> operations.</li>
    </ol>
  </li>
</ol>
<h2><a href="#configuration-server" name="configuration-server" class="anchor"><span class="anchor-link"></span></a>Configuration Server</h2>
<p>Configuration server is made up of following three main components:</p>
<ol>
  <li>HTTP Routes/Layer</li>
  <li>SVN Service/Repo</li>
  <li>Annex Service</li>
</ol>
<p><img src="config.png" alt="Config Service" /></p>
<h3><a href="#http-routes-layer" name="http-routes-layer" class="anchor"><span class="anchor-link"></span></a>HTTP Routes/Layer</h3>
<p>Configuration server exposes set of HTTP routes to write or read configuration files to/from subversion(svn) or local file system(annex).</p>
<h3><a href="#write-routes" name="write-routes" class="anchor"><span class="anchor-link"></span></a>Write Routes</h3>
<ul>
  <li>create</li>
  <li>update</li>
  <li>delete</li>
  <li>setActive</li>
  <li>resetActive</li>
</ul>
<p>These are <em>admin</em> protected which uses utilities provided by <a href="../aas/csw-aas-http.md">csw-aas-http</a> adapter for protection. <code>csw-aas-http</code> adapter internally uses <a href="https://www.keycloak.org/">Keycloak</a> for authentication and authorization.</p>
<p>Admin protected routes expects <code>Access Token</code> to be passed in HTTP requests header field called <code>Authorization: Bearer ****</code>. This token then used to retrieve <a href="https://www.keycloak.org/docs/latest/authorization_services/#_service_rpt_overview">RPT(Requesting Party Token)</a> from keycloak. RPT contains user&rsquo;s permissions. Once RPT is received, then it is validated to see if user has valid <em>admin client role</em>. If user has valid admin role, then only request gets served otherwise authentication/authorization failed response is sent back to user.</p>
<h3><a href="#read-routes" name="read-routes" class="anchor"><span class="anchor-link"></span></a>Read Routes</h3>
<ul>
  <li>get</li>
  <li>get active</li>
  <li>get metadata</li>
  <li>list</li>
  <li>history</li>
</ul>
<p>These routes are read only and not protected. Anyone with valid HTTP request can access these routes.</p>
<h3><a href="#svn-service-repo" name="svn-service-repo" class="anchor"><span class="anchor-link"></span></a>SVN Service/Repo</h3>
<p>Primary store for small or normal configuration files is <a href="https://wiki.svnkit.com/Subversion">Subversion</a>. <a href="https://wiki.svnkit.com">SVNKit</a> is used to perform all the read&rsquo;s and write&rsquo;s operations programmatically.</p>
<p>There is a notion of active files in configuration service. Whenever user creates new file using <em>create</em> API provided by service, there are following two files gets created in svn behind the scenes.</p>
<ul>
  <li>Normal file which user has requested with provided content</li>
  <li><code>{name}.$active</code> file which keeps track of current active version of file</li>
</ul>
<p>Once new file is created, user can keep updating it as and when required but <code>{name}.$active</code> file will still point to initial version of file. When user is done with changes and wants respective components to pick these new changes, he can mark specific version as active version by using <code>setActiveVersion</code> API. These will update <code>{name}.$active</code> file to point to provided version.</p>
<h3><a href="#annex-service" name="annex-service" class="anchor"><span class="anchor-link"></span></a>Annex Service</h3>
<p>Large/Binary files are stored in annex repo. There are two ways file gets archived in annex store:</p>
<ul>
  <li>Files of size more than 10 MB</li>
  <li>If user explicitly specifies <code>annex=true</code> while creating new file</li>
</ul>
<p>Whenever new annex file has to be created, there are following three files gets created in svn and annex store behind the scenes:</p>
<ul>
  <li>actual large file which user has requested with provided content in annex store</li>
  <li>while creating large file, it&rsquo;s sha gets calculated based on file content and new file <code>{name}.$sha1</code> with this sha gets created in svn repo</li>
  <li><code>{name}.$active</code> file which keeps track of current active version of file</li>
</ul>
<h2><a href="#internals" name="internals" class="anchor"><span class="anchor-link"></span></a>Internals</h2>
<p>Important classes involved in configuration service are:</p>
<ul>
  <li>
  <p><a href="https://github.com/tmtsoftware/csw/tree/v1.0.0-RC1/csw-config/csw-config-server/src/main/scala/csw/config/server/http/ConfigServiceRoute.scala">ConfigServiceRoute</a>: contains all the read and write http routes</p></li>
  <li>
  <p><a href="https://github.com/tmtsoftware/csw/tree/v1.0.0-RC1/csw-config/csw-config-server/src/main/scala/csw/config/server/svn/SvnConfigService.scala">SvnConfigService</a>: responsible for all the interactions with SvnRepo and AnnexFileService to perform CRUD operations </p></li>
  <li>
  <p><a href="https://github.com/tmtsoftware/csw/tree/v1.0.0-RC1/csw-config/csw-config-server/src/main/scala/csw/config/server/svn/SvnRepo.scala">SvnRepo</a>: responsible for all the CRUD operations on svn repository using <a href="https://wiki.svnkit.com">SVNKit</a></p></li>
  <li>
  <p><a href="https://github.com/tmtsoftware/csw/tree/v1.0.0-RC1/csw-config/csw-config-server/src/main/scala/csw/config/server/files/AnnexFileService.scala">AnnexFileService</a>: responsible for calculating SHA1 based on file content and interacting with AnnexFileRepo to perform CRUD operations</p></li>
  <li>
  <p><a href="https://github.com/tmtsoftware/csw/tree/v1.0.0-RC1/csw-config/csw-config-server/src/main/scala/csw/config/server/files/AnnexFileRepo.scala">AnnexFileRepo</a>: represents file based repository for large/binary/annex files</p></li>
</ul>
<p>Below sequence diagram indicates how these classes are involved in creation of annex file: </p>
<p><img src="config_sequence_diagram.png" alt="Config Sequence" /></p>
</div>
<div>
<a href="https://github.com/tmtsoftware/csw/tree/v1.0.0-RC1/docs/src/main/technical/configuration/configuration.md" title="Edit this page" class="md-source-file md-edit">
Edit this page
</a>
</div>
<div class="print-only">
<span class="md-source-file md-version">
1.0.0-RC1
</span>
</div>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-nav">
<nav class="md-footer-nav__inner md-grid">
<a href="../../technical/location/location.html" title="Location Service" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
</div>
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Previous
</span>
Location Service
</span>
</div>
</a>
<a href="../../technical/logging/logging.html" title="Logging Service" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Next
</span>
Logging Service
</span>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
</div>
</a>
</nav>
</div>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
Powered by
<a href="https://github.com/lightbend/paradox">Paradox</a>
and
<a href="https://jonas.github.io/paradox-material-theme/">Paradox Material Theme</a>

</div>
</div>
</div>
</footer>

</div>
<script src="../../assets/javascripts/application.583bbe55.js"></script>
<script src="../../assets/javascripts/paradox-material-theme.js"></script>
<script>app.initialize({version:"0.17",url:{base:"../../."}})</script>
<script type="text/javascript" src="../../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function(event) {
window.prettyPrint && prettyPrint();
});
</script>
</body>
</html>
