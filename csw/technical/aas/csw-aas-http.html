<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="description" content="docs">
<meta name="generator" content="Paradox, paradox-material-theme=0.7.0, mkdocs-material=3.0.3">

<meta name="lang:clipboard.copy" content="Copy to clipboard">
<meta name="lang:clipboard.copied" content="Copied to clipboard">
<meta name="lang:search.language" content="">
<meta name="lang:search.pipeline.stopwords" content="true">
<meta name="lang:search.pipeline.trimmer" content="true">
<meta name="lang:search.result.none" content="No matching documents">
<meta name="lang:search.result.one" content="1 matching document">
<meta name="lang:search.result.other" content="# matching documents">
<meta name="lang:search.tokenizer" content="[\s\-]+">


<meta name="description" content="docs">
<link rel="shortcut icon" href="../../assets/images/favicon.png">
<title>csw-aas-http - Akka HTTP Adapter</title>
<link rel="stylesheet" href="../../assets/stylesheets/application.451f80e5.css">
<link rel="stylesheet" href="../../lib/material__tabs/dist/mdc.tabs.min.css">
<link rel="stylesheet" href="../../lib/prettify/prettify.css">
<script src="../../assets/javascripts/modernizr.1aa3b519.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
<style>
body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}
code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}
</style>
<link rel="stylesheet" href="../../assets/fonts/font-awesome.css">
<link rel="stylesheet" href="../../assets/fonts/material-icons.css">
<link rel="stylesheet" href="../../assets/stylesheets/paradox-material-theme.css">
</head>
<body
>
<input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
<input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
<label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
<header class="md-header" data-md-component="header">
<nav class="md-header-nav md-grid">
<div class="md-flex">
<div class="md-flex__cell md-flex__cell--shrink">
<a href="../../technical/aas/csw-aas-http.html" title="csw-aas-http - Akka HTTP Adapter" class="md-header-nav__button md-logo">
<i class="md-icon">local_library</i>
</a>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
</div>
<div class="md-flex__cell md-flex__cell--stretch">
<div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
csw-aas-http - Akka HTTP Adapter
</div>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
<label class="md-icon md-search__icon" for="__search"></label>
<button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">&#xE5CD;</button>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix>
<div class="md-search-result" data-md-component="result">
<div class="md-search-result__meta">
Type to start searching
</div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>

</div>
</div>
</nav>
</header>

<div class="md-container">
<main class="md-main">
<div class="md-main__inner md-grid" data-md-component="container">
<div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--primary" data-md-level="0" style="visibility: hidden">
<label class="md-nav__title md-nav__title--site" for="drawer">
<a href="../../technical/aas/csw-aas-http.html" title="csw-aas-http - Akka HTTP Adapter" class="md-nav__button md-logo">
<span class="md-nav__button md-logo">
<i class="md-icon">local_library</i>
</a>
<a href="../../technical/aas/csw-aas-http.html" title="csw-aas-http - Akka HTTP Adapter">
csw-aas-http - Akka HTTP Adapter
</a>
</label>
<ul>
</ul>
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../../technical/aas/csw-aas-http.html#csw-aas-http-akka-http-adapter" class="header">csw-aas-http - Akka HTTP Adapter</a>
  <ul>
    <li><a href="../../technical/aas/csw-aas-http.html#types-of-tokens" class="header">Types of tokens</a></li>
    <li><a href="../../technical/aas/csw-aas-http.html#request-flow" class="header">Request flow</a></li>
    <li><a href="../../technical/aas/csw-aas-http.html#asynchronous-nature-of-akka-http-routing-layer" class="header">Asynchronous nature of Akka-HTTP Routing layer</a></li>
  </ul></li>
</ul>
</nav>

</nav>
<ul style="display: none">
<li class="md-nav__item md-version" id="project.version">
<label class="md-nav__link" for="__version">
<i class="md-icon" title="Version">label_outline</i> 3.0.0
</label>
</li>
</ul>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../../technical/aas/csw-aas-http.html#csw-aas-http-akka-http-adapter" class="header">csw-aas-http - Akka HTTP Adapter</a>
  <ul>
    <li><a href="../../technical/aas/csw-aas-http.html#types-of-tokens" class="header">Types of tokens</a></li>
    <li><a href="../../technical/aas/csw-aas-http.html#request-flow" class="header">Request flow</a></li>
    <li><a href="../../technical/aas/csw-aas-http.html#asynchronous-nature-of-akka-http-routing-layer" class="header">Asynchronous nature of Akka-HTTP Routing layer</a></li>
  </ul></li>
</ul>
</nav>

</div>
</div>
</div>
<div class="md-content">
<article class="md-content__inner md-typeset">
<div class="md-content__searchable">
<h1><a href="#csw-aas-http-akka-http-adapter" name="csw-aas-http-akka-http-adapter" class="anchor"><span class="anchor-link"></span></a>csw-aas-http - Akka HTTP Adapter</h1>
<p>This is security adapter for akka http server applications. It exposes security directives e.g. sGet, sPost etc which enforce authentication and authorization based on authorization policies.</p>
<p>In order for akka http server to utilize keycloak it has to be registered as keycloak client. Please refer to <a href="https://www.keycloak.org/docs/latest/getting_started/index.html">keycloak documentation</a> for details.</p>
<h2><a href="#types-of-tokens" name="types-of-tokens" class="anchor"><span class="anchor-link"></span></a>Types of tokens</h2>
<h3><a href="#id-token-" name="id-token-" class="anchor"><span class="anchor-link"></span></a>ID Token -</h3>
<p>The ID Token is a JSON Web Token (JWT) that contains user profile information (such as the user&rsquo;s name and email) which is represented in the form of claims.</p>
<h3><a href="#access-token-" name="access-token-" class="anchor"><span class="anchor-link"></span></a>Access Token -</h3>
<p>An Access Token is a credential that can be used by an application to access an API. Access Tokens is JSON web token digitally signed using JSON web signature (JWS). They inform the API that the bearer of the token has been authorized to access the API and perform specific actions specified by the scope that has been granted. Access token contains all the information that ID token has. Additionally, it has information related to realm and roles associated to user. This information is used for authorization based on RealmRole policy.</p>
<h2><a href="#request-flow" name="request-flow" class="anchor"><span class="anchor-link"></span></a>Request flow</h2>
<p>When request comes to secure akka http server, it performs following steps.</p>
<ul>
  <li>Authentication</li>
</ul>
<p>Authentication involves token verification and decoding. Secure http endpoints expect access token to be provided in request header. For verification, it uses api provided by keycloak-adapter-core. For decoding csw-aas-http uses third party library - <a href="https://github.com/pauldijou/jwt-scala">jwt-play-json</a>. Authentication process verifies access token string and decode it into <code>AccessToken</code> domain model. </p>
<ul>
  <li>Authorization</li>
</ul>
<p>Authorization involves applying specified <code>AuthorizationPolicy</code> against <code>AccessToken</code>. Foe example, role based authorization involves checking access to secure api against roles information present in access token.</p>
<p>Following diagrams shows request flow for secure akka http server.</p>
<p><img src="akka-http-workflow.png" alt="akka-http-workflow.png" /> </p>
<p>The core of this adapter is the <code>SecurityDirectives</code> class. Following diagram shows request flow through different core classes of this adapter. <code>SecurityDirecives</code> provided by this adapter are used while writing akka http server. For detailing following diagram shows akka http server and security directives as separate. Diagram depicts happy flow of POST request secured using realm role based authorization policy where server returns 200 OK code. When authentication and authorization is successful, application logic is executed and 200 OK is returned by server. e.g. create config file if user is authenticated and have admin role. In case of errors, server return 401 (unauthorized) or 403 (forbidden) e.g. - If token verification fails for invalid or expired token, <code>TokenVerifier</code> returns appropriate <code>TokenVerificationFailure</code> and akka http server returns 401. If authorization policy check fails then <code>AccessToken</code> returns false and then akka http server return 403.</p>
<p><img src="aas-http-sequence-diagram.png" alt="aas-http-sequence-diagram" /></p>
<h2><a href="#asynchronous-nature-of-akka-http-routing-layer" name="asynchronous-nature-of-akka-http-routing-layer" class="anchor"><span class="anchor-link"></span></a>Asynchronous nature of Akka-HTTP Routing layer</h2>
<p>csw-aas-http uses <code>authenticateOAuth2Async</code> and <code>authorizeAsync</code> which are async variants of akka-http security directives. This allows it to run without blocking routing layer of Akka HTTP, freeing it for other requests.</p>
</div>
<div>
<a href="https://github.com/tmtsoftware/csw/tree/master/docs/src/main/technical/aas/csw-aas-http.md" title="Edit this page" class="md-source-file md-edit">
Edit this page
</a>
</div>
<div class="print-only">
<span class="md-source-file md-version">
3.0.0
</span>
</div>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
Powered by
<a href="https://github.com/lightbend/paradox">Paradox</a>
and
<a href="https://jonas.github.io/paradox-material-theme/">Paradox Material Theme</a>

</div>
</div>
</div>
</footer>

</div>
<script src="../../assets/javascripts/application.583bbe55.js"></script>
<script src="../../assets/javascripts/paradox-material-theme.js"></script>
<script>app.initialize({version:"0.17",url:{base:"../../."}})</script>
<script type="text/javascript" src="../../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function(event) {
window.prettyPrint && prettyPrint();
});
</script>
</body>
</html>
