<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="description" content="docs">
<meta name="generator" content="Paradox, paradox-material-theme=0.4.0, mkdocs-material=2.2.2">

<meta name="lang:clipboard.copy" content="Copy to clipboard">
<meta name="lang:clipboard.copied" content="Copied to clipboard">
<meta name="lang:search.result.none" content="No matching documents">
<meta name="lang:search.result.one" content="1 matching document">
<meta name="lang:search.result.other" content="# matching documents">
<meta name="lang:search.language" content="">
<meta name="lang:search.tokenizer" content="[\s\-]+">


<meta name="description" content="docs">
<link rel="shortcut icon" href="assets/tmt_favicon.ico">
<title>Multiple Components Â· TMT Common Software (CSW)</title>
<link rel="stylesheet" href="assets/stylesheets/application.7a4cdee3.css">
<link rel="stylesheet" href="lib/material__tabs/dist/mdc.tabs.min.css">
<link rel="stylesheet" href="lib/prettify/prettify.css">
<script src="lib/modernizr/modernizr.min.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
<style>
body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}
code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}
</style>
<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="assets/stylesheets/paradox-material-theme.css">
</head>
<body
>
<input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
<input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
<label class="md-overlay" data-md-component="overlay" for="drawer"></label>
<header class="md-header" data-md-component="header">
<nav class="md-header-nav md-grid">
<div class="md-flex">
<div class="md-flex__cell md-flex__cell--shrink">
<a href="index.html" title="TMT Common Software (CSW)" class="md-header-nav__button md-logo">
<i class="md-icon">local_library</i>
</a>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
</div>
<div class="md-flex__cell md-flex__cell--stretch">
<div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
<span class="md-header-nav__topic">
TMT Common Software (CSW)
</span>
<span class="md-header-nav__topic">
Multiple Components
</span>
</div>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="search"></label>
<div class="md-search__inner">
<form class="md-search__form" name="search">
<input type="text" class="md-search__input" name="query" required placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query">
<label class="md-icon md-search__icon" for="search"></label>
<button type="reset" class="md-icon md-search__icon" data-md-component="reset">&#xE5CD;</button>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix>
<div class="md-search-result" data-md-component="result">
<div class="md-search-result__meta">
Type to start searching
</div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>

</div>
<div class="md-flex__cell md-flex__cell--shrink">
<div class="md-header-nav__source">
<a href="https://github.com/tmtsoftware/csw-prod"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
tmtsoftware/csw-prod
</div>
</a>

</div>
</div>
</div>
</nav>
</header>

<div class="md-container">
<main class="md-main">
<div class="md-main__inner md-grid" data-md-component="container">
<div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--primary" data-md-level="0" style="visibility: hidden">
<label class="md-nav__title md-nav__title--site" for="drawer">
<span class="md-nav__button md-logo">
<i class="md-icon">local_library</i>
</span>
<a href="index.html" title="TMT Common Software (CSW)">
TMT Common Software (CSW)
</a>
</label>
<div class="md-nav__source">
<a href="https://github.com/tmtsoftware/csw-prod"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
tmtsoftware/csw-prod
</div>
</a>

</div>
<ul>
  <li><a href="csw-overview.html" class="page">Using CSW</a></li>
  <li><a href="getting-started.html" class="page">Getting Started</a></li>
  <li><a href="create-component.html" class="page">Creating a Component</a></li>
  <li><a href="multiple-components.html" class="active page">Multiple Components</a></li>
  <li><a href="messages.html" class="page">Messages</a>
  <ul>
    <li><a href="messages/keys-parameters.html" class="page">Keys and Parameters</a></li>
    <li><a href="messages/units.html" class="page">Units</a></li>
    <li><a href="messages/subsystem.html" class="page">Subsystem</a></li>
    <li><a href="messages/commands.html" class="page">Commands</a></li>
    <li><a href="messages/events.html" class="page">Events</a></li>
    <li><a href="messages/states.html" class="page">State variables</a></li>
    <li><a href="messages/result.html" class="page">Result</a></li>
  </ul></li>
  <li><a href="framework.html" class="page">Framework for creating components (HCD, Assembly, Container)</a>
  <ul>
    <li><a href="framework/describing-components.html" class="page">ComponentInfo</a></li>
    <li><a href="framework/creating-components.html" class="page">Creating an Assembly or Hcd Component</a></li>
    <li><a href="framework/handling-lifecycle.html" class="page">Lifecycle support</a></li>
    <li><a href="framework/managing-command-state.html" class="page">Managing Command State</a></li>
    <li><a href="framework/tracking-connections.html" class="page">Tracking Connections</a></li>
    <li><a href="framework/publishing-state.html" class="page">Publishing State</a></li>
    <li><a href="framework/handling-exceptions.html" class="page">Handling Exceptions</a></li>
    <li><a href="framework/deploying-components.html" class="page">Deploying Components</a></li>
  </ul></li>
  <li><a href="services.html" class="page">Services</a>
  <ul>
    <li><a href="services/location.html" class="page">Location service</a></li>
    <li><a href="services/config.html" class="page">Configuration service</a></li>
    <li><a href="services/logging.html" class="page">Logging service</a></li>
  </ul></li>
  <li><a href="command.html" class="page">Communication using Commands</a></li>
  <li><a href="testing.html" class="page">Testing</a></li>
  <li><a href="apps.html" class="page">Applications</a>
  <ul>
    <li><a href="apps/cswclusterseed.html" class="page">csw-cluster-seed</a></li>
    <li><a href="apps/cswlocationagent.html" class="page">csw-location-agent</a></li>
    <li><a href="apps/cswonfigserverapp.html" class="page">csw-config-server</a></li>
    <li><a href="apps/cswconfigclientcli.html" class="page">csw-config-client-cli</a></li>
    <li><a href="apps/hostconfig.html" class="page">csw-host-config</a></li>
  </ul></li>
  <li><a href="manuals.html" class="page">Manuals</a></li>
  <li><a href="sbt-tasks.html" class="page">sbt tasks</a></li>
</ul>
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="toc">Table of contents</label>
<ul>
  <li><a href="multiple-components.html#multiple-components" class="header">Multiple Components</a>
  <ul>
    <li><a href="multiple-components.html#creating-an-assembly" class="header">Creating an Assembly</a></li>
    <li><a href="multiple-components.html#component-configuration-componentinfo-" class="header">Component Configuration (ComponentInfo)</a></li>
    <li><a href="multiple-components.html#tracking-dependencies" class="header">Tracking Dependencies</a></li>
    <li><a href="multiple-components.html#sending-commands" class="header">Sending Commands</a></li>
    <li><a href="multiple-components.html#deploying-multiple-components-in-a-container" class="header">Deploying Multiple Components in a Container</a></li>
    <li><a href="multiple-components.html#running-components-in-a-container" class="header">Running components in a Container</a></li>
    <li><a href="multiple-components.html#deploying-and-running-components" class="header">Deploying and Running Components</a></li>
  </ul></li>
</ul>
</nav>

<div class="md-nav__title--site md-version" title="Version">
<i class="md-icon">label_outline</i> 0.1.2
</div>
</nav>

</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="toc">Table of contents</label>
<ul>
  <li><a href="multiple-components.html#multiple-components" class="header">Multiple Components</a>
  <ul>
    <li><a href="multiple-components.html#creating-an-assembly" class="header">Creating an Assembly</a></li>
    <li><a href="multiple-components.html#component-configuration-componentinfo-" class="header">Component Configuration (ComponentInfo)</a></li>
    <li><a href="multiple-components.html#tracking-dependencies" class="header">Tracking Dependencies</a></li>
    <li><a href="multiple-components.html#sending-commands" class="header">Sending Commands</a></li>
    <li><a href="multiple-components.html#deploying-multiple-components-in-a-container" class="header">Deploying Multiple Components in a Container</a></li>
    <li><a href="multiple-components.html#running-components-in-a-container" class="header">Running components in a Container</a></li>
    <li><a href="multiple-components.html#deploying-and-running-components" class="header">Deploying and Running Components</a></li>
  </ul></li>
</ul>
</nav>

</div>
</div>
</div>
<div class="md-content">
<article class="md-content__inner md-typeset">
<div class="md-content__searchable">
<h1><a href="#multiple-components" name="multiple-components" class="anchor"><span class="anchor-link"></span></a>Multiple Components</h1>
<p>Deploying multiple components (in Container), and having them communicate with each other. This tutorial discusses constructing an Assembly.</p>
<h2><a href="#creating-an-assembly" name="creating-an-assembly" class="anchor"><span class="anchor-link"></span></a>Creating an Assembly</h2>
<p>To create an assembly, the component developer need to implement the <code>ComponentHandlers</code>. More details about implementing ComponentHandlers can be referred <a href="create-component.html#handlers">here</a>. </p>
<h2><a href="#component-configuration-componentinfo-" name="component-configuration-componentinfo-" class="anchor"><span class="anchor-link"></span></a>Component Configuration (ComponentInfo)</h2>
<p>Component configuration contains details needed to spawn a component. This configuration resides in a configuration file for a particular component. The sample for Assembly is as follows:</p>
<pre><code>{
    name = &quot;Laser&quot;
    componentType = assembly
    behaviorFactoryClassName = csw.common.components.framework.SampleComponentBehaviorFactory
    prefix = tcs.mobie.blue.filter
    locationServiceUsage = RegisterAndTrackServices
    connections = [
      {
        name: Motion_Controller
        componentType: hcd
        connectionType: akka
      },
      {
        name: Galil
        componentType: hcd
        connectionType: akka
      },
      {
        name: Eton
        componentType: hcd
        connectionType: akka
      }
    ]
}
</code></pre><div class="callout note "><div class="callout-title">Note</div>
<p>The Assembly has multiple <code>connections</code> of HCDs that it will track in it&rsquo;s life span.</p></div>
<p>More details about each configuration and it&rsquo;s significance can be referred <a href="create-component.html#component-configuration-(componentinfo">here</a>). </p>
<h2><a href="#tracking-dependencies" name="tracking-dependencies" class="anchor"><span class="anchor-link"></span></a>Tracking Dependencies</h2>
<p>The connections that are defined in configuration file for an assembly will be tracked by <code>csw-framework</code>. For each connection the following details are configured:</p>
<pre><code>{
  name: Eton
  componentType: hcd
  connectionType: akka
}
</code></pre>
<p>The name of the component, the type(hcd, service, etc) and the connection(akka, http, tcp) will be used to create a <code>Connection</code> object. Connection object will be then used to track the location of a component using location service.</p>
<p>The <code>Location</code> object represents one of the following types:</p>
<ul>
  <li>AkkaLocation: Represents a remote address of the actorRef. The actorRef will be the Supervisor actor of a component.</li>
  <li>HttpLocation: Represents a Http URI of the web server e.g. configuration service</li>
  <li>TcpLocation: Represents a tcp URI of the server e.g. event service</li>
</ul>
<p>More details about tracking a component using location service can be referred <a href="services/location.html#tracking-and-subscribing">here</a>.</p>
<h3><a href="#onlocationtrackingevent-handler" name="onlocationtrackingevent-handler" class="anchor"><span class="anchor-link"></span></a>onLocationTrackingEvent Handler</h3>
<p>For all the tracked connections, whenever a location is changed, one of the following events is generated:</p>
<ul>
  <li>LocationUpdated: Represents if a location is added or changed</li>
  <li>LocationRemoved: Represents if a location is no longer available on the network</li>
</ul>
<p>Whenever such an event is generated, the Top level actor will call the <code>onLocationTrackingEvent</code> hook of <code>ComponentHandlers</code> with the event(LocationUpdated or LocationRemoved) as parameter of the hook.</p>
<p>More details around tracking a connection can be referred <a href="framework/tracking-connections.html">here</a></p>
<h3><a href="#trackconnection" name="trackconnection" class="anchor"><span class="anchor-link"></span></a>trackConnection</h3>
<p>If the component developer wants to track a connection that is not configured in it&rsquo;s configuration file then it can use the <code>trackConnection</code> method provided by <code>csw-framework</code> in <code>ComponentHandlers</code>. The <code>trackConnection</code> method will take the <code>Connection</code> instance. How to create a connection instance can be referred <a href="services/location.html#creating-components-connections-and-registrations">here</a>.</p><div class="callout note "><div class="callout-title">Note</div>
<p>Connections tracked by <code>csw-framework</code> (from configuration file) or by component developer using <code>trackConnection</code> method both will be received in <code>onLocationTrackingEvent</code> hook of <code>ComponentHandlers</code>. </p></div>
<h2><a href="#sending-commands" name="sending-commands" class="anchor"><span class="anchor-link"></span></a>Sending Commands</h2>
<p>If a component wants to send command to other component, it may use the <code>CommandService</code> instance. The creation of a<code>CommandService</code> instance and its usage can be referred <a href="command.html#commandservice">here</a>.</p>
<p>If a component wants to send multiple commands in response to a single received command, then it may use <code>CommandDistributor</code> instance. The CommandDistributor will help in getting the aggregated response of multiple commands sent to other components. The component developer can use aggregated response to update the <code>CommandResponseManager</code> with appropriate status if the received command was in <code>Submit</code> wrapper.</p>
<p>More details about creating <code>CommandDistributor</code> and it&rsquo;s usage can be referred <a href="command.html#distributing-commands">here</a>.</p><div class="callout note "><div class="callout-title">Note</div>
<p><code>CommandDistributor</code> can be used to get aggregated response only if the multiple commands sent to other components are all wrapped in <code>Submit</code> wrapper.</p></div>
<h3><a href="#tracking-long-running-commands" name="tracking-long-running-commands" class="anchor"><span class="anchor-link"></span></a>Tracking Long Running Commands</h3>
<p>A command, when sent in <code>Submit</code> wrapper, and received an <code>Accepted</code> response in return, is considered as a long running command.</p>
<p>When a component sends a long running command to another component, it may be interested in knowing the status of the command and take decisions based on that. In order to subscribe to the changes in command status, the sender component will have to use <code>subscribe</code> method after <code>submit</code> or use <code>submitAndSubscribe</code> in <code>CommandService</code>.</p>
<h3><a href="#matchers" name="matchers" class="anchor"><span class="anchor-link"></span></a>Matchers</h3>
<p>When a component sends a command in <code>Oneway</code> to another component, it may be interested in knowing the receiver component&rsquo;s <code>CurrentState</code> and match it against a desired state. In order to do that, the component developer can use <code>onewayAndMatch</code> method of <code>CommandService</code> or <code>oneway</code> of <code>CommandService</code> and the use <code>Matcher</code> explicitly to match a desired state with current state.</p>
<p>More details on how to use <code>Matcher</code> can be referred <a href="command.html#matching-state-for-command-completion">here</a>. </p>
<h3><a href="#pubsub-connection" name="pubsub-connection" class="anchor"><span class="anchor-link"></span></a>PubSub Connection</h3>
<p>A component might need to subscribe to current state of any other component provided it knows the location of that component. In order to subscribe to current state, it may use <code>subscribeCurrentState</code> method of <code>CommandService</code>. More details about the usage of <code>subscribeCurrentState</code> can ber referred <a href="command.html#subscribecurrentstate">here</a>.</p>
<p>If a component wants to publish it&rsquo;s current state then it can use the <code>currentStatePublisher</code> provided by <code>csw-framework</code> in <code>ComponentHandlers</code>. More details about the usage of <code>currentStatePublisher</code> can ber referred <a href="framework/publishing-state.html">here</a>.</p>
<h2><a href="#deploying-multiple-components-in-a-container" name="deploying-multiple-components-in-a-container" class="anchor"><span class="anchor-link"></span></a>Deploying Multiple Components in a Container</h2>
<h2><a href="#running-components-in-a-container" name="running-components-in-a-container" class="anchor"><span class="anchor-link"></span></a>Running components in a Container</h2>
<p>NOTE: the following was moved from the getting starting page. I thought it was more appropriate here, but I just cut/paste for now, expecting some of this info will be integrated into this page. &ndash; JLW</p>
<h2><a href="#deploying-and-running-components" name="deploying-and-running-components" class="anchor"><span class="anchor-link"></span></a>Deploying and Running Components</h2>
<h3><a href="#pre-requisite" name="pre-requisite" class="anchor"><span class="anchor-link"></span></a>Pre-requisite</h3>
<p><code>galil-deploy</code> project contains applications (ContainerCmd and HostConfig) to run your components, make sure you add necessary dependencies in <code>galil-deploy</code> project.</p>
<h3><a href="#run" name="run" class="anchor"><span class="anchor-link"></span></a>Run</h3>
<p>As seen above <code>galil-deploy</code> depends on <code>galil-assembly</code> and <code>galil-hcd</code>, now if you want to start these Assembly and HCD, follow below steps:</p>
<ul>
  <li>Run <code>sbt galil-deploy/universal:packageBin</code>, this will create self contained zip in <code>galil-deploy/target/universal</code> directory</li>
  <li>Unzip generated zip file and enter into <code>bin</code> directory</li>
  <li>You will see four scripts in <code>bin</code> directory (two bash scripts and two windows scripts)</li>
  <li>If you want to start multiple containers on a host machine, follow this guide <a href="apps/hostconfig.html#examples">here</a></li>
  <li>If you want to start multiple components in container mode or single component in standalone mode, follow this guide <a href="framework/deploying-components.html">here</a></li>
  <li>Example to run container: <code>./galil-container-cmd-app --local ../../../../galil-deploy/src/main/resources/GalilAssemblyContainer.conf</code></li>
  <li>Example to run host config: <code>./galil-host-config-app --local ../../../../galil-deploy/src/main/resources/GalilHostConfig.conf -s ./galil-container-cmd-app</code></li>
</ul><div class="callout note "><div class="callout-title">Note</div>
<p>CSW Location Service cluster seed must be running, and appropriate environment variables set to run apps. See <a href="https://tmtsoftware.github.io/csw-prod/apps/cswclusterseed.html">https://tmtsoftware.github.io/csw-prod/apps/cswclusterseed.html</a>.</p></div>
</div>
<div>
<a href="https://github.com/tmtsoftware/csw-prod/tree/master/docs/src/main/multiple-components.md" title="Edit this page" class="md-source-file md-edit">
Edit this page
</a>
</div>
<div class="print-only">
<span class="md-source-file md-version">
0.1.2
</span>
</div>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-nav">
<nav class="md-footer-nav__inner md-grid">
<a href="create-component.html" title="Creating a Component" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
</div>
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Previous
</span>
Creating a Component
</span>
</div>
</a>
<a href="messages.html" title="Messages" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Next
</span>
Messages
</span>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
</div>
</a>
</nav>
</div>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
Powered by
<a href="https://github.com/lightbend/paradox">Paradox</a>
and
<a href="https://jonas.github.io/paradox-material-theme/">Paradox Material Theme</a>

</div>
</div>
</div>
</footer>

</div>
<script src="assets/javascripts/application.5165553b.js"></script>
<script src="assets/javascripts/paradox-material-theme.js"></script>
<script>app.initialize({version:"0.17",url:{base:"."}})</script>
<script type="text/javascript" src="lib/prettify/prettify.js"></script>
<script type="text/javascript" src="lib/prettify/lang-scala.js"></script>
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function(event) {
window.prettyPrint && prettyPrint();
});
</script>
</body>
</html>
