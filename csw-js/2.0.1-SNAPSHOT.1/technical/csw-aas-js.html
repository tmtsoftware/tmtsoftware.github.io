<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="description" content="docs">
<meta name="generator" content="Paradox, paradox-material-theme=0.6.0, mkdocs-material=3.0.3">

<meta name="lang:clipboard.copy" content="Copy to clipboard">
<meta name="lang:clipboard.copied" content="Copied to clipboard">
<meta name="lang:search.language" content="">
<meta name="lang:search.pipeline.stopwords" content="true">
<meta name="lang:search.pipeline.trimmer" content="true">
<meta name="lang:search.result.none" content="No matching documents">
<meta name="lang:search.result.one" content="1 matching document">
<meta name="lang:search.result.other" content="# matching documents">
<meta name="lang:search.tokenizer" content="[\s\-]+">


<meta name="description" content="docs">
<link rel="shortcut icon" href="../assets/tmt_favicon.ico">
<title>csw-aas-js - Javascript adapter</title>
<link rel="stylesheet" href="../assets/stylesheets/application.451f80e5.css">
<link rel="stylesheet" href="../lib/material__tabs/dist/mdc.tabs.min.css">
<link rel="stylesheet" href="../lib/prettify/prettify.css">
<script src="../assets/javascripts/modernizr.1aa3b519.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
<style>
body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}
code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}
</style>
<link rel="stylesheet" href="../assets/fonts/font-awesome.css">
<link rel="stylesheet" href="../assets/fonts/material-icons.css">
<link rel="stylesheet" href="../assets/stylesheets/paradox-material-theme.css">
</head>
<body
>
<input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
<input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
<label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
<header class="md-header" data-md-component="header">
<nav class="md-header-nav md-grid">
<div class="md-flex">
<div class="md-flex__cell md-flex__cell--shrink">
<a href="../technical/csw-aas-js.html" title="csw-aas-js - Javascript adapter" class="md-header-nav__button md-logo">
<i class="md-icon">local_library</i>
</a>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
</div>
<div class="md-flex__cell md-flex__cell--stretch">
<div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
csw-aas-js - Javascript adapter
</div>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
<label class="md-icon md-search__icon" for="__search"></label>
<button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">&#xE5CD;</button>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix>
<div class="md-search-result" data-md-component="result">
<div class="md-search-result__meta">
Type to start searching
</div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>

</div>
<div class="md-flex__cell md-flex__cell--shrink">
<div class="md-header-nav__source">
<a href="https://github.com/tmtsoftware/csw-js"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
tmtsoftware/csw-js
</div>
</a>

</div>
</div>
</div>
</nav>
</header>

<div class="md-container">
<main class="md-main">
<div class="md-main__inner md-grid" data-md-component="container">
<div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--primary" data-md-level="0" style="visibility: hidden">
<label class="md-nav__title md-nav__title--site" for="drawer">
<a href="../technical/csw-aas-js.html" title="csw-aas-js - Javascript adapter" class="md-nav__button md-logo">
<span class="md-nav__button md-logo">
<i class="md-icon">local_library</i>
</a>
<a href="../technical/csw-aas-js.html" title="csw-aas-js - Javascript adapter">
csw-aas-js - Javascript adapter
</a>
</label>
<div class="md-nav__source">
<a href="https://github.com/tmtsoftware/csw-js"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
tmtsoftware/csw-js
</div>
</a>

</div>
<ul>
</ul>
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../technical/csw-aas-js.html#csw-aas-js-javascript-adapter" class="header">csw-aas-js - Javascript adapter</a>
  <ul>
    <li><a href="../technical/csw-aas-js.html#csw-aas-js-implementation" class="header">csw-aas-js Implementation</a></li>
    <li><a href="../technical/csw-aas-js.html#project-setup" class="header">Project setup</a></li>
    <li><a href="../technical/csw-aas-js.html#keycloak" class="header">Keycloak</a></li>
    <li><a href="../technical/csw-aas-js.html#working-of-csw-aas-js" class="header">Working of csw-aas-js</a></li>
  </ul></li>
</ul>
</nav>

</nav>
<ul style="display: none">
<li class="md-nav__item md-version" id="project.version">
<label class="md-nav__link" for="__version">
<i class="md-icon" title="Version">label_outline</i> 2.0.1*.1
</label>
</li>
</ul>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../technical/csw-aas-js.html#csw-aas-js-javascript-adapter" class="header">csw-aas-js - Javascript adapter</a>
  <ul>
    <li><a href="../technical/csw-aas-js.html#csw-aas-js-implementation" class="header">csw-aas-js Implementation</a></li>
    <li><a href="../technical/csw-aas-js.html#project-setup" class="header">Project setup</a></li>
    <li><a href="../technical/csw-aas-js.html#keycloak" class="header">Keycloak</a></li>
    <li><a href="../technical/csw-aas-js.html#working-of-csw-aas-js" class="header">Working of csw-aas-js</a></li>
  </ul></li>
</ul>
</nav>

</div>
</div>
</div>
<div class="md-content">
<article class="md-content__inner md-typeset">
<div class="md-content__searchable">
<h1><a href="#csw-aas-js-javascript-adapter" name="csw-aas-js-javascript-adapter" class="anchor"><span class="anchor-link"></span></a>csw-aas-js - Javascript adapter</h1>
<p>csw-aas-js is a npm package which exposes react components to enable authentication and authorization. csw-aas-js is built in typescript on top of <a href="https://www.keycloak.org/docs/latest/securing_apps/index.html#_javascript_adapter">keycloak-js</a> which is javascript adapter provided by keycloak.</p>
<h2><a href="#csw-aas-js-implementation" name="csw-aas-js-implementation" class="anchor"><span class="anchor-link"></span></a>csw-aas-js Implementation</h2>
<p>Core implementation of csw-aas-js uses</p>
<ul>
  <li><a href="https://www.keycloak.org/docs/latest/securing_apps/index.html#_javascript_adapter">keycloak-js</a> - keycloak javascript adapter</li>
  <li><a href="https://reactjs.org/">React</a> - JavaScript library for building user interfaces</li>
  <li><a href="https://www.typescriptlang.org/">Typescript</a> - Types superset of JavaScript which compiles to JavaScript</li>
  <li><a href="https://tmtsoftware.github.io/csw/0.1.0-SNAPSHOT/services/location">csw-location-service</a> - resolve keycloak using location service http endpoint</li>
</ul>
<h2><a href="#project-setup" name="project-setup" class="anchor"><span class="anchor-link"></span></a>Project setup</h2>
<p><code>csw-aas-js</code> is a library written in <a href="https://www.typescriptlang.org/">Typescript</a>. <code>tsc</code> is a command line compiler of Typescript which compiles typescrit files to JavaScript. <code>tsc</code> picks up configurations from <code>tsconfig.json</code> file which is at root level of project. <code>tsconfig.json</code> allows to configure multiple compiler options. Please refer <a href="https://www.typescriptlang.org/docs/handbook/compiler-options.html">this</a> for details of compiler options. <code>npm run build</code> command will run <code>tsc</code> which will produce outputs (.js and .d.ts). <code>.d.ts</code> files are the type declaration files which provide typings for react components exported by library. <code>package.json</code> points to <code>index.js</code> as a entry point for library and <code>index.d.ts</code> as types. This will help <code>csw-aas-js</code> library users to know type signatures of components. e.g. type signature for react component props, api signatures. <code>csw-aas-js</code> can be seamlessly consumed by applications written ES6 or Typescript. </p>
<h2><a href="#keycloak" name="keycloak" class="anchor"><span class="anchor-link"></span></a>Keycloak</h2>
<p>In order for web application utilize keycloak following steps are needed:</p>
<ul>
  <li>
  <p>Registered web application as a public keycloak client Please refer to <a href="https://www.keycloak.org/docs/latest/getting_started/index.html">keycloak documentation</a> for details.</p></li>
  <li>
  <p>Create new Keycloak client instance This instantiation expects config which includes keycloak server url and some application specific config like <code>realm</code> and <code>clientId</code>. csw-aas-js uses csw location service to resolve keycloak server. If you don&rsquo;t want to use location service, you can provide <code>AAS-server-url</code> along with <code>realm</code> and <code>clientId</code> in web application config. </p></li>
</ul>
<pre class="prettyprint"><code class="language-javascript">const AppConfig = {
  realm: &#39;example&#39;,
  clientId: &#39;example-app&#39;,
  &#39;AAS-server-url&#39;: &#39;http://localhost:8081/auth&#39;
}
</code></pre>
<ul>
  <li>Initialize javascript adapter To call secure end point, web application first needs to be authenticated using keycloak server. There are two options to make this adapter automatically authenticate - <code>login-required</code> and <code>check-sso</code>. <code>login-required</code> will automatically authenticate if the user is already logged-in, otherwise it will display keycloak login page. <code>check-sso</code> will only authenticate if the user is already logged-in. If the user is not logged-in the browser will be redirected back to the application and remain unauthenticated.</li>
</ul>
<p>csw-aas-js use <code>check-sso</code> to instantiate keycloak. It shows secure components if user is already logged in. If user is not authenticated Login component is rendered. If user clicks on login button it instantiates keyclock use <code>login-required</code>. This redirects user to keycloak login page. As access token has very short life span, at time of keycloak instantiation csw-aas-js also adds hooks to refresh token. This gives seamless user experience as user need not to login again.</p>
<p>Keycloak adapter supports three authorization flows e.g. authorization code flow, implicit flow and hybrid flow. csw-aas-js has chosen hybrid flow as it has better performance than authorization code flow and unlike implicit flow, hybrid flow makes refresh token available to application. For more information please refer <a href="https://www.keycloak.org/docs/latest/securing_apps/index.html#_javascript_implicit_flow">keyclok documentaion for authorization flows</a></p>
<h2><a href="#working-of-csw-aas-js" name="working-of-csw-aas-js" class="anchor"><span class="anchor-link"></span></a>Working of csw-aas-js</h2>
<p>When user opens web application in browser, AuthContextProvider component is mounted. Which does instantiation of keycloak client and initialize keycloak javascript adapter with <code>check-sso</code> and <code>hybrid</code> authorization flow. It also creates hooks for refreshing token when token is expired which silently refresh token resulting seamless user experience once logged in. After authentication is done via keycloak javascript adapter, AuthContext is extracted in domain model and this data is passed down the component tree using react context api. AuthContext gives handle to token, realm and resource roles, userInfo. Any component which want to use this information can become consumer of AuthContext. For example</p>
<dl>
  <dt>Javascript</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/csw-js/tree/master/csw-aas-js-examples/config-app/src/components/CreateConfig.jsx#L11" target="_blank" title="Go to snippet source"></a><code class="language-jsx">const { auth } = useContext(AuthContext)</code></pre></dd>
</dl>
<p>Access token can be extracted from <code>auth</code> and it can be sent in <code>Authorization</code> header for calling secure api</p>
<p>For example -</p>
<pre class="prettyprint"><code class="language-javascript">const SampleComponent = () =&gt; {

    const url = &#39;http://localhost:8080/secure-restful-service&#39;;
    const auth = useContext(AuthContext) //AuthContext from csw-aas-js
      
    const req = new XMLHttpRequest();
    req.open(&#39;GET&#39;, url, true);
    req.setRequestHeader(&#39;Accept&#39;, &#39;application/json&#39;);
    
    //extract token from auth context and set Authorization header
    req.setRequestHeader(&#39;Authorization&#39;, &#39;Bearer &#39; + auth.token);

    req.onreadystatechange = function () {
        if (req.readyState == 4) {
            if (req.status == 200) {
                alert(&#39;Success&#39;);
            } else if (req.status == 403) {
                alert(&#39;Forbidden&#39;);
            }
        }
    }

    req.send();
};
</code></pre>
<p>Following diagram explains javascript application flow for making request to secure http api</p>
<p><img src="javascript-app-workflow.png" alt="javascript-app-flow" /> </p>
<p>When user opens web application in browser, csw-aas-js checks if user is already logged in using <code>check-sso</code> mode. If user is not logged in then <code>Login</code> button is shown. When user clicks on login, user will be redirected to keyclok login page. This completes authentication process. Once authentication is done, <code>AuthContextProvider</code> extract <code>AuthContext</code> domain model and make it available to consumers of AuthContext. Protected react components can be shown based on information in <code>AuthContext</code>. For example, CreateConfig component can be shown only to users having <code>config admin</code> role. After the user is authenticated the application can make requests to RESTful services secured by Keycloak by including the bearer token in the Authorization header. This completed workflow for web application calling secure http endpoint. </p>
</div>
<div>
<a href="https://github.com/tmtsoftware/csw-js/tree/master/docs/src/main/technical/csw-aas-js.md" title="Edit this page" class="md-source-file md-edit">
Edit this page
</a>
</div>
<div class="print-only">
<span class="md-source-file md-version">
2.0.1*.1
</span>
</div>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
Powered by
<a href="https://github.com/lightbend/paradox">Paradox</a>
and
<a href="https://jonas.github.io/paradox-material-theme/">Paradox Material Theme</a>

</div>
</div>
</div>
</footer>

</div>
<script src="../assets/javascripts/application.583bbe55.js"></script>
<script src="../assets/javascripts/paradox-material-theme.js"></script>
<script>app.initialize({version:"0.17",url:{base:"../."}})</script>
<script type="text/javascript" src="../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function(event) {
window.prettyPrint && prettyPrint();
});
</script>
</body>
</html>
