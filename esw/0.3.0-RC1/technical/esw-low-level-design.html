<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="description" content="docs">
<meta name="generator" content="Paradox, paradox-material-theme=0.7.0, mkdocs-material=3.0.3">

<meta name="lang:clipboard.copy" content="Copy to clipboard">
<meta name="lang:clipboard.copied" content="Copied to clipboard">
<meta name="lang:search.language" content="">
<meta name="lang:search.pipeline.stopwords" content="true">
<meta name="lang:search.pipeline.trimmer" content="true">
<meta name="lang:search.result.none" content="No matching documents">
<meta name="lang:search.result.one" content="1 matching document">
<meta name="lang:search.result.other" content="# matching documents">
<meta name="lang:search.tokenizer" content="[\s\-]+">


<meta name="description" content="docs">
<link rel="shortcut icon" href="../assets/images/favicon.png">
<title>ESW Low Level Design Â· TMT Executive Software Documentation</title>
<link rel="stylesheet" href="../assets/stylesheets/application.451f80e5.css">
<link rel="stylesheet" href="../lib/material__tabs/dist/mdc.tabs.min.css">
<link rel="stylesheet" href="../lib/prettify/prettify.css">
<script src="../assets/javascripts/modernizr.1aa3b519.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
<style>
body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}
code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}
</style>
<link rel="stylesheet" href="../assets/fonts/font-awesome.css">
<link rel="stylesheet" href="../assets/fonts/material-icons.css">
<link rel="stylesheet" href="../assets/stylesheets/paradox-material-theme.css">
</head>
<body
>
<input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
<input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
<label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
<header class="md-header" data-md-component="header">
<nav class="md-header-nav md-grid">
<div class="md-flex">
<div class="md-flex__cell md-flex__cell--shrink">
<a href="../index.html" title="TMT Executive Software Documentation" class="md-header-nav__button md-logo">
<i class="md-icon">local_library</i>
</a>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
</div>
<div class="md-flex__cell md-flex__cell--stretch">
<div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
<span class="md-header-nav__topic">
TMT Executive Software Documentation
</span>
<span class="md-header-nav__topic">
ESW Low Level Design
</span>
</div>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
<label class="md-icon md-search__icon" for="__search"></label>
<button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">&#xE5CD;</button>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix>
<div class="md-search-result" data-md-component="result">
<div class="md-search-result__meta">
Type to start searching
</div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>

</div>
</div>
</nav>
</header>

<div class="md-container">
<main class="md-main">
<div class="md-main__inner md-grid" data-md-component="container">
<div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--primary" data-md-level="0" style="visibility: hidden">
<label class="md-nav__title md-nav__title--site" for="drawer">
<a href="../index.html" title="TMT Executive Software Documentation" class="md-nav__button md-logo">
<span class="md-nav__button md-logo">
<i class="md-icon">local_library</i>
</a>
<a href="../index.html" title="TMT Executive Software Documentation">
TMT Executive Software Documentation
</a>
</label>
<ul>
  <li><a href="../esw/eswOverview.html" class="page">Executive Software Overview</a></li>
  <li><a href="../sequencersandscripts/seq-index.html" class="page">Sequencers and Sequence Components</a>
  <ul>
    <li><a href="../sequencersandscripts/sequencer.html" class="page">Sequencers in the Executive Software</a></li>
    <li><a href="../sequencersandscripts/sequencer-app.html" class="page">Running a Sequencer Using esw-ocs-app</a></li>
  </ul></li>
  <li><a href="../scripts/scripts-index.html" class="page">Sequencer Scripts</a>
  <ul>
    <li><a href="../scripts/script-styles.html" class="page">Sequencer Script Styles</a></li>
    <li><a href="../scripts/dsl/script-constructs.html" class="page">Script DSL Constructs</a></li>
    <li><a href="../scripts/dsl/csw-services.html" class="page">CSW Services DSL</a></li>
  </ul></li>
  <li><a href="../uisupport/uisupp-index.html" class="page">User Interface Support</a>
  <ul>
    <li><a href="../uisupport/UIOverview.html" class="page">User Interfaces in ESW and TMT</a></li>
    <li><a href="../uisupport/frontend-template.html" class="page">Creating and Using the Frontend UI Template</a></li>
    <li><a href="../uisupport/backend-template.html" class="page">Creating and Using the UI Backend Template</a></li>
    <li><a href="../uisupport/gateway.html" class="page">User Interface Gateway</a></li>
  </ul></li>
  <li><a href="../technical/tech-index.html" class="page">Technical Design Documents</a>
  <ul>
    <li><a href="../technical/sequence-manager-tech.html" class="page">Sequence Manager Technical Documentation</a></li>
    <li><a href="../technical/sequencer-tech.html" class="page">Sequencer Technical Documentation</a></li>
    <li><a href="../technical/sequence-component-tech.html" class="page">Sequence Component Technical Documentation</a></li>
    <li><a href="../technical/gateway-tech.html" class="page">Gateway Technical Documentation</a></li>
    <li><a href="../technical/contracts.html" class="page">Service Contracts</a></li>
    <li><a href="../technical/agent-service-tech.html" class="page">Agent Service and Agent Technical Documentation</a></li>
    <li><a href="../technical/apps/apps-index.html" class="page">ESW Technical Applications</a></li>
    <li><a href="../technical/esw-low-level-design.html" class="active page">ESW Low Level Design</a></li>
  </ul></li>
  <li><a href="../tutorials/web-app-tutorial.html" class="page">Web Application Tutorial</a></li>
</ul>
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../technical/esw-low-level-design.html#esw-low-level-design" class="header">ESW Low Level Design</a>
  <ul>
    <li><a href="../technical/esw-low-level-design.html#main-class" class="header">Main Class</a></li>
    <li><a href="../technical/esw-low-level-design.html#wiring-class" class="header">Wiring Class</a></li>
    <li><a href="../technical/esw-low-level-design.html#httpservice" class="header">HttpService</a></li>
    <li><a href="../technical/esw-low-level-design.html#route-handlers" class="header">Route handlers</a></li>
    <li><a href="../technical/esw-low-level-design.html#api-impl-and-behavior-classes" class="header">Api, Impl and Behavior classes</a></li>
    <li><a href="../technical/esw-low-level-design.html#codecs" class="header">Codecs</a></li>
    <li><a href="../technical/esw-low-level-design.html#complete-flow-of-above-discussed-classes-is" class="header">Complete flow of above discussed classes is</a></li>
  </ul></li>
</ul>
</nav>

</nav>
<ul style="display: none">
<li class="md-nav__item md-version" id="project.version">
<label class="md-nav__link" for="__version">
<i class="md-icon" title="Version">label_outline</i> 0.3.0-RC1
</label>
</li>
</ul>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../technical/esw-low-level-design.html#esw-low-level-design" class="header">ESW Low Level Design</a>
  <ul>
    <li><a href="../technical/esw-low-level-design.html#main-class" class="header">Main Class</a></li>
    <li><a href="../technical/esw-low-level-design.html#wiring-class" class="header">Wiring Class</a></li>
    <li><a href="../technical/esw-low-level-design.html#httpservice" class="header">HttpService</a></li>
    <li><a href="../technical/esw-low-level-design.html#route-handlers" class="header">Route handlers</a></li>
    <li><a href="../technical/esw-low-level-design.html#api-impl-and-behavior-classes" class="header">Api, Impl and Behavior classes</a></li>
    <li><a href="../technical/esw-low-level-design.html#codecs" class="header">Codecs</a></li>
    <li><a href="../technical/esw-low-level-design.html#complete-flow-of-above-discussed-classes-is" class="header">Complete flow of above discussed classes is</a></li>
  </ul></li>
</ul>
</nav>

</div>
</div>
</div>
<div class="md-content">
<article class="md-content__inner md-typeset">
<div class="md-content__searchable">
<h1><a href="#esw-low-level-design" name="esw-low-level-design" class="anchor"><span class="anchor-link"></span></a>ESW Low Level Design</h1>
<p>Goal of this section is to provide walk through of the low level design of the ESW applications. This section is targeted towards future maintainers of the ESW. It should help them understand different parts of the ESW applications and easily navigate through the codebase.</p>
<p>ESW applications are divided into following two major categories:</p>
<ol>
  <li>Pure Actor based, for example, ESW Agent Akka Application.</li>
  <li>Embedded Http Server based - Such applications exposes two protocols for communication, one is HTTP and other is Akka. for example, ESW Gateway.</li>
</ol>
<p>Most if not all the ESW applications follows the following conventions for organizing the codebase:</p>
<ol>
  <li>Main - Runnable application responsible for starting the ESW service.</li>
  <li>Wiring - Initializes all the dependencies and wires them together.</li>
  <li>HttpService - Starts and registers the HTTP service with Location Service.</li>
  <li>Route Handlers - Defines two types of the routes for the HTTP service i.e. HTTP routes and Websocket routes.</li>
  <li>API - Interface defining the contract for the Service</li>
</ol>
<ul>
  <li>Impl - Server side implementation of the API.</li>
  <li>Clients - Two types of clients implementing API i.e. HTTP and Actor clients.</li>
</ul>
<ol>
  <li>Actor Behavior - Defines the behavior of the Service. This includes actual implementation of backend service logic.</li>
  <li>Codecs - Encoders and Decoders required for the remote communication. This includes codecs required for Actors and HTTP service.</li>
</ol>
<h2><a href="#main-class" name="main-class" class="anchor"><span class="anchor-link"></span></a>Main Class</h2>
<p>Main class is the entry point for all the ESW applications, and responsible for specifying the command line arguments, options and parsing them to domain models. This capability is provided by extending Main class with <code>CommandApp</code> which is coming from a <a href="https://github.com/alexarchambault/case-app">case-app</a>. <strong>case-app</strong> is a command line argument parsing library for scala <code>Command</code> class has fields corresponding to each supported program argument. For ESW applications, we use a rich wrapper class <code>EswCommandApp</code> build on top of <code>CommandApp</code>. When we run Main class it creates a new instance <code>Wiring</code> class and triggers Http server startup. How to start Http server and what other things to initialize is decided by <code>Wiring</code> class. For example,</p>
<ol>
  <li>For Gateway Service application, refer classes <code>GatewayMain</code> and <code>ServerCommand</code></li>
  <li>For Agent Service application, refer <code>AgentServiceApp</code>, <code>AgentServiceAppCommand</code>kk</li>
</ol>
<h2><a href="#wiring-class" name="wiring-class" class="anchor"><span class="anchor-link"></span></a>Wiring Class</h2>
<p>This class takes care of initializing instances of various other classes required by this application like <code>ActorSystem</code>, api instances, setting overrides, <code>HttpService</code>, handlers for routes and clients to connect to other services like Location Service, Event Service, security etc. e.g <code>GatewayWiring</code>, <code>AgentServiceWiring</code>, <code>SequenceManagerWiring</code></p>
<h2><a href="#httpservice" name="httpservice" class="anchor"><span class="anchor-link"></span></a>HttpService</h2>
<p>Most of esw applications needs a HTTP server to handle http requests, Hence we have extracted to a common module <code>esw-http-core</code>, which has things common to all esw http applications. <code>HttpService</code> class is responsible for initializing a HTTP Server and registering its location to Location Service. Module <code>esw-http-core</code> has other common classes like <code>ActorRuntime</code> wrapper containing actor related class references, <code>Settings</code> containing logic to extract common settings.</p>
<h2><a href="#route-handlers" name="route-handlers" class="anchor"><span class="anchor-link"></span></a>Route handlers</h2>
<p>There are two type of route handlers.</p>
<ol>
  <li>
  <p>PostHandler - This handler contains routes corresponding to http requests. e.g. <code>GatewayPostHandler</code>, <code>AgentServicePostHandler</code>. Since the underlying infrastructure used to handle Http requests is using Msocket library, all requests are of type <code>POST</code>.</p></li>
  <li>
  <p>WebsocketHandler - This handler contains routes corresponding to web-socket requests. e.g. <code>GatewayWebsocketHandler</code>, <code>SequencerWebsocketHandler</code>. Since, websocket request work on top of http protocol, routes in WebsocketHandler are handled by <code>HttpService</code> along with PostHandler routes.</p></li>
</ol>
<h2><a href="#api-impl-and-behavior-classes" name="api-impl-and-behavior-classes" class="anchor"><span class="anchor-link"></span></a>Api, Impl and Behavior classes</h2>
<h3><a href="#api" name="api" class="anchor"><span class="anchor-link"></span></a>Api</h3>
<p>These classes define the contracts for external users of our application. e.g. <code>SequencerApi</code>, <code>SequenceManagerApi</code>, <code>AlarmApi</code>.</p>
<h3><a href="#impl" name="impl" class="anchor"><span class="anchor-link"></span></a>Impl</h3>
<p>These classes has implementation to Api classes. e.g. <code>SequencerImpl</code>, <code>SequenceManagerImpl</code>, <code>AlarmImpl</code>. These classes can call other services to fulfil the requests or handle it using corresponding behaviour classes.</p>
<h3><a href="#behaviour" name="behaviour" class="anchor"><span class="anchor-link"></span></a>Behaviour</h3>
<p>Impl classes don&rsquo;t have logic to manage application state of the system, it is handled by behaviours classes. They use Akka Actors state machine pattern to manage state. e.g. <code>SequencerBehavior</code>, <code>SequenceManagerBehavior</code>.</p>
<h2><a href="#codecs" name="codecs" class="anchor"><span class="anchor-link"></span></a>Codecs</h2>
<p>When you send request over the wire, it needs to be converted and send in some standard format like JSON. For this purpose we use Codec classes which use Borer library to automatically derive JSON and CBOR format. e.g. in <code>OcsCodecs</code> <code>implicit lazy val stepCodec: Codec[Step] = deriveCodec</code>, here deriveCode do the job of generating decoder/encoder for serialization/deserialization. These Codec classes contain reference of model case classes and these are marked implicit, so that when a class extends this codec class it gets the model class codec automatically. e.g <code>OcsCodecs</code>, <code>SequencerServiceCodecs</code>. You can even have hierarchy of model classes, and you just need to provide top level class/marker trait, and it will automatically derive child class codecs. e.g. in <code>SequencerServiceCodecs</code> <code>implicit lazy val sequencerPostRequestValue: Codec[SequencerRequest] = deriveAllCodecs</code>, here you see deriveAllCodecs which means generate decoder/encoder of complete class hierarchy starting from top level <code>SequencerRequest</code>. There are mainly two use cases when you need to serialize/deserialize of request and response.</p>
<p>Remote Actor Communication - First use case is when your actor system interact with other remote actor systems from other services. We use cbor format for serialization/deserialization in our application for it. e.g. When Sequencer receive requests from Gateway via Actors. For such cases first we need to add model classes to Codecs so that encoder/decoder can be derived. e.g. <code>AgentActorCodecs</code>. Then we need to registered models classes to serializer class e.g. <code>AgentAkkaSerializer</code> and also we need to mark our model classes as Serializable e.g. <code>sealed trait AgentResponse extends AgentAkkaSerializable</code>. Both Serializer and Serializable class are present in configuration of application so that Akka Actors can use them for serialization/deserialization. e.g. in <code>esw-agent-akka-client</code> module <code>reference.conf</code> has <code>AgentAkkaSerializer</code> as serializers and <code>AgentAkkaSerializable</code> as serialization-bindings.</p>
<p>Http Communication - Second use case is when consume your request and send response back over Http protocol. For such use cases, when a request goes to PostHandler, it needs a mechanism to deserialize request, process it and serialize the response and sent it back. For this reason PostHandler uses HttpCodec classes which takes care of serialization and deserialization. Since, Web socket protocol work on top of Http protocol hence WebsocketHandler uses same mechanism as PostHandler. e.g. <code>SequencerWiring</code> extends <code>SequencerServiceCodecs</code> and further <code>SequencerWiring</code> pass Codecs to <code>SequencerPostHandler</code> via <code>PostRouteFactory</code> and to <code>SequencerWebsocketHandler</code> via <code>WebsocketRouteFactory</code>.</p>
<h2><a href="#complete-flow-of-above-discussed-classes-is" name="complete-flow-of-above-discussed-classes-is" class="anchor"><span class="anchor-link"></span></a>Complete flow of above discussed classes is</h2>
<p>Main (using case app) -&gt; Wiring -&gt; HttpService(esw-http-core) -&gt; HttpPostHandler(using Codecs) + WebsocketHandler(using Codecs) -&gt; Behaviour classes(using Codecs).</p>
</div>
<div>
<a href="https://github.com/tmtsoftware/esw/tree/master/docs/src/main/technical/esw-low-level-design.md" title="Edit this page" class="md-source-file md-edit">
Edit this page
</a>
</div>
<div class="print-only">
<span class="md-source-file md-version">
0.3.0-RC1
</span>
</div>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-nav">
<nav class="md-footer-nav__inner md-grid">
<a href="../technical/apps/eng-ui.html" title="ESW OCS Engineering User Interface User Manual" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
</div>
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Previous
</span>
ESW OCS Engineering User Interface User Manual
</span>
</div>
</a>
<a href="../tutorials/web-app-tutorial.html" title="Web Application Tutorial" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Next
</span>
Web Application Tutorial
</span>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
</div>
</a>
</nav>
</div>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
Powered by
<a href="https://github.com/lightbend/paradox">Paradox</a>
and
<a href="https://jonas.github.io/paradox-material-theme/">Paradox Material Theme</a>

</div>
</div>
</div>
</footer>

</div>
<script src="../assets/javascripts/application.583bbe55.js"></script>
<script src="../assets/javascripts/paradox-material-theme.js"></script>
<script>app.initialize({version:"0.17",url:{base:"../."}})</script>
<script type="text/javascript" src="../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function(event) {
window.prettyPrint && prettyPrint();
});
</script>
</body>
</html>
