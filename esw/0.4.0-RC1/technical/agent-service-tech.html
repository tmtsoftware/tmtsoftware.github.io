<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="description" content="docs">
<meta name="generator" content="Paradox, paradox-material-theme=0.7.0, mkdocs-material=3.0.3">

<meta name="lang:clipboard.copy" content="Copy to clipboard">
<meta name="lang:clipboard.copied" content="Copied to clipboard">
<meta name="lang:search.language" content="">
<meta name="lang:search.pipeline.stopwords" content="true">
<meta name="lang:search.pipeline.trimmer" content="true">
<meta name="lang:search.result.none" content="No matching documents">
<meta name="lang:search.result.one" content="1 matching document">
<meta name="lang:search.result.other" content="# matching documents">
<meta name="lang:search.tokenizer" content="[\s\-]+">


<meta name="description" content="docs">
<link rel="shortcut icon" href="../assets/images/favicon.png">
<title>Agent Service and Agent Technical Documentation Â· TMT Executive Software Documentation</title>
<link rel="stylesheet" href="../assets/stylesheets/application.451f80e5.css">
<link rel="stylesheet" href="../lib/material__tabs/dist/mdc.tabs.min.css">
<link rel="stylesheet" href="../lib/prettify/prettify.css">
<script src="../assets/javascripts/modernizr.1aa3b519.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
<style>
body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}
code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}
</style>
<link rel="stylesheet" href="../assets/fonts/font-awesome.css">
<link rel="stylesheet" href="../assets/fonts/material-icons.css">
<link rel="stylesheet" href="../assets/stylesheets/paradox-material-theme.css">
</head>
<body
>
<input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
<input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
<label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
<header class="md-header" data-md-component="header">
<nav class="md-header-nav md-grid">
<div class="md-flex">
<div class="md-flex__cell md-flex__cell--shrink">
<a href="../index.html" title="TMT Executive Software Documentation" class="md-header-nav__button md-logo">
<i class="md-icon">local_library</i>
</a>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
</div>
<div class="md-flex__cell md-flex__cell--stretch">
<div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
<span class="md-header-nav__topic">
TMT Executive Software Documentation
</span>
<span class="md-header-nav__topic">
Agent Service and Agent Technical Documentation
</span>
</div>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
<label class="md-icon md-search__icon" for="__search"></label>
<button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">&#xE5CD;</button>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix>
<div class="md-search-result" data-md-component="result">
<div class="md-search-result__meta">
Type to start searching
</div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>

</div>
</div>
</nav>
</header>

<div class="md-container">
<main class="md-main">
<div class="md-main__inner md-grid" data-md-component="container">
<div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--primary" data-md-level="0" style="visibility: hidden">
<label class="md-nav__title md-nav__title--site" for="drawer">
<a href="../index.html" title="TMT Executive Software Documentation" class="md-nav__button md-logo">
<span class="md-nav__button md-logo">
<i class="md-icon">local_library</i>
</a>
<a href="../index.html" title="TMT Executive Software Documentation">
TMT Executive Software Documentation
</a>
</label>
<ul>
  <li><a href="../esw/eswOverview.html" class="page">Executive Software Overview</a></li>
  <li><a href="../sequencersandscripts/seq-index.html" class="page">Sequencers and Sequence Components</a>
  <ul>
    <li><a href="../sequencersandscripts/sequencer.html" class="page">Sequencers in the Executive Software</a></li>
    <li><a href="../sequencersandscripts/sequencer-app.html" class="page">Running a Sequencer Using esw-ocs-app</a></li>
  </ul></li>
  <li><a href="../scripts/scripts-index.html" class="page">Sequencer Scripts</a>
  <ul>
    <li><a href="../scripts/script-styles.html" class="page">Sequencer Script Styles</a></li>
    <li><a href="../scripts/dsl/script-constructs.html" class="page">Script DSL Constructs</a></li>
    <li><a href="../scripts/dsl/csw-services.html" class="page">CSW Services DSL</a></li>
  </ul></li>
  <li><a href="../uisupport/uisupp-index.html" class="page">User Interface Support</a>
  <ul>
    <li><a href="../uisupport/UIOverview.html" class="page">User Interfaces in ESW and TMT</a></li>
    <li><a href="../uisupport/gatewayUI-template.html" class="page">Using the Gateway-only UI Template and Tutorial</a></li>
    <li><a href="../uisupport/webapp-template.html" class="page">Using the Web Application Template and Tutorial</a></li>
    <li><a href="../uisupport/gateway.html" class="page">User Interface Gateway</a></li>
  </ul></li>
  <li><a href="../technical/apps/apps-index.html" class="page">ESW Applications</a>
  <ul>
    <li><a href="../technical/apps/getting-apps.html" class="page">Getting and Running ESW Applications</a></li>
    <li><a href="../technical/apps/esw-shell.html" class="page">ESW Shell - A Testing Environment for ESW and CSW</a></li>
    <li><a href="../technical/apps/sequence-manager-app.html" class="page">Starting the Sequence Manager Application</a></li>
    <li><a href="../technical/apps/agent-service-app.html" class="page">The Agent Service Application</a></li>
    <li><a href="../technical/apps/agent-app.html" class="page">The Agent Application</a></li>
    <li><a href="../uisupport/gateway-app.html" class="page">Running the UI Gateway App</a></li>
    <li><a href="../technical/apps/esw-services.html" class="page">Running Multiple ESW Applications with esw-services</a></li>
    <li><a href="../technical/apps/eng-ui.html" class="page">ESW OCS Engineering User Interface User Manual</a></li>
  </ul></li>
  <li><a href="../technical/tech-index.html" class="page">Technical Design Documents</a>
  <ul>
    <li><a href="../technical/sequence-manager-tech.html" class="page">Sequence Manager Technical Documentation</a></li>
    <li><a href="../technical/sequencer-tech.html" class="page">Sequencer Technical Documentation</a></li>
    <li><a href="../technical/sequence-component-tech.html" class="page">Sequence Component Technical Documentation</a></li>
    <li><a href="../technical/gateway-tech.html" class="page">Gateway Technical Documentation</a></li>
    <li><a href="../technical/agent-service-tech.html" class="active page">Agent Service and Agent Technical Documentation</a></li>
    <li><a href="../technical/esw-application-parts.html" class="page">ESW Application Architecture</a></li>
    <li><a href="../technical/contracts.html" class="page">Service Contracts</a></li>
    <li><a href="../technical/testing-philosophy.html" class="page">OSW Testing Philosophy</a></li>
  </ul></li>
</ul>
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../technical/agent-service-tech.html#agent-service-and-agent-technical-documentation" class="header">Agent Service and Agent Technical Documentation</a>
  <ul>
    <li><a href="../technical/agent-service-tech.html#agent-service-introduction" class="header">Agent Service Introduction</a></li>
    <li><a href="../technical/agent-service-tech.html#agent-service-implementation-details" class="header">Agent Service Implementation Details</a></li>
    <li><a href="../technical/agent-service-tech.html#agent-service-module-esw-agent-service-" class="header">Agent Service Module (esw-agent-service)</a></li>
    <li><a href="../technical/agent-service-tech.html#agent-introduction" class="header">Agent Introduction</a></li>
    <li><a href="../technical/agent-service-tech.html#agent-implementation" class="header">Agent Implementation</a></li>
    <li><a href="../technical/agent-service-tech.html#agent-module-esw-agent-akka-" class="header">Agent Module (esw-agent-akka)</a></li>
    <li><a href="../technical/agent-service-tech.html#agent-client" class="header">Agent Client</a></li>
    <li><a href="../technical/agent-service-tech.html#running-agent-and-agent-service" class="header">Running Agent and Agent Service</a></li>
  </ul></li>
</ul>
</nav>

</nav>
<ul style="display: none">
<li class="md-nav__item md-version" id="project.version">
<label class="md-nav__link" for="__version">
<i class="md-icon" title="Version">label_outline</i> 0.4.0-RC1
</label>
</li>
</ul>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../technical/agent-service-tech.html#agent-service-and-agent-technical-documentation" class="header">Agent Service and Agent Technical Documentation</a>
  <ul>
    <li><a href="../technical/agent-service-tech.html#agent-service-introduction" class="header">Agent Service Introduction</a></li>
    <li><a href="../technical/agent-service-tech.html#agent-service-implementation-details" class="header">Agent Service Implementation Details</a></li>
    <li><a href="../technical/agent-service-tech.html#agent-service-module-esw-agent-service-" class="header">Agent Service Module (esw-agent-service)</a></li>
    <li><a href="../technical/agent-service-tech.html#agent-introduction" class="header">Agent Introduction</a></li>
    <li><a href="../technical/agent-service-tech.html#agent-implementation" class="header">Agent Implementation</a></li>
    <li><a href="../technical/agent-service-tech.html#agent-module-esw-agent-akka-" class="header">Agent Module (esw-agent-akka)</a></li>
    <li><a href="../technical/agent-service-tech.html#agent-client" class="header">Agent Client</a></li>
    <li><a href="../technical/agent-service-tech.html#running-agent-and-agent-service" class="header">Running Agent and Agent Service</a></li>
  </ul></li>
</ul>
</nav>

</div>
</div>
</div>
<div class="md-content">
<article class="md-content__inner md-typeset">
<div class="md-content__searchable">
<h1><a href="#agent-service-and-agent-technical-documentation" name="agent-service-and-agent-technical-documentation" class="anchor"><span class="anchor-link"></span></a>Agent Service and Agent Technical Documentation</h1>
<h2><a href="#agent-service-introduction" name="agent-service-introduction" class="anchor"><span class="anchor-link"></span></a>Agent Service Introduction</h2>
<p>The <code>Agent Service</code> was created to support the creation and configuration <code>Sequence Components</code> (and <code>Sequencers</code>) at run-time, a key feature of the OSW Observing Mode Oriented Architecture. Agent Service was created primarily for use by the <code>Sequence Manager</code>, but it provides a general service that may become more heavily used in the future.</p>
<p>For instance, <code>Sequence Manager</code> provides a <code>provision</code> function that takes a configuration and starts one or more <code>Sequence Components</code> on a set of machines. These <code>Sequence Components</code> can be used to run <code>Sequencers</code>.</p>
<p>The functionality of Agent Service is flexible and can be used to provide a more resilient OSW by allowing the operator of the telescope to easily respond to unexpected failures. For instance, the <code>Sequence Manager</code> itself can be created using the Agent Service. In this use case, a future operation&rsquo;s user interface will allow the operator to start a new <code>Sequence Manager</code> on a backup machine in the case where the machine running the <code>Sequence Manager</code> has failed. This kind of scenario can in many cases reduce or eliminate OSW down-time due to machine failures.</p>
<h2><a href="#agent-service-implementation-details" name="agent-service-implementation-details" class="anchor"><span class="anchor-link"></span></a>Agent Service Implementation Details</h2>
<p>The figure below shows the key parts of the Agent Service. Agent Service consists of a few different, collaborating parts deployed on different machines. Agent Service depends on and uses CSW Location Service. The Agent Service is a protected service using CSW Authorization and Authentication Service. Only users with an appropriate role are able to use the Agent Service functionality.</p>
<p><img src="../images/agentservice/AgentService.svg" alt="AgentService" /></p>
<p>The Agent Service has the following layers and modules:</p>
<ul>
  <li>Server: which provides the protected HTTP-based interface.</li>
  <li>Service implementation layer: implementation logic that includes creating the <code>AgentClient</code> for an Agent.</li>
  <li>Agent: a second program executing on hosts, which spawns or kills a given component.</li>
</ul>
<p>The figure shows a browser contacting the Agent Service executing on an ESW machine. It is registered in the Location Service. The browser makes an authorized HTTP call to the Agent Server. The server locates an Agent on the desired host using the CSW Location Service. It then uses the Agent&rsquo;s Akka-based API to execute the request on the remote host. The Agent returns a response that is serialized by the Agent Server and returned as an AgentServiceResponse.</p>
<p>The following sections describe the major modules of the Agent Service. The Agent itself is described below.</p>
<h2><a href="#agent-service-module-esw-agent-service-" name="agent-service-module-esw-agent-service-" class="anchor"><span class="anchor-link"></span></a>Agent Service Module (esw-agent-service)</h2>
<p>Agent Service starts with an HTTP service built using the <code>msocket</code> framework that is common to all ESW HTTP-based services. See <a href="https://github.com/tmtsoftware/msocket" title="msocket">msocket</a> for more information.</p>
<p>Implementation of Agent Service is distributed within the following submodules:</p>
<h3><a href="#esw-agent-service-api" name="esw-agent-service-api" class="anchor"><span class="anchor-link"></span></a>esw-agent-service-api</h3>
<p>All the request models and APIs related to <code>AgentService</code> reside within this module. This module also contains the codecs for the models. This module depends on <code>esw-agent-akka-api</code> module which provides all the response models.</p>
<p>This module is a cross-compiled project which has following parts:</p>
<ul>
  <li>js - code which is related to scala-js (for possible future UI usage)</li>
  <li>jvm - code which is related only to JVM</li>
  <li>shared - code which can be used by both scala-js and JVM</li>
</ul>
<h3><a href="#esw-agent-service-impl" name="esw-agent-service-impl" class="anchor"><span class="anchor-link"></span></a>esw-agent-service-impl</h3>
<p>This module depends on the <code>esw-agent-service-api</code> module. It contains the AgentService API&rsquo;s implementation which has the logic of creation of the <code>AgentClient</code> for a given specific Agent and calling the specific APIs of the AgentClient.</p>
<h3><a href="#esw-agent-service-app" name="esw-agent-service-app" class="anchor"><span class="anchor-link"></span></a>esw-agent-service-app</h3>
<p>A command-line application exists to start the Agent Service. It is implemented in this module.</p>
<p>This module contains all the HTTP handlers, server wiring, and the CLI app to start the agent server.</p>
<h2><a href="#agent-introduction" name="agent-introduction" class="anchor"><span class="anchor-link"></span></a>Agent Introduction</h2>
<p>Agent is an Akka-based actor which is used to spawn or kill a component on the machine where the Agent is running. The Agent must be started on each machine that is available to spawn components. At this time, we anticipate this will be primarily ESW machines, but any subsystem that needs to run a Sequencer on their machine (rather than on ESW machines) will also start an Agent.</p>
<p>Currently, Agent is able to spawn or kill the following components:</p>
<ul>
  <li>Sequence Manager</li>
  <li>Sequence Component</li>
</ul>
<h2><a href="#agent-implementation" name="agent-implementation" class="anchor"><span class="anchor-link"></span></a>Agent Implementation</h2>
<p>Agent is an Akka actor which can spawn or kill a JVM process (at this time) depending on the received message. If actor receives a spawn message(e.g., <code>SpawnSequenceManager</code> etc), it will first check if the given component is already registered in the Location Service. If yes, it replies with a failure response indicating the component already exists; otherwise, it tries to spawn the component.</p>
<p>On any spawn message Agent follows following steps:</p>
<ul>
  <li>
    <p>Checks if the component is already registered.</p>
    <ul>
      <li>If yes it returns the <code>Failure</code> response</li>
      <li>If not then it goes to the next step</li>
    </ul>
  </li>
  <li>
    <p>It spawns the component by starting a JVM-based process.</p>
    <ul>
      <li>If the process is spawned successfully, it returns the <code>Spawned</code> response</li>
      <li>If the process fails to spawn, it returns the <code>Failure</code> response</li>
    </ul>
  </li>
</ul>
<p>The following modules are part of the Agent implementation.</p>
<h2><a href="#agent-module-esw-agent-akka-" name="agent-module-esw-agent-akka-" class="anchor"><span class="anchor-link"></span></a>Agent Module (esw-agent-akka)</h2>
<p>The Agent is not a relatively simple module with only a few modules. Implementation of Agent is distributed within the following submodules:</p>
<h3><a href="#esw-agent-akka-app" name="esw-agent-akka-app" class="anchor"><span class="anchor-link"></span></a>esw-agent-akka-app</h3>
<p>This module contains Agent actor&rsquo;s implementation. The Akka-based API is implemented here. This module depends on <a href="agent-service-tech.html#agent-client">Agent Client</a> for the Agent actor&rsquo;s messages and codecs.</p>
<p>There is also a CLI-based application for starting an Agent, and it is also implemented in this module.</p>
<h2><a href="#agent-client" name="agent-client" class="anchor"><span class="anchor-link"></span></a>Agent Client</h2>
<p>A formal Akka-based client is provided for applications that need to send and receive messages to/from the Agent. This module defines the Agent actor messages and codecs.</p>
<p>Agent Client is an actor proxy to the Agent actor. It provides the API which is used internally to send messages to the Agent actor and return responses of the Agent actor to the caller.</p>
<h2><a href="#running-agent-and-agent-service" name="running-agent-and-agent-service" class="anchor"><span class="anchor-link"></span></a>Running Agent and Agent Service</h2>
<ul>
  <li>For running Agent, please refer <a href="apps/agent-app.html">this</a>.</li>
  <li>For running Agent Service, please refer <a href="apps/agent-service-app.html">this</a>.</li>
</ul>
</div>
<div>
<a href="https://github.com/tmtsoftware/esw/tree/master/docs/src/main/technical/agent-service-tech.md" title="Edit this page" class="md-source-file md-edit">
Edit this page
</a>
</div>
<div class="print-only">
<span class="md-source-file md-version">
0.4.0-RC1
</span>
</div>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-nav">
<nav class="md-footer-nav__inner md-grid">
<a href="../technical/gateway-tech.html" title="Gateway Technical Documentation" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
</div>
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Previous
</span>
Gateway Technical Documentation
</span>
</div>
</a>
<a href="../technical/esw-application-parts.html" title="ESW Application Architecture" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Next
</span>
ESW Application Architecture
</span>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
</div>
</a>
</nav>
</div>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
Powered by
<a href="https://github.com/lightbend/paradox">Paradox</a>
and
<a href="https://jonas.github.io/paradox-material-theme/">Paradox Material Theme</a>

</div>
</div>
</div>
</footer>

</div>
<script src="../assets/javascripts/application.583bbe55.js"></script>
<script src="../assets/javascripts/paradox-material-theme.js"></script>
<script>app.initialize({version:"0.17",url:{base:"../."}})</script>
<script type="text/javascript" src="../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function(event) {
window.prettyPrint && prettyPrint();
});
</script>
</body>
</html>
