<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="description" content="docs">
<meta name="generator" content="Paradox, paradox-material-theme=0.7.0, mkdocs-material=3.0.3">

<meta name="lang:clipboard.copy" content="Copy to clipboard">
<meta name="lang:clipboard.copied" content="Copied to clipboard">
<meta name="lang:search.language" content="">
<meta name="lang:search.pipeline.stopwords" content="true">
<meta name="lang:search.pipeline.trimmer" content="true">
<meta name="lang:search.result.none" content="No matching documents">
<meta name="lang:search.result.one" content="1 matching document">
<meta name="lang:search.result.other" content="# matching documents">
<meta name="lang:search.tokenizer" content="[\s\-]+">


<meta name="description" content="docs">
<link rel="shortcut icon" href="../../assets/images/favicon.png">
<title>ESW Shell - A Testing Environment for ESW and CSW Â· TMT Executive Software Documentation</title>
<link rel="stylesheet" href="../../assets/stylesheets/application.451f80e5.css">
<link rel="stylesheet" href="../../lib/material__tabs/dist/mdc.tabs.min.css">
<link rel="stylesheet" href="../../lib/prettify/prettify.css">
<script src="../../assets/javascripts/modernizr.1aa3b519.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
<style>
body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}
code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}
</style>
<link rel="stylesheet" href="../../assets/fonts/font-awesome.css">
<link rel="stylesheet" href="../../assets/fonts/material-icons.css">
<link rel="stylesheet" href="../../assets/stylesheets/paradox-material-theme.css">
</head>
<body
>
<input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
<input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
<label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
<header class="md-header" data-md-component="header">
<nav class="md-header-nav md-grid">
<div class="md-flex">
<div class="md-flex__cell md-flex__cell--shrink">
<a href="../../index.html" title="TMT Executive Software Documentation" class="md-header-nav__button md-logo">
<i class="md-icon">local_library</i>
</a>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
</div>
<div class="md-flex__cell md-flex__cell--stretch">
<div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
<span class="md-header-nav__topic">
TMT Executive Software Documentation
</span>
<span class="md-header-nav__topic">
ESW Shell - A Testing Environment for ESW and CSW
</span>
</div>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
<label class="md-icon md-search__icon" for="__search"></label>
<button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">&#xE5CD;</button>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix>
<div class="md-search-result" data-md-component="result">
<div class="md-search-result__meta">
Type to start searching
</div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>

</div>
</div>
</nav>
</header>

<div class="md-container">
<main class="md-main">
<div class="md-main__inner md-grid" data-md-component="container">
<div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--primary" data-md-level="0" style="visibility: hidden">
<label class="md-nav__title md-nav__title--site" for="drawer">
<a href="../../index.html" title="TMT Executive Software Documentation" class="md-nav__button md-logo">
<span class="md-nav__button md-logo">
<i class="md-icon">local_library</i>
</a>
<a href="../../index.html" title="TMT Executive Software Documentation">
TMT Executive Software Documentation
</a>
</label>
<ul>
  <li><a href="../../esw/eswOverview.html" class="page">Executive Software Overview</a></li>
  <li><a href="../../sequencersandscripts/seq-index.html" class="page">Sequencers and Sequence Components</a>
  <ul>
    <li><a href="../../sequencersandscripts/sequencer.html" class="page">Sequencers in the Executive Software</a></li>
    <li><a href="../../sequencersandscripts/sequencer-app.html" class="page">Running a Sequencer Using esw-ocs-app</a></li>
  </ul></li>
  <li><a href="../../scripts/scripts-index.html" class="page">Sequencer Scripts</a>
  <ul>
    <li><a href="../../scripts/script-styles.html" class="page">Sequencer Script Styles</a></li>
    <li><a href="../../scripts/dsl/script-constructs.html" class="page">Script DSL Constructs</a></li>
    <li><a href="../../scripts/dsl/csw-services.html" class="page">CSW Services DSL</a></li>
  </ul></li>
  <li><a href="../../uisupport/uisupp-index.html" class="page">User Interface Support</a>
  <ul>
    <li><a href="../../uisupport/UIOverview.html" class="page">User Interfaces in ESW and TMT</a></li>
    <li><a href="../../uisupport/gatewayUI-template.html" class="page">Using the Gateway-only UI Template and Tutorial</a></li>
    <li><a href="../../uisupport/webapp-template.html" class="page">Using the Web Application Template and Tutorial</a></li>
    <li><a href="../../uisupport/gateway.html" class="page">User Interface Gateway</a></li>
  </ul></li>
  <li><a href="../../technical/apps/apps-index.html" class="page">ESW Applications</a>
  <ul>
    <li><a href="../../technical/apps/getting-apps.html" class="page">Getting and Running ESW Applications</a></li>
    <li><a href="../../technical/apps/esw-shell.html" class="active page">ESW Shell - A Testing Environment for ESW and CSW</a></li>
    <li><a href="../../technical/apps/sequence-manager-app.html" class="page">Starting the Sequence Manager Application</a></li>
    <li><a href="../../technical/apps/agent-service-app.html" class="page">The Agent Service Application</a></li>
    <li><a href="../../technical/apps/agent-app.html" class="page">The Agent Application</a></li>
    <li><a href="../../uisupport/gateway-app.html" class="page">Running the UI Gateway App</a></li>
    <li><a href="../../technical/apps/esw-services.html" class="page">Running Multiple ESW Applications with esw-services</a></li>
    <li><a href="../../technical/apps/eng-ui.html" class="page">ESW OCS Engineering User Interface User Manual</a></li>
  </ul></li>
  <li><a href="../../technical/tech-index.html" class="page">Technical Design Documents</a>
  <ul>
    <li><a href="../../technical/sequence-manager-tech.html" class="page">Sequence Manager Technical Documentation</a></li>
    <li><a href="../../technical/sequencer-tech.html" class="page">Sequencer Technical Documentation</a></li>
    <li><a href="../../technical/sequence-component-tech.html" class="page">Sequence Component Technical Documentation</a></li>
    <li><a href="../../technical/gateway-tech.html" class="page">Gateway Technical Documentation</a></li>
    <li><a href="../../technical/agent-service-tech.html" class="page">Agent Service and Agent Technical Documentation</a></li>
    <li><a href="../../technical/esw-application-parts.html" class="page">ESW Application Architecture</a></li>
    <li><a href="../../technical/contracts.html" class="page">Service Contracts</a></li>
    <li><a href="../../technical/testing-philosophy.html" class="page">OSW Testing Philosophy</a></li>
  </ul></li>
</ul>
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../../technical/apps/esw-shell.html#esw-shell-a-testing-environment-for-esw-and-csw" class="header">ESW Shell - A Testing Environment for ESW and CSW</a>
  <ul>
    <li><a href="../../technical/apps/esw-shell.html#1-install-coursier-and-the-tmt-apps-channel" class="header">1. Install <code>coursier</code> and the TMT Apps Channel</a></li>
    <li><a href="../../technical/apps/esw-shell.html#2-start-any-needed-csw-services-or-esw-apps" class="header">2. Start Any Needed CSW Services or ESW Apps</a></li>
    <li><a href="../../technical/apps/esw-shell.html#3-starting-esw-shell" class="header">3. Starting esw-shell</a></li>
    <li><a href="../../technical/apps/esw-shell.html#4-exiting-esw-shell" class="header">4. Exiting esw-shell</a></li>
    <li><a href="../../technical/apps/esw-shell.html#using-esw-shell" class="header">Using ESW Shell</a></li>
  </ul></li>
</ul>
</nav>

</nav>
<ul style="display: none">
<li class="md-nav__item md-version" id="project.version">
<label class="md-nav__link" for="__version">
<i class="md-icon" title="Version">label_outline</i> 0.4.0
</label>
</li>
</ul>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../../technical/apps/esw-shell.html#esw-shell-a-testing-environment-for-esw-and-csw" class="header">ESW Shell - A Testing Environment for ESW and CSW</a>
  <ul>
    <li><a href="../../technical/apps/esw-shell.html#1-install-coursier-and-the-tmt-apps-channel" class="header">1. Install <code>coursier</code> and the TMT Apps Channel</a></li>
    <li><a href="../../technical/apps/esw-shell.html#2-start-any-needed-csw-services-or-esw-apps" class="header">2. Start Any Needed CSW Services or ESW Apps</a></li>
    <li><a href="../../technical/apps/esw-shell.html#3-starting-esw-shell" class="header">3. Starting esw-shell</a></li>
    <li><a href="../../technical/apps/esw-shell.html#4-exiting-esw-shell" class="header">4. Exiting esw-shell</a></li>
    <li><a href="../../technical/apps/esw-shell.html#using-esw-shell" class="header">Using ESW Shell</a></li>
  </ul></li>
</ul>
</nav>

</div>
</div>
</div>
<div class="md-content">
<article class="md-content__inner md-typeset">
<div class="md-content__searchable">
<h1><a href="#esw-shell-a-testing-environment-for-esw-and-csw" name="esw-shell-a-testing-environment-for-esw-and-csw" class="anchor"><span class="anchor-link"></span></a>ESW Shell - A Testing Environment for ESW and CSW</h1>
<p>This project contains an interactive shell powered by <a href="https://ammonite.io/#Ammonite-REPL">Ammonite</a> that provides access to all the major CSW and ESW services via a command-line interface (CLI). ESW-shell can be used to communicate with Assemblies, HCDs (Hardware Control Daemon), and Sequencers using TMT Common Software (<a href="https://github.com/tmtsoftware/csw">CSW</a>) APIs. </p>
<p>Additionally, there are ESW-provided Sequencer commands and ESW applications using TMT Executive Software (<a href="https://github.com/tmtsoftware/esw">ESW</a>) that can be used and communicated with and controlled using ESW-shell.</p>
<h2><a href="#1-install-coursier-and-the-tmt-apps-channel" name="1-install-coursier-and-the-tmt-apps-channel" class="anchor"><span class="anchor-link"></span></a>1. Install <code>coursier</code> and the TMT Apps Channel</h2>
<p>The <code>coursier</code> application must be installed on your machine and the OCS Apps channel must be installed. The instructions for doing this are provided <a href="getting-apps.html">here</a>.</p>
<h2><a href="#2-start-any-needed-csw-services-or-esw-apps" name="2-start-any-needed-csw-services-or-esw-apps" class="anchor"><span class="anchor-link"></span></a>2. Start Any Needed CSW Services or ESW Apps</h2>
<p>If you need some CSW Services or Assemblies or HCDs, they should be started depending on your goals according to steps 3 and 4 of <a href="getting-apps.html">here</a>.</p>
<h2><a href="#3-starting-esw-shell" name="3-starting-esw-shell" class="anchor"><span class="anchor-link"></span></a>3. Starting esw-shell</h2>
<p>Once <code>coursier</code> and apps are installed, it can be used to start <code>esw-shell</code>, type:</p>
<pre class="prettyprint"><code class="language-bash">cs launch esw-shell
</code></pre>
<p>If you need to start with a specific version, the following can be used:</p>
<pre class="prettyprint"><code class="language-bash">cs launch esw-shell
</code></pre>
<p>Normally, you don&rsquo;t need to start the app with a specific version.</p>
<h2><a href="#4-exiting-esw-shell" name="4-exiting-esw-shell" class="anchor"><span class="anchor-link"></span></a>4. Exiting esw-shell</h2>
<p>At any point in time, if you want to exit the shell, type <code>exit</code> and press enter. <br/><br/></p>
<h1><a href="#using-esw-shell" name="using-esw-shell" class="anchor"><span class="anchor-link"></span></a>Using ESW Shell</h1>
<p>The following sections provide examples of some built-in capabilities of ESW-shell. Note that ESW shell can be extended by the user by defining your own functions and saving them in files that can be loaded dynamically whenever needed.</p>
<h2><a href="#imports-available-in-esw-shell" name="imports-available-in-esw-shell" class="anchor"><span class="anchor-link"></span></a>Imports Available in esw-shell</h2>
<p>The contents of the following imports are available in <code>esw-shell</code> when it is started. A user does not need to import them again.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/esw/tree/master/esw-shell/src/main/scala/esw/shell/Main.scala#L18-L54" target="_blank" title="Go to snippet source">source</a><code class="language-scala">|import java.nio.file.Path
|import java.nio.file.Paths
|import akka.util.Timeout
|import akka.Done
|import scala.concurrent.duration.{Duration, DurationDouble}
|import scala.concurrent.{Await, Future}
|import csw.alarm.models.AlarmSeverity
|import csw.alarm.models.Key.AlarmKey
|import csw.params.core.generics.KeyType._
|import csw.params.core.generics._
|import csw.params.events._
|import csw.params.commands._
|import csw.params.commands.CommandResponse._
|import csw.params.core.models._
|import csw.logging.models.Level._
|import csw.prefix.models.Subsystem._
|import csw.prefix.models.Prefix
|import csw.time.core.models._
|import csw.params.core.states._
|import csw.location.api.models._
|import csw.location.api.models.ComponentType._
|import csw.location.api.models.ConnectionType._
|import csw.location.api.models.Connection._
|import csw.logging.models.LogMetadata
|import csw.command.api.{DemandMatcher, DemandMatcherAll, PresenceMatcher}
|import esw.ocs.api.models._
|import esw.ocs.api.protocol._
|import esw.sm.api.models.ProvisionConfig
|import esw.sm.api.protocol._
|import esw.agent.service.api.models._
|import esw.shell.utils._
|import esw.commons.extensions.FutureExt._
|import esw.shell.utils.Timeouts._
|import eswWiring._
|import eswWiring.factories._
|import eswWiring.cswWiring.cswContext._
|import csw.framework.scaladsl.DefaultComponentHandlers</code></pre></dd>
</dl>
<h2><a href="#usage-of-command-service-to-interact-with-hcds-assemblies-and-sequencers" name="usage-of-command-service-to-interact-with-hcds-assemblies-and-sequencers" class="anchor"><span class="anchor-link"></span></a>Usage of Command Service to interact with HCDs, Assemblies and Sequencers</h2>
<p>The following is built-in functionality for working with Command Service and Assemblies and HCDs.</p>
<h3><a href="#spawning-a-simulated-hcd-assembly" name="spawning-a-simulated-hcd-assembly" class="anchor"><span class="anchor-link"></span></a>Spawning a Simulated HCD/Assembly</h3>
<p><code>esw-shell</code> can be used to spawn a simulated HCD/Assembly using these <a href="https://github.com/tmtsoftware/esw/blob/v0.4.0/esw-shell/src/main/scala/esw/shell/component/SimulatedComponentHandlers.scala">Simulated Component Handlers</a>.</p>
<p><code>SimulatedComponentHandlers</code> supports two commands:</p>
<ul>
  <li><code>noop</code> : This command immediately returns <code>Completed</code> response with <code>runId</code></li>
  <li><code>sleep</code> : This command immediately returns <code>Started</code> response with <code>runId</code> and <code>Completed</code> response after some sleep time. This sleep time is specified in <code>timeInMs</code> parameter of the command.</li>
</ul>
<p>The example commands below will spawn a simulated HCD/Assembly without having the need of a running Agent.</p>
<pre class="prettyprint"><code class="language-bash">spawnSimulatedHCD(&quot;ESW.testHCD1&quot;) // &quot;ESW.testHCD1&quot; is the HCD prefix
spawnSimulatedAssembly(&quot;ESW.testAssembly&quot;) // &quot;ESW.testAssembly&quot; is the assembly prefix
</code></pre>
<h3><a href="#using-predefined-component-handlers-on-agent" name="using-predefined-component-handlers-on-agent" class="anchor"><span class="anchor-link"></span></a>Using predefined component handlers on Agent</h3>
<p>The Agent Service can also be used to spawn simulated HCD/Assemblies on any machine that is running an Agent.</p>
<p>These example commands will spawn a simulated HCD/Assembly on <code>ESW.machine1</code> Agent. It is assumed that <code>ESW.machine1</code> Agent is already running. For running agent refer <a href="agent-app.html">Agent App</a></p>
<pre class="prettyprint"><code class="language-bash">spawnSimulatedHCD(&quot;ESW.testHCD&quot;, &quot;ESW.machine1&quot;) // &quot;ESW.testHCD&quot; is the HCD prefix
spawnSimulatedAssembly(&quot;ESW.testAssembly&quot;, &quot;ESW.machine1&quot;) // &quot;ESW.testAssembly&quot; is the assembly prefix
</code></pre>
<h3><a href="#using-custom-component-handlers" name="using-custom-component-handlers" class="anchor"><span class="anchor-link"></span></a>Using custom component handlers</h3>
<p><code>esw-shell</code> can be used to spawn a real HCD/Assembly which uses custom component handlers passed by the user.</p>
<p>The example below will spawn an Assembly that uses the provided component handlers which will be used by the created Assembly.</p>
<pre class="prettyprint"><code class="language-bash">val componentHandlers = (ctx, cswCtx) =&gt;
      new DefaultComponentHandlers(ctx, cswCtx) {
        override def onSubmit(runId: Id, controlCommand: ControlCommand): CommandResponse.SubmitResponse = {
          controlCommand.commandName.name match {
            case &quot;sleep&quot; =&gt;
              // do something on receiving move command
              cswCtx.timeServiceScheduler.scheduleOnce(UTCTime(UTCTime.now().value.plusSeconds(5))) {
                cswCtx.commandResponseManager.updateCommand(CommandResponse.Completed(runId))
              }
              CommandResponse.Started(runId)
            case _ =&gt; CommandResponse.Completed(runId)
          }
        }
      }
spawnAssemblyWithHandler(&quot;ESW.testHCD&quot;, componentHandlers) // &quot;ESW.testHCD&quot; is the HCD prefix
spawnHCDWithHandler(&quot;ESW.testAssembly&quot;, componentHandlers) // &quot;ESW.testAssembly&quot; is the assembly prefix
</code></pre>
<p>This is a very nice feature! It can be used to create components that can simulate other components within tests, for instance.</p>
<h3><a href="#finding-a-required-component" name="finding-a-required-component" class="anchor"><span class="anchor-link"></span></a>Finding a required component</h3>
<p>To get a handle to a Command Service for a particular HCD/Assembly/Sequencer, use the following <code>esw-shell</code> short-cut commands:</p>
<p>To create a CommandService for an HCD:</p>
<ul>
  <li><code>val hcdComponent = hcdCommandService(&quot;IRIS.hcd_name&quot;)</code></li>
</ul>
<p>For Assemblies:</p>
<ul>
  <li><code>val assemblyComponent = assemblyCommandService(&quot;IRIS.assembly_name&quot;)</code></li>
</ul>
<p>This can also be done for a Sequencer in order to send a Sequence to a Sequencer. (See also: <a href="../sequencer-tech.html">Sequencers</a>)</p>
<ul>
  <li><code>val sequencer = sequencerCommandService(IRIS, &quot;darknight&quot;)</code></li>
</ul>
<p><strong>IRIS.hcd_name</strong> and <strong>IRIS.assembly_name</strong> are the Prefix by which the HCD and Assembly respectively, are registered with Location Service.</p>
<p><strong>IRIS</strong> and <strong>darknight</strong> are the Subsystem and the observing mode for the Sequencer.</p><div class="callout note "><div class="callout-title">Note</div>
<p>The above calls internally use Location Service to resolve the required HCD/Assembly/Sequencer.</p></div>
<h3><a href="#creating-a-setup-to-submit-to-hcd-assembly-using-command-service" name="creating-a-setup-to-submit-to-hcd-assembly-using-command-service" class="anchor"><span class="anchor-link"></span></a>Creating a Setup to submit to HCD/Assembly using Command Service</h3>
<p>To send a Setup or Observe command to a component, create the Parameters and add them to the Setup or Observe.</p>
<pre class="prettyprint"><code class="language-scala">val longKey  = LongKey.make(&quot;timeInMs&quot;)
val paramSet = Set(longKey.set(1000))

val setup = Setup(Prefix(&quot;iris.filter.wheel&quot;), CommandName(&quot;sleep&quot;), Some(ObsId(&quot;2020A-001-123&quot;))).madd(paramSet)
</code></pre>
<h3><a href="#creating-a-sequence-to-submit-to-a-sequencer-using-command-service" name="creating-a-sequence-to-submit-to-a-sequencer-using-command-service" class="anchor"><span class="anchor-link"></span></a>Creating a Sequence to submit to a Sequencer using Command Service</h3>
<pre class="prettyprint"><code class="language-scala">val byteKey  = ByteKey.make(&quot;byteKey&quot;)
val paramSet = Set(byteKey.set(100, 100))

val setup = Setup(Prefix(&quot;iris.filter.wheel&quot;), CommandName(&quot;move&quot;), Some(ObsId(&quot;2020A-001-123&quot;))).madd(paramSet)
val sequence = Sequence(setup)
</code></pre>
<p>Note that in the last step, the Setup is wrapped in a Sequence to make a Sequence with one Step.</p>
<p>Other than Command Service handles, the following pre-defined handles or factories are available in <code>esw-shell</code> to interact with different services:</p>
<ul>
  <li>For Sequence Manager, use pre-imported <code>sequenceManager()</code> handle</li>
  <li>For Agent, create new handle using <code>agentClient(&quot;iris.machine_1&quot;)</code></li>
  <li>For SequenceComponent, create new handle using <code>sequenceComponentService(&quot;ESW.ESW_1&quot;)</code></li>
  <li>For AdminApi, use pre-imported <code>adminApi</code> handle</li>
  <li>For EventService, use pre-imported <code>eventService</code> handle</li>
  <li>For AlarmService, use pre-imported <code>alarmService</code> handle</li>
</ul>
<h3><a href="#creating-a-csw-componentid" name="creating-a-csw-componentid" class="anchor"><span class="anchor-link"></span></a>Creating a CSW ComponentId</h3>
<pre class="prettyprint"><code class="language-scala">val componentId = ComponentId(Prefix(ESW, &quot;test1&quot;), Assembly)
</code></pre>
<h3><a href="#creating-an-event" name="creating-an-event" class="anchor"><span class="anchor-link"></span></a>Creating an Event</h3>
<p>Events work much like Setups.</p>
<pre class="prettyprint"><code class="language-scala">val byteKey  = ByteKey.make(&quot;byteKey&quot;)
val paramSet = Set(byteKey.set(100, 100 ))
val prefix   = Prefix(&quot;tcs.assembly&quot;)
val event    = SystemEvent(prefix, EventName(&quot;event_1&quot;)).madd(paramSet)
</code></pre>
<h3><a href="#creating-an-alarmkey" name="creating-an-alarmkey" class="anchor"><span class="anchor-link"></span></a>Creating an AlarmKey</h3>
<pre class="prettyprint"><code class="language-scala">val alarmKey = AlarmKey(Prefix(NFIRAOS, &quot;trombone&quot;), &quot;tromboneAxisHighLimitAlarm&quot;)
</code></pre>
<h3><a href="#submitting-a-setup-to-a-component" name="submitting-a-setup-to-a-component" class="anchor"><span class="anchor-link"></span></a>Submitting a Setup to a component</h3>
<p>Use the Command Service <code>submit</code> call with the Setup created in a previous step to send the Setup to the HCD or Assembly.</p>
<p>The <code>esw-shell</code> is just providing a Scala programming environment. Therefore, <code>submit</code> returns a response wrapped in a Future, you can use <code>get</code> to extract the response out of any Future response once it completes. The Future has a default wait timeout of <code>10.seconds</code> for the future to complete:</p>
<ul>
  <li><code>val hcdResponse = hcdComponent.submit(setup).get</code></li>
  <li><code>val assemblyResponse = assemblyComponent.submit(setup).get</code></li>
</ul>
<p>If you have a long-running command, you can use <code>await</code> method with your own custom timeout:</p>
<ul>
  <li><code>val hcdResponse = hcdComponent.submit(setup).await(20.seconds)</code></li>
</ul>
<p>Submit the Sequence created in a previous step using the Command Service for the Sequencer:</p>
<ul>
  <li><code>val sequencerResponse = sequencer.submit(sequence).get</code></li>
</ul>
<p>The other Command Service calls are also present on a Command Service handle.</p>
<h3><a href="#submitting-commands-to-an-esw-service" name="submitting-commands-to-an-esw-service" class="anchor"><span class="anchor-link"></span></a>Submitting commands to an ESW service</h3>
<p>To Agent:</p>
<ul>
  <li><code>val agent = agentClient(&quot;iris.machine_1&quot;)</code></li>
  <li><code>val spawnResponse = agent.spawnSequenceComponent(&quot;ESW_1&quot;, Some(&quot;1.0.0&quot;)).get</code></li>
</ul>
<p>To AdminApi:</p>
<ul>
  <li><code>val logMetadata = adminApi.getLogMetadata(componentId).get</code></li>
</ul>
<p>To Event Service:</p>
<ul>
  <li><code>val publishResponse = eventService.publish(event).get</code></li>
</ul>
<p>To AlarmService:</p>
<ul>
  <li><code>val response = alarmService.setSeverity(alarmKey, AlarmSeverity.Major).get</code></li>
</ul>
<h2><a href="#interacting-with-sequence-manager" name="interacting-with-sequence-manager" class="anchor"><span class="anchor-link"></span></a>Interacting with Sequence Manager</h2>
<p>You can also use the Sequence Manager to send commands to the ESW Sequence Manager. Sequence Manager is a service, it is not an Assembly or HCD. It has its own specialized Sequence Manager API.</p>
<p>A handle to a running <a href="sequence-manager-app.html">Sequence Manager</a> can be obtained using:</p>
<pre class="prettyprint"><code class="language-bash">val sm = sequenceManager()
</code></pre><div class="callout note "><div class="callout-title">Note</div>
<p>Unlike Assemblies, and HCDs, there is only one Sequence Manager service at a time.</p></div>
<p>All Sequence Manager APIs can be called upon the handle. For example:</p>
<pre class="prettyprint"><code class="language-bash">val configureResponse = sm.configure(ObsMode(&quot;darknight&quot;)).get
val shutdownSequencerResponse = sm.shutdownSequencer(ESW, ObsMode(&quot;darknight&quot;)).get
val resources = sm.getResources.get
</code></pre>
<h2><a href="#interacting-with-sequence-component" name="interacting-with-sequence-component" class="anchor"><span class="anchor-link"></span></a>Interacting with Sequence Component</h2>
<p>Sequence Components are used to create Sequencers. They, too, can be accessed with <code>esw-shell</code>.</p>
<p>Get a handle to a running <a href="../../sequencersandscripts/sequencer-app.html">Sequence Component</a> using:</p>
<pre class="prettyprint"><code class="language-bash">val sc = sequenceComponentService(&quot;ESW.ESW_1&quot;)
</code></pre>
<p>Note that the Sequence Component is registered with a Subsystem.name.</p>
<p>All Sequence Component APIs can be called upon the handle. For example:</p>
<pre class="prettyprint"><code class="language-bash">val loadScriptResponse =  sc.loadScript(Prefix(ESW,&quot;darknight&quot;)).get
val unloadScriptResponse =  sc.unloadScript().get
val restartScriptResponse =  sc.restartScript().get
</code></pre>
<h3><a href="#provisioning-sequence-components" name="provisioning-sequence-components" class="anchor"><span class="anchor-link"></span></a>Provisioning Sequence Components</h3>
<p>In order to provision Sequence Components using Sequence Manager, use some custom version of Sequencer scripts, we have provided a special method in <code>esw-shell</code>:</p>
<pre class="prettyprint"><code class="language-bash">provision(ProvisionConfig((Prefix(ESW, &quot;primary&quot;) -&gt; 3)), &lt;sequencer scripts version | SHA&gt;)
</code></pre>
<p>This is useful in case new scripts are to be tested in a dev environment. The Sequencer scripts version for these new scripts can be provided in this method. It will take care of updating this version in the Configuration Service before setting up the Sequence Components.</p>
</div>
<div>
<a href="https://github.com/tmtsoftware/esw/tree/master/docs/src/main/technical/apps/esw-shell.md" title="Edit this page" class="md-source-file md-edit">
Edit this page
</a>
</div>
<div class="print-only">
<span class="md-source-file md-version">
0.4.0
</span>
</div>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-nav">
<nav class="md-footer-nav__inner md-grid">
<a href="../../technical/apps/getting-apps.html" title="Getting and Running ESW Applications" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
</div>
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Previous
</span>
Getting and Running ESW Applications
</span>
</div>
</a>
<a href="../../technical/apps/sequence-manager-app.html" title="Starting the Sequence Manager Application" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Next
</span>
Starting the Sequence Manager Application
</span>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
</div>
</a>
</nav>
</div>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
Powered by
<a href="https://github.com/lightbend/paradox">Paradox</a>
and
<a href="https://jonas.github.io/paradox-material-theme/">Paradox Material Theme</a>

</div>
</div>
</div>
</footer>

</div>
<script src="../../assets/javascripts/application.583bbe55.js"></script>
<script src="../../assets/javascripts/paradox-material-theme.js"></script>
<script>app.initialize({version:"0.17",url:{base:"../../."}})</script>
<script type="text/javascript" src="../../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function(event) {
window.prettyPrint && prettyPrint();
});
</script>
</body>
</html>
