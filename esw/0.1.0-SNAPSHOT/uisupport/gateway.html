<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="description" content="docs">
<meta name="generator" content="Paradox, paradox-material-theme=0.7.0, mkdocs-material=3.0.3">

<meta name="lang:clipboard.copy" content="Copy to clipboard">
<meta name="lang:clipboard.copied" content="Copied to clipboard">
<meta name="lang:search.language" content="">
<meta name="lang:search.pipeline.stopwords" content="true">
<meta name="lang:search.pipeline.trimmer" content="true">
<meta name="lang:search.result.none" content="No matching documents">
<meta name="lang:search.result.one" content="1 matching document">
<meta name="lang:search.result.other" content="# matching documents">
<meta name="lang:search.tokenizer" content="[\s\-]+">


<meta name="description" content="docs">
<link rel="shortcut icon" href="../assets/images/favicon.png">
<title>User Interface Gateway Â· TMT Executive Software Documentation</title>
<link rel="stylesheet" href="../assets/stylesheets/application.451f80e5.css">
<link rel="stylesheet" href="../lib/material__tabs/dist/mdc.tabs.min.css">
<link rel="stylesheet" href="../lib/prettify/prettify.css">
<script src="../assets/javascripts/modernizr.1aa3b519.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
<style>
body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}
code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}
</style>
<link rel="stylesheet" href="../assets/fonts/font-awesome.css">
<link rel="stylesheet" href="../assets/fonts/material-icons.css">
<link rel="stylesheet" href="../assets/stylesheets/paradox-material-theme.css">
</head>
<body
>
<input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
<input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
<label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
<header class="md-header" data-md-component="header">
<nav class="md-header-nav md-grid">
<div class="md-flex">
<div class="md-flex__cell md-flex__cell--shrink">
<a href="../index.html" title="TMT Executive Software Documentation" class="md-header-nav__button md-logo">
<i class="md-icon">local_library</i>
</a>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
</div>
<div class="md-flex__cell md-flex__cell--stretch">
<div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
<span class="md-header-nav__topic">
TMT Executive Software Documentation
</span>
<span class="md-header-nav__topic">
User Interface Gateway
</span>
</div>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
<label class="md-icon md-search__icon" for="__search"></label>
<button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">&#xE5CD;</button>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix>
<div class="md-search-result" data-md-component="result">
<div class="md-search-result__meta">
Type to start searching
</div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>

</div>
</div>
</nav>
</header>

<div class="md-container">
<main class="md-main">
<div class="md-main__inner md-grid" data-md-component="container">
<div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--primary" data-md-level="0" style="visibility: hidden">
<label class="md-nav__title md-nav__title--site" for="drawer">
<a href="../index.html" title="TMT Executive Software Documentation" class="md-nav__button md-logo">
<span class="md-nav__button md-logo">
<i class="md-icon">local_library</i>
</a>
<a href="../index.html" title="TMT Executive Software Documentation">
TMT Executive Software Documentation
</a>
</label>
<ul>
  <li><a href="../esw/eswOverview.html" class="page">Executive Software Overview</a></li>
  <li><a href="../sequencersandscripts/seq-index.html" class="page">Sequencers and Sequence Components</a>
  <ul>
    <li><a href="../sequencersandscripts/sequencer.html" class="page">Sequencers in the Executive Software</a></li>
    <li><a href="../sequencersandscripts/sequencer-app.html" class="page">Running a Sequencer Using esw-ocs-app</a></li>
  </ul></li>
  <li><a href="../scripts/scripts-index.html" class="page">Sequencer Scripts</a>
  <ul>
    <li><a href="../scripts/script-styles.html" class="page">Sequencer Script Styles</a></li>
    <li><a href="../scripts/dsl/script-constructs.html" class="page">Script DSL Constructs</a></li>
    <li><a href="../scripts/dsl/csw-services.html" class="page">CSW Services DSL</a></li>
  </ul></li>
  <li><a href="../uisupport/uisupp-index.html" class="page">User Interface Support</a>
  <ul>
    <li><a href="../uisupport/UIOverview.html" class="page">User Interfaces in ESW and TMT</a></li>
    <li><a href="../uisupport/gatewayUI-template.html" class="page">Using the Gateway-only UI Template and Tutorial</a></li>
    <li><a href="../uisupport/webapp-template.html" class="page">Using the Web Application Template and Tutorial</a></li>
    <li><a href="../uisupport/gateway.html" class="active page">User Interface Gateway</a></li>
    <li><a href="../uisupport/gateway-app.html" class="page">Running the UI Gateway App</a></li>
  </ul></li>
  <li><a href="../technical/apps/apps-index.html" class="page">ESW Applications</a>
  <ul>
    <li><a href="../technical/apps/getting-apps.html" class="page">Getting and Running ESW Applications</a></li>
    <li><a href="../technical/apps/esw-shell.html" class="page">ESW Shell - A Testing Environment for ESW and CSW</a></li>
    <li><a href="../technical/apps/sequence-manager-app.html" class="page">Starting the Sequence Manager Application</a></li>
    <li><a href="../technical/apps/agent-service-app.html" class="page">The Agent Service Application</a></li>
    <li><a href="../technical/apps/agent-app.html" class="page">The Agent Application</a></li>
    <li><a href="../technical/apps/eng-ui.html" class="page">ESW OCS Engineering User Interface User Manual</a></li>
  </ul></li>
  <li><a href="../technical/tech-index.html" class="page">Technical Design Documents</a>
  <ul>
    <li><a href="../technical/sequence-manager-tech.html" class="page">Sequence Manager Technical Documentation</a></li>
    <li><a href="../technical/sequencer-tech.html" class="page">Sequencer Technical Documentation</a></li>
    <li><a href="../technical/sequence-component-tech.html" class="page">Sequence Component Technical Documentation</a></li>
    <li><a href="../technical/gateway-tech.html" class="page">Gateway Technical Documentation</a></li>
    <li><a href="../technical/agent-service-tech.html" class="page">Agent Service and Agent Technical Documentation</a></li>
    <li><a href="../technical/esw-application-parts.html" class="page">ESW Application Architecture</a></li>
    <li><a href="../technical/contracts.html" class="page">Service Contracts</a></li>
    <li><a href="../technical/testing-philosophy.html" class="page">OSW Testing Philosophy</a></li>
    <li><a href="../technical/apps/esw-services.html" class="page">Running Multiple ESW Applications with esw-services</a></li>
  </ul></li>
</ul>
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../uisupport/gateway.html#user-interface-gateway" class="header">User Interface Gateway</a>
  <ul>
    <li><a href="../uisupport/gateway.html#esw-gateway-with-authentication-and-authorization" class="header">ESW Gateway with Authentication and Authorization</a></li>
    <li><a href="../uisupport/gateway.html#sample-requests" class="header">Sample Requests</a></li>
    <li><a href="../uisupport/gateway.html#gateway-technical-design" class="header">Gateway Technical Design</a></li>
  </ul></li>
</ul>
</nav>

</nav>
<ul style="display: none">
<li class="md-nav__item md-version" id="project.version">
<label class="md-nav__link" for="__version">
<i class="md-icon" title="Version">label_outline</i> 0.1.0*
</label>
</li>
</ul>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../uisupport/gateway.html#user-interface-gateway" class="header">User Interface Gateway</a>
  <ul>
    <li><a href="../uisupport/gateway.html#esw-gateway-with-authentication-and-authorization" class="header">ESW Gateway with Authentication and Authorization</a></li>
    <li><a href="../uisupport/gateway.html#sample-requests" class="header">Sample Requests</a></li>
    <li><a href="../uisupport/gateway.html#gateway-technical-design" class="header">Gateway Technical Design</a></li>
  </ul></li>
</ul>
</nav>

</div>
</div>
</div>
<div class="md-content">
<article class="md-content__inner md-typeset">
<div class="md-content__searchable">
<h1><a href="#user-interface-gateway" name="user-interface-gateway" class="anchor"><span class="anchor-link"></span></a>User Interface Gateway</h1>
<p>This is provided to give access to all CSW and ESW services and components from browser-based user interfaces.</p>
<h2><a href="#esw-gateway-with-authentication-and-authorization" name="esw-gateway-with-authentication-and-authorization" class="anchor"><span class="anchor-link"></span></a>ESW Gateway with Authentication and Authorization</h2>
<p>All TMT users use browser-based user interfaces to interact with the control system, and all TMT users must be authenticated. Once authenticated, they are authorized to use certain commands based on their roles. All UI programs must use the UI Gateway to reach the control system. The UI Gateway provides authorization and authentication in the ESW/CSW system. </p>
<p>ESW UI Gateway is accessible to the outside network and exposes API endpoints through an HTTP interface, hence we need to protect its endpoints from unauthorized access. To better understand the inside and outside network terminology, refer <a href="https://tmtsoftware.github.io/csw/0.1.0-SNAPSHOT/deployment/network-topology.html" title="network-topology" target="_blank" rel="noopener noreferrer">network-topology</a>.</p>
<h3><a href="#protection-on-command-service-endpoints-on-gateway" name="protection-on-command-service-endpoints-on-gateway" class="anchor"><span class="anchor-link"></span></a>Protection on Command Service Endpoints on Gateway</h3>
<p>Each subsystem can control command access using three roles: <strong>user</strong>, <strong>eng</strong>, and <strong>admin</strong>. For example: APS-user, APS-eng, and APS-admin. The user role is the least restrictive, eng role more restrictive, and admin the most restrictive. The eng role is meant for commands that should only be executed by qualified subsystem engineers. The admin command role should be reserved for commands that may damage or otherwise risk equipment. A subsystem is not required to have eng or admin role commands. It&rsquo;s okay to have only commands that are accessible to all subsystem users. </p>
<p>A TMT user must at least have a subsystem&rsquo;s user role to be allowed to access commands in a subsystem. By default, all commands are available to a user with the user role unless they are listed in the command map as requiring a more restrictive role. The hierarchy of roles is shown in the following figure:</p>
<p><img src="../images/gateway/role-hierarchy.png" alt="Role Hierarchy" /></p>
<p>There are often commands which are more restrictive and should not be accessible to every user. These commands need eng or admin role for the most restricted or dangerous commands. Also, these more restrictive eng commands need a fine-grained control mechanism so that they can be safely executed by authorized person having specific role at subsystem level. To achieve this we have the role hierarchy at subsystem level along with a config table containing the mapping between more restrictive commands and these roles.</p>
<p>This type of role hierarchy is created in Keycloak as one time setup. As per this hierarchy there should be three roles present for each subsystem which are composed in specific order.</p>
<ul>
  <li>E.g. TCS-admin -&gt; TCS-eng -&gt; TCS-user.
    <ul>
      <li>When you assign a user TCS-eng role, keycloak will automatically add TCS-user role to that user</li>
      <li>When you assign a user TCS-admin role, keycloak will automatically add TCS-eng and TCS-user role to that user</li>
    </ul>
  </li>
</ul>
<p>Also, there are three special roles. OSW-admin, OSW-eng and OSW-user which are composed of all respective subsystem level roles. </p>
<ul>
  <li>E.g. When you assign a user OSW-eng role, keycloak will automatically add roles TCS-eng, APS-eng and so on to that user and these roles will automatically add their respective lower level roles TCS-user, APS-user and so on.</li>
</ul>
<h4><a href="#examples-" name="examples-" class="anchor"><span class="anchor-link"></span></a>Examples:</h4>
<p><img src="../images/gateway/user-roles.png" alt="User Roles" /></p>
<h4><a href="#command-role-mapping" name="command-role-mapping" class="anchor"><span class="anchor-link"></span></a>Command Role Mapping</h4>
<p>Below shown are example entries in config table with commands and roles who can execute those commands.</p>
<pre><code>IRIS.filter.wheel.startExposure: [IRIS-user, APS-eng]
IRIS.filter.wheel.stopExposure: [IRIS-user, APS-eng]
</code></pre>
<p>We need to create a config containing role mapping entries like shown above and use it when starting esw-gateway server. </p>
<h3><a href="#protection-on-sequencer-endpoints-on-gateway" name="protection-on-sequencer-endpoints-on-gateway" class="anchor"><span class="anchor-link"></span></a>Protection on Sequencer endpoints on Gateway</h3>
<p>On protected endpoints of sequencer commands in esw-gateway, {subsystem}-user role check is performed. </p>
<ul>
  <li>Subsystem is obtained from componentId</li>
  <li>E.g. If current sequence to be executed is for esw.primary then user should have minimum ESW-user role.</li>
</ul>
<h2><a href="#sample-requests" name="sample-requests" class="anchor"><span class="anchor-link"></span></a>Sample Requests</h2>
<h4><a href="#request-without-auth-token" name="request-without-auth-token" class="anchor"><span class="anchor-link"></span></a>Request without auth token</h4>
<pre class="prettyprint"><code class="language-http request">curl --location --request POST &#39;http://&lt;host&gt;:&lt;port&gt;/post-endpoint&#39; \
--header &#39;Content-Type: application/json&#39; \
--data-raw &#39;{
    &quot;_type&quot;: &quot;ComponentCommand&quot;,
    &quot;componentId&quot;: {
        &quot;prefix&quot;: &quot;IRIS.filter.wheel&quot;,
        &quot;componentType&quot;: &quot;hcd&quot;
    },
    &quot;command&quot;: {
        &quot;_type&quot;: &quot;Submit&quot;,
        &quot;controlCommand&quot;: {
            &quot;_type&quot;: &quot;Setup&quot;,
            &quot;source&quot;: &quot;CSW.ncc.trombone&quot;,
            &quot;commandName&quot;: &quot;startExposure&quot;,
            &quot;maybeObsId&quot;: [
                &quot;2020A-001-123&quot;
            ],
            &quot;paramSet&quot;: []
        }
    }&#39;
</code></pre>
<h4><a href="#request-with-auth-token" name="request-with-auth-token" class="anchor"><span class="anchor-link"></span></a>Request with auth token</h4>
<pre class="prettyprint"><code class="language-http request">curl --location --request POST &#39;http://&lt;host&gt;:&lt;port&gt;/post-endpoint&#39; \
--header &#39;Content-Type: application/json&#39; \
--header &#39;Authorization: &lt;bearer token&gt; \
--data-raw &#39;{
    &quot;_type&quot;: &quot;SetLogLevel&quot;,
    &quot;componentId&quot;: {
        &quot;prefix&quot;: &quot;CSW.ncc.trombone&quot;,
        &quot;componentType&quot;: &quot;HCD&quot;
    },
    &quot;level&quot;: &quot;ERROR&quot;
}&#39;
</code></pre>
<h3><a href="#protection-on-admin-endpoints-on-gateway" name="protection-on-admin-endpoints-on-gateway" class="anchor"><span class="anchor-link"></span></a>Protection on Admin endpoints on Gateway</h3>
<p>On protected endpoints of admin API in esw-gateway, <code>esw-user</code> or <code>{subsystem}-eng</code> role check is performed.</p>
<ul>
  <li>Subsystem is obtained from <code>componentId</code> for which admin api action needs to be performed.</li>
  <li>E.g. To shutdown <code>SequenceComponent</code> of prefix <code>IRIS.comp</code> using gateway, user should have minimum <code>esw-user</code> or <code>iris-eng</code> role.</li>
</ul>
<h2><a href="#gateway-technical-design" name="gateway-technical-design" class="anchor"><span class="anchor-link"></span></a>Gateway Technical Design</h2>
<p>See <a href="../technical/gateway-tech.html">ESW Gateway Technical Documentation</a>.</p>
</div>
<div>
<a href="https://github.com/tmtsoftware/esw/tree/master/docs/src/main/uisupport/gateway.md" title="Edit this page" class="md-source-file md-edit">
Edit this page
</a>
</div>
<div class="print-only">
<span class="md-source-file md-version">
0.1.0*
</span>
</div>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-nav">
<nav class="md-footer-nav__inner md-grid">
<a href="../uisupport/webapp-template.html" title="Using the Web Application Template and Tutorial" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
</div>
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Previous
</span>
Using the Web Application Template and Tutorial
</span>
</div>
</a>
<a href="../uisupport/gateway-app.html" title="Running the UI Gateway App" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Next
</span>
Running the UI Gateway App
</span>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
</div>
</a>
</nav>
</div>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
Powered by
<a href="https://github.com/lightbend/paradox">Paradox</a>
and
<a href="https://jonas.github.io/paradox-material-theme/">Paradox Material Theme</a>

</div>
</div>
</div>
</footer>

</div>
<script src="../assets/javascripts/application.583bbe55.js"></script>
<script src="../assets/javascripts/paradox-material-theme.js"></script>
<script>app.initialize({version:"0.17",url:{base:"../."}})</script>
<script type="text/javascript" src="../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function(event) {
window.prettyPrint && prettyPrint();
});
</script>
</body>
</html>
