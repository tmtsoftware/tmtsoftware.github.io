<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="description" content="docs">
<meta name="generator" content="Paradox, paradox-material-theme=0.7.0, mkdocs-material=3.0.3">

<meta name="lang:clipboard.copy" content="Copy to clipboard">
<meta name="lang:clipboard.copied" content="Copied to clipboard">
<meta name="lang:search.language" content="">
<meta name="lang:search.pipeline.stopwords" content="true">
<meta name="lang:search.pipeline.trimmer" content="true">
<meta name="lang:search.result.none" content="No matching documents">
<meta name="lang:search.result.one" content="1 matching document">
<meta name="lang:search.result.other" content="# matching documents">
<meta name="lang:search.tokenizer" content="[\s\-]+">


<meta name="description" content="docs">
<link rel="shortcut icon" href="../../../assets/images/favicon.png">
<title>Sequencer Command Service Â· TMT Executive Software Documentation</title>
<link rel="stylesheet" href="../../../assets/stylesheets/application.451f80e5.css">
<link rel="stylesheet" href="../../../lib/material__tabs/dist/mdc.tabs.min.css">
<link rel="stylesheet" href="../../../lib/prettify/prettify.css">
<script src="../../../assets/javascripts/modernizr.1aa3b519.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
<style>
body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}
code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}
</style>
<link rel="stylesheet" href="../../../assets/fonts/font-awesome.css">
<link rel="stylesheet" href="../../../assets/fonts/material-icons.css">
<link rel="stylesheet" href="../../../assets/stylesheets/paradox-material-theme.css">
</head>
<body
>
<input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
<input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
<label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
<header class="md-header" data-md-component="header">
<nav class="md-header-nav md-grid">
<div class="md-flex">
<div class="md-flex__cell md-flex__cell--shrink">
<a href="../../../index.html" title="TMT Executive Software Documentation" class="md-header-nav__button md-logo">
<i class="md-icon">local_library</i>
</a>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
</div>
<div class="md-flex__cell md-flex__cell--stretch">
<div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
<span class="md-header-nav__topic">
TMT Executive Software Documentation
</span>
<span class="md-header-nav__topic">
Sequencer Command Service
</span>
</div>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
<label class="md-icon md-search__icon" for="__search"></label>
<button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">&#xE5CD;</button>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix>
<div class="md-search-result" data-md-component="result">
<div class="md-search-result__meta">
Type to start searching
</div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>

</div>
</div>
</nav>
</header>

<div class="md-container">
<main class="md-main">
<div class="md-main__inner md-grid" data-md-component="container">
<div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--primary" data-md-level="0" style="visibility: hidden">
<label class="md-nav__title md-nav__title--site" for="drawer">
<a href="../../../index.html" title="TMT Executive Software Documentation" class="md-nav__button md-logo">
<span class="md-nav__button md-logo">
<i class="md-icon">local_library</i>
</a>
<a href="../../../index.html" title="TMT Executive Software Documentation">
TMT Executive Software Documentation
</a>
</label>
<ul>
  <li><a href="../../../esw/eswOverview.html" class="page">Executive Software Overview</a></li>
  <li><a href="../../../sequencersandscripts/seq-index.html" class="page">Sequencers and Sequence Components</a>
  <ul>
    <li><a href="../../../sequencersandscripts/sequencer.html" class="page">Sequencers in the Executive Software</a></li>
    <li><a href="../../../sequencersandscripts/sequencer-app.html" class="page">Running a Sequencer Using esw-ocs-app</a></li>
  </ul></li>
  <li><a href="../../../scripts/scripts-index.html" class="page">Sequencer Scripts</a>
  <ul>
    <li><a href="../../../scripts/script-styles.html" class="page">Sequencer Script Styles</a></li>
    <li><a href="../../../scripts/dsl/script-constructs.html" class="page">Script DSL Constructs</a></li>
    <li><a href="../../../scripts/dsl/csw-services.html" class="page">CSW Services DSL</a></li>
  </ul></li>
  <li><a href="../../../uisupport/uisupp-index.html" class="page">User Interface Support</a>
  <ul>
    <li><a href="../../../uisupport/UIOverview.html" class="page">User Interfaces in ESW and TMT</a></li>
    <li><a href="../../../uisupport/gatewayUI-template.html" class="page">Using the Gateway-only UI Template and Tutorial</a></li>
    <li><a href="../../../uisupport/webapp-template.html" class="page">Using the Web Application Template and Tutorial</a></li>
    <li><a href="../../../uisupport/gateway.html" class="page">User Interface Gateway</a></li>
    <li><a href="../../../uisupport/gateway-app.html" class="page">Running the UI Gateway App</a></li>
  </ul></li>
  <li><a href="../../../technical/apps/apps-index.html" class="page">ESW Applications</a>
  <ul>
    <li><a href="../../../technical/apps/getting-apps.html" class="page">Getting and Running ESW Applications</a></li>
    <li><a href="../../../technical/apps/esw-shell.html" class="page">ESW Shell - A Testing Environment for ESW and CSW</a></li>
    <li><a href="../../../technical/apps/sequence-manager-app.html" class="page">Starting the Sequence Manager Application</a></li>
    <li><a href="../../../technical/apps/agent-service-app.html" class="page">The Agent Service Application</a></li>
    <li><a href="../../../technical/apps/agent-app.html" class="page">The Agent Application</a></li>
  </ul></li>
  <li><a href="../../../technical/tech-index.html" class="page">Technical Design Documents</a>
  <ul>
    <li><a href="../../../technical/sequence-manager-tech.html" class="page">Sequence Manager Technical Documentation</a></li>
    <li><a href="../../../technical/sequencer-tech.html" class="page">Sequencer Technical Documentation</a></li>
    <li><a href="../../../technical/sequence-component-tech.html" class="page">Sequence Component Technical Documentation</a></li>
    <li><a href="../../../technical/gateway-tech.html" class="page">Gateway Technical Documentation</a></li>
    <li><a href="../../../technical/apps/eng-ui.html" class="page">ESW OCS Engineering User Interface User Manual</a></li>
    <li><a href="../../../technical/agent-service-tech.html" class="page">Agent Service and Agent Technical Documentation</a></li>
    <li><a href="../../../technical/esw-application-parts.html" class="page">ESW Application Architecture</a></li>
    <li><a href="../../../technical/contracts.html" class="page">Service Contracts</a></li>
    <li><a href="../../../technical/testing-philosophy.html" class="page">OSW Testing Philosophy</a></li>
    <li><a href="../../../technical/apps/esw-services.html" class="page">Running Multiple ESW Applications with esw-services</a></li>
  </ul></li>
</ul>
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../../../scripts/dsl/services/sequencer-command-service.html#sequencer-command-service" class="header">Sequencer Command Service</a>
  <ul>
    <li><a href="../../../scripts/dsl/services/sequencer-command-service.html#sequencer" class="header">Sequencer</a></li>
    <li><a href="../../../scripts/dsl/services/sequencer-command-service.html#submitting-sequences-to-a-sequencer-querying-the-response" class="header">Submitting Sequences to a Sequencer &amp; Querying the Response</a></li>
    <li><a href="../../../scripts/dsl/services/sequencer-command-service.html#handling-online-and-offline" class="header">Handling Online and Offline</a></li>
    <li><a href="../../../scripts/dsl/services/sequencer-command-service.html#handling-diagnostic-and-operations-mode" class="header">Handling Diagnostic and Operations Mode</a></li>
    <li><a href="../../../scripts/dsl/services/sequencer-command-service.html#aborting-and-stopping-a-sequence" class="header">Aborting and Stopping a Sequence</a></li>
  </ul></li>
</ul>
</nav>

</nav>
<ul style="display: none">
<li class="md-nav__item md-version" id="project.version">
<label class="md-nav__link" for="__version">
<i class="md-icon" title="Version">label_outline</i> 0.1.0*
</label>
</li>
</ul>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../../../scripts/dsl/services/sequencer-command-service.html#sequencer-command-service" class="header">Sequencer Command Service</a>
  <ul>
    <li><a href="../../../scripts/dsl/services/sequencer-command-service.html#sequencer" class="header">Sequencer</a></li>
    <li><a href="../../../scripts/dsl/services/sequencer-command-service.html#submitting-sequences-to-a-sequencer-querying-the-response" class="header">Submitting Sequences to a Sequencer &amp; Querying the Response</a></li>
    <li><a href="../../../scripts/dsl/services/sequencer-command-service.html#handling-online-and-offline" class="header">Handling Online and Offline</a></li>
    <li><a href="../../../scripts/dsl/services/sequencer-command-service.html#handling-diagnostic-and-operations-mode" class="header">Handling Diagnostic and Operations Mode</a></li>
    <li><a href="../../../scripts/dsl/services/sequencer-command-service.html#aborting-and-stopping-a-sequence" class="header">Aborting and Stopping a Sequence</a></li>
  </ul></li>
</ul>
</nav>

</div>
</div>
</div>
<div class="md-content">
<article class="md-content__inner md-typeset">
<div class="md-content__searchable">
<h1><a href="#sequencer-command-service" name="sequencer-command-service" class="anchor"><span class="anchor-link"></span></a>Sequencer Command Service</h1>
<p>A Sequencer can send commands to Assemblies and HCDs and Sequences to other Sequencers. In order to interact or send commands from one Sequencer to the other, one needs to create a <code>Sequencer</code> instance first. The API provided by a Sequencer Command Service is tailored to Sequencer functionality.</p>
<h2><a href="#sequencer" name="sequencer" class="anchor"><span class="anchor-link"></span></a>Sequencer</h2>
<p>First a Sequencer instance is needed. To create a Sequencer instance, the following parameters need to be passed to the Sequencer method:</p>
<ul>
  <li><code>subsystem</code>: Subsystem of the Sequencer to be resolved and sent commands (for eg. TCS, IRIS)</li>
  <li><code>obsMode</code>: observing mode of the Sequencer to be resolved and send commands to (for eg. wfos_imaging, wfos_spec)</li>
  <li><code>defaultTimeout</code>: optional max timeout to wait for completion of Sequences sent with <code>sumbitAndWait</code> or <code>queryFinal</code>. The default value for this option is set to 10 hours since it will be common that the handling of Sequences can take a long time, and we don&rsquo;t want unexpected timeouts to occur in production. For development, it might make sense to set this to some smaller value. This can always be overridden in the specific <code>submitAndWait</code> and <code>queryFinal</code> calls, when appropriate (see below).</li>
</ul>
<p>Here is an example:</p>
<dl>
  <dt>Kotlin</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/esw/tree/master/examples/src/main/kotlin/esw/ocs/scripts/examples/paradox/SequencerCommandServiceDslExample.kts#L19-L20" target="_blank" title="Go to snippet source">source</a><code class="language-kts">// create a sequencer entity
val wfos = Sequencer(WFOS, ObsMode(&quot;wfos_darknight&quot;))</code></pre></dd>
</dl>
<p>Here is one showing the setting of the default timeout:</p>
<dl>
  <dt>Kotlin</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/esw/tree/master/examples/src/main/kotlin/esw/ocs/scripts/examples/paradox/SequencerCommandServiceDslExample.kts#L24-L25" target="_blank" title="Go to snippet source">source</a><code class="language-kts">// create a sequencer entity with a timeout
val wfos2 = Sequencer(WFOS, ObsMode(&quot;wfos_darknight&quot;), Duration.minutes(5))</code></pre></dd>
</dl><div class="callout note "><div class="callout-title">Resolving a Component with Location Service</div>
<p>Since all the components in the TMT architecture are dynamic in nature, which implies they can be shutdown and spawned dynamically on some other location, the Sequencer is resolved each time the Command Service DSL is used. It is possible to create a Sequencer entity for a non-existent component, but a command to the component will fail because the component is resolved when the command is sent. </p></div>
<h2><a href="#submitting-sequences-to-a-sequencer-querying-the-response" name="submitting-sequences-to-a-sequencer-querying-the-response" class="anchor"><span class="anchor-link"></span></a>Submitting Sequences to a Sequencer &amp; Querying the Response</h2>
<h3><a href="#creating-a-sequence" name="creating-a-sequence" class="anchor"><span class="anchor-link"></span></a>Creating a Sequence</h3>
<p>Unlike Assemblies and HCDs, Sequencers send Sequences to other Sequencers. A <code>Sequence</code> is a list of <code>SequenceCommand</code> type instances, each of which can be one of the <code>Setup</code>, <code>Observe</code> or <code>Wait</code> types. To create a Sequence, create individual <code>SequenceCommand</code> objects and then create a <code>Sequence</code> with the <code>sequenceOf</code> DSL method as shown below.</p>
<dl>
  <dt>Kotlin</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/esw/tree/master/examples/src/main/kotlin/esw/ocs/scripts/examples/paradox/SequencerCommandServiceDslExample.kts#L30-L32" target="_blank" title="Go to snippet source">source</a><code class="language-kts">val wfosCommand1: SequenceCommand = Setup(&quot;ESW.wfos_darknight&quot;, &quot;wfosCommand1&quot;)
val wfosCommand2: SequenceCommand = Setup(&quot;ESW.wfos_darknight&quot;, &quot;wfosCommand2&quot;)
val sequence: Sequence = sequenceOf(wfosCommand1, wfosCommand2)</code></pre></dd>
</dl>
<p>This example <code>Sequence</code> consists of two steps. The Sequencer sends the two step <code>Sequence</code> to the destination Sequencer and waits for it to complete, which means both of the two commands/steps are executed and completed. All <code>Sequence</code> steps must complete successfully for the <code>Sequence</code> to complete successfully. </p>
<p>The API for Sequence is <a href="https://tmtsoftware.github.io/csw/0.1.0-SNAPSHOT/api/java/csw/params/commands/Sequence.html">here</a>. The API for SequenceCommand is <a href="https://tmtsoftware.github.io/csw/0.1.0-SNAPSHOT/api/scala/csw/params/commands/SequenceCommand.html">here</a></p>
<h4><a href="#submit-a-sequence-to-a-sequencer" name="submit-a-sequence-to-a-sequencer" class="anchor"><span class="anchor-link"></span></a>Submit a Sequence to a Sequencer</h4>
<p>In order to send a <code>Sequence</code> to another Sequencer, you can use the <code>submit</code> or <code>submitAndWait</code> DSL method as shown in examples below. The <code>submit</code> DSL method sends the Sequence and returns <code>Started</code> if the <code>Sequence</code> is started or <code>Invalid</code> if there is a reason it cannot be started. The <code>query</code> and <code>queryFinal</code> DSL is provided to check the response of a submitted sequence.</p>
<dl>
  <dt>Kotlin</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/esw/tree/master/examples/src/main/kotlin/esw/ocs/scripts/examples/paradox/SequencerCommandServiceDslExample.kts#L36-L37" target="_blank" title="Go to snippet source">source</a><code class="language-kts">val submitResponse: SubmitResponse = wfos.submit(sequence)
val queryResponse: SubmitResponse = wfos.query(submitResponse.runId())</code></pre></dd>
</dl>
<p>The <code>query</code> DSL method allows checking on the state of the <code>Sequence</code>. <code>query</code> returns the current response immediately, which could be either a final response (eg. <code>Completed</code>) or the <code>Started</code> response. The <code>runId</code> of the submitted <code>Sequence</code> can be obtained from the <code>SubmitResponse</code> returned by <code>submit</code>. <code>query</code> is useful in the case where polling of the command is needed, or the script needs to take other actions and periodically check for the completion of the <code>Sequence</code>. </p>
<p>Note that if the <code>runId</code> is not present in the Sequencer or has been removed from the CRM, the response returned is an <code>Invalid</code> response with an <code>IdNotAvailableIssue</code>. </p>
<p>Please refer to <a href="submit-response-extensions.html">SubmitResponse extension utilities</a> for using helper methods on <code>SubmitResponse</code>.</p>
<p>By default, any negative <code>SubmitResponse</code> (for e.g. <code>Invalid</code> or <code>Error</code>) is treated as a Script error. Refer to <a href="../constructs/handlers.html#error-handlers">error handling</a> section for more details. Alternatively, if you do not want to escalate a negative <code>SubmitResponse</code>, you can use <code>submit</code> Api with <code>resumeOnError</code> flag.</p>
<dl>
  <dt>Kotlin</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/esw/tree/master/examples/src/main/kotlin/esw/ocs/scripts/examples/paradox/SequencerCommandServiceDslExample.kts#L41" target="_blank" title="Go to snippet source">source</a><code class="language-kts">val response: SubmitResponse = wfos.submit(sequence, resumeOnError = true)</code></pre></dd>
</dl>
<h4><a href="#queryfinal" name="queryfinal" class="anchor"><span class="anchor-link"></span></a>QueryFinal</h4>
<p>While <code>query</code> returns immediately, <code>queryFinal</code> will wait for the final response of the <code>Sequence</code> for the <code>defaultTimeout</code> specified at the time of creation of the <code>Sequencer</code> instance.</p>
<dl>
  <dt>Kotlin</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/esw/tree/master/examples/src/main/kotlin/esw/ocs/scripts/examples/paradox/SequencerCommandServiceDslExample.kts#L45" target="_blank" title="Go to snippet source">source</a><code class="language-kts">val finalResponse: SubmitResponse = wfos.queryFinal(submitResponse.runId())</code></pre></dd>
</dl>
<p>If you want to increase/decrease the <code>defaultTimeout</code>, you can use the other variation of the same <code>queryFinal</code> DSL method which takes a timeout.</p>
<dl>
  <dt>Kotlin</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/esw/tree/master/examples/src/main/kotlin/esw/ocs/scripts/examples/paradox/SequencerCommandServiceDslExample.kts#L49" target="_blank" title="Go to snippet source">source</a><code class="language-kts">val finalRes: SubmitResponse = wfos.queryFinal(submitResponse.runId(), Duration.seconds(5))</code></pre></dd>
</dl>
<h4><a href="#sending-a-sequence-with-submitandwait" name="sending-a-sequence-with-submitandwait" class="anchor"><span class="anchor-link"></span></a>Sending a Sequence with submitAndWait</h4>
<p>The <code>submitAndWait</code> DSL method is a combination of <code>submit</code> followed with <code>queryFinal</code>. If you are not interested in the initial response but only in final response of the Sequence, the <code>submitAndWait</code> DSL method is more convenient. It submits the <code>Sequence</code> and waits for the final response. If the <code>Sequence</code> was successfully <code>Started</code>, it will wait until the <code>defaultTimeout</code> specified at the time of creation of the <code>Sequencer</code> instance.</p>
<dl>
  <dt>Kotlin</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/esw/tree/master/examples/src/main/kotlin/esw/ocs/scripts/examples/paradox/SequencerCommandServiceDslExample.kts#L53" target="_blank" title="Go to snippet source">source</a><code class="language-kts">val sequenceResponse: SubmitResponse = wfos.submitAndWait(sequence)</code></pre></dd>
</dl>
<p>If you want to increase/decrease the default timeout, you can use the other variation of the same DSL method which takes a timeout.</p>
<dl>
  <dt>Kotlin</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/esw/tree/master/examples/src/main/kotlin/esw/ocs/scripts/examples/paradox/SequencerCommandServiceDslExample.kts#L57" target="_blank" title="Go to snippet source">source</a><code class="language-kts">val sequenceRes: SubmitResponse = wfos.submitAndWait(sequence, Duration.seconds(5))</code></pre></dd>
</dl>
<h2><a href="#handling-online-and-offline" name="handling-online-and-offline" class="anchor"><span class="anchor-link"></span></a>Handling Online and Offline</h2>
<p>As with Assemblies and HCDs, a Sequencer can also indicate to another Sequencer to go offline or online using the Sequencer Command Service DSL.</p>
<h3><a href="#sequencer-sends-goonline" name="sequencer-sends-goonline" class="anchor"><span class="anchor-link"></span></a>Sequencer Sends goOnline</h3>
<p>This DSL method is used to send online/offline commands to other sequencers. The Sequencer can go online only if it is currently in the offline state. If this command is received in any other state apart from offline, an <code>Unhandled</code> response will be sent.</p>
<p>If the Sequencer is in the Offline state, and it receives the <code>goOnline</code> command, the <a href="../constructs/handlers.html#online-and-offline-handlers">goOnline handlers</a> of the receiving Sequencer will be called. In case the handlers fail, a <code>GoOnlineHookFailed</code> response would be sent, and the Sequencer remains in the previous state. Otherwise, an <code>Ok</code> response is returned, and the Sequencer goes in online(idle) state.</p>
<dl>
  <dt>Kotlin</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/esw/tree/master/examples/src/main/kotlin/esw/ocs/scripts/examples/paradox/SequencerCommandServiceDslExample.kts#L61" target="_blank" title="Go to snippet source">source</a><code class="language-kts">val onlineResponse: GoOnlineResponse = wfos.goOnline()</code></pre></dd>
</dl>
<h3><a href="#sequencer-sends-gooffline" name="sequencer-sends-gooffline" class="anchor"><span class="anchor-link"></span></a>Sequencer Sends goOffline</h3>
<p>Go offline command is received in 2 states only.</p>
<ul>
  <li>If the Sequencer is Idle, which means it is not processing any sequence currently</li>
  <li>If the Sequencer is Loaded with a sequence</li>
</ul>
<p>If this command is sent in any other state apart from these, an <code>Unhandled</code> response will be sent. If the Sequencer is in idle/loaded state, and it receives the <code>goOffline</code> command, the <a href="../constructs/handlers.html#online-and-offline-handlers">goOffline handlers</a> of the receiving Sequencer will be called. In case the handlers fail, a <code>GoOfflineHookFailed</code> response would be sent, resulting the Sequencer remains in the previous state. Otherwise, an <code>Ok</code> message is sent, and the Sequencer goes to offline state.</p>
<dl>
  <dt>Kotlin</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/esw/tree/master/examples/src/main/kotlin/esw/ocs/scripts/examples/paradox/SequencerCommandServiceDslExample.kts#L65" target="_blank" title="Go to snippet source">source</a><code class="language-kts">val offlineResponse: GoOfflineResponse = wfos.goOffline()</code></pre></dd>
</dl>
<h2><a href="#handling-diagnostic-and-operations-mode" name="handling-diagnostic-and-operations-mode" class="anchor"><span class="anchor-link"></span></a>Handling Diagnostic and Operations Mode</h2>
<h3><a href="#diagnostic-mode" name="diagnostic-mode" class="anchor"><span class="anchor-link"></span></a>Diagnostic Mode</h3>
<p>The <code>diagnosticMode</code> command can be sent to Sequencers in all states and a <code>DiagnosticModeResponse</code> is returned. If the Sequencer script has defined the <a href="../constructs/handlers.html#diagnostic-mode-handler">diagnostic mode handlers</a>, they will be called. If the handlers execute successfully, an <code>Ok</code> response is sent; otherwise, the <code>DiagnosticHookFailed</code> response is sent.</p>
<dl>
  <dt>Kotlin</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/esw/tree/master/examples/src/main/kotlin/esw/ocs/scripts/examples/paradox/SequencerCommandServiceDslExample.kts#L69" target="_blank" title="Go to snippet source">source</a><code class="language-kts">val diagnosticModeResponse: DiagnosticModeResponse = wfos.diagnosticMode(utcTimeNow(), &quot;engineering&quot;)</code></pre></dd>
</dl>
<h3><a href="#operations-mode" name="operations-mode" class="anchor"><span class="anchor-link"></span></a>Operations Mode</h3>
<p>The <code>operationsMode</code> command returns a Sequencer in a diagnostic data mode to normal operation. <code>operationsMode</code> is accepted by Sequencers in all states and an <code>OperationsModeResponse</code> is returned to the sender. If the Sequencer has defined its <a href="../constructs/handlers.html#operations-mode-handler">operations mode handlers</a>, they will be called. If the handlers execute successfully, an <code>Ok</code> response is sent; otherwise, the <code>OperationsHookFailed</code> response is sent.</p>
<dl>
  <dt>Kotlin</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/esw/tree/master/examples/src/main/kotlin/esw/ocs/scripts/examples/paradox/SequencerCommandServiceDslExample.kts#L73" target="_blank" title="Go to snippet source">source</a><code class="language-kts">val operationsModeResponse: OperationsModeResponse = wfos.operationsMode()</code></pre></dd>
</dl>
<h2><a href="#aborting-and-stopping-a-sequence" name="aborting-and-stopping-a-sequence" class="anchor"><span class="anchor-link"></span></a>Aborting and Stopping a Sequence</h2>
<p>Stopping and aborting are meant to handle early termination of observing sequences in instruments. Aborting indicates that the current observe should stop as soon as possible and save the data if possible. Stop indicates that the current observe should stop at the end of the current step. In both cases, the observation is over and no subsequent steps can be executed.</p>
<p>Stop and abort commands are accepted only if the Sequencer is in <code>Running</code> state, which means it is executing a sequence. If this command is sent in any other state, an <code>Unhandled</code> response is returned. In all other cases, an <code>Ok</code> response is sent.</p>
<h3><a href="#aborting-a-sequence" name="aborting-a-sequence" class="anchor"><span class="anchor-link"></span></a>Aborting a Sequence</h3>
<p>On receiving the abort command in the <code>Running</code> state, the Sequencer will execute the <a href="../constructs/handlers.html#abort-sequence-handler">abort sequence handlers</a> and on completion of execution of handlers (whether successful or failed), the Sequencer will discard all the <code>pending</code> steps and return an <code>Ok</code> response. </p>
<p>Note that, abort of a sequence does not abruptly terminate the in-flight step(s) which are already under execution. It will discard only the pending steps, and the sequence is finished gracefully after the inflight step(s) are finished although the script can take action to end the current step immediately.</p>
<dl>
  <dt>Kotlin</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/esw/tree/master/examples/src/main/kotlin/esw/ocs/scripts/examples/paradox/SequencerCommandServiceDslExample.kts#L77" target="_blank" title="Go to snippet source">source</a><code class="language-kts">val abortResponse: OkOrUnhandledResponse = wfos.abortSequence()</code></pre></dd>
</dl>
<h3><a href="#stopping-a-sequence" name="stopping-a-sequence" class="anchor"><span class="anchor-link"></span></a>Stopping a Sequence</h3>
<p>Stopping a Sequence is very similar to aborting. The only difference is that instead of abort handlers, the <a href="../constructs/handlers.html#stop-handler">stop handlers</a> are called.</p>
<dl>
  <dt>Kotlin</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/esw/tree/master/examples/src/main/kotlin/esw/ocs/scripts/examples/paradox/SequencerCommandServiceDslExample.kts#L81" target="_blank" title="Go to snippet source">source</a><code class="language-kts">val stopResponse: OkOrUnhandledResponse = wfos.stop()</code></pre></dd>
</dl>
</div>
<div>
<a href="https://github.com/tmtsoftware/esw/tree/master/docs/src/main/scripts/dsl/services/sequencer-command-service.md" title="Edit this page" class="md-source-file md-edit">
Edit this page
</a>
</div>
<div class="print-only">
<span class="md-source-file md-version">
0.1.0*
</span>
</div>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-nav">
<nav class="md-footer-nav__inner md-grid">
<a href="../../../scripts/dsl/services/command-service.html" title="Command Service for Assemblies and HCDs" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
</div>
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Previous
</span>
Command Service for Assemblies and HCDs
</span>
</div>
</a>
<a href="../../../scripts/dsl/services/event-service.html" title="Event Service" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Next
</span>
Event Service
</span>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
</div>
</a>
</nav>
</div>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
Powered by
<a href="https://github.com/lightbend/paradox">Paradox</a>
and
<a href="https://jonas.github.io/paradox-material-theme/">Paradox Material Theme</a>

</div>
</div>
</div>
</footer>

</div>
<script src="../../../assets/javascripts/application.583bbe55.js"></script>
<script src="../../../assets/javascripts/paradox-material-theme.js"></script>
<script>app.initialize({version:"0.17",url:{base:"../../../."}})</script>
<script type="text/javascript" src="../../../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../../../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function(event) {
window.prettyPrint && prettyPrint();
});
</script>
</body>
</html>
