<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="description" content="docs">
<meta name="generator" content="Paradox, paradox-material-theme=0.6.0, mkdocs-material=3.0.3">

<meta name="lang:clipboard.copy" content="Copy to clipboard">
<meta name="lang:clipboard.copied" content="Copied to clipboard">
<meta name="lang:search.language" content="">
<meta name="lang:search.pipeline.stopwords" content="true">
<meta name="lang:search.pipeline.trimmer" content="true">
<meta name="lang:search.result.none" content="No matching documents">
<meta name="lang:search.result.one" content="1 matching document">
<meta name="lang:search.result.other" content="# matching documents">
<meta name="lang:search.tokenizer" content="[\s\-]+">


<meta name="description" content="docs">
<link rel="shortcut icon" href="../../../assets/tmt_favicon.ico">
<title>Script Handlers Â· TMT Executive Software (ESW)</title>
<link rel="stylesheet" href="../../../assets/stylesheets/application.451f80e5.css">
<link rel="stylesheet" href="../../../lib/material__tabs/dist/mdc.tabs.min.css">
<link rel="stylesheet" href="../../../lib/prettify/prettify.css">
<script src="../../../assets/javascripts/modernizr.1aa3b519.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
<style>
body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}
code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}
</style>
<link rel="stylesheet" href="../../../assets/fonts/font-awesome.css">
<link rel="stylesheet" href="../../../assets/fonts/material-icons.css">
<link rel="stylesheet" href="../../../assets/stylesheets/paradox-material-theme.css">
</head>
<body
>
<input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
<input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
<label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
<header class="md-header" data-md-component="header">
<nav class="md-header-nav md-grid">
<div class="md-flex">
<div class="md-flex__cell md-flex__cell--shrink">
<a href="../../../index.html" title="TMT Executive Software (ESW)" class="md-header-nav__button md-logo">
<i class="md-icon">local_library</i>
</a>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
</div>
<div class="md-flex__cell md-flex__cell--stretch">
<div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
<span class="md-header-nav__topic">
TMT Executive Software (ESW)
</span>
<span class="md-header-nav__topic">
Script Handlers
</span>
</div>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
<label class="md-icon md-search__icon" for="__search"></label>
<button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">&#xE5CD;</button>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix>
<div class="md-search-result" data-md-component="result">
<div class="md-search-result__meta">
Type to start searching
</div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>

</div>
<div class="md-flex__cell md-flex__cell--shrink">
<div class="md-header-nav__source">
<a href="https://github.com/tmtsoftware/esw"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
tmtsoftware/esw
</div>
</a>

</div>
</div>
</div>
</nav>
</header>

<div class="md-container">
<main class="md-main">
<div class="md-main__inner md-grid" data-md-component="container">
<div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--primary" data-md-level="0" style="visibility: hidden">
<label class="md-nav__title md-nav__title--site" for="drawer">
<a href="../../../index.html" title="TMT Executive Software (ESW)" class="md-nav__button md-logo">
<span class="md-nav__button md-logo">
<i class="md-icon">local_library</i>
</a>
<a href="../../../index.html" title="TMT Executive Software (ESW)">
TMT Executive Software (ESW)
</a>
</label>
<div class="md-nav__source">
<a href="https://github.com/tmtsoftware/esw"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
tmtsoftware/esw
</div>
</a>

</div>
<ul>
  <li><a href="../../../sequencer/state-transition.html" class="page">Sequencer State Transition</a></li>
  <li><a href="../../../sequencer/scripts/scripts.html" class="page">Sequencer Script</a>
  <ul>
    <li><a href="../../../sequencer/scripts/fsm.html" class="page">FSM</a></li>
    <li><a href="../../../sequencer/scripts/dsl/dsl.html" class="page">High Level DSL</a></li>
  </ul></li>
</ul>
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../../../sequencer/scripts/dsl/handlers.html#script-handlers" class="header">Script Handlers</a>
  <ul>
    <li><a href="../../../sequencer/scripts/dsl/handlers.html#command-handlers" class="header">Command Handlers</a></li>
    <li><a href="../../../sequencer/scripts/dsl/handlers.html#online-and-offline-handlers" class="header">Online and Offline Handlers</a></li>
    <li><a href="../../../sequencer/scripts/dsl/handlers.html#abort-sequence-handler" class="header">Abort Sequence Handler</a></li>
    <li><a href="../../../sequencer/scripts/dsl/handlers.html#stop-handler" class="header">Stop Handler</a></li>
    <li><a href="../../../sequencer/scripts/dsl/handlers.html#shutdown-handler" class="header">Shutdown Handler</a></li>
    <li><a href="../../../sequencer/scripts/dsl/handlers.html#diagnostic-mode-handler" class="header">Diagnostic Mode Handler</a></li>
    <li><a href="../../../sequencer/scripts/dsl/handlers.html#operations-mode-handler" class="header">Operations Mode Handler</a></li>
    <li><a href="../../../sequencer/scripts/dsl/handlers.html#exceptionhandlers" class="header">exceptionHandlers</a></li>
  </ul></li>
</ul>
</nav>

</nav>
<ul style="display: none">
<li class="md-nav__item md-version" id="project.version">
<label class="md-nav__link" for="__version">
<i class="md-icon" title="Version">label_outline</i> 0.1.0*
</label>
</li>
</ul>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../../../sequencer/scripts/dsl/handlers.html#script-handlers" class="header">Script Handlers</a>
  <ul>
    <li><a href="../../../sequencer/scripts/dsl/handlers.html#command-handlers" class="header">Command Handlers</a></li>
    <li><a href="../../../sequencer/scripts/dsl/handlers.html#online-and-offline-handlers" class="header">Online and Offline Handlers</a></li>
    <li><a href="../../../sequencer/scripts/dsl/handlers.html#abort-sequence-handler" class="header">Abort Sequence Handler</a></li>
    <li><a href="../../../sequencer/scripts/dsl/handlers.html#stop-handler" class="header">Stop Handler</a></li>
    <li><a href="../../../sequencer/scripts/dsl/handlers.html#shutdown-handler" class="header">Shutdown Handler</a></li>
    <li><a href="../../../sequencer/scripts/dsl/handlers.html#diagnostic-mode-handler" class="header">Diagnostic Mode Handler</a></li>
    <li><a href="../../../sequencer/scripts/dsl/handlers.html#operations-mode-handler" class="header">Operations Mode Handler</a></li>
    <li><a href="../../../sequencer/scripts/dsl/handlers.html#exceptionhandlers" class="header">exceptionHandlers</a></li>
  </ul></li>
</ul>
</nav>

</div>
</div>
</div>
<div class="md-content">
<article class="md-content__inner md-typeset">
<div class="md-content__searchable">
<h1><a href="#script-handlers" name="script-handlers" class="anchor"><span class="anchor-link"></span></a>Script Handlers</h1>
<h2><a href="#command-handlers" name="command-handlers" class="anchor"><span class="anchor-link"></span></a>Command Handlers</h2>
<h3><a href="#onsetup" name="onsetup" class="anchor"><span class="anchor-link"></span></a>onSetup</h3>
<p>This handler is used to handle a <code>Setup</code> command sent to this sequencer. The handler takes two parameters:</p>
<ol>
  <li><strong>command name</strong> which is matched against the sequence command sent, if the command name matches, corresponding block provided is executed</li>
  <li><strong>block</strong> of code which contains logic to act on the sequence command.</li>
</ol>
<dl>
  <dt>Kotlin</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/esw/tree/master/examples/src/main/kotlin/esw/ocs/scripts/examples/paradox/HandlersExample.kts#L12-L20" target="_blank" title="Go to snippet source"></a><code class="language-kts">onSetup(&quot;command1&quot;) {
    // split command and send to downstream
    val assembly1 = Assembly(&quot;filter.wheel&quot;, 5.seconds)
    val assembly2 = Assembly(&quot;wfos.red.detector&quot;, 5.seconds)
    par(
            { assembly1.submit(Setup(&quot;tcs.darknight&quot;, &quot;command-1&quot;)) },
            { assembly2.submit(Setup(&quot;tcs.darknight&quot;, &quot;command-1&quot;)) }
    )
}</code></pre></dd>
</dl>
<p>In the block provided to this handler, all the csw services (event, alarm, time service, etc) and control dsl (loop, par etc) are accessible.</p>
<h3><a href="#onobserve" name="onobserve" class="anchor"><span class="anchor-link"></span></a>onObserve</h3>
<p>This handler is used to handle an <code>Observe</code> command sent to this sequencer. The handler takes two parameters:</p>
<ol>
  <li><strong>command name</strong> which is matched against the sequence command sent, if the command name matches, corresponding block provided is executed</li>
  <li><strong>block</strong> of code which contains logic to act on the sequence command.</li>
</ol>
<dl>
  <dt>Kotlin</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/esw/tree/master/examples/src/main/kotlin/esw/ocs/scripts/examples/paradox/HandlersExample.kts#L25-L27" target="_blank" title="Go to snippet source"></a><code class="language-kts">onObserve(&quot;command2&quot;) {
    // do something
}</code></pre></dd>
</dl>
<h2><a href="#online-and-offline-handlers" name="online-and-offline-handlers" class="anchor"><span class="anchor-link"></span></a>Online and Offline Handlers</h2>
<h3><a href="#ongoonline" name="ongoonline" class="anchor"><span class="anchor-link"></span></a>onGoOnline</h3>
<p>On receiving the <code>goOnline</code> command, the onGoOnline handlers, if defined, will be called. Only if the handlers execute successfully, will the sequencer become online. Hence, error handling for the block passed to onGoOnline needs to be taken care of by the script writer.</p>
<dl>
  <dt>Kotlin</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/esw/tree/master/examples/src/main/kotlin/esw/ocs/scripts/examples/paradox/HandlersExample.kts#L31-L35" target="_blank" title="Go to snippet source"></a><code class="language-kts">onGoOnline {
    // send command to downstream components
    val assembly = Assembly(&quot;filter.wheel&quot;, 5.seconds)
    assembly.goOnline()
}</code></pre></dd>
</dl>
<h3><a href="#ongooffline" name="ongooffline" class="anchor"><span class="anchor-link"></span></a>onGoOffline</h3>
<p>On receiving the <code>goOffline</code> command, the onGoOffline handlers, if defined, will be called. Only if the handlers execute successfully, will the sequencer become offline. Hence, error handling for the block passed to onGoOffline needs to be taken care of by the script writer. Offline handlers could be written to clear the sequencer state before going offline.</p>
<dl>
  <dt>Kotlin</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/esw/tree/master/examples/src/main/kotlin/esw/ocs/scripts/examples/paradox/HandlersExample.kts#L39-L43" target="_blank" title="Go to snippet source"></a><code class="language-kts">onGoOffline {
    // send command to downstream components
    val assembly = Assembly(&quot;filter.wheel&quot;, 5.seconds)
    assembly.goOffline()
}</code></pre></dd>
</dl>
<h2><a href="#abort-sequence-handler" name="abort-sequence-handler" class="anchor"><span class="anchor-link"></span></a>Abort Sequence Handler</h2>
<h2><a href="#stop-handler" name="stop-handler" class="anchor"><span class="anchor-link"></span></a>Stop Handler</h2>
<h2><a href="#shutdown-handler" name="shutdown-handler" class="anchor"><span class="anchor-link"></span></a>Shutdown Handler</h2>
<h2><a href="#diagnostic-mode-handler" name="diagnostic-mode-handler" class="anchor"><span class="anchor-link"></span></a>Diagnostic Mode Handler</h2>
<h2><a href="#operations-mode-handler" name="operations-mode-handler" class="anchor"><span class="anchor-link"></span></a>Operations Mode Handler</h2>
<h2><a href="#exceptionhandlers" name="exceptionhandlers" class="anchor"><span class="anchor-link"></span></a>exceptionHandlers</h2>
</div>
<div>
<a href="https://github.com/tmtsoftware/esw/tree/master/docs/src/main/sequencer/scripts/dsl/handlers.md" title="Edit this page" class="md-source-file md-edit">
Edit this page
</a>
</div>
<div class="print-only">
<span class="md-source-file md-version">
0.1.0*
</span>
</div>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-nav">
<nav class="md-footer-nav__inner md-grid">
<a href="../../../sequencer/scripts/dsl/misc.html" title="Misc" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
</div>
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Previous
</span>
Misc
</span>
</div>
</a>
<a href="../../../sequencer/scripts/dsl/services/sequencer-command-service.html" title="Sequencer Command Service" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Next
</span>
Sequencer Command Service
</span>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
</div>
</a>
</nav>
</div>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
Powered by
<a href="https://github.com/lightbend/paradox">Paradox</a>
and
<a href="https://jonas.github.io/paradox-material-theme/">Paradox Material Theme</a>

</div>
</div>
</div>
</footer>

</div>
<script src="../../../assets/javascripts/application.583bbe55.js"></script>
<script src="../../../assets/javascripts/paradox-material-theme.js"></script>
<script>app.initialize({version:"0.17",url:{base:"../../../."}})</script>
<script type="text/javascript" src="../../../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../../../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function(event) {
window.prettyPrint && prettyPrint();
});
</script>
</body>
</html>
