<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="description" content="docs">
<meta name="generator" content="Paradox, paradox-material-theme=0.6.0, mkdocs-material=3.0.3">

<meta name="lang:clipboard.copy" content="Copy to clipboard">
<meta name="lang:clipboard.copied" content="Copied to clipboard">
<meta name="lang:search.language" content="">
<meta name="lang:search.pipeline.stopwords" content="true">
<meta name="lang:search.pipeline.trimmer" content="true">
<meta name="lang:search.result.none" content="No matching documents">
<meta name="lang:search.result.one" content="1 matching document">
<meta name="lang:search.result.other" content="# matching documents">
<meta name="lang:search.tokenizer" content="[\s\-]+">


<meta name="description" content="docs">
<link rel="shortcut icon" href="../../../../assets/tmt_favicon.ico">
<title>Command Service Â· TMT Executive Software (ESW)</title>
<link rel="stylesheet" href="../../../../assets/stylesheets/application.451f80e5.css">
<link rel="stylesheet" href="../../../../lib/material__tabs/dist/mdc.tabs.min.css">
<link rel="stylesheet" href="../../../../lib/prettify/prettify.css">
<script src="../../../../assets/javascripts/modernizr.1aa3b519.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
<style>
body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}
code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}
</style>
<link rel="stylesheet" href="../../../../assets/fonts/font-awesome.css">
<link rel="stylesheet" href="../../../../assets/fonts/material-icons.css">
<link rel="stylesheet" href="../../../../assets/stylesheets/paradox-material-theme.css">
</head>
<body
>
<input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
<input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
<label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
<header class="md-header" data-md-component="header">
<nav class="md-header-nav md-grid">
<div class="md-flex">
<div class="md-flex__cell md-flex__cell--shrink">
<a href="../../../../index.html" title="TMT Executive Software (ESW)" class="md-header-nav__button md-logo">
<i class="md-icon">local_library</i>
</a>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
</div>
<div class="md-flex__cell md-flex__cell--stretch">
<div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
<span class="md-header-nav__topic">
TMT Executive Software (ESW)
</span>
<span class="md-header-nav__topic">
Command Service
</span>
</div>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
<label class="md-icon md-search__icon" for="__search"></label>
<button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">&#xE5CD;</button>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix>
<div class="md-search-result" data-md-component="result">
<div class="md-search-result__meta">
Type to start searching
</div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>

</div>
<div class="md-flex__cell md-flex__cell--shrink">
<div class="md-header-nav__source">
<a href="https://github.com/tmtsoftware/esw"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
tmtsoftware/esw
</div>
</a>

</div>
</div>
</div>
</nav>
</header>

<div class="md-container">
<main class="md-main">
<div class="md-main__inner md-grid" data-md-component="container">
<div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--primary" data-md-level="0" style="visibility: hidden">
<label class="md-nav__title md-nav__title--site" for="drawer">
<a href="../../../../index.html" title="TMT Executive Software (ESW)" class="md-nav__button md-logo">
<span class="md-nav__button md-logo">
<i class="md-icon">local_library</i>
</a>
<a href="../../../../index.html" title="TMT Executive Software (ESW)">
TMT Executive Software (ESW)
</a>
</label>
<div class="md-nav__source">
<a href="https://github.com/tmtsoftware/esw"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
tmtsoftware/esw
</div>
</a>

</div>
<ul>
  <li><a href="../../../../sequencer/state-transition.html" class="page">Sequencer State Transition</a></li>
  <li><a href="../../../../sequencer/scripts/scripts.html" class="page">Sequencer Script</a>
  <ul>
    <li><a href="../../../../sequencer/scripts/fsm.html" class="page">FSM</a></li>
    <li><a href="../../../../sequencer/scripts/dsl/dsl.html" class="page">High Level DSL</a></li>
  </ul></li>
</ul>
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../../../../sequencer/scripts/dsl/services/command-service.html#command-service" class="header">Command Service</a>
  <ul>
    <li><a href="../../../../sequencer/scripts/dsl/services/command-service.html#assembly" class="header">Assembly</a></li>
    <li><a href="../../../../sequencer/scripts/dsl/services/command-service.html#hcd" class="header">Hcd</a></li>
    <li><a href="../../../../sequencer/scripts/dsl/services/command-service.html#command-service-dsl" class="header">Command Service Dsl</a></li>
    <li><a href="../../../../sequencer/scripts/dsl/services/command-service.html#going-online-offline-mode" class="header">Going online/offline mode</a></li>
    <li><a href="../../../../sequencer/scripts/dsl/services/command-service.html#operations-mode-and-diagnostic-mode" class="header">Operations mode and Diagnostic mode</a></li>
    <li><a href="../../../../sequencer/scripts/dsl/services/command-service.html#locking-and-unlocking" class="header">Locking and unlocking</a></li>
    <li><a href="../../../../sequencer/scripts/dsl/services/command-service.html#source-code-for-examples" class="header">Source code for examples</a></li>
  </ul></li>
</ul>
</nav>

</nav>
<ul style="display: none">
<li class="md-nav__item md-version" id="project.version">
<label class="md-nav__link" for="__version">
<i class="md-icon" title="Version">label_outline</i> 0.1.0*
</label>
</li>
</ul>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../../../../sequencer/scripts/dsl/services/command-service.html#command-service" class="header">Command Service</a>
  <ul>
    <li><a href="../../../../sequencer/scripts/dsl/services/command-service.html#assembly" class="header">Assembly</a></li>
    <li><a href="../../../../sequencer/scripts/dsl/services/command-service.html#hcd" class="header">Hcd</a></li>
    <li><a href="../../../../sequencer/scripts/dsl/services/command-service.html#command-service-dsl" class="header">Command Service Dsl</a></li>
    <li><a href="../../../../sequencer/scripts/dsl/services/command-service.html#going-online-offline-mode" class="header">Going online/offline mode</a></li>
    <li><a href="../../../../sequencer/scripts/dsl/services/command-service.html#operations-mode-and-diagnostic-mode" class="header">Operations mode and Diagnostic mode</a></li>
    <li><a href="../../../../sequencer/scripts/dsl/services/command-service.html#locking-and-unlocking" class="header">Locking and unlocking</a></li>
    <li><a href="../../../../sequencer/scripts/dsl/services/command-service.html#source-code-for-examples" class="header">Source code for examples</a></li>
  </ul></li>
</ul>
</nav>

</div>
</div>
</div>
<div class="md-content">
<article class="md-content__inner md-typeset">
<div class="md-content__searchable">
<h1><a href="#command-service" name="command-service" class="anchor"><span class="anchor-link"></span></a>Command Service</h1>
<p>Command service dsl is kotlin wrapper over csw command service module provided for sending commands to assemblies or hcds via scripts. You can refer a detailed documentation of command Service provided by csw <a href="https://tmtsoftware.github.io/csw/0.1.0-SNAPSHOT/commons/command.html#commandservice">here</a>. This dsl exposes following APIs:</p>
<h2><a href="#assembly" name="assembly" class="anchor"><span class="anchor-link"></span></a>Assembly</h2>
<p>This dsl creates assembly instance with provided name and gives handle to command service dsl through which script can interact with assembly. For example send commands or lifecycle methods e.g. goOnline, goOffline, lock assembly etc. This api also takes default timeout which will be used in commands like submitAndWait, queryFinal etc.</p>
<p>This dsl takes following parameters: * <code>prefix</code>: Prefix of assembly * <code>defaultTimeout</code>: if dsl like submitAndWait, queryFinal etc does not explicitly provide timeout then this Default timeout is used.</p>
<dl>
  <dt>Kotlin</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/esw/tree/master/examples/src/main/kotlin/esw/ocs/scripts/examples/paradox/CommandServiceDslExample.kts#L14" target="_blank" title="Go to snippet source"></a><code class="language-kts">val galilAssembly = Assembly(&quot;tcs.galil&quot;, defaultTimeout = 10.seconds)</code></pre></dd>
</dl>
<h2><a href="#hcd" name="hcd" class="anchor"><span class="anchor-link"></span></a>Hcd</h2>
<p>This dsl creates hcd instance with provided name and gives handle to command service dsl through which script can interact with hcd. For example send commands to assembly or lifecycle methods e.g. goOnline, goOffline, lock hcd etc. This api also takes default timeout which will be used in commands like submitAndWait, queryFinal etc.</p>
<p>This dsl takes following parameters: * <code>prefix</code> - Prefix of assembly * <code>defaultTimeout</code> - if dsl like submitAndWait, queryFinal etc does not explicitly provide timeout then this Default timeout is used.</p>
<dl>
  <dt>Kotlin</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/esw/tree/master/examples/src/main/kotlin/esw/ocs/scripts/examples/paradox/CommandServiceDslExample.kts#L18" target="_blank" title="Go to snippet source"></a><code class="language-kts">val filterWheelHcd = Hcd(&quot;tcs.filter.wheel.hcd&quot;, defaultTimeout = 10.seconds)</code></pre></dd>
</dl><div class="callout note "><div class="callout-title">Note</div>
<p>Since all the components in the TMT architecture are dynamic in nature, which implies they can be shutdown and spawned dynamically on some other location, the assembly/hdc is resolved each time on receiving a command with the provided <code>prefix</code>. Following dsl can be used to interact with both <strong>Assembly and HCD</strong> resolved using APIs explained above.</p></div>
<h2><a href="#command-service-dsl" name="command-service-dsl" class="anchor"><span class="anchor-link"></span></a>Command Service Dsl</h2>
<h3><a href="#submit" name="submit" class="anchor"><span class="anchor-link"></span></a>Submit</h3>
<p>This dsl allows to submit a command to assembly/hcd and return after first phase. If it returns Started then final response can be obtained with query final api.</p>
<dl>
  <dt>Kotlin</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/esw/tree/master/examples/src/main/kotlin/esw/ocs/scripts/examples/paradox/CommandServiceDslExample.kts#L46-L55" target="_blank" title="Go to snippet source"></a><code class="language-kts">val response = galilAssembly.submit(command, resumeOnError = true)
val startedResponse = galilAssembly.submit(command)
galilAssembly.queryFinal(startedResponse.runId())</code></pre></dd>
</dl>
<h4><a href="#error-handling" name="error-handling" class="anchor"><span class="anchor-link"></span></a>Error handling</h4>
<p>submit always returns positive submit response. In case of negative submit response, onError handler (if written) is called and then onGlobalError handler is called. Script execution flow breaks in case of negative submit response and sequence is terminated with failure. Following example shows scenario where script execution flow breaks when submit return negative response, in this case onError handler will be executed followed by onGlobalError handler, and sequence is completed with failure.</p>
<dl>
  <dt>Kotlin</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/esw/tree/master/examples/src/main/kotlin/esw/ocs/scripts/examples/paradox/CommandServiceDslExample.kts#L70-L102" target="_blank" title="Go to snippet source"></a><code class="language-kts">onSetup(&quot;submit-error-handling&quot;) { command -&gt;

    /* =========== Scenario-1 (default) ============
     * if submit returns negative response (which is considered as error by default)
     * then current execution flow breaks and onError command handler gets invoked
     * Hence, only Started (in case of long-running command) or Completed (in case of short running command) response is returned
     */
    val positiveSubmitResponse: CommandResponse.SubmitResponse = galilAssembly.submit(command)

    //  First approach - using custom dsl (this is an alternative to kotlin pattern match using when)
    positiveSubmitResponse
            .onStarted { startedRes -&gt;
                val completedResponse = galilAssembly.queryFinal(startedRes.runId())
                info(&quot;command completed with result: ${completedResponse.result}&quot;)
            }
            .onCompleted { completed -&gt;
                info(&quot;command with ${completed.runId()} is completed with result: ${completed.result}&quot;)
            }

    // Second approach - using kotlin pattern matching
    when (positiveSubmitResponse) {
        is CommandResponse.Started -&gt; {
            val completedResponse = galilAssembly.queryFinal(positiveSubmitResponse.runId())
            info(&quot;command completed with response: $completedResponse&quot;)
        }
        is CommandResponse.Completed -&gt; info(&quot;command with ${positiveSubmitResponse.runId()} is completed&quot;)
        else -&gt; finishWithError(&quot;Error starting WFS exposures: $positiveSubmitResponse&quot;)
    }

}.onError { err -&gt;
    // onError is called when submit command to galil assembly fails
    error(err.reason)
}</code></pre></dd>
</dl>
<p>To change this default behaviour, resumeOnError flag can be used. If this flag is set to true then script execution continues, and action is taken based on custom logic in script. Script writer can still choose to terminate sequence using <code>failedOnTerminate</code> utility.</p>
<dl>
  <dt>Kotlin</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/esw/tree/master/examples/src/main/kotlin/esw/ocs/scripts/examples/paradox/CommandServiceDslExample.kts#L106-L130" target="_blank" title="Go to snippet source"></a><code class="language-kts">onSetup(&quot;submit-error-handling-resume&quot;) { command -&gt;
    /* =========== Scenario-2 (resumeOnError = true) ============
     * if submit returns negative response
     * then current execution flow will continue because resumeOnError = true
     * Here, all the possible SubmitResponses are expected to be returned
     */
    val submitResponse: CommandResponse.SubmitResponse = galilAssembly.submit(command, resumeOnError = true)

    //  First approach - using custom dsl (this is an alternative to kotlin pattern match using when)
    submitResponse
            .onStarted { startedRes -&gt;
                val completedResponse = galilAssembly.queryFinal(startedRes.runId())
                info(&quot;command completed with result: ${completedResponse.result}&quot;)
            }
            .onCompleted { completed -&gt;
                info(&quot;command with ${completed.runId()} is completed with result: ${completed.result}&quot;)
            }
            .onFailed { negativeResponse -&gt;
                error(&quot;command with ${negativeResponse.runId()} is failed with result: ${negativeResponse}&quot;)

            }

    // Script writer can still choose to terminate sequence in case of negative response
    submitResponse.onFailedTerminate()
}</code></pre></dd>
</dl>
<h3><a href="#submitandwait" name="submitandwait" class="anchor"><span class="anchor-link"></span></a>SubmitAndWait</h3>
<p>This dsl allows submitting command to assembly/hcd to submit command to assembly/hcd and waits for positive final response. Script writer can provide a timeout for which it will wait for getting final submit response, otherwise command will timeout and script execution flow breaks and sequence is terminated with failure. If timeout is not provided explicitly, then timeout provided while creating instance of assembly/hcd is used as default timeout. </p>
<dl>
  <dt>Kotlin</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/esw/tree/master/examples/src/main/kotlin/esw/ocs/scripts/examples/paradox/CommandServiceDslExample.kts#L41" target="_blank" title="Go to snippet source"></a><code class="language-kts">galilAssembly.submitAndWait(command, timeout = 20.seconds)</code></pre></dd>
</dl>
<p>submitAndWait always return positive final response. In case of negative response it follows same error handling semantics as submit explained above. </p>
<h3><a href="#query" name="query" class="anchor"><span class="anchor-link"></span></a>Query</h3>
<p>This dsl allows querying for response of submitted command. Started response returned by submit has runId which can be used to query for response. Query always returns positive submit response. In case of negative response it follows same error handling semantics as submit.</p>
<dl>
  <dt>Kotlin</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/esw/tree/master/examples/src/main/kotlin/esw/ocs/scripts/examples/paradox/CommandServiceDslExample.kts#L46-L49" target="_blank" title="Go to snippet source"></a><code class="language-kts">val response = galilAssembly.submit(command, resumeOnError = true)

galilAssembly.query(response.runId())</code></pre></dd>
</dl>
<h3><a href="#queryfinal" name="queryfinal" class="anchor"><span class="anchor-link"></span></a>QueryFinal</h3>
<p>This dsl allows querying for final response of submitted command. Started response returned by submit has runId which can be used to query for final response. Script writer can provide a timeout for which it will wait for getting final submit response, otherwise command will timeout and script execution flow breaks and sequence is terminated with failure. If timeout is not provided explicitly, then timeout provided while creating instance of assembly/hcd is used as default timeout. QueryFinal always returns positive final response. In case of negative response it follows same error handling semantics as submit. </p>
<dl>
  <dt>Kotlin</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/esw/tree/master/examples/src/main/kotlin/esw/ocs/scripts/examples/paradox/CommandServiceDslExample.kts#L54-L58" target="_blank" title="Go to snippet source"></a><code class="language-kts">val startedResponse = galilAssembly.submit(command)
galilAssembly.queryFinal(startedResponse.runId())

galilAssembly.query(response.runId())</code></pre></dd>
</dl><div class="callout note "><div class="callout-title">Note</div>
<p>submit, submitAndWait, query and queryFinal always return positive response. In case of negative response (considered as error by default), script execution flow breaks, error handling mechanism kicks in and sequence is terminated with failure. <strong>resumeOnError</strong> allows to change this default behaviour and custom logic in script can decide flow. For details of error handling in script, please refer <a href="../error-handling.html">Error handling in script</a></p></div>
<h3><a href="#subscribecurrentstate" name="subscribecurrentstate" class="anchor"><span class="anchor-link"></span></a>SubscribeCurrentState</h3>
<p>This dsl allows subscribing to current states of assembly/hcd. Script writer can provide state names to subscribe. If not provided all current states are subscribed. This dsl takes callback, callback provides handle to subscribed state and script writer can write logic in callback which will be executed for all subscribed states.</p>
<dl>
  <dt>Kotlin</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/esw/tree/master/examples/src/main/kotlin/esw/ocs/scripts/examples/paradox/CommandServiceDslExample.kts#L62-L65" target="_blank" title="Go to snippet source"></a><code class="language-kts">galilAssembly.subscribeCurrentState(StateName(&quot;stateName1&quot;)) { currentState -&gt;
    // do something with currentState matching provided state name
    println(&quot;current state : $currentState&quot;)
}</code></pre></dd>
</dl>
<h2><a href="#going-online-offline-mode" name="going-online-offline-mode" class="anchor"><span class="anchor-link"></span></a>Going online/offline mode</h2>
<p>This is kotlin wrapper for sending assembly/hcd in online and offline mode. When assembly/hcd receives this command respective handlers are called. The detailed documentation of online/offline handlers for assembly/hcd can be found <a href="https://tmtsoftware.github.io/csw/0.1.0-SNAPSHOT/framework/handling-lifecycle.html#component-online-and-offline">here</a></p>
<h3><a href="#goonline" name="goonline" class="anchor"><span class="anchor-link"></span></a>goOnline</h3>
<p>This dsl allows sending assembly/hcd into online mode. <code>goOnline</code> can be called from anywhere in script. Following example shows sequencer sending <code>goOnline</code> command to downstream galil assembly when it receives <code>goOnline</code> command. </p>
<dl>
  <dt>Kotlin</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/esw/tree/master/examples/src/main/kotlin/esw/ocs/scripts/examples/paradox/CommandServiceDslExample.kts#L157-L160" target="_blank" title="Go to snippet source"></a><code class="language-kts">onGoOnline {
    // do some actions to go online
    galilAssembly.goOnline()
}</code></pre></dd>
</dl>
<h3><a href="#gooffline" name="gooffline" class="anchor"><span class="anchor-link"></span></a>goOffline</h3>
<p>This dsl allows to send assembly/hcd into offline mode. <code>goOffline</code> can be called from anywhere in script. Following example shows sequencer sending <code>goOffline</code> command to downstream galil assembly when it receives <code>goOffline</code> command. </p>
<dl>
  <dt>Kotlin</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/esw/tree/master/examples/src/main/kotlin/esw/ocs/scripts/examples/paradox/CommandServiceDslExample.kts#L148-L153" target="_blank" title="Go to snippet source"></a><code class="language-kts">onGoOffline {
    // do some actions to go offline

    galilAssembly.goOffline()

}</code></pre></dd>
</dl>
<h2><a href="#operations-mode-and-diagnostic-mode" name="operations-mode-and-diagnostic-mode" class="anchor"><span class="anchor-link"></span></a>Operations mode and Diagnostic mode</h2>
<h3><a href="#operationsmode" name="operationsmode" class="anchor"><span class="anchor-link"></span></a>operationsMode</h3>
<p>This dsl allows to send assembly/hcd into operations mode. <code>operationsMode</code> can be called from anywhere in script. Following example shows sequencer sending <code>operationsMode</code> command to downstream galil assembly when it receives <code>operationsMode</code> command. </p>
<dl>
  <dt>Kotlin</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/esw/tree/master/examples/src/main/kotlin/esw/ocs/scripts/examples/paradox/CommandServiceDslExample.kts#L141-L144" target="_blank" title="Go to snippet source"></a><code class="language-kts">onOperationsMode {
    // do some actions to go to operations mode
    galilAssembly.operationsMode()
}</code></pre></dd>
</dl>
<h3><a href="#diagnosticmode" name="diagnosticmode" class="anchor"><span class="anchor-link"></span></a>diagnosticMode</h3>
<p>This dsl allows to send assembly/hcd into diagnostic data mode based on a hint at the specified startTime. <code>diagnosticMode</code> can be called from anywhere in script. Following example shows sequencer sending <code>diagnosticMode</code> command to downstream galil assembly when it receives <code>diagnosticMode</code> command. </p>
<dl>
  <dt>Kotlin</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/esw/tree/master/examples/src/main/kotlin/esw/ocs/scripts/examples/paradox/CommandServiceDslExample.kts#L134-L137" target="_blank" title="Go to snippet source"></a><code class="language-kts">onDiagnosticMode { startTime, hint -&gt;
    // do some actions to go to diagnostic mode based on hint
    galilAssembly.diagnosticMode(startTime, hint)
}</code></pre></dd>
</dl>
<h2><a href="#locking-and-unlocking" name="locking-and-unlocking" class="anchor"><span class="anchor-link"></span></a>Locking and unlocking</h2>
<h3><a href="#lock" name="lock" class="anchor"><span class="anchor-link"></span></a>lock</h3>
<p>This dsl allows locking assembly/hcd from sequencer script for specified duration. When you lock assembly/hcd, sequencer sending lock command is treated as source. This dsl returns <code>LockingResponse</code> which can be <code>LockAcquired</code> in the successful scenario or <code>AcquiringLockFailed</code> in case of failure. This dsl also provides callbacks for <code>onLockAboutToExpire</code> and, <code>onLockExpired</code> where script writer can write custom logic. These callbacks are thread safe.</p>
<dl>
  <dt>Kotlin</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/esw/tree/master/examples/src/main/kotlin/esw/ocs/scripts/examples/paradox/CommandServiceDslExample.kts#L23-L33" target="_blank" title="Go to snippet source"></a><code class="language-kts">galilAssembly.lock(
        leaseDuration = 20.seconds,
        onLockAboutToExpire = {
            // do something when lock is about to expire
            publishEvent(SystemEvent(&quot;esw.test&quot;, &quot;tcs.lock.about.to.expire&quot;))
        },
        onLockExpired = {
            // do something when lock expired
            publishEvent(SystemEvent(&quot;esw.test&quot;, &quot;tcs.lock.expired&quot;))
        }
)</code></pre></dd>
</dl>
<h3><a href="#unlock" name="unlock" class="anchor"><span class="anchor-link"></span></a>unlock</h3>
<p>This dsl allows unlocking assembly/hcd from sequencer script for specified duration. When you unlock assembly/hcd, sequencer sending lock command is treated as source. This dsl returns <code>LockingResponse</code> which can be <code>LockReleased</code> or <code>LockAlreadyReleased</code> in the successful scenario or <code>ReleasingLockFailed</code> in case of failure.</p>
<dl>
  <dt>Kotlin</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/esw/tree/master/examples/src/main/kotlin/esw/ocs/scripts/examples/paradox/CommandServiceDslExample.kts#L37" target="_blank" title="Go to snippet source"></a><code class="language-kts">galilAssembly.unlock()</code></pre></dd>
</dl>
<h2><a href="#source-code-for-examples" name="source-code-for-examples" class="anchor"><span class="anchor-link"></span></a>Source code for examples</h2>
<ul>
  <li><a href="https://github.com/tmtsoftware/esw/blob/master/examples/src/main/kotlin/esw/ocs/scripts/examples/paradox/CommandServiceDslExample.kts">Command Service Examples</a></li>
</ul>
</div>
<div>
<a href="https://github.com/tmtsoftware/esw/tree/master/docs/src/main/sequencer/scripts/dsl/services/command-service.md" title="Edit this page" class="md-source-file md-edit">
Edit this page
</a>
</div>
<div class="print-only">
<span class="md-source-file md-version">
0.1.0*
</span>
</div>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-nav">
<nav class="md-footer-nav__inner md-grid">
<a href="../../../../sequencer/scripts/dsl/services/config-service.html" title="Config Service" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
</div>
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Previous
</span>
Config Service
</span>
</div>
</a>
<a href="../../../../sequencer/scripts/dsl/services/event-service.html" title="Event Service" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Next
</span>
Event Service
</span>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
</div>
</a>
</nav>
</div>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
Powered by
<a href="https://github.com/lightbend/paradox">Paradox</a>
and
<a href="https://jonas.github.io/paradox-material-theme/">Paradox Material Theme</a>

</div>
</div>
</div>
</footer>

</div>
<script src="../../../../assets/javascripts/application.583bbe55.js"></script>
<script src="../../../../assets/javascripts/paradox-material-theme.js"></script>
<script>app.initialize({version:"0.17",url:{base:"../../../../."}})</script>
<script type="text/javascript" src="../../../../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../../../../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function(event) {
window.prettyPrint && prettyPrint();
});
</script>
</body>
</html>
