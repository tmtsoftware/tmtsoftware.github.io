<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="description" content="docs">
<meta name="generator" content="Paradox, paradox-material-theme=0.6.0, mkdocs-material=3.0.3">

<meta name="lang:clipboard.copy" content="Copy to clipboard">
<meta name="lang:clipboard.copied" content="Copied to clipboard">
<meta name="lang:search.language" content="">
<meta name="lang:search.pipeline.stopwords" content="true">
<meta name="lang:search.pipeline.trimmer" content="true">
<meta name="lang:search.result.none" content="No matching documents">
<meta name="lang:search.result.one" content="1 matching document">
<meta name="lang:search.result.other" content="# matching documents">
<meta name="lang:search.tokenizer" content="[\s\-]+">


<meta name="description" content="docs">
<link rel="shortcut icon" href="../../../../assets/tmt_favicon.ico">
<title>Event Service Â· TMT Executive Software (ESW)</title>
<link rel="stylesheet" href="../../../../assets/stylesheets/application.451f80e5.css">
<link rel="stylesheet" href="../../../../lib/material__tabs/dist/mdc.tabs.min.css">
<link rel="stylesheet" href="../../../../lib/prettify/prettify.css">
<script src="../../../../assets/javascripts/modernizr.1aa3b519.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
<style>
body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}
code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}
</style>
<link rel="stylesheet" href="../../../../assets/fonts/font-awesome.css">
<link rel="stylesheet" href="../../../../assets/fonts/material-icons.css">
<link rel="stylesheet" href="../../../../assets/stylesheets/paradox-material-theme.css">
</head>
<body
>
<input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
<input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
<label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
<header class="md-header" data-md-component="header">
<nav class="md-header-nav md-grid">
<div class="md-flex">
<div class="md-flex__cell md-flex__cell--shrink">
<a href="../../../../index.html" title="TMT Executive Software (ESW)" class="md-header-nav__button md-logo">
<i class="md-icon">local_library</i>
</a>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
</div>
<div class="md-flex__cell md-flex__cell--stretch">
<div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
<span class="md-header-nav__topic">
TMT Executive Software (ESW)
</span>
<span class="md-header-nav__topic">
Event Service
</span>
</div>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
<label class="md-icon md-search__icon" for="__search"></label>
<button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">&#xE5CD;</button>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix>
<div class="md-search-result" data-md-component="result">
<div class="md-search-result__meta">
Type to start searching
</div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>

</div>
<div class="md-flex__cell md-flex__cell--shrink">
<div class="md-header-nav__source">
<a href="https://github.com/tmtsoftware/esw"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
tmtsoftware/esw
</div>
</a>

</div>
</div>
</div>
</nav>
</header>

<div class="md-container">
<main class="md-main">
<div class="md-main__inner md-grid" data-md-component="container">
<div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--primary" data-md-level="0" style="visibility: hidden">
<label class="md-nav__title md-nav__title--site" for="drawer">
<a href="../../../../index.html" title="TMT Executive Software (ESW)" class="md-nav__button md-logo">
<span class="md-nav__button md-logo">
<i class="md-icon">local_library</i>
</a>
<a href="../../../../index.html" title="TMT Executive Software (ESW)">
TMT Executive Software (ESW)
</a>
</label>
<div class="md-nav__source">
<a href="https://github.com/tmtsoftware/esw"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
tmtsoftware/esw
</div>
</a>

</div>
<ul>
  <li><a href="../../../../sequencer/scripts/scripts.html" class="page">Sequencer Scripts</a>
  <ul>
    <li><a href="../../../../sequencer/scripts/dsl/handlers.html" class="page">Script Handlers</a></li>
    <li><a href="../../../../sequencer/scripts/dsl/loop.html" class="page">Including Looping in Scripts</a></li>
    <li><a href="../../../../sequencer/scripts/dsl/misc.html" class="page">Other DSL</a></li>
    <li><a href="../../../../sequencer/scripts/fsm.html" class="page">Finite State Machines</a></li>
    <li><a href="../../../../sequencer/scripts/dsl/services/location-service.html" class="page">Location Service</a></li>
    <li><a href="../../../../sequencer/scripts/dsl/services/config-service.html" class="page">Using the Configuration Service in Scripts</a></li>
    <li><a href="../../../../sequencer/scripts/dsl/services/command-service.html" class="page">Command Service for Assemblies and HCDs</a></li>
    <li><a href="../../../../sequencer/scripts/dsl/services/sequencer-command-service.html" class="page">Sequencer Command Service</a></li>
    <li><a href="../../../../sequencer/scripts/dsl/services/submit-response-extensions.html" class="page">Extension utilities on SubmitResponse</a></li>
    <li><a href="../../../../sequencer/scripts/dsl/services/event-service.html" class="active page">Event Service</a></li>
    <li><a href="../../../../sequencer/scripts/dsl/services/logging-service.html" class="page">Logging Service</a></li>
    <li><a href="../../../../sequencer/scripts/dsl/services/alarm-service.html" class="page">Alarm Service</a></li>
    <li><a href="../../../../sequencer/scripts/dsl/services/time-service.html" class="page">Time Service Access in Scripts</a></li>
  </ul></li>
  <li><a href="../../../../sequencer/state-transition.html" class="page">Sequencer State Transition</a></li>
  <li><a href="../../../../apps/apps.html" class="page">Applications</a>
  <ul>
    <li><a href="../../../../apps/sequencerapp.html" class="page">sequencer-app</a></li>
  </ul></li>
</ul>
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../../../../sequencer/scripts/dsl/services/event-service.html#event-service" class="header">Event Service</a>
  <ul>
    <li><a href="../../../../sequencer/scripts/dsl/services/event-service.html#helper-methods" class="header">Helper Methods</a></li>
    <li><a href="../../../../sequencer/scripts/dsl/services/event-service.html#publishevent" class="header">publishEvent</a></li>
    <li><a href="../../../../sequencer/scripts/dsl/services/event-service.html#onevent" class="header">onEvent</a></li>
    <li><a href="../../../../sequencer/scripts/dsl/services/event-service.html#getevent" class="header">getEvent</a></li>
    <li><a href="../../../../sequencer/scripts/dsl/services/event-service.html#source-code-for-examples" class="header">Source code for examples</a></li>
  </ul></li>
</ul>
</nav>

</nav>
<ul style="display: none">
<li class="md-nav__item md-version" id="project.version">
<label class="md-nav__link" for="__version">
<i class="md-icon" title="Version">label_outline</i> 0.1.0*
</label>
</li>
</ul>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../../../../sequencer/scripts/dsl/services/event-service.html#event-service" class="header">Event Service</a>
  <ul>
    <li><a href="../../../../sequencer/scripts/dsl/services/event-service.html#helper-methods" class="header">Helper Methods</a></li>
    <li><a href="../../../../sequencer/scripts/dsl/services/event-service.html#publishevent" class="header">publishEvent</a></li>
    <li><a href="../../../../sequencer/scripts/dsl/services/event-service.html#onevent" class="header">onEvent</a></li>
    <li><a href="../../../../sequencer/scripts/dsl/services/event-service.html#getevent" class="header">getEvent</a></li>
    <li><a href="../../../../sequencer/scripts/dsl/services/event-service.html#source-code-for-examples" class="header">Source code for examples</a></li>
  </ul></li>
</ul>
</nav>

</div>
</div>
</div>
<div class="md-content">
<article class="md-content__inner md-typeset">
<div class="md-content__searchable">
<h1><a href="#event-service" name="event-service" class="anchor"><span class="anchor-link"></span></a>Event Service</h1>
<p>The Event Service DSL is a Kotlin wrapper for the CSW Event Service. This DSL has the ability of publishing, getting, and subscribing to events, and also contains some helper methods for model creation. You can refer to the detailed documentation of Event Service provided by CSW <a href="https://tmtsoftware.github.io/csw/0.1.0-SNAPSHOT/services/event">here</a>.</p>
<h2><a href="#helper-methods" name="helper-methods" class="anchor"><span class="anchor-link"></span></a>Helper Methods</h2>
<p>These methods can be used to create Systerm and Observe Events. Additionally, a System or Observe &ldquo;Event Variable&rdquo; can be created that can be tied to the first value of a parameter of an Event, similar to the way local variables are tied to &ldquo;process variables&rdquo; in the EPICS State Notation Language (see <a href="https://www-csr.bessy.de/control/SoftDist/sequencer/Introduction.html#overview">EPICS Sequencer Documentation</a> for more information).</p>
<h3><a href="#systemevent" name="systemevent" class="anchor"><span class="anchor-link"></span></a>SystemEvent</h3>
<p>Helper DSL to create a <code>SystemEvent</code> from the provided <code>prefix</code>, <code>event name</code> and <code>parameters</code> (optional).</p>
<dl>
  <dt>Kotlin</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/esw/tree/master/examples/src/main/kotlin/esw/ocs/scripts/examples/paradox/EventServiceDslExample.kts#L21-L24" target="_blank" title="Go to snippet source"></a><code class="language-kts">val parameters = intKey(&quot;stepNumber&quot;).set(1)
val systemEvent: SystemEvent = SystemEvent(&quot;ESW.IRIS_darkNight&quot;, &quot;stepInfo&quot;, parameters)</code></pre></dd>
</dl>
<h3><a href="#observeevent" name="observeevent" class="anchor"><span class="anchor-link"></span></a>ObserveEvent</h3>
<p>Helper DSL to create an <code>ObserveEvent</code> from the provided <code>prefix</code>, <code>event name</code> and <code>parameters</code> (optional).</p>
<dl>
  <dt>Kotlin</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/esw/tree/master/examples/src/main/kotlin/esw/ocs/scripts/examples/paradox/EventServiceDslExample.kts#L21-L29" target="_blank" title="Go to snippet source"></a><code class="language-kts">val parameters = intKey(&quot;stepNumber&quot;).set(1)
val observeEvent: ObserveEvent = ObserveEvent(&quot;ESW.IRIS_darkNight&quot;, &quot;observationStarted&quot;)</code></pre></dd>
</dl>
<h3><a href="#systemvar" name="systemvar" class="anchor"><span class="anchor-link"></span></a>SystemVar</h3>
<p>Helper DSL to create an <code>EventVariable</code> corresponding to a parameter of a <code>SystemEvent</code>. This DSL needs the initial value of the parameter, the name of the <code>EventKey</code>, and the <code>ParameterKey</code> of the connected parameter.  More details about <code>SystemVar</code>s are provided in the <a href="../../fsm.html#reactive-fsm">FSM documentation</a></p>
<dl>
  <dt>Kotlin</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/esw/tree/master/examples/src/main/kotlin/esw/ocs/scripts/examples/paradox/EventServiceDslExample.kts#L76-L77" target="_blank" title="Go to snippet source"></a><code class="language-kts">val locKey = intKey(&quot;current-location&quot;)
val systemVar: EventVariable&lt;Int&gt; = SystemVar(0, &quot;IRIS.ifs.motor.position&quot;, locKey)</code></pre></dd>
</dl>
<h3><a href="#observevar" name="observevar" class="anchor"><span class="anchor-link"></span></a>ObserveVar</h3>
<p>Helper DSL to create an <code>EventVariable</code> corresponding to a parameter of an <code>ObserveEvent</code>. This DSL needs the initial value of the parameter, the name of the <code>EventKey</code> and the <code>ParameterKey</code> of the connected parameter. More details about <code>ObserveVar</code>s are provided in the <a href="../../fsm.html#reactive-fsm">FSM documentation</a></p>
<dl>
  <dt>Kotlin</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/esw/tree/master/examples/src/main/kotlin/esw/ocs/scripts/examples/paradox/EventServiceDslExample.kts#L81-L82" target="_blank" title="Go to snippet source"></a><code class="language-kts">val readNumberKey = intKey(&quot;readNumber&quot;)
val observeVar: EventVariable&lt;Int&gt; = ObserveVar(0, &quot;IRIS.ifs.detector.readCompleted&quot;, readNumberKey)</code></pre></dd>
</dl>
<h2><a href="#publishevent" name="publishevent" class="anchor"><span class="anchor-link"></span></a>publishEvent</h2>
<p>DSL to publish the given <code>Event</code>.</p>
<dl>
  <dt>Kotlin</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/esw/tree/master/examples/src/main/kotlin/esw/ocs/scripts/examples/paradox/EventServiceDslExample.kts#L24-L33" target="_blank" title="Go to snippet source"></a><code class="language-kts">val systemEvent: SystemEvent = SystemEvent(&quot;ESW.IRIS_darkNight&quot;, &quot;stepInfo&quot;, parameters)
publishEvent(systemEvent)</code></pre></dd>
</dl>
<p>This DSL can also publish events periodically when provided with the optional <code>duration</code> and an <code>event generator</code> function. In the below example, an Event with temperature Key will get published every 10 seconds, with current temperature value given by <em>getTemperature</em> method.</p>
<dl>
  <dt>Kotlin</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/esw/tree/master/examples/src/main/kotlin/esw/ocs/scripts/examples/paradox/EventServiceDslExample.kts#L57-L60" target="_blank" title="Go to snippet source"></a><code class="language-kts">publishEvent(10.seconds) {
    val temperatureKey = intKey(&quot;temperature&quot;).set(getTemperature())
    SystemEvent(&quot;ESW.IRIS_darkNight&quot;, &quot;temperature&quot;, temperatureKey)
}</code></pre></dd>
</dl>
<h2><a href="#onevent" name="onevent" class="anchor"><span class="anchor-link"></span></a>onEvent</h2>
<p>DSL to subscribe to events getting published on the given <code>EventKey</code> names. This DSL takes a <code>callback</code> as a lambda which operates on an event. The callback block will be invoked whenever an Event is published on any of the provided event keys.</p>
<dl>
  <dt>Kotlin</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/esw/tree/master/examples/src/main/kotlin/esw/ocs/scripts/examples/paradox/EventServiceDslExample.kts#L38-L44" target="_blank" title="Go to snippet source"></a><code class="language-kts">val tempEventKey = &quot;IRIS.env.temperature.temp&quot;
val stateEventKey = &quot;IRIS.env.temperature.state&quot;
onEvent(tempEventKey, stateEventKey) { event -&gt;
    // logic to execute on every event
    println(event.eventKey())
}</code></pre></dd>
</dl>
<p>This DSL has the ability to control the subscription rate by providing a <code>duration</code> with the <code>callback</code>. This operates like the <a href="https://tmtsoftware.github.io/csw/0.1.0-SNAPSHOT/services/event#controlling-subscription-rate">Rate Adapter Mode</a> for regular Event Service subscriptions.</p>
<dl>
  <dt>Kotlin</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/esw/tree/master/examples/src/main/kotlin/esw/ocs/scripts/examples/paradox/EventServiceDslExample.kts#L48-L51" target="_blank" title="Go to snippet source"></a><code class="language-kts">onEvent(tempEventKey, stateEventKey, duration = 2.seconds) { event -&gt;
    // logic to execute on every event
    println(event.eventKey())
}</code></pre></dd>
</dl>
<h2><a href="#getevent" name="getevent" class="anchor"><span class="anchor-link"></span></a>getEvent</h2>
<p>DSL to get the latest Event published on each of the given <code>EventKey</code> names.</p>
<dl>
  <dt>Kotlin</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/esw/tree/master/examples/src/main/kotlin/esw/ocs/scripts/examples/paradox/EventServiceDslExample.kts#L38-L64" target="_blank" title="Go to snippet source"></a><code class="language-kts">val tempEventKey = &quot;IRIS.env.temperature.temp&quot;
val stateEventKey = &quot;IRIS.env.temperature.state&quot;
val events: Set&lt;Event&gt; = getEvent(tempEventKey, stateEventKey)</code></pre></dd>
</dl>
<h2><a href="#source-code-for-examples" name="source-code-for-examples" class="anchor"><span class="anchor-link"></span></a>Source code for examples</h2>
<ul>
  <li><a href="https://github.com/tmtsoftware/esw/blob/master/examples/src/main/kotlin/esw/ocs/scripts/examples/paradox/EventServiceDslExample.kts">Event Service Examples</a></li>
</ul>
</div>
<div>
<a href="https://github.com/tmtsoftware/esw/tree/master/docs/src/main/sequencer/scripts/dsl/services/event-service.md" title="Edit this page" class="md-source-file md-edit">
Edit this page
</a>
</div>
<div class="print-only">
<span class="md-source-file md-version">
0.1.0*
</span>
</div>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-nav">
<nav class="md-footer-nav__inner md-grid">
<a href="../../../../sequencer/scripts/dsl/services/submit-response-extensions.html" title="Extension utilities on SubmitResponse" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
</div>
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Previous
</span>
Extension utilities on SubmitResponse
</span>
</div>
</a>
<a href="../../../../sequencer/scripts/dsl/services/logging-service.html" title="Logging Service" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Next
</span>
Logging Service
</span>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
</div>
</a>
</nav>
</div>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
Powered by
<a href="https://github.com/lightbend/paradox">Paradox</a>
and
<a href="https://jonas.github.io/paradox-material-theme/">Paradox Material Theme</a>

</div>
</div>
</div>
</footer>

</div>
<script src="../../../../assets/javascripts/application.583bbe55.js"></script>
<script src="../../../../assets/javascripts/paradox-material-theme.js"></script>
<script>app.initialize({version:"0.17",url:{base:"../../../../."}})</script>
<script type="text/javascript" src="../../../../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../../../../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function(event) {
window.prettyPrint && prettyPrint();
});
</script>
</body>
</html>
