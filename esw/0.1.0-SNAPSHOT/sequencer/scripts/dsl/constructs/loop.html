<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="description" content="docs">
<meta name="generator" content="Paradox, paradox-material-theme=0.6.0, mkdocs-material=3.0.3">

<meta name="lang:clipboard.copy" content="Copy to clipboard">
<meta name="lang:clipboard.copied" content="Copied to clipboard">
<meta name="lang:search.language" content="">
<meta name="lang:search.pipeline.stopwords" content="true">
<meta name="lang:search.pipeline.trimmer" content="true">
<meta name="lang:search.result.none" content="No matching documents">
<meta name="lang:search.result.one" content="1 matching document">
<meta name="lang:search.result.other" content="# matching documents">
<meta name="lang:search.tokenizer" content="[\s\-]+">


<meta name="description" content="docs">
<link rel="shortcut icon" href="../../../../assets/tmt_favicon.ico">
<title>Including Looping in Scripts Â· TMT Executive Software (ESW)</title>
<link rel="stylesheet" href="../../../../assets/stylesheets/application.451f80e5.css">
<link rel="stylesheet" href="../../../../lib/material__tabs/dist/mdc.tabs.min.css">
<link rel="stylesheet" href="../../../../lib/prettify/prettify.css">
<script src="../../../../assets/javascripts/modernizr.1aa3b519.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
<style>
body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}
code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}
</style>
<link rel="stylesheet" href="../../../../assets/fonts/font-awesome.css">
<link rel="stylesheet" href="../../../../assets/fonts/material-icons.css">
<link rel="stylesheet" href="../../../../assets/stylesheets/paradox-material-theme.css">
</head>
<body
>
<input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
<input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
<label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
<header class="md-header" data-md-component="header">
<nav class="md-header-nav md-grid">
<div class="md-flex">
<div class="md-flex__cell md-flex__cell--shrink">
<a href="../../../../index.html" title="TMT Executive Software (ESW)" class="md-header-nav__button md-logo">
<i class="md-icon">local_library</i>
</a>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
</div>
<div class="md-flex__cell md-flex__cell--stretch">
<div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
<span class="md-header-nav__topic">
TMT Executive Software (ESW)
</span>
<span class="md-header-nav__topic">
Including Looping in Scripts
</span>
</div>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
<label class="md-icon md-search__icon" for="__search"></label>
<button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">&#xE5CD;</button>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix>
<div class="md-search-result" data-md-component="result">
<div class="md-search-result__meta">
Type to start searching
</div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>

</div>
<div class="md-flex__cell md-flex__cell--shrink">
<div class="md-header-nav__source">
<a href="https://github.com/tmtsoftware/esw"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
tmtsoftware/esw
</div>
</a>

</div>
</div>
</div>
</nav>
</header>

<div class="md-container">
<main class="md-main">
<div class="md-main__inner md-grid" data-md-component="container">
<div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--primary" data-md-level="0" style="visibility: hidden">
<label class="md-nav__title md-nav__title--site" for="drawer">
<a href="../../../../index.html" title="TMT Executive Software (ESW)" class="md-nav__button md-logo">
<span class="md-nav__button md-logo">
<i class="md-icon">local_library</i>
</a>
<a href="../../../../index.html" title="TMT Executive Software (ESW)">
TMT Executive Software (ESW)
</a>
</label>
<div class="md-nav__source">
<a href="https://github.com/tmtsoftware/esw"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
tmtsoftware/esw
</div>
</a>

</div>
<ul>
  <li><a href="../../../../sequencer/seqcompsequencer/index.html" class="page">Sequence Components and Sequencers</a>
  <ul>
    <li><a href="../../../../sequencer/seqcompsequencer/Terms.html" class="page">OCS Terms</a></li>
    <li><a href="../../../../sequencer/seqcompsequencer/SeqComp.html" class="page">Sequence Component</a></li>
    <li><a href="../../../../sequencer/seqcompsequencer/Sequencers.html" class="page">Sequencers</a></li>
    <li><a href="../../../../sequencer/seqcompsequencer/state-transition.html" class="page">Sequencer Lifecycle</a></li>
  </ul></li>
  <li><a href="../../../../sequencer/scripts/scripts.html" class="page">Sequencer Scripts</a>
  <ul>
    <li><a href="../../../../sequencer/scripts/script-styles.html" class="page">Sequencer Script Styles</a></li>
    <li><a href="../../../../sequencer/scripts/dsl/script-constructs.html" class="page">Script DSL Constructs</a></li>
    <li><a href="../../../../sequencer/scripts/dsl/csw-services.html" class="page">CSW Services DSL</a></li>
  </ul></li>
  <li><a href="../../../../commons/contracts.html" class="page">ESW Service contract</a></li>
  <li><a href="../../../../apps/apps.html" class="page">Applications</a>
  <ul>
    <li><a href="../../../../apps/sequencerapp.html" class="page">sequencer-app</a></li>
  </ul></li>
  <li><a href="../../../../eswgateway/esw-gateway.html" class="page">Esw Gateway</a></li>
</ul>
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../../../../sequencer/scripts/dsl/constructs/loop.html#including-looping-in-scripts" class="header">Including Looping in Scripts</a>
  <ul>
    <li><a href="../../../../sequencer/scripts/dsl/constructs/loop.html#loop-with-default-loop-interval" class="header">loop - With Default loop Interval</a></li>
    <li><a href="../../../../sequencer/scripts/dsl/constructs/loop.html#loop-with-custom-minimum-loop-interval" class="header">loop - With Custom Minimum Loop Interval</a></li>
    <li><a href="../../../../sequencer/scripts/dsl/constructs/loop.html#waitfor-loop-until-a-condition-is-true" class="header">waitFor - Loop Until a Condition is True</a></li>
    <li><a href="../../../../sequencer/scripts/dsl/constructs/loop.html#loopasync-with-a-default-loop-interval" class="header">loopAsync - With a Default Loop Interval</a></li>
    <li><a href="../../../../sequencer/scripts/dsl/constructs/loop.html#loopasync-with-a-custom-loop-interval" class="header">loopAsync - With a Custom Loop Interval</a></li>
    <li><a href="../../../../sequencer/scripts/dsl/constructs/loop.html#source-code-for-examples" class="header">Source code for examples</a></li>
  </ul></li>
</ul>
</nav>

</nav>
<ul style="display: none">
<li class="md-nav__item md-version" id="project.version">
<label class="md-nav__link" for="__version">
<i class="md-icon" title="Version">label_outline</i> 0.1.0*
</label>
</li>
</ul>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../../../../sequencer/scripts/dsl/constructs/loop.html#including-looping-in-scripts" class="header">Including Looping in Scripts</a>
  <ul>
    <li><a href="../../../../sequencer/scripts/dsl/constructs/loop.html#loop-with-default-loop-interval" class="header">loop - With Default loop Interval</a></li>
    <li><a href="../../../../sequencer/scripts/dsl/constructs/loop.html#loop-with-custom-minimum-loop-interval" class="header">loop - With Custom Minimum Loop Interval</a></li>
    <li><a href="../../../../sequencer/scripts/dsl/constructs/loop.html#waitfor-loop-until-a-condition-is-true" class="header">waitFor - Loop Until a Condition is True</a></li>
    <li><a href="../../../../sequencer/scripts/dsl/constructs/loop.html#loopasync-with-a-default-loop-interval" class="header">loopAsync - With a Default Loop Interval</a></li>
    <li><a href="../../../../sequencer/scripts/dsl/constructs/loop.html#loopasync-with-a-custom-loop-interval" class="header">loopAsync - With a Custom Loop Interval</a></li>
    <li><a href="../../../../sequencer/scripts/dsl/constructs/loop.html#source-code-for-examples" class="header">Source code for examples</a></li>
  </ul></li>
</ul>
</nav>

</div>
</div>
</div>
<div class="md-content">
<article class="md-content__inner md-typeset">
<div class="md-content__searchable">
<h1><a href="#including-looping-in-scripts" name="including-looping-in-scripts" class="anchor"><span class="anchor-link"></span></a>Including Looping in Scripts</h1>
<p>The script DSL supports a variety of looping constructs to satisfy different use cases:</p>
<ol>
  <li>loop</li>
  <li>waitFor</li>
  <li>loopAsync</li>
</ol>
<h3><a href="#loop-with-default-loop-interval" name="loop-with-default-loop-interval" class="anchor"><span class="anchor-link"></span></a>loop - With Default loop Interval</h3>
<p>The <code>loop</code> DSL allows you to start a &ldquo;blocking&rdquo; loop so that the rest of the code after loop will not be executed until a <code>stopWhen</code> condition written inside loop becomes true. You can use this DSL when you want to iteratively perform some actions until a certain condition becomes true. An interval can be provided to set the minimum period of the loop, where every iteration of the loop wait at least for the minimum provided interval before executing the next iteration. If no period is provided, the default interval is <code>50 milliseconds</code>.</p>
<p>The following example demonstrates the usage of the <code>loop</code> DSL with the default interval. In the loop body, a motor is being &ldquo;moved&rdquo; by 10 degrees in every iteration of the loop. The loop will be terminated when motor&rsquo;s current position reaches the expected position of 100 degrees.</p>
<dl>
  <dt>Kotlin</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/esw/tree/master/examples/src/main/kotlin/esw/ocs/scripts/examples/paradox/LoopExample.kts#L20-L89" target="_blank" title="Go to snippet source"></a><code class="language-kts">var motorPosition = 0
fun moveMotor(degrees: Int) {
    // move motor logic
    motorPosition += degrees
}
onSetup(&quot;move-motor&quot;) {

    val expectedMotorPosition = 100

    // move motor by 10 degrees in each iteration, default loop interval is 50 millis
    // stop loop when current motor position matches expected motor position and continue with the execution of rest of the handler
    loop {
        moveMotor(10)
        stopWhen(motorPosition == expectedMotorPosition)
    }
}</code></pre></dd>
</dl>
<h3><a href="#loop-with-custom-minimum-loop-interval" name="loop-with-custom-minimum-loop-interval" class="anchor"><span class="anchor-link"></span></a>loop - With Custom Minimum Loop Interval</h3>
<p>The following example demonstrates the usage of the <code>loop</code> DSL when providing a custom loop interval.</p>
<dl>
  <dt>Kotlin</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/esw/tree/master/examples/src/main/kotlin/esw/ocs/scripts/examples/paradox/LoopExample.kts#L68-L89" target="_blank" title="Go to snippet source"></a><code class="language-kts">onSetup(&quot;move-motor&quot;) {

    val expectedMotorPosition = 100
    // move motor by 20 degrees in every iteration after a loop interval of 500 millis (custom loop interval used here)
    // stop loop when current motor position matches expected motor position and continue with the execution of rest of the handler
    loop(minInterval = 500.milliseconds) {
        moveMotor(20)
        stopWhen(motorPosition == expectedMotorPosition)
    }
}</code></pre></dd>
</dl><div class="callout note "><div class="callout-title">Is there a minimum loop interval?</div>
<p><code>minInterval</code> needs to be greater than default interval of <code>50 milliseconds</code> otherwise it will be ignored and default loop interval will be used.</p></div>
<h3><a href="#waitfor-loop-until-a-condition-is-true" name="waitfor-loop-until-a-condition-is-true" class="anchor"><span class="anchor-link"></span></a>waitFor - Loop Until a Condition is True</h3>
<p>This is a specialized version of loop and satisfies simple use cases where you want to semantically block the execution until certain condition becomes true.</p>
<p>In the following example, <code>initializeMotor</code> method will start the initialization and eventually set <code>motorUp</code> flag to true indicating motor is successfully initialized. <code>waitFor { motorUp }</code> will check the value of <code>motorUp</code> flag every <code>50 milliseconds</code>, and when it is true, the rest of the code execution will continue. </p>
<dl>
  <dt>Kotlin</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/esw/tree/master/examples/src/main/kotlin/esw/ocs/scripts/examples/paradox/LoopExample.kts#L24-L59" target="_blank" title="Go to snippet source"></a><code class="language-kts">var motorUp = false

fun initializeMotor() {
    // some motor initialization logic goes here
    motorUp = true
}
onSetup(&quot;init-motor&quot;) {
    // start initializing motor and this method will set motorUp flag to true once initialization is successful
    initializeMotor()
    // pauses the init-motor command handlers execution until motor becomes up
    waitFor { motorUp }

    // rest of the handler implementation (here you can safely assume that motor is up)
}</code></pre></dd>
</dl>
<h3><a href="#loopasync-with-a-default-loop-interval" name="loopasync-with-a-default-loop-interval" class="anchor"><span class="anchor-link"></span></a>loopAsync - With a Default Loop Interval</h3>
<p>The previous DSL loop constructs &ldquo;block&rdquo; until the loop completes. You can use this DSL when you want to iteratively perform some actions in the background. Since it is asynchronous, once the code in the background loop starts, the code written after <code>loopAsync</code> will be executed immediately and concurrently.</p>
<p>Like <code>loop</code>, <code>loopAsync</code> will be terminated when a <code>stopWhen</code> condition written inside loop becomes true. <code>loopAsync</code> also has a default interval of <code>50 milliseconds</code>.</p>
<p>The following example demonstrates the usage of <code>loopAsync</code> DSL with the default interval. In the loop body, a current temperature event is published every <code>50 milliseconds</code>. The <code>loopAsync</code> will be terminated when <code>stopPublishingTemperature</code> flag becomes true, which is set to true in the <code>onStop</code> handler.</p>
<dl>
  <dt>Kotlin</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/esw/tree/master/examples/src/main/kotlin/esw/ocs/scripts/examples/paradox/LoopExample.kts#L11-L97" target="_blank" title="Go to snippet source"></a><code class="language-kts">var stopPublishingTemperature = false
val temperatureEvent = ObserveEvent(&quot;IRIS.motor&quot;, &quot;temperature&quot;)
val temperatureKey = longKey(&quot;temperature&quot;)

fun getCurrentTemp(): Long = TODO()

// start background loop which publishes current temperature of motor every 50 milliseconds (default loop interval)
loopAsync {
    val currentTemp = getCurrentTemp()
    publishEvent(temperatureEvent.add(temperatureKey.set(currentTemp)))
    stopWhen(stopPublishingTemperature)
}

onStop {
    stopPublishingTemperature = true
}</code></pre></dd>
</dl>
<h3><a href="#loopasync-with-a-custom-loop-interval" name="loopasync-with-a-custom-loop-interval" class="anchor"><span class="anchor-link"></span></a>loopAsync - With a Custom Loop Interval</h3>
<p>The following example demonstrates the usage of <code>loopAsync</code> DSL with a custom loop interval specified.</p>
<dl>
  <dt>Kotlin</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/esw/tree/master/examples/src/main/kotlin/esw/ocs/scripts/examples/paradox/LoopExample.kts#L37-L42" target="_blank" title="Go to snippet source"></a><code class="language-kts">// start background loop which publishes current temperature of motor every 100 milliseconds
loopAsync(minInterval = 100.milliseconds) {
    val currentTemp = getCurrentTemp()
    publishEvent(temperatureEvent.add(temperatureKey.set(currentTemp)))
    stopWhen(stopPublishingTemperature)
}</code></pre></dd>
</dl>
<h2><a href="#source-code-for-examples" name="source-code-for-examples" class="anchor"><span class="anchor-link"></span></a>Source code for examples</h2>
<ul>
  <li><a href="https://github.com/tmtsoftware/esw/blob/master/examples/src/main/kotlin/esw/ocs/scripts/examples/paradox/LoopExample.kts">Loop Examples</a></li>
</ul>
</div>
<div>
<a href="https://github.com/tmtsoftware/esw/tree/master/docs/src/main/sequencer/scripts/dsl/constructs/loop.md" title="Edit this page" class="md-source-file md-edit">
Edit this page
</a>
</div>
<div class="print-only">
<span class="md-source-file md-version">
0.1.0*
</span>
</div>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-nav">
<nav class="md-footer-nav__inner md-grid">
<a href="../../../../sequencer/scripts/dsl/constructs/handlers.html" title="Script Handlers" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
</div>
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Previous
</span>
Script Handlers
</span>
</div>
</a>
<a href="../../../../sequencer/scripts/dsl/constructs/fsm.html" title="Finite State Machines" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Next
</span>
Finite State Machines
</span>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
</div>
</a>
</nav>
</div>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
Powered by
<a href="https://github.com/lightbend/paradox">Paradox</a>
and
<a href="https://jonas.github.io/paradox-material-theme/">Paradox Material Theme</a>

</div>
</div>
</div>
</footer>

</div>
<script src="../../../../assets/javascripts/application.583bbe55.js"></script>
<script src="../../../../assets/javascripts/paradox-material-theme.js"></script>
<script>app.initialize({version:"0.17",url:{base:"../../../../."}})</script>
<script type="text/javascript" src="../../../../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../../../../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function(event) {
window.prettyPrint && prettyPrint();
});
</script>
</body>
</html>
