<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="description" content="docs">
<meta name="generator" content="Paradox, paradox-material-theme=0.7.0, mkdocs-material=3.0.3">

<meta name="lang:clipboard.copy" content="Copy to clipboard">
<meta name="lang:clipboard.copied" content="Copied to clipboard">
<meta name="lang:search.language" content="">
<meta name="lang:search.pipeline.stopwords" content="true">
<meta name="lang:search.pipeline.trimmer" content="true">
<meta name="lang:search.result.none" content="No matching documents">
<meta name="lang:search.result.one" content="1 matching document">
<meta name="lang:search.result.other" content="# matching documents">
<meta name="lang:search.tokenizer" content="[\s\-]+">


<meta name="description" content="docs">
<link rel="shortcut icon" href="../assets/images/favicon.png">
<title>Gateway Technical Documentation Â· TMT Executive Software Documentation</title>
<link rel="stylesheet" href="../assets/stylesheets/application.451f80e5.css">
<link rel="stylesheet" href="../lib/material__tabs/dist/mdc.tabs.min.css">
<link rel="stylesheet" href="../lib/prettify/prettify.css">
<script src="../assets/javascripts/modernizr.1aa3b519.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
<style>
body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}
code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}
</style>
<link rel="stylesheet" href="../assets/fonts/font-awesome.css">
<link rel="stylesheet" href="../assets/fonts/material-icons.css">
<link rel="stylesheet" href="../assets/stylesheets/paradox-material-theme.css">
</head>
<body
>
<input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
<input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
<label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
<header class="md-header" data-md-component="header">
<nav class="md-header-nav md-grid">
<div class="md-flex">
<div class="md-flex__cell md-flex__cell--shrink">
<a href="../index.html" title="TMT Executive Software Documentation" class="md-header-nav__button md-logo">
<i class="md-icon">local_library</i>
</a>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
</div>
<div class="md-flex__cell md-flex__cell--stretch">
<div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
<span class="md-header-nav__topic">
TMT Executive Software Documentation
</span>
<span class="md-header-nav__topic">
Gateway Technical Documentation
</span>
</div>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
<label class="md-icon md-search__icon" for="__search"></label>
<button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">&#xE5CD;</button>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix>
<div class="md-search-result" data-md-component="result">
<div class="md-search-result__meta">
Type to start searching
</div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>

</div>
</div>
</nav>
</header>

<div class="md-container">
<main class="md-main">
<div class="md-main__inner md-grid" data-md-component="container">
<div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--primary" data-md-level="0" style="visibility: hidden">
<label class="md-nav__title md-nav__title--site" for="drawer">
<a href="../index.html" title="TMT Executive Software Documentation" class="md-nav__button md-logo">
<span class="md-nav__button md-logo">
<i class="md-icon">local_library</i>
</a>
<a href="../index.html" title="TMT Executive Software Documentation">
TMT Executive Software Documentation
</a>
</label>
<ul>
  <li><a href="../esw/eswOverview.html" class="page">Executive Software Overview</a></li>
  <li><a href="../sequencersandscripts/seq-index.html" class="page">Sequencers and Sequence Components</a>
  <ul>
    <li><a href="../sequencersandscripts/sequencer.html" class="page">Sequencers in the Executive Software</a></li>
    <li><a href="../sequencersandscripts/sequencer-app.html" class="page">Running a Sequencer Using esw-ocs-app</a></li>
  </ul></li>
  <li><a href="../scripts/scripts-index.html" class="page">Sequencer Scripts</a>
  <ul>
    <li><a href="../scripts/script-styles.html" class="page">Sequencer Script Styles</a></li>
    <li><a href="../scripts/dsl/script-constructs.html" class="page">Script DSL Constructs</a></li>
    <li><a href="../scripts/dsl/csw-services.html" class="page">CSW Services DSL</a></li>
  </ul></li>
  <li><a href="../eswshell/esw-shell.html" class="page">ESW Shell</a></li>
  <li><a href="../uisupport/uisupp-index.html" class="page">User Interface Support</a>
  <ul>
    <li><a href="../uisupport/UIOverview.html" class="page">User Interfaces in ESW and TMT</a></li>
    <li><a href="../uisupport/frontend-template.html" class="page">Creating and Using the Frontend UI Template</a></li>
    <li><a href="../uisupport/backend-template.html" class="page">Creating and Using the UI Backend Template</a></li>
    <li><a href="../uisupport/gateway.html" class="page">User Interface Gateway</a></li>
  </ul></li>
  <li><a href="../technical/tech-index.html" class="page">Technical Design Documents</a>
  <ul>
    <li><a href="../technical/sequence-manager-tech.html" class="page">Sequence Manager Technical Documentation</a></li>
    <li><a href="../technical/sequencer-tech.html" class="page">Sequencer Technical Documentation</a></li>
    <li><a href="../technical/sequence-component-tech.html" class="page">Sequence Component Technical Documentation</a></li>
    <li><a href="../technical/gateway-tech.html" class="active page">Gateway Technical Documentation</a></li>
    <li><a href="../technical/agent-service-tech.html" class="page">Agent Service and Agent Technical Documentation</a></li>
    <li><a href="../technical/apps/apps-index.html" class="page">Technical Applications</a></li>
    <li><a href="../technical/esw-application-parts.html" class="page">ESW Application Architecture</a></li>
    <li><a href="../technical/contracts.html" class="page">Service Contracts</a></li>
    <li><a href="../technical/testing-philosophy.html" class="page">OSW Testing Philosophy</a></li>
    <li><a href="../technical/esw-services.html" class="page">esw-services</a></li>
  </ul></li>
  <li><a href="../tutorials/web-app-tutorial.html" class="page">Web Application Tutorial</a></li>
</ul>
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../technical/gateway-tech.html#gateway-technical-documentation" class="header">Gateway Technical Documentation</a>
  <ul>
    <li><a href="../technical/gateway-tech.html#implementation" class="header">Implementation</a></li>
    <li><a href="../technical/gateway-tech.html#api-call-flow" class="header">API call flow</a></li>
    <li><a href="../technical/gateway-tech.html#modules" class="header">Modules</a></li>
    <li><a href="../technical/gateway-tech.html#running-gateway-server" class="header">Running Gateway Server</a></li>
    <li><a href="../technical/gateway-tech.html#metrics" class="header">Metrics</a></li>
  </ul></li>
</ul>
</nav>

</nav>
<ul style="display: none">
<li class="md-nav__item md-version" id="project.version">
<label class="md-nav__link" for="__version">
<i class="md-icon" title="Version">label_outline</i> 0.1.0*
</label>
</li>
</ul>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../technical/gateway-tech.html#gateway-technical-documentation" class="header">Gateway Technical Documentation</a>
  <ul>
    <li><a href="../technical/gateway-tech.html#implementation" class="header">Implementation</a></li>
    <li><a href="../technical/gateway-tech.html#api-call-flow" class="header">API call flow</a></li>
    <li><a href="../technical/gateway-tech.html#modules" class="header">Modules</a></li>
    <li><a href="../technical/gateway-tech.html#running-gateway-server" class="header">Running Gateway Server</a></li>
    <li><a href="../technical/gateway-tech.html#metrics" class="header">Metrics</a></li>
  </ul></li>
</ul>
</nav>

</div>
</div>
</div>
<div class="md-content">
<article class="md-content__inner md-typeset">
<div class="md-content__searchable">
<h1><a href="#gateway-technical-documentation" name="gateway-technical-documentation" class="anchor"><span class="anchor-link"></span></a>Gateway Technical Documentation</h1>
<p>The User Interface Gateway gives access to all CSW and ESW services (available to user) and components from browser-based user interfaces. The Gateway also enforces authorization on Command Service APIs to components and Sequencer APIs to protect from unauthorized access.</p>
<p><img src="../images/gateway/gateway.svg" alt="ESW Gateway" /></p>
<h2><a href="#implementation" name="implementation" class="anchor"><span class="anchor-link"></span></a>Implementation</h2>
<p>The Gateway is an HTTP service which relies on <code>msocket</code> framework. Internally it delegates to the various services(of both ESW or CSW) needed as per the request.</p>
<p>It provides access to following:</p>
<ul>
  <li>Command Service APIs (CSW)</li>
  <li>Alarm APIs (CSW)</li>
  <li>Event APIs (CSW)</li>
  <li>Sequencer APIs (ESW)</li>
  <li>Admin APIs (ESW)</li>
  <li>Logging APIS (ESW)</li>
</ul>
<p>Some services are not part of the Gateway. This is mainly because of 2 reasons:</p>
<ol>
  <li>The service can be accessed via its own HTTP interface. Example, Config Service.</li>
  <li>The service is not user facing. Example, the Sequence Manager Service.</li>
</ol>
<p>The Command and Sequencer Command Services provide configurable protection to restrict certain commands to certain users. This is done by applying security directives on the Command Service routes that check for proper authorization.</p>
<h2><a href="#api-call-flow" name="api-call-flow" class="anchor"><span class="anchor-link"></span></a>API call flow</h2>
<p>Let&rsquo;s take an example of <code>AbortSequence</code> command coming from a browser to a Sequencer via the Gateway:</p>
<ol>
  <li>Since Sequencer APIs are protected using authorization, the UI app gets a valid token from <code>AAS</code> that will enable access to Sequencer API in the Gateway.</li>
  <li>The UI app will create an <code>abortSequence</code> request using the authorization token and send it to the Gateway.</li>
  <li>The Gateway validates the request authorization token and the role of UI app against the <code>command role config</code>.</li>
  <li>If the validation is successful, the Gateway delegates the request to the Sequencer Command Service.</li>
  <li>The Sequencer executes the request and returns the <code>stepList</code> as a response.</li>
  <li>This response is given back to the UI app that made the request.</li>
</ol>
<p>Below diagram depicts the flow mapped by above points:</p>
<p><img src="../images/gateway/api-flow.svg" alt="API call flow" /></p>
<h2><a href="#modules" name="modules" class="anchor"><span class="anchor-link"></span></a>Modules</h2>
<h3><a href="#esw-gateway-api" name="esw-gateway-api" class="anchor"><span class="anchor-link"></span></a>esw-gateway-api</h3>
<p>All the request models, clients, and APIs exposed in gateway service resides within this module. This also contains the codecs for the models.</p>
<p>It is a cross-compiled project which has following parts:</p>
<ul>
  <li>js - code used by scala-js.</li>
  <li>jvm - code used by jvm</li>
  <li>shared - code which can be used by both scala-js and jvm</li>
</ul>
<h3><a href="#esw-gateway-impl" name="esw-gateway-impl" class="anchor"><span class="anchor-link"></span></a>esw-gateway-impl</h3>
<p>This module depends on <code>esw-gateway-api</code> and contains implementation for all the apis declared in <code>esw-gateway-api</code>. In case of CSW services(ex, Event Service, Alarm Service), the implementation delegates the call to respective CSW service.</p>
<h3><a href="#esw-gateway-server" name="esw-gateway-server" class="anchor"><span class="anchor-link"></span></a>esw-gateway-server</h3>
<p>This module contains the main application which when run starts the gateway server. This includes server wiring, post and websocket handlers and cli app.</p>
<p>This module depends on <code>esw-http-core</code> for starting up an HTTP service.</p>
<h2><a href="#running-gateway-server" name="running-gateway-server" class="anchor"><span class="anchor-link"></span></a>Running Gateway Server</h2>
<p>For running Gateway server, please refer <a href="../uisupport/gateway-app.html">this</a>.</p>
<h2><a href="#metrics" name="metrics" class="anchor"><span class="anchor-link"></span></a>Metrics</h2>
<p>The Gateway has support for capturing metrics. The metrics can be enabled by providing <code>--metrics</code> or <code>-m</code> flag while starting the <code>gateway-server</code> application.</p>
<p>Gateway metrics are powered by <a href="https://prometheus.io/">Prometheus</a>. We use a Prometheus Java <a href="https://github.com/prometheus/client_java">client</a> to capture HTTP and websocket-based metrics. The Gateway exposes a <code>/metrics</code> endpoint where a snapshot of metrics can be fetched. The Prometheus server then polls the metrics endpoint and stores the metrics in a time series database which then can be used for visualization using tools like <a href="https://grafana.com/">Grafana</a>.</p>
<p>Gateway metrics are categorized into two major sections: <strong>HTTP Metrics</strong> and <strong>Websocket Metrics</strong>.</p>
<h3><a href="#http-metrics" name="http-metrics" class="anchor"><span class="anchor-link"></span></a>HTTP Metrics</h3>
<p>The HTTP metrics section includes following different types of metrics:</p>
<ol>
  <li>Total HTTP requests processed by the Gateway. This includes all the commands, events, log etc. messages processed by the Gateway since it was started.</li>
  <li>HTTP requests flowing via the Gateway per second. These are categorized by command type, for example, <code>ComponentCommand</code>, <code>SequencerCommand</code>, <code>GetEvent</code>, <code>PublishEvent</code> etc. This metric helps us to understand the trend of requests processed per second.</li>
  <li>Commands passing through the Gateway per second. These commands can be <code>Submit</code>, <code>Validate</code>, <code>Oneway</code> etc.</li>
</ol>
<h3><a href="#websocket-metrics" name="websocket-metrics" class="anchor"><span class="anchor-link"></span></a>Websocket Metrics</h3>
<p>The Websocket metrics section includes the following different types of metrics:</p>
<ol>
  <li>Active WebSocket connections. This number indicates all the currently connected websocket clients to the Gateway. As soon as a WebSocket connection gets disconnected, this number decreases.</li>
  <li>Active Event Service pattern subscribers. (CommandType = <code>SubscribeWithPattern</code>)</li>
  <li>Active Event Service subscribers. (CommandType = <code>SubscribeEvent</code>)</li>
  <li>Active WebSocket requests per second. This indicates the trend of WebSocket connections over a period of time.</li>
  <li>Event rate per client per second. This indicates the rate at which events are flowing via a WebSocket connection. Here, a client indicates a unique application name and username combination, for example, <code>{app_name: eng-ui, username: Jena}</code></li>
  <li>Active WebSocket connections per client. This indicates the number of active WebSocket connections per unique application name and username combination.</li>
  <li>Active event subscriptions per client. This indicates the number of active event subscribers per unique application name and username combination.</li>
  <li>Active event pattern subscriptions per client. This indicates the number of active event subscribers per unique application name and username combination.</li>
</ol>
<p>The following screenshots show some example Gateway metrics using Grafana.</p>
<p><img src="../images/gateway/http_metrics.png" alt="HTTP Metrics" /> <img src="../images/gateway/ws_metrics1.png" alt="Websocket Metrics 1" /> <img src="../images/gateway/ws_metrics2.png" alt="Websocket Metrics 2" /> <img src="../images/gateway/ws_metrics3.png" alt="Websocket Metrics 3" /></p>
<p>In the above screenshots, last two plots are labelled with <code>App Name (Username)</code> format, for example, <strong>event-dashboard (Alex)</strong>, <strong>event-dashboard (Bob)</strong>.</p><div class="callout note "><div class="callout-title">Note</div>
<p>The screenshots above were taken by following the instructions provided <a href="https://github.com/tmtsoftware/esw/blob/master/scripts/metrics/README.md">here</a>.</p></div>
</div>
<div>
<a href="https://github.com/tmtsoftware/esw/tree/master/docs/src/main/technical/gateway-tech.md" title="Edit this page" class="md-source-file md-edit">
Edit this page
</a>
</div>
<div class="print-only">
<span class="md-source-file md-version">
0.1.0*
</span>
</div>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-nav">
<nav class="md-footer-nav__inner md-grid">
<a href="../technical/sequence-component-tech.html" title="Sequence Component Technical Documentation" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
</div>
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Previous
</span>
Sequence Component Technical Documentation
</span>
</div>
</a>
<a href="../technical/agent-service-tech.html" title="Agent Service and Agent Technical Documentation" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Next
</span>
Agent Service and Agent Technical Documentation
</span>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
</div>
</a>
</nav>
</div>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
Powered by
<a href="https://github.com/lightbend/paradox">Paradox</a>
and
<a href="https://jonas.github.io/paradox-material-theme/">Paradox Material Theme</a>

</div>
</div>
</div>
</footer>

</div>
<script src="../assets/javascripts/application.583bbe55.js"></script>
<script src="../assets/javascripts/paradox-material-theme.js"></script>
<script>app.initialize({version:"0.17",url:{base:"../."}})</script>
<script type="text/javascript" src="../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function(event) {
window.prettyPrint && prettyPrint();
});
</script>
</body>
</html>
