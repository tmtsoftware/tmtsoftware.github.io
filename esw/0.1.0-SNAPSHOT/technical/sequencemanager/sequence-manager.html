<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="description" content="docs">
<meta name="generator" content="Paradox, paradox-material-theme=0.7.0, mkdocs-material=3.0.3">

<meta name="lang:clipboard.copy" content="Copy to clipboard">
<meta name="lang:clipboard.copied" content="Copied to clipboard">
<meta name="lang:search.language" content="">
<meta name="lang:search.pipeline.stopwords" content="true">
<meta name="lang:search.pipeline.trimmer" content="true">
<meta name="lang:search.result.none" content="No matching documents">
<meta name="lang:search.result.one" content="1 matching document">
<meta name="lang:search.result.other" content="# matching documents">
<meta name="lang:search.tokenizer" content="[\s\-]+">


<meta name="description" content="docs">
<link rel="shortcut icon" href="../../assets/images/favicon.png">
<title>Sequence Manager Â· TMT Executive Software (ESW)</title>
<link rel="stylesheet" href="../../assets/stylesheets/application.451f80e5.css">
<link rel="stylesheet" href="../../lib/material__tabs/dist/mdc.tabs.min.css">
<link rel="stylesheet" href="../../lib/prettify/prettify.css">
<script src="../../assets/javascripts/modernizr.1aa3b519.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
<style>
body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}
code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}
</style>
<link rel="stylesheet" href="../../assets/fonts/font-awesome.css">
<link rel="stylesheet" href="../../assets/fonts/material-icons.css">
<link rel="stylesheet" href="../../assets/stylesheets/paradox-material-theme.css">
</head>
<body
>
<input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
<input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
<label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
<header class="md-header" data-md-component="header">
<nav class="md-header-nav md-grid">
<div class="md-flex">
<div class="md-flex__cell md-flex__cell--shrink">
<a href="../../index.html" title="TMT Executive Software (ESW)" class="md-header-nav__button md-logo">
<i class="md-icon">local_library</i>
</a>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
</div>
<div class="md-flex__cell md-flex__cell--stretch">
<div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
<span class="md-header-nav__topic">
TMT Executive Software (ESW)
</span>
<span class="md-header-nav__topic">
Sequence Manager
</span>
</div>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
<label class="md-icon md-search__icon" for="__search"></label>
<button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">&#xE5CD;</button>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix>
<div class="md-search-result" data-md-component="result">
<div class="md-search-result__meta">
Type to start searching
</div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>

</div>
</div>
</nav>
</header>

<div class="md-container">
<main class="md-main">
<div class="md-main__inner md-grid" data-md-component="container">
<div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--primary" data-md-level="0" style="visibility: hidden">
<label class="md-nav__title md-nav__title--site" for="drawer">
<a href="../../index.html" title="TMT Executive Software (ESW)" class="md-nav__button md-logo">
<span class="md-nav__button md-logo">
<i class="md-icon">local_library</i>
</a>
<a href="../../index.html" title="TMT Executive Software (ESW)">
TMT Executive Software (ESW)
</a>
</label>
<ul>
  <li><a href="../../commons/getting-started.html" class="page">Getting Started</a></li>
  <li><a href="../../sequencer/seqcompsequencer/index.html" class="page">Sequence Components and Sequencers</a>
  <ul>
    <li><a href="../../sequencer/seqcompsequencer/Terms.html" class="page">OCS Terms</a></li>
    <li><a href="../../sequencer/seqcompsequencer/SeqComp.html" class="page">Sequence Component</a></li>
    <li><a href="../../sequencer/seqcompsequencer/Sequencers.html" class="page">Sequencers</a></li>
    <li><a href="../../sequencer/seqcompsequencer/state-transition.html" class="page">Sequencer Lifecycle</a></li>
  </ul></li>
  <li><a href="../../sequencer/scripts/scripts.html" class="page">Sequencer Scripts</a>
  <ul>
    <li><a href="../../sequencer/scripts/script-styles.html" class="page">Sequencer Script Styles</a></li>
    <li><a href="../../sequencer/scripts/dsl/script-constructs.html" class="page">Script DSL Constructs</a></li>
    <li><a href="../../sequencer/scripts/dsl/csw-services.html" class="page">CSW Services DSL</a></li>
  </ul></li>
  <li><a href="../../commons/contracts.html" class="page">ESW Service contract</a></li>
  <li><a href="../../apps/apps.html" class="page">Applications</a>
  <ul>
    <li><a href="../../apps/sequencer-app.html" class="page">Sequencer App</a></li>
    <li><a href="../../apps/sequence-manager-app.html" class="page">Sequence Manager App</a></li>
    <li><a href="../../apps/agent-service-app.html" class="page">Agent Service App</a></li>
    <li><a href="../../apps/agent-app.html" class="page">Agent App</a></li>
    <li><a href="../../apps/gateway-app.html" class="page">ESW Gateway App</a></li>
  </ul></li>
  <li><a href="../../eswgateway/esw-gateway.html" class="page">Esw Gateway</a></li>
  <li><a href="../../technical/technical.html" class="page">Technical Design Documents</a>
  <ul>
    <li><a href="../../technical/sequencemanager/index.html" class="page">Sequence Manager</a></li>
    <li><a href="../../technical/agent/agent.html" class="page">Agent</a></li>
    <li><a href="../../technical/agentservice/agent-service.html" class="page">Agent Service</a></li>
  </ul></li>
</ul>
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../../technical/sequencemanager/sequence-manager.html#sequence-manager" class="header">Sequence Manager</a>
  <ul>
    <li><a href="../../technical/sequencemanager/sequence-manager.html#introduction" class="header">Introduction</a></li>
    <li><a href="../../technical/sequencemanager/sequence-manager.html#modules" class="header">Modules</a></li>
    <li><a href="../../technical/sequencemanager/sequence-manager.html#implementation-details" class="header">Implementation Details</a></li>
    <li><a href="../../technical/sequencemanager/sequence-manager.html#state-transition" class="header">State Transition</a></li>
  </ul></li>
</ul>
</nav>

</nav>
<ul style="display: none">
<li class="md-nav__item md-version" id="project.version">
<label class="md-nav__link" for="__version">
<i class="md-icon" title="Version">label_outline</i> 0.1.0*
</label>
</li>
</ul>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../../technical/sequencemanager/sequence-manager.html#sequence-manager" class="header">Sequence Manager</a>
  <ul>
    <li><a href="../../technical/sequencemanager/sequence-manager.html#introduction" class="header">Introduction</a></li>
    <li><a href="../../technical/sequencemanager/sequence-manager.html#modules" class="header">Modules</a></li>
    <li><a href="../../technical/sequencemanager/sequence-manager.html#implementation-details" class="header">Implementation Details</a></li>
    <li><a href="../../technical/sequencemanager/sequence-manager.html#state-transition" class="header">State Transition</a></li>
  </ul></li>
</ul>
</nav>

</div>
</div>
</div>
<div class="md-content">
<article class="md-content__inner md-typeset">
<div class="md-content__searchable">
<h1><a href="#sequence-manager" name="sequence-manager" class="anchor"><span class="anchor-link"></span></a>Sequence Manager</h1>
<h2><a href="#introduction" name="introduction" class="anchor"><span class="anchor-link"></span></a>Introduction</h2>
<p>Sequence Manager is ESW component which takes care of provisioning sequence components needed for observation, configuration of sequencer scripts as per observing mode. It has capabilities to start, re-start, shutdown sequencer/s, shutdown sequence components as well as to know status of TMT components like which sequencer script is loaded on which sequence component, which sequence component/s are running on which agent. Sequence Manager is implemented using Akka actor. Sequence Manager provides two interfaces.</p>
<ol>
  <li>Akka interface</li>
  <li>HTTP interface</li>
</ol>
<h2><a href="#modules" name="modules" class="anchor"><span class="anchor-link"></span></a>Modules</h2>
<p>Sequence Manager implementation is distributed into following sub modules:</p>
<h3><a href="#esw-sm-api" name="esw-sm-api" class="anchor"><span class="anchor-link"></span></a>esw-sm-api</h3>
<p>This sequence manager API module is responsible for providing:</p>
<ol>
  <li>shared - API which is cross compiled to JVM as well JS</li>
  <li>shared - HTTP client which can be used by JVM as well as scala-js applications</li>
  <li>jvm - Akka client for JVM applications, Akka actor messages, akka serializer</li>
</ol>
<h3><a href="#esw-sm-handler" name="esw-sm-handler" class="anchor"><span class="anchor-link"></span></a>esw-sm-handler</h3>
<p>This sequence manager handler module is responsible for providing HTTP routes for sequence manager HTTP server.</p>
<h3><a href="#esw-sm-impl" name="esw-sm-impl" class="anchor"><span class="anchor-link"></span></a>esw-sm-impl</h3>
<p>This module contains core logic for Sequence Manager Actor.</p>
<h3><a href="#esw-sm-app" name="esw-sm-app" class="anchor"><span class="anchor-link"></span></a>esw-sm-app</h3>
<p>This module contains cli which starts sequence manager component as well as HTTP server of Sequence Manager</p>
<h2><a href="#implementation-details" name="implementation-details" class="anchor"><span class="anchor-link"></span></a>Implementation Details</h2>
<p>Boot-up time for TMT ecosystem is expected to start agent on every machine, sequence manager on ESW machine and HCD/Assembly components on respective subsystem machines.</p>
<p>Sequence Manager support multiple APIs which allows to configure for an observing mode, cleanup after observation is done etc.</p>
<p>Flow for configuration of observing mode is described below:</p>
<h3><a href="#getagentstatus" name="getagentstatus" class="anchor"><span class="anchor-link"></span></a>GetAgentStatus</h3>
<p>This API allows to show status of TMT ecosystem components (agents, sequence components and sequencers). It shows which all agents are up and running, sequence components running on those agents and sequencer script loaded on sequence component</p><div class="callout note "><div class="callout-title">Note</div>
<p>At this point of time no sequence components or sequencers are present in system as provisioning is not done.</p></div>
<p><img src="../../images/sequencemanager/sm1.png" alt="ObservationStart" /></p>
<h3><a href="#provision" name="provision" class="anchor"><span class="anchor-link"></span></a>Provision</h3>
<p>This API allows to provision sequence components per agent. This API requires configuartion which specifies no of sequence components needed to be spawned on particular agent.</p>
<p>Following diagram depicts status of TMT ecosystem after provisioing as per config</p>
<p><img src="../../images/sequencemanager/sm2.png" alt="Provision" /></p><div class="callout note "><div class="callout-title">Note</div>
<p>Provision API shutdown all running sequence components if any. After shutting down already running sequence components, it spawns new sequence components on agents as per configuration provided at the time of provision.</p></div>
<p>Following flow chart shows algorithm for provision flow</p>
<p><img src="../../images/sequencemanager/provision.png" alt="Configure" /></p>
<h3><a href="#configure" name="configure" class="anchor"><span class="anchor-link"></span></a>Configure</h3>
<p>Configure is responsible for starting sequencers needed for an observing mode. It also checks for any resource conflicts with ongoing observations. Configure API, checks for required sequencers and resources in obsModeConfig file provided at boot up time sequence manager. This config file contains mapping of observing mode to required sequencers and resources. When configure for particular observing mode command is received by Sequence Manager, it checks following:</p>
<ul>
  <li>Mapping for required observing mode exists in configuration file</li>
  <li>availability of adequate sequence components for starting sequencers</li>
  <li>no resource conflict should occur with ongoing observations</li>
</ul>
<p><img src="../../images/sequencemanager/sm3.png" alt="Configure" /></p><div class="callout note "><div class="callout-title">Note</div>
<p>Once Sequence Manager configures for an observing mode, sequence can be sent to top level sequencer (ESW sequencer for that observing mode) by SOSS</p></div>
<p>Following flow chart shows algorithm for configure flow</p>
<p><img src="../../images/sequencemanager/configure.png" alt="Configure" /></p>
<h3><a href="#shutdown-sequencers" name="shutdown-sequencers" class="anchor"><span class="anchor-link"></span></a>Shutdown Sequencers</h3>
<p>Once observation is complete, cleanup for that observation involves shutting down all sequencers of that observing mode. Sequence Manager provides shutdown sequencers API variations which allow to shutdown all sequencers of an observing mode, shutdown all sequencer belonging to specific subsystem, shutdown a particular sequencer and shutdown all running sequencers.</p>
<p><img src="../../images/sequencemanager/sm4.png" alt="ObservationStart" /></p>
<h3><a href="#other-apis" name="other-apis" class="anchor"><span class="anchor-link"></span></a>Other APIs</h3>
<p>Apart from APIs explained above, sequence manager also provides following APIs:</p>
<ul>
  <li>getRunningObsModes - gives information about all running observing modes</li>
  <li>startSequencer - start sequencer for provided subsystem and observing mode</li>
  <li>restartSequencer - re-start sequencer for provided subsystem and observing mode</li>
  <li>shutdownSequenceComponent - shutdown a sequence component with provided prefix</li>
  <li>shutdownAllSequenceComponents - shutdown all running sequence components</li>
</ul>
<h2><a href="#state-transition" name="state-transition" class="anchor"><span class="anchor-link"></span></a>State Transition</h2>
<p>Sequence Manager Actor is implemented as state machine. It has two states: Idle and Processing. At any point of time, sequence manager can be in exactly one of these states.</p>
<p>Following digram depicts state transition for sequence manager:</p>
<p><img src="../../images/sequencemanager/sm-state-transition.png" alt="State Transition Sequence Manager" /></p>
<p>Implementation of these msgs is asynchronous in nature. So handling any other msgs while previous msg processing is incomplete can result in inconsistent system. For example, configure Observing_Mode_1 msg is received by Sequence Manager Actor. Let&rsquo;s assume that this requires to start ESW, IRIS and TCS sequencers. Configure flow has checked for resource conflict. No conflict is there so configure goes ahead with processing. During this processing, if any other msg like startSequencer for IRIS subsystem and Observing_Mode_2 is recieved then this will result in inconsistent behaviour. To avoid these cases, certain msgs are accepted only when sequence manager is idle. When any one of idle state msg is received, sequence manager goes into processing state where it accepts only common msgs (read state msgs which will not cause any inconsistency). In processing state, actor waits for processing complete msg. Once processing complete msg is recieved, actor goes back to idle state and ready to process any of idle state msg. Both idle and processing state can handle commom msgs without any state change.</p>
</div>
<div>
<a href="https://github.com/tmtsoftware/esw/tree/master/docs/src/main/technical/sequencemanager/sequence-manager.md" title="Edit this page" class="md-source-file md-edit">
Edit this page
</a>
</div>
<div class="print-only">
<span class="md-source-file md-version">
0.1.0*
</span>
</div>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-nav">
<nav class="md-footer-nav__inner md-grid">
<a href="../../technical/sequencemanager/index.html" title="Sequence Manager" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
</div>
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Previous
</span>
Sequence Manager
</span>
</div>
</a>
<a href="../../technical/agent/agent.html" title="Agent" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Next
</span>
Agent
</span>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
</div>
</a>
</nav>
</div>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
Powered by
<a href="https://github.com/lightbend/paradox">Paradox</a>
and
<a href="https://jonas.github.io/paradox-material-theme/">Paradox Material Theme</a>

</div>
</div>
</div>
</footer>

</div>
<script src="../../assets/javascripts/application.583bbe55.js"></script>
<script src="../../assets/javascripts/paradox-material-theme.js"></script>
<script>app.initialize({version:"0.17",url:{base:"../../."}})</script>
<script type="text/javascript" src="../../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function(event) {
window.prettyPrint && prettyPrint();
});
</script>
</body>
</html>
