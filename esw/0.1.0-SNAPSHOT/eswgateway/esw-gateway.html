<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="description" content="docs">
<meta name="generator" content="Paradox, paradox-material-theme=0.6.0, mkdocs-material=3.0.3">

<meta name="lang:clipboard.copy" content="Copy to clipboard">
<meta name="lang:clipboard.copied" content="Copied to clipboard">
<meta name="lang:search.language" content="">
<meta name="lang:search.pipeline.stopwords" content="true">
<meta name="lang:search.pipeline.trimmer" content="true">
<meta name="lang:search.result.none" content="No matching documents">
<meta name="lang:search.result.one" content="1 matching document">
<meta name="lang:search.result.other" content="# matching documents">
<meta name="lang:search.tokenizer" content="[\s\-]+">


<meta name="description" content="docs">
<link rel="shortcut icon" href="../assets/tmt_favicon.ico">
<title>Esw Gateway Â· TMT Executive Software (ESW)</title>
<link rel="stylesheet" href="../assets/stylesheets/application.451f80e5.css">
<link rel="stylesheet" href="../lib/material__tabs/dist/mdc.tabs.min.css">
<link rel="stylesheet" href="../lib/prettify/prettify.css">
<script src="../assets/javascripts/modernizr.1aa3b519.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
<style>
body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}
code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}
</style>
<link rel="stylesheet" href="../assets/fonts/font-awesome.css">
<link rel="stylesheet" href="../assets/fonts/material-icons.css">
<link rel="stylesheet" href="../assets/stylesheets/paradox-material-theme.css">
</head>
<body
>
<input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
<input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
<label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
<header class="md-header" data-md-component="header">
<nav class="md-header-nav md-grid">
<div class="md-flex">
<div class="md-flex__cell md-flex__cell--shrink">
<a href="../index.html" title="TMT Executive Software (ESW)" class="md-header-nav__button md-logo">
<i class="md-icon">local_library</i>
</a>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
</div>
<div class="md-flex__cell md-flex__cell--stretch">
<div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
<span class="md-header-nav__topic">
TMT Executive Software (ESW)
</span>
<span class="md-header-nav__topic">
Esw Gateway
</span>
</div>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
<label class="md-icon md-search__icon" for="__search"></label>
<button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">&#xE5CD;</button>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix>
<div class="md-search-result" data-md-component="result">
<div class="md-search-result__meta">
Type to start searching
</div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>

</div>
<div class="md-flex__cell md-flex__cell--shrink">
<div class="md-header-nav__source">
<a href="https://github.com/tmtsoftware/esw"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
tmtsoftware/esw
</div>
</a>

</div>
</div>
</div>
</nav>
</header>

<div class="md-container">
<main class="md-main">
<div class="md-main__inner md-grid" data-md-component="container">
<div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--primary" data-md-level="0" style="visibility: hidden">
<label class="md-nav__title md-nav__title--site" for="drawer">
<a href="../index.html" title="TMT Executive Software (ESW)" class="md-nav__button md-logo">
<span class="md-nav__button md-logo">
<i class="md-icon">local_library</i>
</a>
<a href="../index.html" title="TMT Executive Software (ESW)">
TMT Executive Software (ESW)
</a>
</label>
<div class="md-nav__source">
<a href="https://github.com/tmtsoftware/esw"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
tmtsoftware/esw
</div>
</a>

</div>
<ul>
  <li><a href="../sequencer/seqcompsequencer/index.html" class="page">Sequence Components and Sequencers</a>
  <ul>
    <li><a href="../sequencer/seqcompsequencer/Terms.html" class="page">OCS Terms</a></li>
    <li><a href="../sequencer/seqcompsequencer/SeqComp.html" class="page">Sequence Component</a></li>
    <li><a href="../sequencer/seqcompsequencer/Sequencers.html" class="page">Sequencers</a></li>
    <li><a href="../sequencer/seqcompsequencer/state-transition.html" class="page">Sequencer Lifecycle</a></li>
  </ul></li>
  <li><a href="../sequencer/scripts/scripts.html" class="page">Sequencer Scripts</a>
  <ul>
    <li><a href="../sequencer/scripts/script-styles.html" class="page">Sequencer Script Styles</a></li>
    <li><a href="../sequencer/scripts/dsl/script-constructs.html" class="page">Script DSL Constructs</a></li>
    <li><a href="../sequencer/scripts/dsl/csw-services.html" class="page">CSW Services DSL</a></li>
  </ul></li>
  <li><a href="../commons/contracts.html" class="page">ESW Service contract</a></li>
  <li><a href="../apps/apps.html" class="page">Applications</a>
  <ul>
    <li><a href="../apps/sequencerapp.html" class="page">sequencer-app</a></li>
  </ul></li>
  <li><a href="../eswgateway/esw-gateway.html" class="active page">Esw Gateway</a></li>
</ul>
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../eswgateway/esw-gateway.html#esw-gateway" class="header">Esw Gateway</a>
  <ul>
    <li><a href="../eswgateway/esw-gateway.html#esw-gateway-with-authentication-and-authorization" class="header">Esw Gateway with authentication and authorization</a></li>
  </ul></li>
</ul>
</nav>

</nav>
<ul style="display: none">
<li class="md-nav__item md-version" id="project.version">
<label class="md-nav__link" for="__version">
<i class="md-icon" title="Version">label_outline</i> 0.1.0*
</label>
</li>
</ul>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../eswgateway/esw-gateway.html#esw-gateway" class="header">Esw Gateway</a>
  <ul>
    <li><a href="../eswgateway/esw-gateway.html#esw-gateway-with-authentication-and-authorization" class="header">Esw Gateway with authentication and authorization</a></li>
  </ul></li>
</ul>
</nav>

</div>
</div>
</div>
<div class="md-content">
<article class="md-content__inner md-typeset">
<div class="md-content__searchable">
<h1><a href="#esw-gateway" name="esw-gateway" class="anchor"><span class="anchor-link"></span></a>Esw Gateway</h1>
<p>This is provided to give access to all CSW and ESW services and components from browser-based user interfaces.</p>
<h2><a href="#esw-gateway-with-authentication-and-authorization" name="esw-gateway-with-authentication-and-authorization" class="anchor"><span class="anchor-link"></span></a>Esw Gateway with authentication and authorization</h2>
<p>Esw Gateway is accessible to public network and exposes API endpoints through Http interface, hence we need to protected its endpoints from unauthorized access.</p>
<h3><a href="#protection-on-commands-service-endpoints-on-gateway" name="protection-on-commands-service-endpoints-on-gateway" class="anchor"><span class="anchor-link"></span></a>Protection on Commands service endpoints on Gateway</h3>
<p>There are commands which are more restrictive which need eng or above role and some commands which just need user level role. Also, these more restrictive eng commands need a fined grained control mechanism so that they can be safely executed by authorized person having specific role at subsystem level. To achieve this we need to have a role hierarchy at subsystem level along with a config table containing the mapping between more restrictive commands and these roles.</p>
<h4><a href="#role-hierarchy" name="role-hierarchy" class="anchor"><span class="anchor-link"></span></a>Role Hierarchy</h4>
<p><img src="../images/eswgateway/role-hierarchy-keycloak.png" alt="Role Hierarchy" /></p>
<p>This type of role hierarchy is created in Keycloak as one time setup. As per this hierarchy there should be three roles present for each subsystem which are composed in specific order.</p>
<ul>
  <li>E.g. TCS-admin -&gt; TCS-eng -&gt; TCS-user.
    <ul>
      <li>When you assign a user TCS-eng role, keycloak will automatically add TCS-user role to that user</li>
      <li>When you assign a user TCS-admin role, keycloak will automatically add TCS-eng and TCS-user role to that user</li>
    </ul>
  </li>
</ul>
<p>Also, there are three special roles. OSW-admin, OSW-eng and OSW-user which are composed of all respective subsystem  level roles. </p>
<ul>
  <li>E.g. When you assign a user OSW-eng role, keycloak will automatically add roles TCS-eng, APS-eng and so on to that user and these roles will automatically add their respective lower level roles TCS-user, APS-user and so on</li>
</ul>
<h4><a href="#examples-" name="examples-" class="anchor"><span class="anchor-link"></span></a>Examples:</h4>
<p><img src="../images/eswgateway/user-roles.png" alt="User Roles" /></p>
<h4><a href="#command-role-mapping" name="command-role-mapping" class="anchor"><span class="anchor-link"></span></a>Command Role Mapping</h4>
<p>Below shown are example entries in config table with commands and roles who can execute those commands.</p>
<pre><code>IRIS.filter.wheel.startExposure: [IRIS-user, APS-eng]
IRIS.filter.wheel.stopExposure: [IRIS-user, APS-eng]
</code></pre>
<p>We need to create a config containing role mapping entries like shown above and use it when starting esw-gateway server. </p>
<h4><a href="#how-to-start-gateway" name="how-to-start-gateway" class="anchor"><span class="anchor-link"></span></a>How to start Gateway</h4>
<p>Use command role mapping file from local file system</p>
<pre><code>./esw-gateway-server start --local --command-role-config-path /local/path/filename.conf
</code></pre>
<p>or</p>
<pre><code>./esw-gateway-server start -l -c /local/path/filename.conf
</code></pre>
<p>Use command role mapping file from config service</p>
<pre><code>./esw-gateway-server start --command-role-config-path /path/filename.conf
</code></pre>
<p>or</p>
<pre><code>./esw-gateway-server start -c /path/filename.conf
</code></pre>
<h3><a href="#protection-on-sequencer-endpoints-on-gateway-" name="protection-on-sequencer-endpoints-on-gateway-" class="anchor"><span class="anchor-link"></span></a>Protection on Sequencer endpoints on Gateway.</h3>
<p>On protected endpoints of sequencer commands in esw-gateway, {subsystem}-user role check is performed. </p>
<ul>
  <li>Subsystem is obtained form componentId.prefix.subsystem</li>
  <li>E.g. If current sequence to be executed is for esw.primary then user should have minimum ESW-user role.</li>
</ul>
</div>
<div>
<a href="https://github.com/tmtsoftware/esw/tree/master/docs/src/main/eswgateway/esw-gateway.md" title="Edit this page" class="md-source-file md-edit">
Edit this page
</a>
</div>
<div class="print-only">
<span class="md-source-file md-version">
0.1.0*
</span>
</div>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-nav">
<nav class="md-footer-nav__inner md-grid">
<a href="../apps/sequencerapp.html" title="sequencer-app" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
</div>
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Previous
</span>
sequencer-app
</span>
</div>
</a>
</nav>
</div>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
Powered by
<a href="https://github.com/lightbend/paradox">Paradox</a>
and
<a href="https://jonas.github.io/paradox-material-theme/">Paradox Material Theme</a>

</div>
</div>
</div>
</footer>

</div>
<script src="../assets/javascripts/application.583bbe55.js"></script>
<script src="../assets/javascripts/paradox-material-theme.js"></script>
<script>app.initialize({version:"0.17",url:{base:"../."}})</script>
<script type="text/javascript" src="../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function(event) {
window.prettyPrint && prettyPrint();
});
</script>
</body>
</html>
