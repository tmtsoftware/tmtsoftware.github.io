<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="description" content="docs">
<meta name="generator" content="Paradox, paradox-material-theme=0.7.0, mkdocs-material=3.0.3">

<meta name="lang:clipboard.copy" content="Copy to clipboard">
<meta name="lang:clipboard.copied" content="Copied to clipboard">
<meta name="lang:search.language" content="">
<meta name="lang:search.pipeline.stopwords" content="true">
<meta name="lang:search.pipeline.trimmer" content="true">
<meta name="lang:search.result.none" content="No matching documents">
<meta name="lang:search.result.one" content="1 matching document">
<meta name="lang:search.result.other" content="# matching documents">
<meta name="lang:search.tokenizer" content="[\s\-]+">


<meta name="description" content="docs">
<link rel="shortcut icon" href="../assets/images/favicon.png">
<title>Sequencers in the Executive Software · TMT Executive Software Documentation</title>
<link rel="stylesheet" href="../assets/stylesheets/application.451f80e5.css">
<link rel="stylesheet" href="../lib/material__tabs/dist/mdc.tabs.min.css">
<link rel="stylesheet" href="../lib/prettify/prettify.css">
<script src="../assets/javascripts/modernizr.1aa3b519.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
<style>
body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}
code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}
</style>
<link rel="stylesheet" href="../assets/fonts/font-awesome.css">
<link rel="stylesheet" href="../assets/fonts/material-icons.css">
<link rel="stylesheet" href="../assets/stylesheets/paradox-material-theme.css">
</head>
<body
>
<input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
<input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
<label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
<header class="md-header" data-md-component="header">
<nav class="md-header-nav md-grid">
<div class="md-flex">
<div class="md-flex__cell md-flex__cell--shrink">
<a href="../index.html" title="TMT Executive Software Documentation" class="md-header-nav__button md-logo">
<i class="md-icon">local_library</i>
</a>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
</div>
<div class="md-flex__cell md-flex__cell--stretch">
<div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
<span class="md-header-nav__topic">
TMT Executive Software Documentation
</span>
<span class="md-header-nav__topic">
Sequencers in the Executive Software
</span>
</div>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
<label class="md-icon md-search__icon" for="__search"></label>
<button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">&#xE5CD;</button>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix>
<div class="md-search-result" data-md-component="result">
<div class="md-search-result__meta">
Type to start searching
</div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>

</div>
</div>
</nav>
</header>

<div class="md-container">
<main class="md-main">
<div class="md-main__inner md-grid" data-md-component="container">
<div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--primary" data-md-level="0" style="visibility: hidden">
<label class="md-nav__title md-nav__title--site" for="drawer">
<a href="../index.html" title="TMT Executive Software Documentation" class="md-nav__button md-logo">
<span class="md-nav__button md-logo">
<i class="md-icon">local_library</i>
</a>
<a href="../index.html" title="TMT Executive Software Documentation">
TMT Executive Software Documentation
</a>
</label>
<ul>
  <li><a href="../esw/eswOverview.html" class="page">Executive Software Overview</a></li>
  <li><a href="../sequencersandscripts/seq-index.html" class="page">Sequencers and Sequence Components</a>
  <ul>
    <li><a href="../sequencersandscripts/sequencer.html" class="active page">Sequencers in the Executive Software</a></li>
    <li><a href="../sequencersandscripts/sequencer-app.html" class="page">Running a Sequencer Using ocs-app</a></li>
  </ul></li>
  <li><a href="../scripts/scripts-index.html" class="page">Sequencer Scripts</a>
  <ul>
    <li><a href="../scripts/script-styles.html" class="page">Sequencer Script Styles</a></li>
    <li><a href="../scripts/dsl/script-constructs.html" class="page">Script DSL Constructs</a></li>
    <li><a href="../scripts/dsl/csw-services.html" class="page">CSW Services DSL</a></li>
  </ul></li>
  <li><a href="../uisupport/uisupp-index.html" class="page">User Interface Support</a>
  <ul>
    <li><a href="../uisupport/UIOverview.html" class="page">User Interfaces in ESW and TMT</a></li>
    <li><a href="../uisupport/frontend-template.html" class="page">Creating and Using the Frontend UI Template</a></li>
    <li><a href="../uisupport/backend-template.html" class="page">Creating and Using the UI Backend Template</a></li>
    <li><a href="../uisupport/gateway.html" class="page">User Interface Gateway</a></li>
  </ul></li>
  <li><a href="../technical/tech-index.html" class="page">Technical Design Documents</a>
  <ul>
    <li><a href="../technical/sequence-manager-tech.html" class="page">Sequence Manager Technical Documentation</a></li>
    <li><a href="../technical/sequencer-tech.html" class="page">Sequencer Technical Documentation</a></li>
    <li><a href="../technical/sequence-component-tech.html" class="page">Sequence Component Technical Documentation</a></li>
    <li><a href="../technical/gateway-tech.html" class="page">Gateway Technical Documentation</a></li>
    <li><a href="../technical/contracts.html" class="page">Service Contracts</a></li>
    <li><a href="../technical/agent-service-tech.html" class="page">Agent Service and Agent Technical Documentation</a></li>
    <li><a href="../technical/apps/apps-index.html" class="page">Applications</a></li>
  </ul></li>
</ul>
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../sequencersandscripts/sequencer.html#sequencers-in-the-executive-software" class="header">Sequencers in the Executive Software</a>
  <ul>
    <li><a href="../sequencersandscripts/sequencer.html#what-is-a-sequence-component-sequencer-script-and-sequence-" class="header">What is a Sequence Component, Sequencer, Script, and Sequence?</a></li>
    <li><a href="../sequencersandscripts/sequencer.html#sequencer-is-an-omoa-component" class="header">Sequencer is an OMOA Component</a></li>
    <li><a href="../sequencersandscripts/sequencer.html#defining-observing-modes" class="header">Defining Observing Modes</a></li>
    <li><a href="../sequencersandscripts/sequencer.html#registering-sequencers-in-location-service" class="header">Registering Sequencers in Location Service</a></li>
    <li><a href="../sequencersandscripts/sequencer.html#sequencer-technical-design" class="header">Sequencer Technical Design</a></li>
  </ul></li>
</ul>
</nav>

</nav>
<ul style="display: none">
<li class="md-nav__item md-version" id="project.version">
<label class="md-nav__link" for="__version">
<i class="md-icon" title="Version">label_outline</i> 0.1.0*
</label>
</li>
</ul>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../sequencersandscripts/sequencer.html#sequencers-in-the-executive-software" class="header">Sequencers in the Executive Software</a>
  <ul>
    <li><a href="../sequencersandscripts/sequencer.html#what-is-a-sequence-component-sequencer-script-and-sequence-" class="header">What is a Sequence Component, Sequencer, Script, and Sequence?</a></li>
    <li><a href="../sequencersandscripts/sequencer.html#sequencer-is-an-omoa-component" class="header">Sequencer is an OMOA Component</a></li>
    <li><a href="../sequencersandscripts/sequencer.html#defining-observing-modes" class="header">Defining Observing Modes</a></li>
    <li><a href="../sequencersandscripts/sequencer.html#registering-sequencers-in-location-service" class="header">Registering Sequencers in Location Service</a></li>
    <li><a href="../sequencersandscripts/sequencer.html#sequencer-technical-design" class="header">Sequencer Technical Design</a></li>
  </ul></li>
</ul>
</nav>

</div>
</div>
</div>
<div class="md-content">
<article class="md-content__inner md-typeset">
<div class="md-content__searchable">
<h1><a href="#sequencers-in-the-executive-software" name="sequencers-in-the-executive-software" class="anchor"><span class="anchor-link"></span></a>Sequencers in the Executive Software</h1>
<p>Sequencers are part of the ESW Observatory Control System or OCS. The job of OCS is to receive the description of the science observation from the planning tools and <em>execute the observation</em>. It does this using Sequencers and a few other ideas defined here.</p>
<p>This first section provides an overview of the critical OCS architectural ideas. Subsequent sections go into more depth. </p>
<h2><a href="#what-is-a-sequence-component-sequencer-script-and-sequence-" name="what-is-a-sequence-component-sequencer-script-and-sequence-" class="anchor"><span class="anchor-link"></span></a>What is a Sequence Component, Sequencer, Script, and Sequence?</h2>
<p>ESW.OCS provides the <strong>Sequence Component</strong>, which is one of the OMOA architecture components (along with HCD, Assembly, Container, and Application). The Sequence Component is configured by loading a &ldquo;<strong>script</strong>&rdquo; that is written in the &ldquo;<strong>script language</strong>&rdquo;. A different script can be written and loaded into a Sequence Component depending on the observing mode in use. When combined with a specific script, the Sequence Component becomes a <strong>Sequencer</strong> (i.e., Sequence Component + Script = Sequencer). The Sequence Component provides the framework and a consistent environment for a Sequencer. Scripts are stored in a dedicated script repository in the TMT Github called <a href="https://github.com/tmtsoftware/sequencer-scripts">sequencer-scripts</a>. <em>All scripts for all subsystems reside in the script repository</em>.</p>
<p><img src="../images/ocs/OCS-SeqCompScript.png" alt="SeqCompPlusSequencer" /></p>
<p>A <strong>Sequence</strong> is defined in Common Software as a list of Sequence Commands: Setup, Observe, Wait. The only message type a Sequencer can receive and process is a Sequence, which can contain 1 or more Sequence Commands. Note that a Sequence with only 1 Sequence Command is still wrapped in a Sequence message. </p>
<p>There is one more term: <strong>Observing Block</strong>. The Observing Block is an SOSS type that is usually defined as the &ldquo;smallest schedulable science entity&rdquo;. The Observing Block describes the observation using high level terms, and may contain a sequence of exposures, such as dither patterns. A Sequence is created from the Observing Block, including acquisition and configuration steps, before it is sent to the OCS.</p>
<p>In the OMO architecture, the Sequencer does most of its work in a scripting environment. For OCS, &ldquo;scripting&rdquo; means that the code of the Script is easier to write and update without requiring installation of a new software version. This is unlike Assemblies, HCDs, and applications that are compiled programs. The reason for this is to support flexible Sequencer arrangements and Scripts that are minimal and can change based on the observing mode. Operations experience shows that the most frequent software changes will happen in the Sequencer level and changes to lower level devices (i.e., Assemblies and HCDs) are less frequent and more disruptive. It makes sense to make it easier to change the software that changes most frequently. The use of scripts also has the advantage of allowing for an interactive environment that can be used during engineering and acceptance testing.</p>
<p>A Sequencer is created with a Script that may be specific to an observing or maintenance mode. Once the Sequencer is created with the specific Script it is able to execute Sequences for that mode. The specific Sequence Commands that may appear in a Sequence as input to a specific Sequencer/Script is the API for the Sequencer mode as defined in the ICD for the Sequencer/Script.</p>
<p>Each Sequence Command in a Sequence is handled by the Script&ndash;usually one step at a time. The Script examines each input Sequence Command and takes whatever actions are needed to match the demands specified in the command. The Script actions taken may include involved activities that include sending commands to subsystem Assemblies and receiving events. The commands and events used by the executing Script are the commands defined by the Assemblies in their ICDs. The Sequence Command may trigger a mode or state machine that operates after the Sequence Command completes.</p>
<p>The Sequencers needed for an observing mode form a hierarchy. The OMOA allows any arrangement of Sequencers for an observing mode, but the construction agreement is that there will be one or more Sequencers for each of the major subsystems with Scripts written by each subsystem team. For a typical AO-dependent observation such as with IRIS and NFIRAOS the Sequencers would include: OCS (master sequencer), AOESW, TCS, and an instrument such as IRIS.</p>
<p>The following figure shows all of the key discussion points of the previous paragraphs. This figure shows a simplified construction Sequencer hierarchy with OCS Master Sequencer, TCS Sequencer, and an Instrument Sequencer arranged in a hierarchy. Each Sequencer has a loaded Script. The Master Sequencer has received a Sequence and in processing that Sequence. It has sent Sequences to the TCS and INS Sequencers.</p>
<p><img src="../images/ocs/OCS-MultiLevel.png" alt="MultiLevel" /></p>
<p>Note that in this hierarchical arrangement, a Sequencer can send commands to Assemblies using CSW Command Service or, as with the OCS Master Sequencer, it can construct and send a Sequence within the Script. The point of this figure is to show that the OCS Master Sequencer may receive a long Sequence that it will process and will typically submit smaller Sequences of one or two Sequence Commands to sub-Sequencers and wait for completion before processing additional steps.</p>
<h2><a href="#sequencer-is-an-omoa-component" name="sequencer-is-an-omoa-component" class="anchor"><span class="anchor-link"></span></a>Sequencer is an OMOA Component</h2>
<p>Sequencers are OMOA components and must therefore contain the same basic functionality expected of all OMOA components. This includes:</p>
<ul>
  <li>Supporting the component lifecycle.</li>
  <li>Registering itself in the Location Service.</li>
  <li>Using CSW to communicate with other components.</li>
</ul>
<p>The core of each Sequencer is a Sequence Component, a reusable framework component which is used to construct a Sequencer as an OMOA component. Please refer <a href="../technical/sequence-component-tech.html">Sequencer Component</a> for details about Sequence Component.</p>
<p>All Sequencers use the same component framework. What makes a Sequencer unique is the Script with witch it was loaded. A Sequencer is a Sequence Component configured with a specific Script. The Script is written with a specific observing mode (or set of common observing modes) in mind. Behavior that is common to more than one observing mode can be defined in Scripts that can be shared and &ldquo;imported&rdquo; into other scripts (see <a href="../scripts/dsl/constructs/define-script.html#reusable-scripts">ReusableScripts</a>).</p>
<p>Which observing modes a Script can support is up to the developer, but the intention is that a Script can be developed independently of other Scripts to refine behavior specific to an observing mode, without affecting any other observing modes. In the future TMT operations phase, this will allow new observing modes to be added without necessarily impacting scripts that have been verified. It also makes maintenance easier because changes to verified scripts are easy to track and test. </p>
<p>Since the Script defines the behavior of the Sequencer, one can be written to support a simulation mode or a standalone mode, such that development and testing can be performed with a Sequencer handling real Sequences, but only simulating its actions. Scripts can also be created for special purposes such as testing Assemblies or HCDs in the lab.</p>
<h2><a href="#defining-observing-modes" name="defining-observing-modes" class="anchor"><span class="anchor-link"></span></a>Defining Observing Modes</h2>
<p>Observing modes are usually associated with instruments or engineering tasks. Observing modes must following the naming convention shown below:</p>
<pre><code>              &lt;system&gt;_&lt;modeName&gt;

                   IRIS_ifsonly
                   WFOS_darknight
                    ENG_pointingmap
</code></pre>
<p>The <code>&lt;system&gt;</code> indicates the system to which the observing mode applies to. This is typically the instrument subsystem used for the observations, but could be any subsystem or other tag (such as ENG) that identifies the observing mode. If a subsystem is used, it should be capitalized to conform with other subsystem uses. The <code>&lt;modeName&gt;</code> portion will generally also be part of the instrument configuration set in the observation planning tool. There are no restrictions on this name, but shorter is better. Any name can be used for testing. </p>
<h2><a href="#registering-sequencers-in-location-service" name="registering-sequencers-in-location-service" class="anchor"><span class="anchor-link"></span></a>Registering Sequencers in Location Service</h2>
<p>A Sequencer is a Sequence Component that has a script loaded. A Sequencer converts a Sequence Component, but the Sequence Component stays around. A Sequencer must be started specifying the subsystem for the Sequencer and the observing mode (as described above). </p>
<p>Like Sequence Components, Sequencers register themselves in the Location Service based on arguments used when they are started. The following table shows scenarios that may happen when the Sequence Manager starts Sequencers for an observing mode.</p>
<!-- Comment: span tag in Registered Location is to fix broken link error.
Use of @ sign makes it appear like an email, hence validateSite fails without span tag.
-->
<table>
  <thead>
    <tr>
      <th align="center">Sequence<br>Component Name </th>
      <th align="center">Sequencer Subsystem </th>
      <th align="center">Observing Mode</th>
      <th align="center">Registered Location </th>
      <th align="left">Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td align="center">ESW.ESW_77 </td>
      <td align="center">IRIS </td>
      <td align="center">IRIS_ifsonly </td>
      <td align="center">IRIS<span>@</span>IRIS_ifsonly </td>
      <td align="left">An IRIS instrument Sequencer running the IRIS script for the IRIS_ifsonly observing mode using the ESW.ESW_77 Sequence Component. </td>
    </tr>
    <tr>
      <td align="center">ESW.primary </td>
      <td align="center">ESW </td>
      <td align="center">IRIS_ifsonly </td>
      <td align="center">ESW<span>@</span>IRIS_ifsonly </td>
      <td align="left">An ESW Sequencer running the ESW script for the IRIS_ifsonly observing mode using the ESW.primary Sequence Component. </td>
    </tr>
  </tbody>
</table>
<p>As shown above, the observing mode is the instrument name and an instrument-specific label related to observing mode features. Each instrument includes its scripts inside its specific package. The subsystem and observing mode are used to lookup the correct script in the script repository. Once the Sequencer script is loaded in a Sequence Component, the Sequencer API exposes a <code>GetSequenceComponent</code> command which returns the Location of the Sequence Component allowing the Sequence Manager or other client to determine which Sequence Component is executing the observing mode script for a specific packageId.</p>
<p>The figure below shows the Sequence Component ESW_77 loading the IRIS instrument script for the IRIS_ifsonly observing mode.</p>
<p><img src="../images/ocs/OCS-SeqCompSeqNaming.png" alt="SequenceCompNaming" /></p>
<p>Once loaded, a client can ask the Sequence Component what Sequencer it is running using the <code>GetStatus</code> message. A client can ask what Sequence Component a Sequencer is running on using the <code>GetSequenceComponent</code> message. Both commands return a Location Service <code>Location</code>. The naming convention allows the following:</p>
<ol>
  <li>The Sequence Manager can search for all Sequencers related to an observing mode.</li>
  <li>The Sequence Manager can identify the Sequencer running a subsystem’s instrument observing mode script.</li>
  <li>The Sequence Manager can identify which Sequence Component is running a specific subsystem’s instrument observing mode.</li>
</ol>
<h2><a href="#sequencer-technical-design" name="sequencer-technical-design" class="anchor"><span class="anchor-link"></span></a>Sequencer Technical Design</h2>
<p>Details on the technical design of a Sequencer can be found here: <a href="../technical/sequencer-tech.html">Sequencer Technical Documentation</a>.</p>
<p>Details on the technical design of the Sequence Component can be found here: <a href="../technical/sequence-component-tech.html">Sequence Component Technical Documentation</a>.</p>
</div>
<div>
<a href="https://github.com/tmtsoftware/esw/tree/master/docs/src/main/sequencersandscripts/sequencer.md" title="Edit this page" class="md-source-file md-edit">
Edit this page
</a>
</div>
<div class="print-only">
<span class="md-source-file md-version">
0.1.0*
</span>
</div>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-nav">
<nav class="md-footer-nav__inner md-grid">
<a href="../sequencersandscripts/seq-index.html" title="Sequencers and Sequence Components" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
</div>
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Previous
</span>
Sequencers and Sequence Components
</span>
</div>
</a>
<a href="../sequencersandscripts/sequencer-app.html" title="Running a Sequencer Using ocs-app" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Next
</span>
Running a Sequencer Using ocs-app
</span>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
</div>
</a>
</nav>
</div>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
Powered by
<a href="https://github.com/lightbend/paradox">Paradox</a>
and
<a href="https://jonas.github.io/paradox-material-theme/">Paradox Material Theme</a>

</div>
</div>
</div>
</footer>

</div>
<script src="../assets/javascripts/application.583bbe55.js"></script>
<script src="../assets/javascripts/paradox-material-theme.js"></script>
<script>app.initialize({version:"0.17",url:{base:"../."}})</script>
<script type="text/javascript" src="../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function(event) {
window.prettyPrint && prettyPrint();
});
</script>
</body>
</html>
