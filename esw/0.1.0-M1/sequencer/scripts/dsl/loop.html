<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="description" content="docs">
<meta name="generator" content="Paradox, paradox-material-theme=0.6.0, mkdocs-material=3.0.3">

<meta name="lang:clipboard.copy" content="Copy to clipboard">
<meta name="lang:clipboard.copied" content="Copied to clipboard">
<meta name="lang:search.language" content="">
<meta name="lang:search.pipeline.stopwords" content="true">
<meta name="lang:search.pipeline.trimmer" content="true">
<meta name="lang:search.result.none" content="No matching documents">
<meta name="lang:search.result.one" content="1 matching document">
<meta name="lang:search.result.other" content="# matching documents">
<meta name="lang:search.tokenizer" content="[\s\-]+">


<meta name="description" content="docs">
<link rel="shortcut icon" href="../../../assets/tmt_favicon.ico">
<title>Loops Â· TMT Executive Software (ESW)</title>
<link rel="stylesheet" href="../../../assets/stylesheets/application.451f80e5.css">
<link rel="stylesheet" href="../../../lib/material__tabs/dist/mdc.tabs.min.css">
<link rel="stylesheet" href="../../../lib/prettify/prettify.css">
<script src="../../../assets/javascripts/modernizr.1aa3b519.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
<style>
body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}
code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}
</style>
<link rel="stylesheet" href="../../../assets/fonts/font-awesome.css">
<link rel="stylesheet" href="../../../assets/fonts/material-icons.css">
<link rel="stylesheet" href="../../../assets/stylesheets/paradox-material-theme.css">
</head>
<body
>
<input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
<input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
<label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
<header class="md-header" data-md-component="header">
<nav class="md-header-nav md-grid">
<div class="md-flex">
<div class="md-flex__cell md-flex__cell--shrink">
<a href="../../../index.html" title="TMT Executive Software (ESW)" class="md-header-nav__button md-logo">
<i class="md-icon">local_library</i>
</a>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
</div>
<div class="md-flex__cell md-flex__cell--stretch">
<div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
<span class="md-header-nav__topic">
TMT Executive Software (ESW)
</span>
<span class="md-header-nav__topic">
Loops
</span>
</div>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
<label class="md-icon md-search__icon" for="__search"></label>
<button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">&#xE5CD;</button>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix>
<div class="md-search-result" data-md-component="result">
<div class="md-search-result__meta">
Type to start searching
</div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>

</div>
<div class="md-flex__cell md-flex__cell--shrink">
<div class="md-header-nav__source">
<a href="https://github.com/tmtsoftware/esw"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
tmtsoftware/esw
</div>
</a>

</div>
</div>
</div>
</nav>
</header>

<div class="md-container">
<main class="md-main">
<div class="md-main__inner md-grid" data-md-component="container">
<div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--primary" data-md-level="0" style="visibility: hidden">
<label class="md-nav__title md-nav__title--site" for="drawer">
<a href="../../../index.html" title="TMT Executive Software (ESW)" class="md-nav__button md-logo">
<span class="md-nav__button md-logo">
<i class="md-icon">local_library</i>
</a>
<a href="../../../index.html" title="TMT Executive Software (ESW)">
TMT Executive Software (ESW)
</a>
</label>
<div class="md-nav__source">
<a href="https://github.com/tmtsoftware/esw"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
tmtsoftware/esw
</div>
</a>

</div>
<ul>
  <li><a href="../../../sequencer/state-transition.html" class="page">Sequencer State Transition</a></li>
  <li><a href="../../../sequencer/scripts/scripts.html" class="page">Sequencer Script</a>
  <ul>
    <li><a href="../../../sequencer/scripts/fsm.html" class="page">FSM</a></li>
    <li><a href="../../../sequencer/scripts/dsl/dsl.html" class="page">High Level DSL</a></li>
  </ul></li>
</ul>
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../../../sequencer/scripts/dsl/loop.html#loops" class="header">Loops</a>
  <ul>
    <li><a href="../../../sequencer/scripts/dsl/loop.html#loop-with-default-loop-interval" class="header">loop - With default loop interval</a></li>
    <li><a href="../../../sequencer/scripts/dsl/loop.html#loop-with-custom-minimum-loop-interval" class="header">loop - With custom minimum loop interval</a></li>
    <li><a href="../../../sequencer/scripts/dsl/loop.html#waitfor" class="header">waitFor</a></li>
    <li><a href="../../../sequencer/scripts/dsl/loop.html#loopasync-with-default-loop-interval" class="header">loopAsync - With default loop interval</a></li>
    <li><a href="../../../sequencer/scripts/dsl/loop.html#loopasync-with-custom-loop-interval" class="header">loopAsync - With custom loop interval</a></li>
    <li><a href="../../../sequencer/scripts/dsl/loop.html#source-code-for-examples" class="header">Source code for examples</a></li>
  </ul></li>
</ul>
</nav>

</nav>
<ul style="display: none">
<li class="md-nav__item md-version" id="project.version">
<label class="md-nav__link" for="__version">
<i class="md-icon" title="Version">label_outline</i> 0.1.0-M1
</label>
</li>
</ul>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../../../sequencer/scripts/dsl/loop.html#loops" class="header">Loops</a>
  <ul>
    <li><a href="../../../sequencer/scripts/dsl/loop.html#loop-with-default-loop-interval" class="header">loop - With default loop interval</a></li>
    <li><a href="../../../sequencer/scripts/dsl/loop.html#loop-with-custom-minimum-loop-interval" class="header">loop - With custom minimum loop interval</a></li>
    <li><a href="../../../sequencer/scripts/dsl/loop.html#waitfor" class="header">waitFor</a></li>
    <li><a href="../../../sequencer/scripts/dsl/loop.html#loopasync-with-default-loop-interval" class="header">loopAsync - With default loop interval</a></li>
    <li><a href="../../../sequencer/scripts/dsl/loop.html#loopasync-with-custom-loop-interval" class="header">loopAsync - With custom loop interval</a></li>
    <li><a href="../../../sequencer/scripts/dsl/loop.html#source-code-for-examples" class="header">Source code for examples</a></li>
  </ul></li>
</ul>
</nav>

</div>
</div>
</div>
<div class="md-content">
<article class="md-content__inner md-typeset">
<div class="md-content__searchable">
<h1><a href="#loops" name="loops" class="anchor"><span class="anchor-link"></span></a>Loops</h1>
<p>Script supports following multiple variations of loop DSL to satisfy different use cases:</p>
<ol>
  <li>loop</li>
  <li>waitFor</li>
  <li>loopAsync</li>
</ol>
<h2><a href="#loop-with-default-loop-interval" name="loop-with-default-loop-interval" class="anchor"><span class="anchor-link"></span></a>loop - With default loop interval</h2>
<p><code>loop</code> DSL allows you to start loop synchronously which means rest of the code written after loop will not be executed until <code>stopWhen</code> condition written inside loop becomes true. You can use this DSL when you want to iteratively perform some actions until certain condition becomes true. loop without providing any minimum interval uses default interval of <code>50 milliseconds</code>. Default <code>loopInterval</code>is used to reduce cpu contention.</p>
<p>Following example demonstrate the usage of <code>loop</code> DSL without providing custom loop interval. In the loop body, motor is being moved by 10 degrees in every iteration of the loop. Loop will be terminated when motor&rsquo;s current position reaches to expected position which is <code>100 degrees</code> in this case.</p>
<dl>
  <dt>Kotlin</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/esw/tree/master/examples/src/main/kotlin/esw/ocs/scripts/examples/paradox/LoopExample.kts#L60-L67" target="_blank" title="Go to snippet source"></a><code class="language-kts">val expectedMotorPosition = 100

// move motor by 10 degrees in each iteration, default loop interval is 50 millis
// stop loop when current motor position matches expected motor position and continue with the execution of rest of the handler
loop {
    moveMotor(10)
    stopWhen(motorPosition == expectedMotorPosition)
}</code></pre></dd>
</dl>
<h2><a href="#loop-with-custom-minimum-loop-interval" name="loop-with-custom-minimum-loop-interval" class="anchor"><span class="anchor-link"></span></a>loop - With custom minimum loop interval</h2>
<p><code>loop</code> DSL allows you to provide minimum loop interval and starts loop synchronously. Every iteration of loop will at least wait for minimum provided interval before executing next iteration.</p>
<p>Following example demonstrate the usage of <code>loop</code> DSL by providing custom loop interval.</p>
<dl>
  <dt>Kotlin</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/esw/tree/master/examples/src/main/kotlin/esw/ocs/scripts/examples/paradox/LoopExample.kts#L71-L76" target="_blank" title="Go to snippet source"></a><code class="language-kts">// move motor by 20 degrees in every iteration after a loop interval of 100 millis (custom loop interval used here)
// stop loop when current motor position matches expected motor position and continue with the execution of rest of the handler
loop(minInterval = 100.milliseconds) {
    moveMotor(20)
    stopWhen(motorPosition == expectedMotorPosition)
}</code></pre></dd>
</dl><div class="callout note "><div class="callout-title">Note</div>
<p><code>minInterval</code> needs to be greater than default interval of <code>50 milliseconds</code> otherwise it will be ignored and default loop interval will be used.</p></div>
<h2><a href="#waitfor" name="waitfor" class="anchor"><span class="anchor-link"></span></a>waitFor</h2>
<p>This is a specialized version of loop and satisfies simple use cases where you want to semantically block the execution until certain condition becomes true.</p>
<p>In the following example, <code>initializeMotor</code> method will start the initialization and eventually set <code>motorUp</code> flag to true indicating motor is successfully initialized. <code>waitFor { motorUp }</code> will check the value of <code>motorUp</code> flag every <code>50 milliseconds</code> and if it is true then rest of the code execution will continue. </p>
<dl>
  <dt>Kotlin</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/esw/tree/master/examples/src/main/kotlin/esw/ocs/scripts/examples/paradox/LoopExample.kts#L48-L51" target="_blank" title="Go to snippet source"></a><code class="language-kts">// start initializing motor and this method will set motorUp flag to true once initialization is successful
initializeMotor()
// pauses the init-motor command handlers execution until motor becomes up
waitFor { motorUp }</code></pre></dd>
</dl>
<h2><a href="#loopasync-with-default-loop-interval" name="loopasync-with-default-loop-interval" class="anchor"><span class="anchor-link"></span></a>loopAsync - With default loop interval</h2>
<p><code>loopAsync</code> DSL allows you to start loop asynchronously in the background which means rest of the code written after <code>loopAsync</code> will be executed concurrently. <code>loopAsync</code> will be terminated when <code>stopWhen</code> condition written inside loop becomes true.</p>
<p>You can use this DSL when you want to iteratively perform some actions in the background. loopAsync without providing any minimum interval uses default interval of <code>50 milliseconds</code>.</p>
<p>Following example demonstrate the usage of <code>loopAsync</code> DSL without providing custom loop interval. In the loop body, current temperature is published every <code>50 milliseconds</code>. LoopAsync will be terminated when <code>stopPublishingTemperature</code> flag becomes true and this is set to true in <code>onStop</code> handler.</p>
<dl>
  <dt>Kotlin</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/esw/tree/master/examples/src/main/kotlin/esw/ocs/scripts/examples/paradox/LoopExample.kts#L29-L34" target="_blank" title="Go to snippet source"></a><code class="language-kts">// start background loop which publishes current temperature of motor every 50 milliseconds (default loop interval)
loopAsync {
    val currentTemp = getCurrentTemp()
    publishEvent(temperatureEvent.add(temperatureKey.set(currentTemp)))
    stopWhen(stopPublishingTemperature)
}</code></pre></dd>
</dl>
<h2><a href="#loopasync-with-custom-loop-interval" name="loopasync-with-custom-loop-interval" class="anchor"><span class="anchor-link"></span></a>loopAsync - With custom loop interval</h2>
<p><code>loopAsync</code> DSL allows you to provide minimum loop interval and start loop asynchronously. Every iteration of loopAsync will at least wait for minimum provided interval before executing next iteration.</p>
<p>Following example demonstrate the usage of <code>loopAsync</code> DSL by providing custom loop interval.</p>
<dl>
  <dt>Kotlin</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/tmtsoftware/esw/tree/master/examples/src/main/kotlin/esw/ocs/scripts/examples/paradox/LoopExample.kts#L38-L43" target="_blank" title="Go to snippet source"></a><code class="language-kts">// start background loop which publishes current temperature of motor every 100 milliseconds
loopAsync(minInterval = 100.milliseconds) {
    val currentTemp = getCurrentTemp()
    publishEvent(temperatureEvent.add(temperatureKey.set(currentTemp)))
    stopWhen(stopPublishingTemperature)
}</code></pre></dd>
</dl>
<h2><a href="#source-code-for-examples" name="source-code-for-examples" class="anchor"><span class="anchor-link"></span></a>Source code for examples</h2>
<ul>
  <li><a href="https://github.com/tmtsoftware/esw/blob/v0.1.0-M1/examples/src/main/kotlin/esw/ocs/scripts/examples/paradox/LoopExample.kts">Loop Examples</a></li>
</ul>
</div>
<div>
<a href="https://github.com/tmtsoftware/esw/tree/master/docs/src/main/sequencer/scripts/dsl/loop.md" title="Edit this page" class="md-source-file md-edit">
Edit this page
</a>
</div>
<div class="print-only">
<span class="md-source-file md-version">
0.1.0-M1
</span>
</div>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-nav">
<nav class="md-footer-nav__inner md-grid">
<a href="../../../sequencer/scripts/dsl/handlers.html" title="Script Handlers" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
</div>
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Previous
</span>
Script Handlers
</span>
</div>
</a>
<a href="../../../sequencer/scripts/dsl/misc.html" title="Misc" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Next
</span>
Misc
</span>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
</div>
</a>
</nav>
</div>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
Powered by
<a href="https://github.com/lightbend/paradox">Paradox</a>
and
<a href="https://jonas.github.io/paradox-material-theme/">Paradox Material Theme</a>

</div>
</div>
</div>
</footer>

</div>
<script src="../../../assets/javascripts/application.583bbe55.js"></script>
<script src="../../../assets/javascripts/paradox-material-theme.js"></script>
<script>app.initialize({version:"0.17",url:{base:"../../../."}})</script>
<script type="text/javascript" src="../../../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../../../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function(event) {
window.prettyPrint && prettyPrint();
});
</script>
</body>
</html>
