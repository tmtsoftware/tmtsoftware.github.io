<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="description" content="docs">
<meta name="generator" content="Paradox, paradox-material-theme=0.7.0, mkdocs-material=3.0.3">

<meta name="lang:clipboard.copy" content="Copy to clipboard">
<meta name="lang:clipboard.copied" content="Copied to clipboard">
<meta name="lang:search.language" content="">
<meta name="lang:search.pipeline.stopwords" content="true">
<meta name="lang:search.pipeline.trimmer" content="true">
<meta name="lang:search.result.none" content="No matching documents">
<meta name="lang:search.result.one" content="1 matching document">
<meta name="lang:search.result.other" content="# matching documents">
<meta name="lang:search.tokenizer" content="[\s\-]+">


<meta name="description" content="docs">
<link rel="shortcut icon" href="../assets/tmt_favicon.ico">
<title>Sequencer Script Styles Â· TMT Executive Software Documentation</title>
<link rel="stylesheet" href="../assets/stylesheets/application.451f80e5.css">
<link rel="stylesheet" href="../lib/material__tabs/dist/mdc.tabs.min.css">
<link rel="stylesheet" href="../lib/prettify/prettify.css">
<script src="../assets/javascripts/modernizr.1aa3b519.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
<style>
body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}
code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}
</style>
<link rel="stylesheet" href="../assets/fonts/font-awesome.css">
<link rel="stylesheet" href="../assets/fonts/material-icons.css">
<link rel="stylesheet" href="../assets/stylesheets/paradox-material-theme.css">
<link rel="stylesheet" href="../assets/custom.css">
</head>
<body
>
<input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
<input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
<label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
<header class="md-header" data-md-component="header">
<nav class="md-header-nav md-grid">
<div class="md-flex">
<div class="md-flex__cell md-flex__cell--shrink">
<a href="../index.html" title="TMT Executive Software Documentation" class="md-header-nav__button md-logo">
<i class="md-icon">local_library</i>
</a>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
</div>
<div class="md-flex__cell md-flex__cell--stretch">
<div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
<span class="md-header-nav__topic">
TMT Executive Software Documentation
</span>
<span class="md-header-nav__topic">
Sequencer Script Styles
</span>
</div>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
<label class="md-icon md-search__icon" for="__search"></label>
<button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">&#xE5CD;</button>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix>
<div class="md-search-result" data-md-component="result">
<div class="md-search-result__meta">
Type to start searching
</div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>

</div>
<div class="md-flex__cell md-flex__cell--shrink">
<div class="md-header-nav__source">
<a href="https://github.com/tmtsoftware/esw"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
tmtsoftware/esw
</div>
</a>

</div>
</div>
</div>
</nav>
</header>

<div class="md-container">
<main class="md-main">
<div class="md-main__inner md-grid" data-md-component="container">
<div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--primary" data-md-level="0" style="visibility: hidden">
<label class="md-nav__title md-nav__title--site" for="drawer">
<a href="../index.html" title="TMT Executive Software Documentation" class="md-nav__button md-logo">
<span class="md-nav__button md-logo">
<i class="md-icon">local_library</i>
</a>
<a href="../index.html" title="TMT Executive Software Documentation">
TMT Executive Software Documentation
</a>
</label>
<div class="md-nav__source">
<a href="https://github.com/tmtsoftware/esw"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
tmtsoftware/esw
</div>
</a>

</div>
<ul>
  <li><a href="../esw/eswOverview.html" class="page">Executive Software Overview</a></li>
  <li><a href="../sequencersandscripts/seq-index.html" class="page">Sequencers and Sequence Components</a>
  <ul>
    <li><a href="../sequencersandscripts/sequencer.html" class="page">Sequencers in the Executive Software</a></li>
    <li><a href="../sequencersandscripts/sequencer-app.html" class="page">Running a Sequencer Using esw-ocs-app</a></li>
  </ul></li>
  <li><a href="../scripts/scripts-index.html" class="page">Sequencer Scripts</a>
  <ul>
    <li><a href="../scripts/script-styles.html" class="active page">Sequencer Script Styles</a></li>
    <li><a href="../scripts/dsl/script-constructs.html" class="page">Script DSL Constructs</a></li>
    <li><a href="../scripts/dsl/csw-services.html" class="page">CSW Services DSL</a></li>
  </ul></li>
  <li><a href="../uisupport/uisupp-index.html" class="page">User Interface Support</a>
  <ul>
    <li><a href="../uisupport/UIOverview.html" class="page">User Interfaces in ESW and TMT</a></li>
    <li><a href="../uisupport/gatewayUI-template.html" class="page">Using the Gateway-only UI Template and Tutorial</a></li>
    <li><a href="../uisupport/webapp-template.html" class="page">Using the Web Application Template and Tutorial</a></li>
    <li><a href="../uisupport/gateway.html" class="page">User Interface Gateway</a></li>
  </ul></li>
  <li><a href="../technical/apps/apps-index.html" class="page">ESW Applications</a>
  <ul>
    <li><a href="../technical/apps/getting-apps.html" class="page">Getting and Running ESW Applications</a></li>
    <li><a href="../technical/apps/esw-shell.html" class="page">ESW Shell - A Testing Environment for ESW and CSW</a></li>
    <li><a href="../technical/apps/sequence-manager-app.html" class="page">Starting the Sequence Manager Application</a></li>
    <li><a href="../technical/apps/agent-service-app.html" class="page">The Agent Service Application</a></li>
    <li><a href="../technical/apps/agent-app.html" class="page">The Agent Application</a></li>
    <li><a href="../uisupport/gateway-app.html" class="page">Running the UI Gateway App</a></li>
    <li><a href="../technical/apps/esw-services.html" class="page">Running Multiple ESW Applications with esw-services</a></li>
    <li><a href="../technical/apps/eng-ui.html" class="page">ESW OCS Engineering User Interface User Manual</a></li>
  </ul></li>
  <li><a href="../technical/tech-index.html" class="page">Technical Design Documents</a>
  <ul>
    <li><a href="../technical/sequence-manager-tech.html" class="page">Sequence Manager Technical Documentation</a></li>
    <li><a href="../technical/sequencer-tech.html" class="page">Sequencer Technical Documentation</a></li>
    <li><a href="../technical/sequence-component-tech.html" class="page">Sequence Component Technical Documentation</a></li>
    <li><a href="../technical/gateway-tech.html" class="page">Gateway Technical Documentation</a></li>
    <li><a href="../technical/agent-service-tech.html" class="page">Agent Service and Agent Technical Documentation</a></li>
    <li><a href="../technical/esw-application-parts.html" class="page">ESW Application Architecture</a></li>
    <li><a href="../technical/contracts.html" class="page">Service Contracts</a></li>
    <li><a href="../technical/testing-philosophy.html" class="page">OSW Testing Philosophy</a></li>
  </ul></li>
</ul>
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../scripts/script-styles.html#sequencer-script-styles" class="header">Sequencer Script Styles</a>
  <ul>
    <li><a href="../scripts/script-styles.html#handler-oriented-scripts" class="header">Handler-Oriented Scripts</a></li>
    <li><a href="../scripts/script-styles.html#state-machine-oriented-scripts" class="header">State Machine-Oriented Scripts</a></li>
    <li><a href="../scripts/script-styles.html#mixing-the-two-styles" class="header">Mixing the Two Styles</a></li>
  </ul></li>
</ul>
</nav>

</nav>
<ul style="display: none">
<li class="md-nav__item md-version" id="project.version">
<label class="md-nav__link" for="__version">
<i class="md-icon" title="Version">label_outline</i> 0.5.0-RC1
</label>
</li>
</ul>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../scripts/script-styles.html#sequencer-script-styles" class="header">Sequencer Script Styles</a>
  <ul>
    <li><a href="../scripts/script-styles.html#handler-oriented-scripts" class="header">Handler-Oriented Scripts</a></li>
    <li><a href="../scripts/script-styles.html#state-machine-oriented-scripts" class="header">State Machine-Oriented Scripts</a></li>
    <li><a href="../scripts/script-styles.html#mixing-the-two-styles" class="header">Mixing the Two Styles</a></li>
  </ul></li>
</ul>
</nav>

</div>
</div>
</div>
<div class="md-content">
<article class="md-content__inner md-typeset">
<div class="md-content__searchable">
<h1><a href="#sequencer-script-styles" name="sequencer-script-styles" class="anchor"><span class="anchor-link"></span></a>Sequencer Script Styles</h1>
<p>Scripts can be written in two styles: handler-oriented or state machine-oriented. The choice is determined by how the developer wants their Sequencer to work.</p>
<h3><a href="#handler-oriented-scripts" name="handler-oriented-scripts" class="anchor"><span class="anchor-link"></span></a>Handler-Oriented Scripts</h3>
<p>A handler-oriented script is specified with command-handlers at the top-level scope of the script. There is a command-handler associated with every possible Setup or Observe that a received Sequence can contain. The developer can use mutable variables in the script to keep track of the state of the Sequencer script.</p>
<p>A handler-oriented script must be started using the <code>script</code> keyword indicating a scope. The following brief example shows the structure of a handler-oriented script.</p>
<pre><code>script {
    val wfosSequencer = Sequencer(WFOS, &quot;wfos.bluearm&quot;, Duration.seconds(10))
    val wfosBlueDetAssembly = Assembly(WFOS, &quot;blueDetectorAssembly&quot;, Duration.seconds(10))
    var wfosState = IDLE

    onSetup(&quot;wfos-command-1&quot;) {
      // Start actions for wfos-command-1
      wfosState = BUSY 
    }

    onSetup(&quot;wfos-command-2&quot;) {
      // Start actions for wfos-command-2
      if (wfosState == BUSY) {
        // Reject
      } else {
        // Do some IDLE action
    }
}
</code></pre>
<p>This example shows two Setup handlers. One for <code>wfos-command-1</code> and one for <code>wfos-command-2</code>. These names are compared with the <code>CommandName</code> fields of incoming Setups in the Sequence. Note that the <code>var</code> represents internal state. The command-handlers must maintain their state and perform checks as needed to properly handle commands. Code can also be added outside of handlers. This code will be run when the script is loaded. This can be used to, for example, set up subscriptions to Events which can be manually associated with internal state variables or other actions.</p>
<p>More information on handlers is available <a href="dsl/constructs/handlers.html">here</a>.</p>
<h3><a href="#state-machine-oriented-scripts" name="state-machine-oriented-scripts" class="anchor"><span class="anchor-link"></span></a>State Machine-Oriented Scripts</h3>
<p>A State Machine-oriented Script models the entire script as a state machine. The script developer writes a number of <code>state</code> entries that make sense for the Sequencer. Logic can be tied to events or commands. Within a <code>state</code> one can define command handlers to process Sequence steps. The command handlers within a <code>state</code> only work when the state machine is in that state. </p>
<p>A state machine-oriented script must start with the FsmScript keyword. The argument of FsmScript is the initial state machine state. Like handler-oriented scripts, state machine-oriented scripts can contain state that can be shared across states. The following example shows the most important features of an FsmScript. </p>
<pre><code>FsmScript(&quot;OFF&quot;) {

    state(&quot;ON&quot;) { params -&gt;

        onSetup(&quot;turn-off&quot;) {
            turnOffLight()
            become(&quot;OFF&quot;) 
        }
    }

    state(&quot;OFF&quot;) {

        onSetup(&quot;turn-on&quot;) { command -&gt;
            turnOnLight()
            become(&quot;ON&quot;, command.params)
        }
    }

}

</code></pre>
<p>In this script, the states called <em>ON</em> and <em>OFF</em> are defined. The initial state is <em>OFF</em>. In the <em>ON</em> state, the script can process the <em>turn-off</em> command. It executes the <code>turnOffLife</code> function and switches to the ON state using the <code>become</code> keyword.</p>
<p>More information about state machine-oriented scripts is <a href="dsl/constructs/fsm.html">here</a>. </p>
<h3><a href="#mixing-the-two-styles" name="mixing-the-two-styles" class="anchor"><span class="anchor-link"></span></a>Mixing the Two Styles</h3>
<p>A handler-oriented script can include finite state machines. The top-level script is not modeled as a state machine, but the command handlers and script can include one or more state machines and can launch them when a command is received.</p>
<p>A state machine-oriented script can receive commands with handlers as shown in the example above. A state machine-oriented script can start/stop/control other finite state machines as it processes the top-level state machine.</p>
<!-- we should include an example of this.  how are the script and FsmScript tags used? -->
</div>
<div>
<a href="https://github.com/tmtsoftware/esw/tree/bc4c382183b81784c465eb12bb2a9f57de547c43/docs/src/main/scripts/script-styles.md" title="Edit this page" class="md-source-file md-edit">
Edit this page
</a>
</div>
<div class="print-only">
<span class="md-source-file md-version">
0.5.0-RC1
</span>
</div>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-nav">
<nav class="md-footer-nav__inner md-grid">
<a href="../scripts/scripts-index.html" title="Sequencer Scripts" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
</div>
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Previous
</span>
Sequencer Scripts
</span>
</div>
</a>
<a href="../scripts/dsl/script-constructs.html" title="Script DSL Constructs" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Next
</span>
Script DSL Constructs
</span>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
</div>
</a>
</nav>
</div>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
Powered by
<a href="https://github.com/lightbend/paradox">Paradox</a>
and
<a href="https://jonas.github.io/paradox-material-theme/">Paradox Material Theme</a>

</div>
</div>
</div>
</footer>

</div>
<script src="../assets/javascripts/application.583bbe55.js"></script>
<script src="../assets/javascripts/paradox-material-theme.js"></script>
<script>app.initialize({version:"0.17",url:{base:"../."}})</script>
<script type="text/javascript" src="../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function(event) {
window.prettyPrint && prettyPrint();
});
</script>
</body>
</html>
