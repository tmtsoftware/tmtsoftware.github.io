<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="description" content="docs">
<meta name="generator" content="Paradox, paradox-material-theme=0.7.0, mkdocs-material=3.0.3">

<meta name="lang:clipboard.copy" content="Copy to clipboard">
<meta name="lang:clipboard.copied" content="Copied to clipboard">
<meta name="lang:search.language" content="">
<meta name="lang:search.pipeline.stopwords" content="true">
<meta name="lang:search.pipeline.trimmer" content="true">
<meta name="lang:search.result.none" content="No matching documents">
<meta name="lang:search.result.one" content="1 matching document">
<meta name="lang:search.result.other" content="# matching documents">
<meta name="lang:search.tokenizer" content="[\s\-]+">


<meta name="description" content="docs">
<link rel="shortcut icon" href="../assets/tmt_favicon.ico">
<title>Adding Event Subscription Â· Gateway UI Application Tutorial</title>
<link rel="stylesheet" href="../assets/stylesheets/application.451f80e5.css">
<link rel="stylesheet" href="../lib/material__tabs/dist/mdc.tabs.min.css">
<link rel="stylesheet" href="../lib/prettify/prettify.css">
<script src="../assets/javascripts/modernizr.1aa3b519.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
<style>
body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}
code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}
</style>
<link rel="stylesheet" href="../assets/fonts/font-awesome.css">
<link rel="stylesheet" href="../assets/fonts/material-icons.css">
<link rel="stylesheet" href="../assets/stylesheets/paradox-material-theme.css">
<link rel="stylesheet" href="../assets/custom.css">
</head>
<body
>
<input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
<input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
<label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
<header class="md-header" data-md-component="header">
<nav class="md-header-nav md-grid">
<div class="md-flex">
<div class="md-flex__cell md-flex__cell--shrink">
<a href="../index.html" title="Gateway UI Application Tutorial" class="md-header-nav__button md-logo">
<i class="md-icon">local_library</i>
</a>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
</div>
<div class="md-flex__cell md-flex__cell--stretch">
<div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
<span class="md-header-nav__topic">
Gateway UI Application Tutorial
</span>
<span class="md-header-nav__topic">
Adding Event Subscription
</span>
</div>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
<label class="md-icon md-search__icon" for="__search"></label>
<button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">&#xE5CD;</button>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix>
<div class="md-search-result" data-md-component="result">
<div class="md-search-result__meta">
Type to start searching
</div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>

</div>
<div class="md-flex__cell md-flex__cell--shrink">
<div class="md-header-nav__source">
<a href="https://github.com/tmtsoftware/esw-gateway-ui-example"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
tmtsoftware/esw-gateway-ui-example
</div>
</a>

</div>
</div>
</div>
</nav>
</header>

<div class="md-container">
<main class="md-main">
<div class="md-main__inner md-grid" data-md-component="container">
<div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--primary" data-md-level="0" style="visibility: hidden">
<label class="md-nav__title md-nav__title--site" for="drawer">
<a href="../index.html" title="Gateway UI Application Tutorial" class="md-nav__button md-logo">
<span class="md-nav__button md-logo">
<i class="md-icon">local_library</i>
</a>
<a href="../index.html" title="Gateway UI Application Tutorial">
Gateway UI Application Tutorial
</a>
</label>
<div class="md-nav__source">
<a href="https://github.com/tmtsoftware/esw-gateway-ui-example"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
tmtsoftware/esw-gateway-ui-example
</div>
</a>

</div>
<ul>
  <li><a href="../flows/base-flow.html" class="page">Creating Gateway UI Application</a></li>
  <li><a href="../flows/submit-commands.html" class="page">Adding a Submit Command</a></li>
  <li><a href="../flows/subscribe-event.html" class="active page">Adding Event Subscription</a></li>
  <li><a href="../flows/docs-flow.html" class="page">Adding Paradox Documentation</a></li>
</ul>
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../flows/subscribe-event.html#adding-event-subscription" class="header">Adding Event Subscription</a>
  <ul>
    <li><a href="../flows/subscribe-event.html#add-a-subscribe-event-component" class="header">Add a Subscribe Event Component</a></li>
    <li><a href="../flows/subscribe-event.html#integrate-subscribeevent-component" class="header">Integrate SubscribeEvent Component</a></li>
    <li><a href="../flows/subscribe-event.html#publish-events-using-esw-shell" class="header">Publish events using esw-shell</a></li>
  </ul></li>
</ul>
</nav>

</nav>
<ul style="display: none">
<li class="md-nav__item md-version" id="project.version">
<label class="md-nav__link" for="__version">
<i class="md-icon" title="Version">label_outline</i> 0.1.0*
</label>
</li>
</ul>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../flows/subscribe-event.html#adding-event-subscription" class="header">Adding Event Subscription</a>
  <ul>
    <li><a href="../flows/subscribe-event.html#add-a-subscribe-event-component" class="header">Add a Subscribe Event Component</a></li>
    <li><a href="../flows/subscribe-event.html#integrate-subscribeevent-component" class="header">Integrate SubscribeEvent Component</a></li>
    <li><a href="../flows/subscribe-event.html#publish-events-using-esw-shell" class="header">Publish events using esw-shell</a></li>
  </ul></li>
</ul>
</nav>

</div>
</div>
</div>
<div class="md-content">
<article class="md-content__inner md-typeset">
<div class="md-content__searchable">
<h1><a href="#adding-event-subscription" name="adding-event-subscription" class="anchor"><span class="anchor-link"></span></a>Adding Event Subscription</h1>
<p>In this part of the tutorial, we want to add the ability to subscribe to an Event published through the Event Service and display the results. We will be using the esw-shell utility to publish a SystemEvent every 2 seconds to the Event Service.</p>
<p>This section of the app will display a form at the top to specify which event to subscribe to and a table below it showing a list of received values.</p>
<p>Visit <a href="https://tmtsoftware.github.io/csw/5.1.0/params/events.html">here</a> to learn more about events.</p>
<h2><a href="#add-a-subscribe-event-component" name="add-a-subscribe-event-component" class="anchor"><span class="anchor-link"></span></a>Add a Subscribe Event Component</h2>
<p>Create a <code>SubscribeEvent.tsx</code> file in <code>src/components</code> folder.</p>
<p>In this tutorial, we will build up the SubscribeEvent component gradually. </p><div class="callout note "><div class="callout-title">Note</div>
<p>You can refer the source code of the completed application at any point in the course of this tutorial. You can find it <a href="https://github.com/tmtsoftware/esw-gateway-ui-example">here</a></p></div>
<p>Start with the following code, which defines the component, enables authorization, and creates a base Card component to put our other components in. </p>
<dl>
  <dt>Typescript</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/esw-gateway-ui-example/tree/master/src/components/SubscribeEvent.tsx#L24-L138" target="_blank" title="Go to snippet source">source</a><code class="language-tsx">export const SubscribeEvent = ({
  _eventService
}: {
  _eventService?: EventService
}): JSX.Element =&gt; {
  const { auth } = useAuth()
  const authData = { tokenFactory: () =&gt; auth?.token() }
  return (
    &lt;Card
      style={{
        maxWidth: &#39;30rem&#39;,
        maxHeight: &#39;45rem&#39;
      }}
      title={
        &lt;Typography.Title level={2}&gt;Subscribe Event Example&lt;/Typography.Title&gt;
      }&gt;
    &lt;/Card&gt;
  )
}</code></pre></dd>
</dl>
<p>Next, we will add a form to take input from the user.</p>
<p>Add the following in the <code>SubscribeEvent</code> component inside the <code>&lt;Card&gt;</code> component just below the <code>title</code> attribute.</p>
<dl>
  <dt>Typescript</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/esw-gateway-ui-example/tree/master/src/components/SubscribeEvent.tsx#L94-L123" target="_blank" title="Go to snippet source">source</a><code class="language-tsx">&lt;Form
  onFinish={() =&gt; {
    subscription ? unSubscribe() : subscribe()
  }}&gt;
  &lt;Form.Item label=&#39;Source Prefix&#39;&gt;
    &lt;Input
      role=&#39;SourcePrefix&#39;
      value={prefix}
      placeholder=&#39;ESW.assembly123&#39;
      onChange={(e) =&gt; setPrefix(e.target.value)}
    /&gt;
  &lt;/Form.Item&gt;
  &lt;Form.Item label=&#39;Event Keyname&#39;&gt;
    &lt;Input
      role=&#39;keyName&#39;
      value={keyName}
      placeholder=&#39;counterEvent&#39;
      onChange={(e) =&gt; setKeyName(e.target.value)}
    /&gt;
  &lt;/Form.Item&gt;
  &lt;Form.Item wrapperCol={{ offset: 16, span: 16 }}&gt;
    &lt;Button
      role=&#39;subscribe&#39;
      onClick={() =&gt; (subscription ? unSubscribe() : subscribe())}
      type=&#39;primary&#39;
      disabled={keyName === &#39;&#39;}&gt;
      {subscription ? &#39;UnSubscribe&#39; : &#39;Subscribe&#39;}
    &lt;/Button&gt;
  &lt;/Form.Item&gt;
&lt;/Form&gt;</code></pre></dd>
</dl>
<p>This Form includes the following items:</p>
<ul>
  <li>SourcePrefix - A free text input box for putting Source Prefix of the desired subscription.</li>
  <li>Event KeyName - A free text input box for putting Event&rsquo;s keyname of the desired subscription.</li>
  <li>Subscribe - A button for creating subscription. It gets toggled to <code>UnSubscribe</code> on when the subscription is  successfully started.</li>
</ul>
<p>Next, we will add the React state hooks for storing and setting the values of these components:</p>
<p>Add the following snippet in the SubscribeEvent component below the <code>authData</code> react state, above the return statement.</p>
<dl>
  <dt>Typescript</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/esw-gateway-ui-example/tree/master/src/components/SubscribeEvent.tsx#L33-L36" target="_blank" title="Go to snippet source">source</a><code class="language-tsx">const [prefix, setPrefix] = useState(&#39;&#39;)
const [keyName, setKeyName] = useState(&#39;&#39;)
const [events, setEvents] = useState&lt;Event[]&gt;([])
const [subscription, setSubscription] = useState&lt;Subscription&gt;()</code></pre></dd>
</dl>
<p>The <code>onFinish</code> attribute of the form component specifies the method to be called when the form is submitted. We have specified this to be the <code>subscribe</code> method. We will implement this now. </p>
<p>This method makes use of the ESW-TS <a href="https://tmtsoftware.github.io/esw-ts/services/event-service.html">Event Service</a> Typescript client which provides access to the Event Service through the Event Service routes of the Gateway. In this method, we call the <code>subscribe</code> API of the Event Service to create a subscription using a callback. The callback method <code>handleEvent</code>, defined at the top of this block, gets triggered whenever an event is received on that subscription.</p>
<p>We also define an unsubscribe function which cancels the subscription through the ESW-TS client.</p>
<p>Define these functions following the React state hooks inside component.</p>
<dl>
  <dt>Typescript</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/esw-gateway-ui-example/tree/master/src/components/SubscribeEvent.tsx#L40-L63" target="_blank" title="Go to snippet source">source</a><code class="language-tsx">const handleEvent = (event: Event) =&gt; {
  if (event.eventId !== &#39;-1&#39;) {
    setEvents((events) =&gt; [...events, event])
  } else {
    message.error(`Event: ${event.eventName.name} is invalid`)
  }
}
const unSubscribe = () =&gt; {
  subscription?.cancel()
  setSubscription(undefined)
}
const subscribe = async () =&gt; {
  const eventServices = _eventService
    ? _eventService
    : await EventService(authData)

  const subscription = eventServices.subscribe(
    new Set([
      new EventKey(Prefix.fromString(prefix), new EventName(keyName))
    ]),
    1
  )(handleEvent)
  setSubscription(subscription)
}</code></pre></dd>
</dl>
<p>Now we have fully added the functionality of subscribing to an event. The <code>events</code> state variable maintains a list of all received events, so events received in the callback are added to this list. </p>
<p>We will use an Antd Table component to display the values in the <code>event</code> state variable.</p>
<p>First, we will define the columns in the table. Add the following code above the return statement:</p>
<dl>
  <dt>Typescript</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/esw-gateway-ui-example/tree/master/src/components/SubscribeEvent.tsx#L66-L80" target="_blank" title="Go to snippet source">source</a><code class="language-tsx">const columns = [
  {
    title: &#39;Event Name&#39;,
    dataIndex: &#39;eventName&#39;,
    render: (eventName: EventName) =&gt; eventName.name
  },
  {
    title: &#39;Values&#39;,
    // eslint-disable-next-line react/display-name
    render: (_: string, event: Event) =&gt; {
      const counterParam = event.get(intKey(&#39;counter&#39;)) ?? { values: [] }
      return &lt;span&gt;{counterParam.values.join(&#39;,&#39;)}&lt;/span&gt;
    }
  }
]</code></pre></dd>
</dl>
<p>Add this final piece to our UI component below the <code>Form</code> component to visualize the received events.</p>
<dl>
  <dt>Typescript</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/esw-gateway-ui-example/tree/master/src/components/SubscribeEvent.tsx#L127-L133" target="_blank" title="Go to snippet source">source</a><code class="language-tsx">&lt;Table
  scroll={{ y: 240 }}
  pagination={false}
  rowKey={(e) =&gt; e.eventId}
  dataSource={events}
  columns={columns}
/&gt;</code></pre></dd>
</dl>
<p>At this point, make sure to add appropriate imports to the file. The should look something like this:</p>
<dl>
  <dt>Typescript</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/esw-gateway-ui-example/tree/master/src/components/SubscribeEvent.tsx#L2-L21" target="_blank" title="Go to snippet source">source</a><code class="language-tsx">import {
  EventKey,
  EventName,
  EventService,
  intKey,
  Prefix
} from &#39;@tmtsoftware/esw-ts&#39;
import type { Event, Subscription } from &#39;@tmtsoftware/esw-ts&#39;
import {
  Button,
  Card,
  Divider,
  Form,
  Input,
  message,
  Table,
  Typography
} from &#39;antd&#39;
import React, { useState } from &#39;react&#39;
import { useAuth } from &#39;../hooks/useAuth&#39;</code></pre></dd>
</dl>
<h2><a href="#integrate-subscribeevent-component" name="integrate-subscribeevent-component" class="anchor"><span class="anchor-link"></span></a>Integrate SubscribeEvent Component</h2>
<p>Finally, update Main.tsx to include <code>SubscribeEvent</code> component.</p>
<p>Add the following <code>&lt;SubscribeEvent /&gt;</code> immediately after the <code>&lt;SubmitCommand /&gt;</code> component inside <code>&lt;div&gt;</code>. Update imports as needed.</p>
<dl>
  <dt>Typescript</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/esw-gateway-ui-example/tree/master/src/components/Main.tsx#L8-L32" target="_blank" title="Go to snippet source">source</a><code class="language-tsx">import { SubscribeEvent } from &#39;./SubscribeEvent&#39;
export const Main = (): JSX.Element =&gt; {
  const { auth } = useAuth()
  if (!auth) return &lt;div&gt;Loading&lt;/div&gt;
  const isAuthenticated = auth?.isAuthenticated() ?? false

  return isAuthenticated ? (
    &lt;div
      style={{
        display: &#39;flex&#39;,
        placeContent: &#39;space-around&#39;,
        paddingTop: &#39;2rem&#39;
      }}&gt;
      &lt;SubmitCommand /&gt;
      &lt;SubscribeEvent /&gt;
    &lt;/div&gt;
  ) : (
    &lt;Login /&gt;
  )
}</code></pre></dd>
</dl>
<p>The UI should now render the following view.</p>
<p><img src="../images/subscribe-event.png" alt="subscribe-event.png" /></p>
<p>Fill in the values for the input fields and hit subscribe.</p>
<pre class="prettyprint"><code class="nocode">Source Prefix : ESW.assembly123
Event KeyName : counterEvent
</code></pre>
<p>You may see an Invalid Event warning the first time you run this. This is expected because the Event has not yet been published with valid data. This can be ignored.</p>
<p>Now, let&rsquo;s simulate a component publishing some events and see them reflected in the UI in real-time.</p>
<h2><a href="#publish-events-using-esw-shell" name="publish-events-using-esw-shell" class="anchor"><span class="anchor-link"></span></a>Publish events using esw-shell</h2>
<p>If necessary, start the esw-shell utility.</p>
<pre class="prettyprint"><code class="language-bash">cs install esw-shell
esw-shell start 
@                 // you are inside ammonite repl now
</code></pre>
<p>Visit <a href="https://tmtsoftware.github.io/esw/0.5.0/eswshell/esw-shell.html">here</a> to learn more about the esw-shell utility.</p>
<p>We are using the Event Service <code>defaultPublisher</code> API provided in the shell to publish events.</p>
<pre class="prettyprint"><code class="language-scala">@ var counter = 0
@ def eventGenerator = Option{
    counter+=1
    SystemEvent(Prefix(&quot;ESW.assembly123&quot;), EventName(&quot;counterEvent&quot;), Set(IntKey.make(&quot;counter&quot;).set(counter)))
  }
@ eventService.defaultPublisher.publish(eventGenerator, 2.seconds)
</code></pre>
<p>This should start publishing events every 2 seconds from the source prefix <code>ESW.assembly123</code>.</p>
<p>UI should now start showing events. You may need to scroll down to see new events.</p>
<p><img src="../images/events.png" alt="events" /></p>
</div>
<div>
<a href="https://github.com/tmtsoftware/esw-gateway-ui-example/tree/master/docs/src/main/flows/subscribe-event.md" title="Edit this page" class="md-source-file md-edit">
Edit this page
</a>
</div>
<div class="print-only">
<span class="md-source-file md-version">
0.1.0*
</span>
</div>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-nav">
<nav class="md-footer-nav__inner md-grid">
<a href="../flows/submit-commands.html" title="Adding a Submit Command" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
</div>
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Previous
</span>
Adding a Submit Command
</span>
</div>
</a>
<a href="../flows/docs-flow.html" title="Adding Paradox Documentation" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Next
</span>
Adding Paradox Documentation
</span>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
</div>
</a>
</nav>
</div>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
Powered by
<a href="https://github.com/lightbend/paradox">Paradox</a>
and
<a href="https://jonas.github.io/paradox-material-theme/">Paradox Material Theme</a>

</div>
</div>
</div>
</footer>

</div>
<script src="../assets/javascripts/application.583bbe55.js"></script>
<script src="../assets/javascripts/paradox-material-theme.js"></script>
<script>app.initialize({version:"0.17",url:{base:"../."}})</script>
<script type="text/javascript" src="../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function(event) {
window.prettyPrint && prettyPrint();
});
</script>
</body>
</html>
