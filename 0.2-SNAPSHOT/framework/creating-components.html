<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="description" content="docs">
<meta name="generator" content="Paradox, paradox-material-theme, mkdocs-material=1.11.0">

<meta name="lang:clipboard.copy" content="Copy to clipboard">
<meta name="lang:clipboard.copied" content="Copied to clipboard">
<meta name="lang:search.result.none" content="No matching documents">
<meta name="lang:search.result.one" content="1 matching document">
<meta name="lang:search.result.other" content="# matching documents">
<meta name="lang:search.languages" content="">
<meta name="lang:search.tokenizer" content="[\s\-]+">


<meta name="description" content="docs">
<link rel="shortcut icon" href="../assets/images/favicon.png">
<title>Creating an Assembly or Hcd Component Â· TMT Common Software (CSW)</title>
<script src="../lib/modernizr/modernizr.min.js"></script>
<link rel="stylesheet" href="../assets/stylesheets/application-0741cbeb94.css">
<link rel="stylesheet" href="../lib/material__tabs/dist/mdc.tabs.min.css">
<link rel="stylesheet" href="../lib/prettify/prettify.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
<style>
body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}
code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}
</style>
<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="../assets/stylesheets/paradox-material-theme.css">
</head>
<body
data-md-color-primary="indigo"
data-md-color-accent="indigo">
<input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
<input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
<label class="md-overlay" data-md-component="overlay" for="drawer"></label>
<header class="md-header" data-md-component="header">
<nav class="md-header-nav md-grid">
<div class="md-flex">
<div class="md-flex__cell md-flex__cell--shrink">
<a href="../index.html" title="TMT Common Software (CSW)" class="md-header-nav__button md-logo">
<i class="md-icon md-icon--home"></i>
</a>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
</div>
<div class="md-flex__cell md-flex__cell--stretch">
<span class="md-flex__ellipsis md-header-nav__title">
Creating an Assembly or Hcd Component
</span>
</div>
<form name="search" style="display: none">
<input type="text" name="query">
</form>
</div>
</nav>
</header>

<div class="md-container">
<main class="md-main">
<div class="md-main__inner md-grid" data-md-component="container">
<div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--primary" data-md-level="0" style="visibility: hidden">
<label class="md-nav__title md-nav__title--site" for="drawer">
<div class="md-nav__button md-logo">
<i class="md-icon md-icon--home"></i>
</div>
<a href="../index.html" title="TMT Common Software (CSW)">
TMT Common Software (CSW)
</a>
</label>
<ul>
  <li><a href="../manuals.html" class="page">Manuals</a></li>
  <li><a href="../apps.html" class="page">Applications</a>
  <ul>
    <li><a href="../apps/cswclusterseed.html" class="page">csw-cluster-seed</a></li>
    <li><a href="../apps/cswlocationagent.html" class="page">csw-location-agent</a></li>
    <li><a href="../apps/cswonfigserverapp.html" class="page">csw-config-server</a></li>
    <li><a href="../apps/cswconfigclientcli.html" class="page">csw-config-client-cli</a></li>
    <li><a href="../apps/hostconfig.html" class="page">csw-host-config</a></li>
  </ul></li>
  <li><a href="../services.html" class="page">Services</a>
  <ul>
    <li><a href="../services/location.html" class="page">Location service</a></li>
    <li><a href="../services/config.html" class="page">Configuration service</a></li>
    <li><a href="../services/logging.html" class="page">Logging service</a></li>
    <li><a href="../services/messages.html" class="page">csw-messages</a></li>
  </ul></li>
  <li><a href="../framework.html" class="page">Framework for creating components (HCD, Assembly, Container)</a>
  <ul>
    <li><a href="../framework/describing-components.html" class="page">ComponentInfo</a></li>
    <li><a href="../framework/creating-components.html" class="active page">Creating an Assembly or Hcd Component</a></li>
    <li><a href="../framework/handling-lifecycle.html" class="page">Lifecycle support</a></li>
    <li><a href="../framework/tracking-connections.html" class="page">Tracking Connections</a></li>
    <li><a href="../framework/publishing-state.html" class="page">Publishing State</a></li>
    <li><a href="../framework/handling-exceptions.html" class="page">Handling Exceptions</a></li>
    <li><a href="../framework/deploying-components.html" class="page">Deploying Components</a></li>
  </ul></li>
  <li><a href="../command.html" class="page">Communication using Commands</a></li>
</ul>
<nav class="md-nav md-nav--secondary">
</nav>

<div class="md-nav__title--site md-version" title="Version">
<i class="md-icon">label_outline</i> 0.2*
</div>
</nav>

</div>
</div>
</div>
<div class="md-content">
<article class="md-content__inner md-typeset">
<div class="md-content__searchable">
<h2><a href="#creating-an-assembly-or-hcd-component" name="creating-an-assembly-or-hcd-component" class="anchor"><span class="anchor-link"></span></a>Creating an Assembly or Hcd Component</h2>
<p>A component is implemented by extending the <code>ComponentHandlers</code> base class. These handlers are executed under an actor (Top Level Actor or TLA) defined in the framework which handles the lifecycle and supervision of this component.</p>
<dl>
  <dt>Assembly/Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">class TromboneAssemblyHandlers(
    ctx: ActorContext[TopLevelActorMessage],
    componentInfo: ComponentInfo,
    commandResponseManager: ActorRef[CommandResponseManagerMessage],
    pubSubRef: ActorRef[PublisherMessage[CurrentState]],
    locationService: LocationService,
    loggerFactory: LoggerFactory
) extends ComponentHandlers[DiagPublisherMessages](
      ctx,
      componentInfo,
      commandResponseManager,
      pubSubRef,
      locationService,
      loggerFactory
    ) {</code></pre></dd>
  <dt>Assembly/Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">public class JTromboneAssemblyHandlers extends JComponentHandlers&lt;DiagPublisherMessages&gt; {

    // private state of this component
    private AssemblyContext ac;
    private ComponentInfo componentInfo;
    private ActorContext&lt;TopLevelActorMessage&gt; ctx;
    private ILocationService locationService;
    private Map&lt;Connection, Optional&lt;JComponentRef&gt;&gt; runningHcds;
    private ActorRef&lt;DiagPublisherMessages&gt; diagPublisher;
    private ActorRef&lt;AssemblyCommandHandlerMsgs&gt; commandHandler;
    private ActorRef&lt;CommandResponse&gt; commandResponseAdapter;
    private IConfigClientService configClient;
    private ActorSystem actorSystem;
    private Materializer mat;

    public JTromboneAssemblyHandlers(
            akka.typed.javadsl.ActorContext&lt;TopLevelActorMessage&gt; ctx,
            ComponentInfo componentInfo,
            ActorRef&lt;CommandResponseManagerMessage&gt; commandResponseManager,
            ActorRef&lt;PubSub.PublisherMessage&lt;CurrentState&gt;&gt; pubSubRef,
            ILocationService locationService,
            JLoggerFactory loggerFactory,
            Class&lt;DiagPublisherMessages&gt; klass

    ) {
        super(ctx, componentInfo, commandResponseManager, pubSubRef, locationService, loggerFactory, klass);
        this.componentInfo = componentInfo;
        this.ctx = ctx;
        this.locationService = locationService;
        runningHcds = new HashMap&lt;&gt;();
        commandResponseAdapter = ctx.spawnAdapter(DiagPublisherMessages.CommandResponseE::new);
        actorSystem = Adapter.toUntyped(ctx.getSystem());
        mat = ActorMaterializer.create(actorSystem);
        configClient = JConfigClientFactory.clientApi(actorSystem, locationService);
    }
</code></pre></dd>
  <dt>Hcd/Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">class TromboneHcdHandlers(
    ctx: ActorContext[TopLevelActorMessage],
    componentInfo: ComponentInfo,
    commandResponseManager: ActorRef[CommandResponseManagerMessage],
    pubSubRef: ActorRef[PublisherMessage[CurrentState]],
    locationService: LocationService,
    loggerFactory: LoggerFactory
) extends ComponentHandlers[TromboneMessage](
      ctx,
      componentInfo,
      commandResponseManager,
      pubSubRef,
      locationService,
      loggerFactory
    ) {</code></pre></dd>
  <dt>Hcd/Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">public class JTromboneHcdHandlers extends JComponentHandlers&lt;TromboneMessage&gt; {

    // private state of this component
    private ILogger log;
    private AxisResponse.AxisUpdate current;
    private AxisResponse.AxisStatistics stats;
    private ActorRef&lt;AxisRequest&gt; tromboneAxis;
    private AxisConfig axisConfig;
    private ActorContext&lt;TopLevelActorMessage&gt; ctx;

    public JTromboneHcdHandlers(
            ActorContext&lt;TopLevelActorMessage&gt; ctx,
            ComponentInfo componentInfo,
            ActorRef&lt;CommandResponseManagerMessage&gt; commandResponseManager,
            ActorRef&lt;PubSub.PublisherMessage&lt;CurrentState&gt;&gt; pubSubRef,
            ILocationService locationService,
            JLoggerFactory loggerFactory,
            Class&lt;TromboneMessage&gt; klass
    ) {
        super(ctx, componentInfo, commandResponseManager, pubSubRef, locationService, loggerFactory, klass);
        this.ctx = ctx;
        this.log = loggerFactory.getLogger(getClass());
    }</code></pre></dd>
</dl><div class="callout note "><div class="callout-title">Note</div>
<p><strong>converting typed actor system to untyped actor system</strong> </p>
<p>The <code>ctx</code> available to the component is of type <code>akka.typed.scaladsl.ActorContext</code> in scala or <code>akka.typed.javadsl.ActorContext</code> in java. This context can be used to get resources such as actor system which is also typed. In order to get the untyped version of actor system or actor references, akka has provided some implicit extension methods in scala and static methods in java which can be used by adding the following import </p>
<p><code>import akka.typed.scaladsl.adapter._</code> for scala and, <code>import akka.typed.javadsl.Adapter.*</code> for java</p></div>
<p>A component can be created by a factory which extends <code>ComponentBehaviorFactory</code> base class and provides a definition of <code>handlers</code> method to return the appropriate implementation of <code>ComponentHandlers</code>.</p>
<dl>
  <dt>Assembly/Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">class TromboneAssemblyBehaviorFactory extends ComponentBehaviorFactory[DiagPublisherMessages] {
  override def handlers(
      ctx: ActorContext[TopLevelActorMessage],
      componentInfo: ComponentInfo,
      commandResponseManager: ActorRef[CommandResponseManagerMessage],
      pubSubRef: ActorRef[PublisherMessage[CurrentState]],
      locationService: LocationService,
      loggerFactory: LoggerFactory
  ): ComponentHandlers[DiagPublisherMessages] =
    new TromboneAssemblyHandlers(ctx, componentInfo, commandResponseManager, pubSubRef, locationService, loggerFactory)
}</code></pre></dd>
  <dt>Assembly/Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">public class JTromboneAssemblyBehaviorFactory extends JComponentBehaviorFactory&lt;DiagPublisherMessages&gt; {

    public JTromboneAssemblyBehaviorFactory() {
        super(DiagPublisherMessages.class);
    }

    @Override
    public JComponentHandlers&lt;DiagPublisherMessages&gt; jHandlers(
            ActorContext&lt;TopLevelActorMessage&gt; ctx,
            ComponentInfo componentInfo,
            ActorRef&lt;CommandResponseManagerMessage&gt; commandResponseManager,
            ActorRef&lt;PubSub.PublisherMessage&lt;CurrentState&gt;&gt; pubSubRef,
            ILocationService locationService,
            JLoggerFactory loggerFactory
    ) {
        return new JTromboneAssemblyHandlers(ctx, componentInfo, commandResponseManager, pubSubRef, locationService, loggerFactory, DiagPublisherMessages.class);
    }
}</code></pre></dd>
  <dt>Hcd/Scala</dt>
  <dd>
  <pre class="prettyprint"><code class="language-scala">class TromboneHcdBehaviorFactory extends ComponentBehaviorFactory[TromboneMessage] {
  override def handlers(
      ctx: ActorContext[TopLevelActorMessage],
      componentInfo: ComponentInfo,
      commandResponseManager: ActorRef[CommandResponseManagerMessage],
      pubSubRef: ActorRef[PublisherMessage[CurrentState]],
      locationService: LocationService,
      loggerFactory: LoggerFactory
  ): ComponentHandlers[TromboneMessage] =
    new TromboneHcdHandlers(ctx, componentInfo, commandResponseManager, pubSubRef, locationService, loggerFactory)
}</code></pre></dd>
  <dt>Hcd/Java</dt>
  <dd>
  <pre class="prettyprint"><code class="language-java">public class JTromboneHcdBehaviorFactory extends JComponentBehaviorFactory&lt;TromboneMessage&gt; {

    public JTromboneHcdBehaviorFactory() {
        super(TromboneMessage.class);
    }

    @Override
    public JComponentHandlers&lt;TromboneMessage&gt; jHandlers(
            ActorContext&lt;TopLevelActorMessage&gt; ctx,
            ComponentInfo componentInfo,
            ActorRef&lt;CommandResponseManagerMessage&gt; commandResponseManager,
            ActorRef&lt;PubSub.PublisherMessage&lt;CurrentState&gt;&gt; pubSubRef,
            ILocationService locationService,
            JLoggerFactory loggerFactory
    ) {
        return null;
    }
}</code></pre></dd>
</dl>
</div>
<div>
<a href="https://github.com/tmtsoftware/csw-prod/tree/master/docs/src/main/framework/creating-components.md" title="Edit this page" class="md-source-file md-edit">
Edit this page
</a>
</div>
<div class="print-only">
<span class="md-source-file md-version">
0.2*
</span>
</div>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-nav">
<nav class="md-footer-nav__inner md-grid">
<a href="../framework/describing-components.html" title="ComponentInfo" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
</div>
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Previous
</span>
ComponentInfo
</span>
</div>
</a>
<a href="../framework/handling-lifecycle.html" title="Lifecycle support" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Next
</span>
Lifecycle support
</span>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
</div>
</a>
</nav>
</div>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
Powered by
<a href="https://github.com/lightbend/paradox" title="Paradox">Paradox</a>
and
<a href="https://jonas.github.io/paradox-material-theme/" title="Paradox Material Theme">Paradox Material Theme</a>

</div>
<div class="md-footer-social">
</div>

</div>
</div>
</footer>

</div>
<script src="../assets/javascripts/application-268d62d82d.js"></script>
<script src="../assets/javascripts/paradox-material-theme.js"></script>
<script>app.initialize({url:{base:".././"}})</script>
<script type="text/javascript" src="../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function(event) {
window.prettyPrint && prettyPrint();
});
</script>
</body>
</html>
