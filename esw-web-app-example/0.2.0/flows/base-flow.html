<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="description" content="docs">
<meta name="generator" content="Paradox, paradox-material-theme=0.7.0, mkdocs-material=3.0.3">

<meta name="lang:clipboard.copy" content="Copy to clipboard">
<meta name="lang:clipboard.copied" content="Copied to clipboard">
<meta name="lang:search.language" content="">
<meta name="lang:search.pipeline.stopwords" content="true">
<meta name="lang:search.pipeline.trimmer" content="true">
<meta name="lang:search.result.none" content="No matching documents">
<meta name="lang:search.result.one" content="1 matching document">
<meta name="lang:search.result.other" content="# matching documents">
<meta name="lang:search.tokenizer" content="[\s\-]+">


<meta name="description" content="docs">
<link rel="shortcut icon" href="../assets/images/favicon.png">
<title>Creating a Web Application · ESW Web Application Tutorial</title>
<link rel="stylesheet" href="../assets/stylesheets/application.451f80e5.css">
<link rel="stylesheet" href="../lib/material__tabs/dist/mdc.tabs.min.css">
<link rel="stylesheet" href="../lib/prettify/prettify.css">
<script src="../assets/javascripts/modernizr.1aa3b519.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
<style>
body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}
code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}
</style>
<link rel="stylesheet" href="../assets/fonts/font-awesome.css">
<link rel="stylesheet" href="../assets/fonts/material-icons.css">
<link rel="stylesheet" href="../assets/stylesheets/paradox-material-theme.css">
</head>
<body
>
<input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
<input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
<label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
<header class="md-header" data-md-component="header">
<nav class="md-header-nav md-grid">
<div class="md-flex">
<div class="md-flex__cell md-flex__cell--shrink">
<a href="../index.html" title="ESW Web Application Tutorial" class="md-header-nav__button md-logo">
<i class="md-icon">local_library</i>
</a>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
</div>
<div class="md-flex__cell md-flex__cell--stretch">
<div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
<span class="md-header-nav__topic">
ESW Web Application Tutorial
</span>
<span class="md-header-nav__topic">
Creating a Web Application
</span>
</div>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
<label class="md-icon md-search__icon" for="__search"></label>
<button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">&#xE5CD;</button>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix>
<div class="md-search-result" data-md-component="result">
<div class="md-search-result__meta">
Type to start searching
</div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>

</div>
</div>
</nav>
</header>

<div class="md-container">
<main class="md-main">
<div class="md-main__inner md-grid" data-md-component="container">
<div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--primary" data-md-level="0" style="visibility: hidden">
<label class="md-nav__title md-nav__title--site" for="drawer">
<a href="../index.html" title="ESW Web Application Tutorial" class="md-nav__button md-logo">
<span class="md-nav__button md-logo">
<i class="md-icon">local_library</i>
</a>
<a href="../index.html" title="ESW Web Application Tutorial">
ESW Web Application Tutorial
</a>
</label>
<ul>
  <li><a href="../flows/base-flow.html" class="active page">Creating a Web Application</a></li>
  <li><a href="../flows/auth-flow.html" class="page">Adding Authentication</a></li>
  <li><a href="../flows/db-flow.html" class="page">Adding Database Persistence</a></li>
  <li><a href="../flows/docs-flow.html" class="page">Adding Paradox Documentation</a></li>
</ul>
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../flows/base-flow.html#creating-a-web-application" class="header">Creating a Web Application</a>
  <ul>
    <li><a href="../flows/base-flow.html#generate-application" class="header">Generate Application</a></li>
    <li><a href="../flows/base-flow.html#open-in-development-environment" class="header">Open in Development Environment</a></li>
    <li><a href="../flows/base-flow.html#develop-backend" class="header">Develop Backend</a></li>
    <li><a href="../flows/base-flow.html#create-the-frontend" class="header">Create the Frontend</a></li>
  </ul></li>
</ul>
</nav>

</nav>
<ul style="display: none">
<li class="md-nav__item md-version" id="project.version">
<label class="md-nav__link" for="__version">
<i class="md-icon" title="Version">label_outline</i> 0.1.0*
</label>
</li>
</ul>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../flows/base-flow.html#creating-a-web-application" class="header">Creating a Web Application</a>
  <ul>
    <li><a href="../flows/base-flow.html#generate-application" class="header">Generate Application</a></li>
    <li><a href="../flows/base-flow.html#open-in-development-environment" class="header">Open in Development Environment</a></li>
    <li><a href="../flows/base-flow.html#develop-backend" class="header">Develop Backend</a></li>
    <li><a href="../flows/base-flow.html#create-the-frontend" class="header">Create the Frontend</a></li>
  </ul></li>
</ul>
</nav>

</div>
</div>
</div>
<div class="md-content">
<article class="md-content__inner md-typeset">
<div class="md-content__searchable">
<h1><a href="#creating-a-web-application" name="creating-a-web-application" class="anchor"><span class="anchor-link"></span></a>Creating a Web Application</h1>
<p>This flow demonstrates how to use the template to create our project, how to add simple routes, UI components, and how to build and test it. </p>
<p>In this tutorial, we will first generate the application from the template, and build it to ensure tools are in place. Then, we will delete the default implementation and replace it with our own implementation of a coordinate formatter. To do this, we will delete much of the template code and rewrite our own classes custom to our implementation.</p>
<h2><a href="#generate-application" name="generate-application" class="anchor"><span class="anchor-link"></span></a>Generate Application</h2>
<p>First we need to generate a scaffolding application using our giter8 template:</p>
<pre class="prettyprint"><code class="language-bash">g8 tmtsoftware/esw-web-app-template.g8 --name=sample
</code></pre>
<p>This will generate a sample folder with two sub-folders, <code>sample-frontend</code> and <code>sample-backend</code>. For a sanity check, let&rsquo;s go ahead and build the front and back ends created by the template. This will also help ensure you have the necessary tools installed.</p>
<p>You are welcome to try out the generated sample project, which is basically a &ldquo;Hello World&rdquo; application, by following the instructions in the READMEs in each sub-folder. </p>
<h3><a href="#compile-the-frontend" name="compile-the-frontend" class="anchor"><span class="anchor-link"></span></a>Compile the Frontend</h3>
<p>The <code>sample-frontend</code> sub-folder is where your frontend application is located. It uses Typescript, React and node. Make sure node version <code>v16.0.0</code> or higher is installed in your machine. Let&rsquo;s compile our generated application.</p>
<pre class="prettyprint"><code class="language-bash">cd sample/sample-frontend
npm install
npm run build
</code></pre><div class="callout note "><div class="callout-title">Note</div>
<p>This tutorial uses the current ESW.UISTD selections for user interface languages, libraries, and tools. These are the current selections. They will be reviewed and updated once again as part of ESW Phase 2.</p></div>
<h3><a href="#compile-the-backend" name="compile-the-backend" class="anchor"><span class="anchor-link"></span></a>Compile the Backend</h3>
<p>The <code>sample-backend</code> sub-folder is where your backend application is located. It uses the Scala ecosystem, which uses <a href="https://www.scala-sbt.org/">sbt</a> as its build tool. Make sure <a href="https://tmtsoftware.github.io/csw/apps/csinstallation.html">coursier</a>, <a href="https://adoptopenjdk.net/">Adopt OpenJDK 11</a>, and the latest version of <a href="https://www.scala-sbt.org/">sbt</a> are installed in your machine.</p><div class="callout note "><div class="callout-title">Note</div>
<p>For a very smooth setup experience, the coursier tool can be used to do all of these installations in one step as described <a href="https://www.scala-lang.org/2020/06/29/one-click-install.html">here</a>.</p></div>
<p>Let&rsquo;s compile our generated application.</p>
<pre class="prettyprint"><code class="language-bash">cd sample/sample-backend
sbt
sbt:sample-backend&gt; compile
</code></pre>
<h2><a href="#open-in-development-environment" name="open-in-development-environment" class="anchor"><span class="anchor-link"></span></a>Open in Development Environment</h2>
<p>At this point, you may want to open the project in an Integrated Development Environment (IDE), such as Intellij, if you are using one. The template creates two projects, a Scala/sbt-based backend amd a Typescript/npm-based frontend, and because the two projects have different build systems, it is better to open each part, the frontend and backend, in separate IDE projects. We recommend Intellij for the backend, and VS Code or Intellij for the frontend. </p>
<p>To open the backend in Intellij, click on File-&gt;New Project from Existing Sources&hellip; and then browsing to the backend directory, <code>sample/sample-backend</code>. It should have a build.sbt file in it. Create an sbt-based project, and then accept the defaults, making sure the JDK is set to your installation of OpenJDK 11.</p>
<h2><a href="#develop-backend" name="develop-backend" class="anchor"><span class="anchor-link"></span></a>Develop Backend</h2>
<p>We will start with the backend HTTP service first. We will start by deleting the existing application and then create our custom code. Our backend will be written in Scala, so all Java code will be removed.</p>
<p>In ESW, a specialized backend service is only needed in the cases where the application has complicated or compute-expensive tasks that can not be satisfied by CSW-based components. In this case, an application-specific backend is created that is dedicated to the application UI and only provides the needed application functionality.</p><div class="callout note "><div class="callout-title">Note</div>
<p>Many web application frontend user interfaces will also send commands to control system CSW components through the User Interface Gateway.</p></div>
<h3><a href="#cleanup-existing-sample" name="cleanup-existing-sample" class="anchor"><span class="anchor-link"></span></a>Cleanup existing sample</h3>
<p>To remove the generated code from the template sample application, go to the <code>sample-backend</code> folder and:</p>
<ul>
  <li>Delete the folders <code>src/main/java</code> ,<code>src/test</code></li>
</ul>
<p>Browse to <code>src/main/scala/org/tmt/sample</code> and </p>
<ul>
  <li>Delete the existing files from <code>core/models</code></li>
  <li>Delete the existing files from <code>service</code></li>
  <li>Delete the file <code>SampleImpl.scala</code> from <code>impl</code></li>
  <li>Delete the file <code>JSampleImplWrapper.scala</code> from <code>http</code></li>
</ul>
<h3><a href="#add-our-models-classes" name="add-our-models-classes" class="anchor"><span class="anchor-link"></span></a>Add our Models classes</h3>
<p>We will now create the models used by our application. The first model is our request, the values that are sent to the backend, in which we will take a RA/Dec pair as decimals. The other model is the response from the backend, which returns the pair as formatted Strings. It also includes a UUID String for the request.</p>
<p>The request and response models must be put into a format that can be included in an HTTP request, which is this case is JSON. These model classes will be used to serialize and deserialize requests and responses to and from JSON.</p>
<ul>
  <li>Go to <code>core/models</code> in <code>src</code></li>
  <li>Add <code>RaDecRequest.scala</code> model class</li>
</ul>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/esw-web-app-example/tree/master/backend/src/main/scala/org/tmt/sample/core/models/RaDecRequest.scala#L2-L4" target="_blank" title="Go to snippet source">source</a><code class="language-scala">package org.tmt.sample.core.models

case class RaDecRequest(raInDecimals: Double, decInDecimals: Double)</code></pre></dd>
</dl>
<p>Add the <code>RaDecResponse.scala</code> model class</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/esw-web-app-example/tree/master/backend/src/main/scala/org/tmt/sample/core/models/RaDecResponse.scala#L2-L4" target="_blank" title="Go to snippet source">source</a><code class="language-scala">package org.tmt.sample.core.models

case class RaDecResponse(id: String, formattedRa: String, formattedDec: String)</code></pre></dd>
</dl>
<h3><a href="#add-our-implementation" name="add-our-implementation" class="anchor"><span class="anchor-link"></span></a>Add our implementation</h3>
<p>Now we will create our backend logic. First, we create the service API as a Scala trait. Our service will have two methods. The first method will take the RA/Dec request, format it, and then return the response. Our server will also maintain a list of all requests, so the first method will also store this pair as formatted strings in backend-side state.</p>
<p>The second method returns this stored list of all processed RA/Dec pairs.</p>
<ul>
  <li>Go to <code>service</code> in <code>src</code></li>
  <li>Create a <code>RaDecService.scala</code> file and add our <code>raDecToString</code> contract to our API, <code>RaDecService</code>, using our request and response models</li>
  <li>Add the <code>getRaDecValues</code> contract in the service <code>RaDecService.scala</code></li>
</ul>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/esw-web-app-example/tree/master/backend/src/main/scala/org/tmt/sample/service/RaDecService.scala#L2-L11" target="_blank" title="Go to snippet source">source</a><code class="language-scala">package org.tmt.sample.service

import org.tmt.sample.core.models.{RaDecRequest, RaDecResponse}

import scala.concurrent.Future

trait RaDecService {
  def raDecToString(raDecRequest: RaDecRequest): Future[RaDecResponse]
  def getRaDecValues: Future[List[RaDecResponse]]
}</code></pre></dd>
</dl>
<p>Now we will create the implementation class of this service. We use the <code>Angle</code> class from CSW to create the sexagesimal string values.</p>
<ul>
  <li>Go to the <code>impl</code> package in <code>src</code></li>
  <li>Add <code>RaDecImpl.scala</code></li>
  <li>Extend <code>RaDecService.scala</code> to implement <code>raDecToString</code></li>
  <li>Implement <code>getRaDecValues</code> contract in <code>RaDecImpl.scala</code></li>
</ul>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/esw-web-app-example/tree/master/backend/src/main/scala/org/tmt/sample/impl/RaDecImpl.scala#L2-L24" target="_blank" title="Go to snippet source">source</a><code class="language-scala">package org.tmt.sample.impl

import csw.params.core.models.Angle
import org.tmt.sample.core.models.{RaDecRequest, RaDecResponse}
import org.tmt.sample.service.RaDecService

import java.util.UUID
import scala.collection.mutable
import scala.concurrent.Future

class RaDecImpl extends RaDecService {

  private val raDecValues = mutable.ListBuffer[RaDecResponse]()

  override def raDecToString(raDecRequest: RaDecRequest): Future[RaDecResponse] = {
    val formattedRa   = Angle.raToString(Math.toRadians(raDecRequest.raInDecimals*15))
    val formattedDec  = Angle.deToString(Math.toRadians(raDecRequest.decInDecimals))
    val raDecResponse = RaDecResponse(UUID.randomUUID().toString, formattedRa, formattedDec)
    raDecValues.append(raDecResponse)
    Future.successful(raDecResponse)
  }
  override def getRaDecValues: Future[List[RaDecResponse]] = Future.successful(raDecValues.toList)
}</code></pre></dd>
</dl>
<p>Now, lets try to compile our code</p>
<pre class="prettyprint"><code class="language-bash">sbt:sample-backend&gt; compile
</code></pre>
<p>You will notice it will give some compilation errors here. To fix these:</p>
<ul>
  <li>Delete references to the classes we deleted earlier from <code>src/main/org/tmt/sample/impl/SampleWiring.scala</code></li>
  <li>Add a placeholder for route</li>
</ul>
<pre class="prettyprint"><code class="language-scala">override lazy val routes: Route = ???
</code></pre>
<ul>
  <li>Go to <code>src/main/org/tmt/sample/http/SampleRoute.scala</code></li>
  <li>Delete references to the previously deleted classes from the Scala files</li>
  <li>Delete existing route</li>
  <li>Add a placeholder for route</li>
</ul>
<pre class="prettyprint"><code class="language-scala">val route: Route = ???
</code></pre>
<p>Delete references to the previously deleted classes from the Scala files in <code>src/main/org/tmt/sample/http/HttpCodecs</code></p>
<p>Be sure to delete references to deleted classes from import statements as well.</p>
<p>Try compiling code again, this time it should compile successfully.</p>
<pre class="prettyprint"><code class="language-bash">sbt:sample-backend&gt; compile
</code></pre>
<h3><a href="#add-a-route-for-our-implementation" name="add-a-route-for-our-implementation" class="anchor"><span class="anchor-link"></span></a>Add a Route for our implementation</h3>
<p>Next, we will provide the routing that links our HTTP request methods or endpoints to backend server processing created in our implementation class <code>RaDecImpl</code>. </p>
<p>First, we need to inject a reference to an implementation of our service API to the routes, so that the appropriate method will be called for the matching endpoint and request method. Change the constructor of the route to take such an instance, and add an import for <code>RaDecService</code>:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/esw-web-app-example/tree/master/backend/src/main/scala/org/tmt/sample/http/SampleRoute.scala#L13-L15" target="_blank" title="Go to snippet source">source</a><code class="language-scala">class SampleRoute(raDecService: RaDecService, securityDirectives: SecurityDirectives)(implicit
    ec: ExecutionContext
) extends HttpCodecs {</code></pre></dd>
</dl>
<p>Next, we will add our routes. We will have a single endpoint <code>raDecValues</code> that supports two methods: POST and GET. The POST method will cause our backend service method <code>raDecToString</code> to be called, and GET will call <code>getRaDecValues</code>. We are using the Akka routing DSL to compose our HTTP routes. Visit <a href="https://doc.akka.io/docs/akka-http/current/routing-dsl/overview.html">here</a> to learn more about the routing DSL.</p>
<p>Be sure to add an import for our model <code>RaDecRequest</code>.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/esw-web-app-example/tree/master/backend/src/main/scala/org/tmt/sample/http/SampleRoute.scala#L19-L43" target="_blank" title="Go to snippet source">source</a><code class="language-scala">val route: Route = {
  path(&quot;raDecValues&quot;) {
    post {
      entity(as[RaDecRequest]) { raDecRequest =&gt;
        complete(raDecService.raDecToString(raDecRequest))
      }
    } ~
    get {
      complete(raDecService.getRaDecValues)
    }
  } ~
}</code></pre></dd>
</dl><div class="callout note "><div class="callout-title">Note</div>
<p>The tilda (~) at the end, is used to concatenate paths in the Akka DSL. You can safely remove it for now. However, in the following section of this tutorial we are going to add new routes to this file. At that point, you would want to add it again to concatenate multiple routes.</p></div>
<p>Next, let&rsquo;s connect our routes to our service implementation in the wiring.</p>
<ul>
  <li>Go to <code>SampleWiring.scala</code></li>
  <li>Add a <code>raDecImpl</code> reference</li>
</ul>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/esw-web-app-example/tree/master/backend/src/main/scala/org/tmt/sample/impl/SampleWiring.scala#L11" target="_blank" title="Go to snippet source">source</a><code class="language-scala">lazy val raDecImpl = new RaDecImpl()</code></pre></dd>
</dl>
<p>Replace the route placeholder with our route, injecting our service API implementation, and add an import for <code>SampleRoute</code>.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/esw-web-app-example/tree/master/backend/src/main/scala/org/tmt/sample/impl/SampleWiring.scala#L15-L16" target="_blank" title="Go to snippet source">source</a><code class="language-scala">import actorRuntime.ec
override lazy val routes: Route = new SampleRoute(raDecImpl, securityDirectives).route</code></pre></dd>
</dl>
<p>After we add the route, it will show some compilation errors, to fix that we need to add the codec to serialize/deserialize our request/response</p>
<h3><a href="#add-codecs" name="add-codecs" class="anchor"><span class="anchor-link"></span></a>Add Codecs</h3>
<p>We are using <a href="https://sirthias.github.io/borer/">borer</a> to serialize/deserialize. It has support for two formats: JSON and CBOR(binary format)</p>
<p>Add the codecs in <code>HttpCodecs.scala</code>, along with imports for our models.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/esw-web-app-example/tree/master/backend/src/main/scala/org/tmt/sample/http/HttpCodecs.scala#L13-L14" target="_blank" title="Go to snippet source">source</a><code class="language-scala">implicit lazy val raDecResponseCodec: Codec[RaDecResponse] = deriveCodec
implicit lazy val raDecRequestCodec: Codec[RaDecRequest]   = deriveCodec</code></pre></dd>
</dl>
<p><code>SampleRoute</code> should now compile successfully and is ready to use.</p>
<h3><a href="#manually-test-our-application" name="manually-test-our-application" class="anchor"><span class="anchor-link"></span></a>Manually test our application</h3>
<p>Start the Location Service with the Authorization and Authentication Service (we will use auth in the next section of the tutorial).</p>
<pre class="prettyprint"><code class="language-bash">cs install csw-services
csw-services start -k 
</code></pre>
<p>Set <code>INTERFACE_NAME</code> and <code>AAS_INTERFACE_NAME</code> environment variables with the Network interface of your machine. These are needed during startup of the application, so that it is able to connect to Location Service and register its IP address and location information.</p>
<ul>
  <li>During development in your local machine, these can point to same Network interface.</li>
  <li>During production deployment, these will point to a outside (AAS_INTERFACE_NAME) and inside (INTERFACE_NAME) Network interface.</li>
</ul>
<p>For more details, refer CSW <a href="https://tmtsoftware.github.io/csw/deployment/env-vars.html">environment variables</a> and <a href="https://tmtsoftware.github.io/csw/deployment/network-topology.html">network topology</a>.</p>
<p>Try running our backend application</p>
<pre class="prettyprint"><code class="language-bash">sbt:sample-backend&gt; run start
</code></pre>
<p>If the application starts successfully, it will show log messages with the <code>server_ip</code> and <code>app_port</code> registered to the Location Service.</p>
<p>The template includes a file, <code>apptest.http</code>, that can be used to run HTTP requests in Intellij. Update <code>apptest.http</code> with the code below, replacing the <code>&lt;server_ip&gt;:&lt;app_port&gt;</code> with the ones for your server as displayed in the log messages. Then run the request by clicking the green arrow next to the request to test your <code>raDecValues</code> POST route:</p>
<pre class="prettyprint"><code class="language-bash">#### Request to test raDecValues endpoint
POST http://&lt;server_ip&gt;:&lt;app_port&gt;/raDecValues
Content-Type: application/json

{
  &quot;raInDecimals&quot;: 2.13,
  &quot;decInDecimals&quot;: 2.18
}

</code></pre>
<p>The successful response contains the <code>formattedRa</code> and <code>formattedDec</code> values with a unique id.</p>
<pre class="prettyprint"><code class="language-bash">{
  &quot;id&quot;: &quot;80ab3f42-a4cf-4249-b9a0-2b209aab48e8&quot;,
  &quot;formattedRa&quot;: &quot;8h 8m 9.602487087684134s&quot;,
  &quot;formattedDec&quot;: &quot;124°54&#39;17.277618670114634\&quot;&quot;
}
</code></pre>
<p>Add this to your <code>apptest.http</code>, again replacing the server IP and port number, and test your <code>raDecValues</code> GET route</p>
<pre class="prettyprint"><code class="language-http">####
GET http://&lt;server_ip&gt;:&lt;app_port&gt;/raDecValues
</code></pre>
<p>A successful response contains a list with the previous formatted RA/DEC entry.</p>
<pre class="prettyprint"><code class="language-bash">[
  {
    &quot;id&quot;: &quot;d6a16719-72bf-4928-8bf3-abb125186f49&quot;,
    &quot;formattedRa&quot;: &quot;8h 8m 9.602487087684134s&quot;,
    &quot;formattedDec&quot;: &quot;124°54&#39;17.277618670114634\&quot;&quot;
  }
]
</code></pre>
<p>Change the numbers in the POST test and run it again. Then, run the GET test again, and you will see both entries displayed in the list.</p>
<p><strong>Success!</strong></p>
<h2><a href="#create-the-frontend" name="create-the-frontend" class="anchor"><span class="anchor-link"></span></a>Create the Frontend</h2>
<p>In this section, we will be constructing a browser-based UI using React components in Typescript. We will create components that allow the user to specify an RA/Dec pair, and then a Submit button that will send the data to our backend. The response will then be rendered in UI components. We will also provide components to get and display the list of stored coordinates. This section of the tutorial will show how to add and render custom components within the application that act as clients to consume our backend routes.</p><div class="callout note "><div class="callout-title">Note</div>
<p>The frontend tutorial uses functionality from the ESW-TS library. Be sure and look at the documentation for ESW-TS once you start working on your own UI. ESW-TS documentation can be found <a href="http://tmtsoftware.github.io/esw-ts">here</a>.</p></div>
<p>First, cleanup unwanted code from the template:</p>
<ul>
  <li>Go to the <code>components/pages</code> folder in <code>src</code> and delete all component files under this directory</li>
  <li>Delete the folder <code>components/form</code></li>
  <li>Go to the <code>utils</code> folder and remove the contents of the <code>api.ts</code> file</li>
  <li>Go to the <code>pages</code> folder in <code>test</code> and delete all test files under this directory</li>
</ul>
<h3><a href="#add-models" name="add-models" class="anchor"><span class="anchor-link"></span></a>Add models</h3>
<p>Now, we need to add Typescript models for the data we will send to and receive from our backend:</p>
<ul>
  <li>Go to <code>Models.ts</code> in <code>src/models</code></li>
  <li>Delete existing model interfaces</li>
  <li>Add our request and response models</li>
</ul>
<dl>
  <dt>Typescript</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/esw-web-app-example/tree/master/frontend/src/models/Models.ts#L2-L11" target="_blank" title="Go to snippet source">source</a><code class="language-ts">export interface RaDecRequest {
  raInDecimals: number
  decInDecimals: number
}

export interface RaDecResponse {
  id: string
  formattedRa: string
  formattedDec: string
}</code></pre></dd>
</dl><div class="callout note "><div class="callout-title">Note</div>
<p>Now we are in the Javascript world. Serializing as JSON allows information to be communicated from the JVM and Scala-based backend to the Javascript/Typescript browser environment.</p></div>
<h3><a href="#add-fetch" name="add-fetch" class="anchor"><span class="anchor-link"></span></a>Add Fetch</h3>
<p>Implement the following methods to consume data from our POST and GET routes in the <code>api.ts</code> file. These methods will be called by our React components and perform HTTP requests to the backend. The <code>post</code> and <code>get</code> methods are defined in <code>Http.ts</code> and handle the formatting of the request method and arguments into a proper HTTP request, as well as formatting the response.</p>
<p>For POST Route</p>
<dl>
  <dt>Typescript</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/esw-web-app-example/tree/master/frontend/src/utils/api.ts#L7-L16" target="_blank" title="Go to snippet source">source</a><code class="language-ts">export const postRaDecValues = async (
  baseUrl: string,
  raDecRequest: RaDecRequest
): Promise&lt;RaDecResponse | undefined&gt; =&gt;
  (
    await post&lt;RaDecRequest, RaDecResponse&gt;(
      baseUrl + &#39;raDecValues&#39;,
      raDecRequest
    )
  ).parsedBody</code></pre></dd>
</dl>
<p>For GET Route</p>
<dl>
  <dt>Typescript</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/esw-web-app-example/tree/master/frontend/src/utils/api.ts#L37-L40" target="_blank" title="Go to snippet source">source</a><code class="language-ts">export const getRaDecValues = async (
  baseUrl: string
): Promise&lt;RaDecResponse[] | undefined&gt; =&gt;
  (await get&lt;RaDecResponse[]&gt;(baseUrl + &#39;raDecValues&#39;)).parsedBody</code></pre></dd>
</dl>
<p>You will need the following imports: </p>
<dl>
  <dt>Typescript</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/esw-web-app-example/tree/master/frontend/src/utils/api.ts#L2-L3" target="_blank" title="Go to snippet source">source</a><code class="language-ts">import type { RaDecRequest, RaDecResponse } from &#39;../models/Models&#39;
import { get, post } from &#39;./Http&#39;</code></pre></dd>
</dl>
<h3><a href="#create-a-react-component" name="create-a-react-component" class="anchor"><span class="anchor-link"></span></a>Create a React component</h3>
<p>The first component we will create is the form for entering a coordinate and submitting it to the backend server. We are using the <a href="https://ant.design/">Ant Design</a> UI component library for our components, so here we use an Ant.d Form.</p><div class="callout note "><div class="callout-title">Note</div>
<p>Ant Design is the current ESW selection for a React-based UI component library.</p></div>
<ul>
  <li>In the <code>pages</code> folder, create <code>RaDecInput.tsx</code></li>
  <li>Add a simple input form to the <code>RaDecInput</code> React component</li>
</ul>
<dl>
  <dt>Typescript</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/esw-web-app-example/tree/master/frontend/src/components/pages/RaDecInput.tsx#L11-L66" target="_blank" title="Go to snippet source">source</a><code class="language-tsx">export const RaDecInput = ({
  reload = true,
  setReload = () =&gt; ({})
}: {
  reload?: boolean
  setReload?: (s: boolean) =&gt; void
}): JSX.Element =&gt; {
  const locationService = useLocationService()
  return (
    &lt;Form
      onFinish={onFinish}
      style={{ padding: &#39;1rem&#39; }}
      wrapperCol={{
        span: 1
      }}&gt;
      &lt;Form.Item label=&#39;RaInDecimals&#39; name=&#39;raInDecimals&#39;&gt;
        &lt;Input role=&#39;RaInDecimals&#39; style={{ marginLeft: &#39;0.5rem&#39; }} /&gt;
      &lt;/Form.Item&gt;
      &lt;Form.Item label=&#39;DecInDecimals&#39; name=&#39;decInDecimals&#39;&gt;
        &lt;Input role=&#39;DecInDecimals&#39; /&gt;
      &lt;/Form.Item&gt;
      &lt;Form.Item&gt;
        &lt;Button type=&#39;primary&#39; htmlType=&#39;submit&#39; role=&#39;Submit&#39;&gt;
          Submit
        &lt;/Button&gt;
      &lt;/Form.Item&gt;
    &lt;/Form&gt;
  )
}</code></pre></dd>
</dl>
<p>It will be necessary to add the appropriate imports.</p>
<p>Note the first line after the constructor stores a reference to the Location Service in the component.</p>
<dl>
  <dt>Typescript</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/esw-web-app-example/tree/master/frontend/src/components/pages/RaDecInput.tsx#L19" target="_blank" title="Go to snippet source">source</a><code class="language-tsx">const locationService = useLocationService()</code></pre></dd>
</dl>
<p>This instance is required to get the URL of the backend service. It is part of a React <a href="https://reactjs.org/docs/context.html">context</a> named <code>LocationServiceProvider</code>, defined in the <code>contexts</code> folder. This is made available to our component when we put the components together in <code>App.tsx</code>. </p>
<p>Finally, add an <code>onFinish</code> handler to specify the behavior when the submit button is pressed. It will use the <code>postRaDecValues</code> method in our component. Insert this code above the <code>return</code> statement defined above.</p>
<dl>
  <dt>Typescript</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/esw-web-app-example/tree/master/frontend/src/components/pages/RaDecInput.tsx#L24-L43" target="_blank" title="Go to snippet source">source</a><code class="language-tsx">const onFinish = async (values: RaDecRequest) =&gt; {
  const backendUrl = await getBackendUrl(locationService)
  const valueInDecimal = {
    raInDecimals: Number(values.raInDecimals),
    decInDecimals: Number(values.decInDecimals)
  }
  if (backendUrl) {
    const response = await postRaDecValues(backendUrl, valueInDecimal)
    setReload(!reload)
    if (response?.formattedRa &amp;&amp; response?.formattedDec) {
      console.log(response.formattedRa)
      console.log(response.formattedDec)
    } else {
      console.error(response)
      throw new Error(
        &#39;Invalid response, formattedRa or formattedDec field is missing&#39;
      )
    }
  }
}</code></pre></dd>
</dl>
<p>Be sure to add the necessary imports. It should look something like this:</p>
<dl>
  <dt>Typescript</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/esw-web-app-example/tree/master/frontend/src/components/pages/RaDecInput.tsx#L2-L7" target="_blank" title="Go to snippet source">source</a><code class="language-tsx">import { Button, Form, Input } from &#39;antd&#39;
import React from &#39;react&#39;
import { useLocationService } from &#39;../../contexts/LocationServiceContext&#39;
import type { RaDecRequest } from &#39;../../models/Models&#39;
import { postRaDecValues } from &#39;../../utils/api&#39;
import { getBackendUrl } from &#39;../../utils/resolveBackend&#39;</code></pre></dd>
</dl>
<h3><a href="#create-a-table-component" name="create-a-table-component" class="anchor"><span class="anchor-link"></span></a>Create a table component</h3>
<p>In the <code>pages</code> folder, add a new component <code>RaDecTable.tsx</code> to display the RA/Dec values table. Again, we are using an Ant.d component, <code>Table</code>:</p>
<dl>
  <dt>Typescript</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/esw-web-app-example/tree/master/frontend/src/components/pages/RaDecTable.tsx#L35-L65" target="_blank" title="Go to snippet source">source</a><code class="language-tsx">export const RaDecTable = ({ reload }: { reload: boolean }): JSX.Element =&gt; {
  return (
    &lt;Table
      rowKey={(record) =&gt; record.id}
      pagination={false}
      dataSource={raDecValues}
      columns={columns}
      bordered
    /&gt;
  )
}</code></pre></dd>
</dl>
<p>The table will display a list of <code>RaDecResponse</code>s obtained from the backend server, described below. In this table, the key for rows will come from the <code>id</code> field of the response model. </p>
<p>The columns will be defined in a constant value outside of this class. Insert the following code above the <code>RaDecTable</code> declaration:</p>
<dl>
  <dt>Typescript</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/esw-web-app-example/tree/master/frontend/src/components/pages/RaDecTable.tsx#L13-L30" target="_blank" title="Go to snippet source">source</a><code class="language-tsx">const HeaderTitle = ({ title }: { title: string }): JSX.Element =&gt; (
  &lt;Typography.Title level={5} style={{ marginBottom: 0 }}&gt;
    {title}
  &lt;/Typography.Title&gt;
)

const columns: ColumnsType&lt;RaDecResponse&gt; = [
  {
    title: &lt;HeaderTitle title={&#39;Formatted Ra Value&#39;} /&gt;,
    dataIndex: &#39;formattedRa&#39;,
    key: &#39;formattedRa&#39;
  },
  {
    title: &lt;HeaderTitle title={&#39;Formatted Dec Value&#39;} /&gt;,
    dataIndex: &#39;formattedDec&#39;,
    key: &#39;formattedDec&#39;
  }
]</code></pre></dd>
</dl>
<p>The data for the table will come from an <code>raDecValues</code> constant that gets populated using a React <a href="https://reactjs.org/docs/hooks-effect.html">Hook</a>. The <code>useEffect</code> hook is called whenever the component is rendered. In our hook we call the method <code>getRaDecValues</code>, which does the GET request to the backend, whose URL is obtained using the Location Service obtained from the context.</p>
<dl>
  <dt>Typescript</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/esw-web-app-example/tree/master/frontend/src/components/pages/RaDecTable.tsx#L35-L65" target="_blank" title="Go to snippet source">source</a><code class="language-tsx">export const RaDecTable = ({ reload }: { reload: boolean }): JSX.Element =&gt; {
  const locationService = useLocationService()
  const [raDecValues, setRaValues] = useState&lt;RaDecResponse[]&gt;()

  useEffect(() =&gt; {
    async function fetchRaValues() {
      const backendUrl = await getBackendUrl(locationService)
      if (backendUrl) {
        const raDecValues = await getRaDecValues(backendUrl)
        console.log(&#39;raDecValues&#39;, raDecValues)
        setRaValues(raDecValues)
      } else {
        errorMessage(&#39;Failed to fetch ra values&#39;)
      }
    }

    fetchRaValues()
  }, [reload, locationService])

  return (
    &lt;Table
      rowKey={(record) =&gt; record.id}
      pagination={false}
      dataSource={raDecValues}
      columns={columns}
      bordered
    /&gt;
  )
}</code></pre></dd>
</dl>
<p>Imports for this file will look something like this:</p>
<dl>
  <dt>Typescript</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/esw-web-app-example/tree/master/frontend/src/components/pages/RaDecTable.tsx#L2-L9" target="_blank" title="Go to snippet source">source</a><code class="language-tsx">import { Table, Typography } from &#39;antd&#39;
import type { ColumnsType } from &#39;antd/lib/table&#39;
import React, { useEffect, useState } from &#39;react&#39;
import { useLocationService } from &#39;../../contexts/LocationServiceContext&#39;
import type { RaDecResponse } from &#39;../../models/Models&#39;
import { getRaDecValues } from &#39;../../utils/api&#39;
import { errorMessage } from &#39;../../utils/message&#39;
import { getBackendUrl } from &#39;../../utils/resolveBackend&#39;</code></pre></dd>
</dl>
<h3><a href="#putting-our-components-together" name="putting-our-components-together" class="anchor"><span class="anchor-link"></span></a>Putting our components together</h3>
<p>In the <code>pages</code> folder, add a new component <code>RaDec.tsx</code> to compose the components created above and display in a page</p>
<dl>
  <dt>Typescript</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/esw-web-app-example/tree/master/frontend/src/components/pages/RaDec.tsx#L6-L14" target="_blank" title="Go to snippet source">source</a><code class="language-tsx">export const RaDec = (): JSX.Element =&gt; {
  const [reload, setReload] = useState&lt;boolean&gt;(false)
  return (
    &lt;&gt;
      &lt;RaDecInput reload={reload} setReload={setReload} /&gt;
      &lt;RaDecTable reload={reload} /&gt;
    &lt;/&gt;
  )
}</code></pre></dd>
</dl>
<p>Next, we need to show our newly created <code>RaDec</code> component.</p>
<p>Update the <code>Routes.tsx</code> file and delete references to deleted files and their routes, and map our newly created <code>RaDec</code> component to the <code>/</code> path.</p>
<dl>
  <dt>Typescript</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/esw-web-app-example/tree/master/frontend/src/routes/Routes.tsx#L12" target="_blank" title="Go to snippet source">source</a><code class="language-tsx">&lt;Route path=&#39;/&#39; element={&lt;RaDec /&gt;} /&gt;</code></pre></dd>
</dl>
<p>Now, we need a link to let the user navigate to the RA/Dec form from different parts of the application.</p>
<p>Update <code>MenuBar.tsx</code> and delete the existing <code>Menu</code> and its <code>Menu.Item</code>. Add our menu item.</p>
<dl>
  <dt>Typescript</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/tmtsoftware/esw-web-app-example/tree/master/frontend/src/components/menu/MenuBar.tsx#L18-L32" target="_blank" title="Go to snippet source">source</a><code class="language-tsx">&lt;Menu mode=&#39;horizontal&#39;&gt;
  &lt;Menu.Item key=&#39;raDec&#39;&gt;
    &lt;Link to=&#39;/&#39;&gt;RaDec&lt;/Link&gt;
  &lt;/Menu.Item&gt;
&lt;/Menu&gt;</code></pre></dd>
</dl>
<p>Now, we have linked all pieces of our frontend application.</p>
<pre class="prettyprint"><code class="language-bash">$:sample-frontend&gt; npm start
</code></pre>
<p>It will launch application in your default browser with an input form.</p>
<ul>
  <li>Add a value like &lsquo;2.13&rsquo; and &lsquo;2.18&rsquo; and click Submit.</li>
  <li>You will see the formatted RA and Dec values in the table below the input form.</li>
</ul>
<p>To build the application for its production deployment, use the npm command:</p>
<pre class="prettyprint"><code class="language-bash">$:sample-frontend&gt; npm run build
</code></pre>
<p>This will create a <code>dist</code> folder with all the necessary class files to run the application, which can be copied to the production web server for deployment.</p>
</div>
<div>
<a href="https://github.com/tmtsoftware/esw-web-app-example/tree/master/docs/src/main/flows/base-flow.md" title="Edit this page" class="md-source-file md-edit">
Edit this page
</a>
</div>
<div class="print-only">
<span class="md-source-file md-version">
0.1.0*
</span>
</div>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-nav">
<nav class="md-footer-nav__inner md-grid">
<a href="../index.html" title="ESW Web Application Tutorial" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
</div>
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Previous
</span>
ESW Web Application Tutorial
</span>
</div>
</a>
<a href="../flows/auth-flow.html" title="Adding Authentication" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Next
</span>
Adding Authentication
</span>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
</div>
</a>
</nav>
</div>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
Powered by
<a href="https://github.com/lightbend/paradox">Paradox</a>
and
<a href="https://jonas.github.io/paradox-material-theme/">Paradox Material Theme</a>

</div>
</div>
</div>
</footer>

</div>
<script src="../assets/javascripts/application.583bbe55.js"></script>
<script src="../assets/javascripts/paradox-material-theme.js"></script>
<script>app.initialize({version:"0.17",url:{base:"../."}})</script>
<script type="text/javascript" src="../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function(event) {
window.prettyPrint && prettyPrint();
});
</script>
</body>
</html>
